<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>TryHackMe Man in the Middle Detection | Classroom</title><link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon><meta name=author content="Animesh Roy @anir0y  "><meta name=description content="Try Hack Me Room Man-in-the-Middle Detection solved by Animesh Roy. This is a walkthrough; read more..."><title>Animesh Roy | Classroom Posts</title><meta name=title content="Animesh Roy | Blogs & Writeups"><meta name=description content="Animesh Roy has more than a decade worth experience working in cyber security domain. He has worked with governments, corporates, colleges and universities, defence, and the community. He also running a community “Arishti Live” to help everyone who wants to, or work in cyber security domain. His expertise on training & consulting are the best of both the world. He uses his real-life case studies in trainings, to help candidates to understand the job in better ways."><script async src="https://www.googletagmanager.com/gtag/js?id=G-SPD6BXK0P5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SPD6BXK0P5")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","it10lq8bk1")</script><meta property="og:type" content="website"><meta property="og:url" content="https://classroom.anir0y.in/"><meta property="og:title" content="Animesh Roy | Blogs & Writeups"><meta property="og:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="og:image" content="https://i.imgur.com/Ji5C41H.png"><script type=text/javascript src=//cdn.cookie-script.com/s/88cd00f83ae38d0239d06996b1ad293a.js></script><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://classroom.anir0y.in/post/thm-man-in-the-middle-detection/"><meta property="twitter:title" content="Animesh Roy | Blogs & Writeups"><meta property="twitter:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="twitter:image" content="https://i.imgur.com/Ji5C41H.png"><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link rel=canonical href=https://classroom.anir0y.in/post/thm-man-in-the-middle-detection/><meta property="og:url" content="https://classroom.anir0y.in/post/thm-man-in-the-middle-detection/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="TryHackMe Man in the Middle Detection"><meta property="og:description" content="Try Hack Me Room Man-in-the-Middle Detection solved by Animesh Roy. This is a walkthrough; read more..."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-10-13T10:46:19+05:30"><meta property="article:modified_time" content="2025-10-13T10:46:19+05:30"><meta property="article:tag" content="Tryhackme"><meta property="article:tag" content="Man-in-the-Middle"><meta name=twitter:card content="summary"><meta name=twitter:title content="TryHackMe Man in the Middle Detection"><meta name=twitter:description content="Try Hack Me Room Man-in-the-Middle Detection solved by Animesh Roy. This is a walkthrough; read more..."><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><link rel=stylesheet href=/css/custom.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i></div><div class=item><i class="large link home icon" title=Home onclick='window.location.href="https://classroom.anir0y.in/"'></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment toc"><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#task-01-introduction>Task 01: Introduction</a></li><li><a href=#task-02-lab-connection>Task 02: Lab Connection</a><ul><li><a href=#scenario>Scenario</a></li><li><a href=#important-note>Important Note</a></li></ul></li><li><a href=#task-03-mitm-attack-an-overview>Task 03: MITM Attack: An Overview</a><ul><li><a href=#how-mitm-attacks-work>How MITM Attacks Work</a></li><li><a href=#common-types-of-mitm-attacks>Common Types of MITM Attacks</a></li><li><a href=#mitm-and-cyber-kill-chain>MITM and Cyber Kill Chain</a></li><li><a href=#situating-mitm-within-the-cyber-kill-chain>Situating MITM within the Cyber Kill Chain</a></li></ul></li><li><a href=#task-04-detecting-arp-spoofing>Task 04: Detecting ARP Spoofing</a><ul><li><a href=#arp-protocol>ARP Protocol</a></li><li><a href=#arp-spoofing>ARP Spoofing</a></li><li><a href=#why-arp-spoofing-works>Why ARP Spoofing Works</a></li><li><a href=#indicators-of-the-attack>Indicators of the Attack</a></li><li><a href=#network-information>Network Information</a></li><li><a href=#network-traffic-analysis>Network Traffic Analysis</a></li><li><a href=#narrowing-down-arp-traffic>Narrowing down ARP traffic</a></li><li><a href=#arp-requests>ARP Requests</a></li><li><a href=#arp-response>ARP Response</a></li><li><a href=#gratuitous-arp-responses>Gratuitous ARP Responses</a></li><li><a href=#arp-traffic-associated-with-the-gateway>ARP traffic associated with the Gateway</a></li><li><a href=#examining-the-suspicious-mac-address>Examining the suspicious MAC address</a></li><li><a href=#check-for-duplicate-ip-to-mac-mappings>Check for Duplicate IP-to-MAC Mappings</a></li><li><a href=#answer-the-questions-below>Answer the questions below</a></li></ul></li><li><a href=#task-05-unmasking-dns-spoofing>Task 05: Unmasking DNS Spoofing</a><ul><li></li><li><a href=#answer-the-questions-below-1>Answer the questions below</a></li></ul></li><li><a href=#task-06-spotting-ssl-stripping-in-action>Task 06: Spotting SSL Stripping in Action</a><ul><li></li><li><a href=#task-06-answer-the-questions-below>Task 06: Answer the questions below</a></li></ul></li><li><a href=#task-07-conclusion>Task 07: Conclusion</a></li></ul></nav></div><div class="ui segment actions"><button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i>
</button>
<a href="https://twitter.com/intent/tweet?text=TryHackMe%20Man%20in%20the%20Middle%20Detection&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-man-in-the-middle-detection%2f" class="ui circular twitter icon button"><i class="twitter icon"></i>
</a><a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-man-in-the-middle-detection%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui top attached segment"><header><h1 class="ui large header">TryHackMe Man in the Middle Detection<div class="sub header">@
<a href=https://bit.ly/34sGFiK target=_blank>Animesh Roy</a>
|
Monday, Oct 13, 2025
| 16 minutes read
| Update at
Monday, Oct 13, 2025</div></h1></header><article class=main><h2 id=overview>Overview</h2><blockquote><p>My View: Lab is well designed and informative; I loved it while solving the challenge.</p></blockquote><table><thead><tr><th><script src=https://tryhackme.com/badge/434937></script></th><th><a class=twitter-follow-button href=https://twitter.com/anir0y data-size=large>Follow @anir0y<a></th></tr></thead><tbody></tbody></table><h2 id=task-01-introduction>Task 01: Introduction</h2><p><strong>Learning Objectives</strong></p><p>This room focuses on the following learning objectives:</p><ul><li>Understand common MITM attack vectors and techniques</li><li>Learn to identify indicators of compromise related to MITM attacks</li><li>Master network monitoring tools for detecting suspicious traffic patterns</li><li>Practice incident response procedures for MITM scenarios</li></ul><h2 id=task-02-lab-connection>Task 02: Lab Connection</h2><h3 id=scenario>Scenario</h3><p>A routine network monitoring alert at Acme Corp revealed unusual traffic patterns suggesting a possible Man-in-the-Middle (MITM) attack inside the corporate LAN. Over several days, an attacker quietly intercepted communications, redirected connections, and captured user credentials.
In this room, you’ll step into the role of a SOC Analyst investigating this incident. Using the provided packet capture and logs, you’ll uncover evidence of three chained MITM techniques.</p><ul><li>ARP Spoofing (network interception).</li><li>DNS Spoofing (redirection).</li><li>SSL Stripping (credential capture).</li></ul><h3 id=important-note>Important Note</h3><blockquote><p><strong>Important Note:</strong> To accomplish this room, we will be relying on the network traffic provided in the mitm folder on the Desktop. However, there are other ways to also examine and complete the room.</p></blockquote><blockquote><p>A complete log file named mitm_attack.log, containing the entire attack chain, is placed in the same folder. Same logs are ingested into Splunk, which can be accessed at <code>MACHINE_IP:8000</code>, and the logs are ingested into <code>index=network_logs</code>.</p></blockquote><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759728313774.png alt=splunkimg></p><h2 id=task-03-mitm-attack-an-overview>Task 03: MITM Attack: An Overview</h2><p>A Man-in-the-Middle (MITM) attack is a cyberattack where an attacker secretly intercepts and potentially alters communication between two parties, such as a user and a service, without their knowledge. The attacker may eavesdrop to steal sensitive data like credentials and credit card info or inject malicious content. These attacks can target any organization or individual, especially where encryption or authentication is weak.</p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759866809717.png alt=mitm></p><h3 id=how-mitm-attacks-work>How MITM Attacks Work</h3><p>MITM attacks generally involve two main steps:</p><ul><li>Interception: The attacker inserts themselves into a communication stream, often by exploiting weaknesses in network protocols or by using techniques like ARP, DNS, or IP spoofing.</li><li>Manipulation/Decryption: The attacker tries to access or modify the communication, decrypting encoded data or injecting harmful content, such as altered website responses or fake login forms</li></ul><h3 id=common-types-of-mitm-attacks>Common Types of MITM Attacks</h3><ul><li>Packet sniffing: Capturing unencrypted data packets exchanged over a network, often on open Wi-Fi.</li><li>Session hijacking: Stealing and using session tokens to impersonate users.</li><li>SSL stripping: Downgrading HTTPS connections to insecure HTTP to steal or alter data transferred.</li><li>DNS spoofing: Redirecting legitimate website traffic to fraudulent domains by manipulating DNS responses.</li><li>IP spoofing: Crafting malicious IP packets that appear to come from trusted systems.</li><li>Rogue Wi-Fi access point: Creating fake networks to intercept user traffic.</li></ul><h3 id=mitm-and-cyber-kill-chain>MITM and Cyber Kill Chain</h3><p>To effectively analyze and respond to security events, an analyst must contextualize alerts within a broader model of adversary operations. Isolated indicators gain significance when mapped to the attacker&rsquo;s Tactics, Techniques, and Procedures (TTPs). A widely adopted model for this is the Cyber Kill Chain, a framework that sequences the typical stages of an advanced cyber intrusion.</p><p>The framework consists of seven distinct phases:</p><ul><li>Reconnaissance: The adversary gathers intelligence on the target to identify vulnerabilities.</li><li>Weaponization: The adversary couples an exploit with a malicious payload into a deliverable package.</li><li>Delivery: The adversary transmits the weaponized package to the targeted environment.</li><li>Exploitation: The adversary&rsquo;s code is triggered, and it takes advantage of a software, hardware, or human vulnerability to gain initial access.</li><li>Installation: The adversary installs malware or establishes a persistent backdoor on the compromised asset.</li><li>Command & Control (C2): The adversary establishes a covert channel to communicate with and control the compromised asset.</li><li>Actions on Objectives: The adversary executes their ultimate goals, such as data exfiltration, destruction, or lateral movement.</li></ul><h3 id=situating-mitm-within-the-cyber-kill-chain>Situating MITM within the Cyber Kill Chain</h3><p>Man-in-the-Middle is a versatile technique that adversaries primarily leverage during the Exploitation and Installation phases.</p><ul><li><p>As an Exploitation Technique: A MITM attack exploits the inherent trust and design limitations of core network protocols like ARP and DNS. By manipulating these protocols, an attacker can intercept a communication channel. This act of session interception is a form of exploitation, as it violates the integrity of the network and provides the adversary with their initial foothold for eavesdropping or active manipulation.</p></li><li><p>As an Installation Vector: Once an attacker has successfully established a MITM position, they control the data stream and can use it as a delivery mechanism for malicious payloads. For example, an attacker can inject a browser exploit, a malware dropper, or a remote access trojan (RAT) into legitimate, unencrypted downloads. This action corresponds to the Installation phase, where the adversary establishes persistence or deploys additional malicious tools onto the victim&rsquo;s system.
Detecting an MITM attack is a critical finding. It signifies that an adversary is actively engaged in the middle stages of an intrusion, presenting a crucial opportunity for the SOC to intervene and disrupt the attack chain before the final objectives are achieved.</p></li></ul><h2 id=task-04-detecting-arp-spoofing>Task 04: Detecting ARP Spoofing</h2><h3 id=arp-protocol>ARP Protocol</h3><p>ARP (Address Resolution Protocol) maps IP addresses to MAC addresses in a local network. When a device wants to send data to another IP, it first asks: &ldquo;Who has this IP?” The correct device replies with its MAC address.</p><h3 id=arp-spoofing>ARP Spoofing</h3><p>In ARP spoofing, an attacker sends fake ARP replies to trick devices into associating the attacker’s MAC address with a legitimate IP, usually the default gateway. This allows the attacker to intercept, modify, or redirect traffic.</p><h3 id=why-arp-spoofing-works>Why ARP Spoofing Works</h3><p>ARP has no authentication. Any device can send unsolicited <code>is-at</code> messages. An attacker exploits this vulnerability by sending fake ARP replies to victims and gateways:</p><ul><li><code>192.16.10.100</code> is at <code>02:fe:BB:cd :55:55</code> attacker claims to be the gateway.</li></ul><p><strong>Results:</strong></p><ul><li>The Victim&rsquo;s ARP cache becomes poisoned.</li><li>All traffic intended for the gateway flows through the attacker first (MITM).</li></ul><h3 id=indicators-of-the-attack>Indicators of the Attack</h3><p>We can look for the following key indicators while investigating the logs or network traffic for a potential Man-in-the-Middle attack using ARP spoofing.</p><ul><li>Duplicate MAC-to-IP Mappings: Multiple MAC addresses claiming the same IP address. Indicates impersonation.</li><li>Unsolicited ARP Replies: High number of ARP replies without matching requests (&ldquo;gratuitous ARP&rdquo;).</li><li>Abnormal ARP Traffic Volume: A Large number of ARP packets in short intervals.</li><li>Unusual Traffic Routing: Traffic rerouted through the attacker’s MAC.</li><li>Gateway Redirection Patterns: Multiple destination MACs for the same gateway IP.</li><li>ARP Probe / Reply Loops: Many ARP requests with Who has 192.168.1.x? Tell 192.168.1.y patterns</li></ul><h3 id=network-information>Network Information</h3><p>For the case investigated, we have the following information about the network:</p><table><thead><tr><th>Role</th><th>IP</th><th>MAC</th><th>Notes</th></tr></thead><tbody><tr><td>Gateway</td><td>192.168.10.1</td><td>-</td><td>Legit router</td></tr><tr><td>Attacker</td><td>-</td><td>-</td><td>-</td></tr><tr><td>Victim</td><td>-</td><td>-</td><td>-</td></tr><tr><td>Domain</td><td>corp-login.acme-corp.local</td><td>-</td><td></td></tr></tbody></table><h3 id=network-traffic-analysis>Network Traffic Analysis</h3><p>Let’s begin our investigation by examining the ARP traffic and seeing how we can identify and detect ARP spoofing in the network traffic. Open up the <code>network-traffic.pcap</code> placed at the <code>mitm_traffic</code> folder on the Desktop, and follow the steps mentioned below:</p><h3 id=narrowing-down-arp-traffic>Narrowing down ARP traffic</h3><p>As the ARP is the protocol of interest, we can start by isolating it using the following filter. This will allow us to inspect requests/replies and notice abnormal volume or patterns.</p><p><strong>Filter:</strong> <code>arp</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759721627827.png alt=arp></p><p>You’ll see requests and replies (<code>who-has</code> and <code>is-at</code>) pointing to both ARP requests and responses. We can examine the results for any abnormal and repeated requests or responses.</p><p><strong>Important Note</strong>: Press CTRL + ALT + 1 to fix the time displayed</p><h3 id=arp-requests>ARP Requests</h3><p>Let&rsquo;s look at the ARP requests, as shown below.</p><p><strong>Filter:</strong> <code>arp.opcode == 1</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759721650230.png alt="arp.opcode == 1"></p><p>This shows all the ARP requests captured from different hosts.</p><h3 id=arp-response>ARP Response</h3><p>Forged ARP poisoning typically uses unsolicited <code>is-at</code> replies (gratuitous/unasked replies). These are strong indicators. Let&rsquo;s look at the ARP response, as shown below:</p><p><strong>Filter:</strong> <code>arp.opcode == 2</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759721672516.png alt="arp.opcode == 2"></p><p>This filter displays ARP responses from various hosts. Examining these closely reveals multiple responses, including gratuitous ones. Legitimate replies typically correspond to recent &ldquo;who-has&rdquo; requests. Suspicious activity is indicated by numerous replies with no visible requests or repeated advertisements of the same IP address from a suspicious MAC address.</p><h3 id=gratuitous-arp-responses>Gratuitous ARP Responses</h3><p>A suspicious host sends many unsolicited (gratuitous) ARP replies, especially to multiple destinations. Repeated gratuitous ARPs can indicate an attacker maintaining their poison state. We can also filter on the gratuitous packets, as shown below:</p><p><strong>Filter:</strong> <code>arp.isgratuitous</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759721798929.png alt=arp.isgratuitous></p><h3 id=arp-traffic-associated-with-the-gateway>ARP traffic associated with the Gateway</h3><p>We have the information about the IP and the MAC address associated with the gateway. Let&rsquo;s apply the following filter to examine the ARP traffic associated with the gateway, as shown below:</p><p><strong>Filter:</strong> <code>arp && arp.src.proto_ipv4 == 192.168.10.1 && eth.src == 02:aa:bb:cc:00:01</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759771248599.png alt="arp && arp.src.proto_ipv4 == 192.168.10.1 && eth.src == 02:aa:bb:cc:00:0"></p><p>Looking at the output, we can see only the ARP responses. Let&rsquo;s now narrow down on the Gateway IP to further probe about the MAC addresses associated with the IP, using the following filter as shown below:</p><p><strong>Filter:</strong> <code>arp.opcode == 2 && arp.src.proto_ipv4 == 192.168.10.1</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759771696260.png alt="arp.opcode == 2 && arp.src.proto_ipv4 == 192.168.10.1"></p><p>This output looks interesting. Looking closely, we see some ARP replies pointing the Gateway&rsquo;s IP to the suspicious MAC address. The frequency of these ARP replies indicates that this is indeed an ARP spoofing. Let&rsquo;s confirm by applying another filter, as shown below:</p><p><strong>Filter:</strong> <code>arp.opcode == 2 && _ws.col.info contains "192.168.10.1 is at"</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759772377568.png alt="arp.opcode ==2 && _ws.col.info contains &ldquo;192.168.10.1 is at&rdquo;"></p><p>This filter has two parts. The first part focuses on the ARP responses and the second part <code>_ws.col.info contains "192.168.10.1 is at"</code> filters on the content shown in the information column. This filters out the ARP responses, which are pointing the Gateway&rsquo;s IP 192.168.10.1 to the MAC address. But if we look closely, we can see that the attacker uses ARP spoofing to tell the IP to its MAC address. We can also use this filter <code>arp.opcode == 2 && arp.src.proto_ipv4 == 192.168.10.1</code>, which shows the same result.</p><h3 id=examining-the-suspicious-mac-address>Examining the suspicious MAC address</h3><p>Now that we have identified ARP spoofing in action, let&rsquo;s narrow down on the attacker&rsquo;s MAC address that has associated itself with the Gateway&rsquo;s IP address, using the following filter:</p><p><strong>Filter:</strong> <code>arp.opcode == 2 && arp.src.proto_ipv4 == 192.168.10.1 && eth.src == 02:fe[REDACTED]</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759721746435.png alt="Examining the suspicious MAC address"></p><h3 id=check-for-duplicate-ip-to-mac-mappings>Check for Duplicate IP-to-MAC Mappings</h3><p>The last thing we can check and confirm is by filtering on the Check for duplicate MAC address mappings to a single IP address.</p><p><strong>Filter:</strong> <code>arp.duplicate-address-detected || arp.duplicate-address-frame</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759841349525.png alt=img></p><p>This result indicates that the attacker successfully performed ARP spoofing and positioned himself between the victim and the gateway. Let&rsquo;s move on to the next task and examine how the attacker could perform a DNS spoofing attack to get the redirection.</p><h3 id=answer-the-questions-below>Answer the questions below</h3><h4 id=how-many-arp-packets-from-the-gateway-mac-address-were-observed>How many ARP packets from the gateway MAC Address were observed?</h4><blockquote><p><code>arp && arp.src.proto_ipv4 == 192.168.10.1 && eth.src == 02:aa:bb:cc:00:01</code></p></blockquote><p><img src=https://raw.githubusercontent.com/anir0y/cdn/refs/heads/main/Screenshot%202025-10-13%20at%2011.19.07.png alt=img></p><h4 id=what-mac-address-was-used-by-the-attacker-to-impersonate-the-gateway>What MAC address was used by the attacker to impersonate the gateway?</h4><blockquote><p>arp.duplicate-address-detected || arp.duplicate-address-frame</p></blockquote><p><img src=https://raw.githubusercontent.com/anir0y/cdn/refs/heads/main/Screenshot%202025-10-13%20at%2011.24.42.png alt="What MAC address was used by the attacker to impersonate the gateway"></p><h4 id=how-many-gratuitous-arp-replies-were-observed-for-192168101>How many Gratuitous ARP replies were observed for 192.168.10.1?</h4><blockquote><p>arp.isgratuitous && arp.src.proto_ipv4 == 192.168.10.1</p></blockquote><p><img src=https://raw.githubusercontent.com/anir0y/cdn/refs/heads/main/Screenshot%202025-10-13%20at%2011.31.19.png alt="How many Gratuitous ARP replies were observed for 192.168.10.1"></p><h4 id=how-many-unique-mac-addresses-claimed-the-same-ip-192168101>How many unique MAC addresses claimed the same IP (192.168.10.1)?</h4><blockquote><p>arp.opcode==2 && _ws.col.info contains &ldquo;192.168.10.1 is at&rdquo;</p></blockquote><h4 id=how-many-arp-spoofing-packets-were-observed-in-total-from-the-attacker>How many ARP spoofing packets were observed in total from the attacker?</h4><blockquote><p>arp.opcode == 2 && arp.src.proto_ipv4 == 192.168.10.1 && eth.src == 02:fe:fe:fe:55:55</p></blockquote><p><img src=https://raw.githubusercontent.com/anir0y/cdn/refs/heads/main/Screenshot%202025-10-13%20at%2011.37.50.png alt="How many ARP spoofing packets were observed in total from the attacker?"></p><h2 id=task-05-unmasking-dns-spoofing>Task 05: Unmasking DNS Spoofing</h2><h4 id=dns-protocol-simplified>DNS Protocol Simplified</h4><p>First, let&rsquo;s understand DNS. Think of it as your phone&rsquo;s contact list. You don&rsquo;t remember your friends&rsquo; phone numbers; you tap on their names. Similarly, DNS translates human-friendly website names (like <a href=https://www.google.com>www.google.com</a>) into computer-friendly IP addresses.</p><p>DNS Spoofing (or DNS Cache Poisoning) is when an attacker corrupts this system. They give your computer the wrong &ldquo;phone number&rdquo; for a website you&rsquo;re trying to visit.</p><p>This is a powerful technique for launching a Man-in-the-Middle (MITM) attack. Here&rsquo;s how it works:</p><ul><li>The Victim tries to visit their bank at <code>my-real-bank.com</code>.</li><li>The Attacker, who is already on the local network (perhaps via ARP spoofing), intercepts the victim&rsquo;s DNS query.</li><li>The Spoof: The attacker quickly sends a fake DNS response to the victim. This fake response says, <code>my-real-bank.com</code> is at my IP address: <code>ATTACKER_IP</code>.</li><li>The Interception: The victim&rsquo;s computer trusts this fake response and saves it in its DNS cache. When the victim tries to connect to their bank, they unknowingly connect directly to the attacker&rsquo;s server, which might host a perfect replica of the real banking site.
The attacker is now <code>in the middle</code>, capturing everything the victim types, including their username and password.</li></ul><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759866941679.png alt=mitm-dns></p><h4 id=indicators-of-the-attack-1>Indicators of the Attack</h4><p>We can look for the following key indicators while investigating the logs or network traffic for a potential Man-in-the-Middle attack using DNS spoofing.</p><ul><li>Multiple DNS responses for the same query: A legitimate resolver and a forged responder reply to the same query. This is the single most reliable indicator.</li><li>DNS response from an unexpected source: A DNS reply arrives from an IP address that does not match any configured resolver (like 8.8.8.8 or your DNS server).</li><li>Suspiciously short TTL (Time-To-Live) values: Attackers use very low TTLs (1 - 30s) to keep poisoned entries short-lived and reassert control.</li><li>Unsolicited DNS responses: A DNS reply appears without a corresponding DNS request from the victim.</li></ul><h4 id=network-traffic-analysis-1>Network Traffic Analysis</h4><p>Let’s begin our investigation by examining the DNS traffic and how we can identify and detect DNS spoofing in the network traffic. Open up the <code>network-traffic.pcap</code> placed at the <code>mitm_traffic</code> folder on the Desktop, and follow the steps mentioned below:</p><h4 id=narrowing-down-dns-traffic>Narrowing down DNS traffic</h4><p>As the DNS is the protocol of interest, we can start by isolating it using the following filter. This will allow us to inspect requests/replies and notice abnormal volume or patterns.</p><p><strong>Filter:</strong> <code>dns</code></p><p>The output contains both the DNS requests and corresponding responses.</p><h4 id=filtering-on-legit-traffic>Filtering on Legit traffic</h4><p>Legitimate DNS servers (like Google’s 8.8.8.8) respond from a known external IP address. By filtering responses from this IP, we can see what normal answers look like for comparison.</p><p><strong>Filter:</strong> <code>dns.flags.response == 1 && ip.src == 8.8.8.8</code>
The result shows valid DNS replies from the legitimate DNS server.</p><h4 id=examine-dns-responses>Examine DNS Responses</h4><p>Let&rsquo;s look at the DNS responses, using the filter below.</p><p><strong>Filter:</strong> <code>dns.flags.response==1</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759854528899.png alt="malicious dns"></p><p>In the output, we can hunt for responses from IP addresses other than the usual DNS server. Looking closely, we find one DNS response from an IP other than 8.8.8.8. This is an interesting find. Though we have discovered an odd DNS request indicating a potential DNS spoofing attempt, we will note this and return to it later.</p><h4 id=dns-response-from-dns-server>DNS response from DNS Server</h4><p>The following filter will show the DNS responses from the DNS server.</p><p><strong>Filter:</strong> <code>dns.flags.response == 1 && ip.src == 8.8.8.8</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759723160288.png alt=dns.flags.response></p><h4 id=dns-request-for-our-domain>DNS request for our Domain</h4><p>Let&rsquo;s now take a curious look at the DNS traffic for our domain of interest, corp-login.acme-corp.local, using the following filter:</p><p><strong>Filter:</strong> <code>dns && dns.qry.name == "corp-login.acme-corp.local"</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759723059132.png alt=DNS></p><p>Let&rsquo;s now filter on the DNS request for our domain of interest, originating from the DNS server, using the filter, as shown below:</p><p><strong>Filter:</strong> <code>dns.flags.response == 1 && ip.src == 8.8.8.8 && dns.qry.name == "corp-login.acme-corp.local"</code>
<img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759723301205.png alt=img></p><p>The output also looks very much normal, as expected.</p><h4 id=dns-responses-other-than-the-dns-server>DNS responses other than the DNS Server.</h4><p>In the previous results, we explored the DNS traffic originating from the DNS servers for our domain of interest. Let&rsquo;s apply the following filter to see if any DNS requests are coming from servers other than the DNS server <code>8.8.8.8</code>:</p><p><strong>Filter:</strong> <code>dns.flags.response == 1 && ip.src != 8.8.8.8 && dns.qry.name == "corp-login.acme-corp.local"</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759722975158.png alt=img></p><h4 id=analysis-summary>Analysis Summary</h4><p>The analysis in the previous two tasks shows:</p><ul><li>A successful multi-stage Man-in-the-Middle attack where the attacker first poisoned the ARP mapping for the gateway (192.168.10.1)</li><li>Followed by the forged DNS replies for corp-login.acme-corp.local that redirected the victim to the attacker’s IP.</li></ul><p>Let&rsquo;s move on to the next task: understanding why SSL stripping is used and finding the evidence of SSL stripping that resulted in the victim&rsquo;s data theft.</p><h3 id=answer-the-questions-below-1>Answer the questions below</h3><h4 id=how-many-dns-responses-were-observed-for-the-domain-corp-loginacme-corplocal>How many DNS responses were observed for the domain corp-login.acme-corp.local?</h4><p><code>dns && dns.qry.name == "corp-login.acme-corp.local" && dns.flags.response == 1</code></p><p><img src=https://raw.githubusercontent.com/anir0y/cdn/refs/heads/main/Screenshot%202025-10-13%20at%2011.52.16.png alt="How many DNS responses were observed for the domain corp-login.acme-corp.local"></p><h4 id=how-many-dns-requests-were-observed-from-the-ips-other-than-8888>How many DNS requests were observed from the IPs other than 8.8.8.8?</h4><p><img src="https://github.com/anir0y/cdn/blob/main/Screenshot%202025-10-13%20at%2011.54.21.png?raw=true" alt="How many DNS requests were observed from the IPs other than 8.8.8.8?"></p><h4 id=what-ip-did-the-attackers-forged-dns-response-return-for-the-domain>What IP did the attacker’s forged DNS response return for the domain?</h4><p><code>192.168.10.55</code></p><p><img src="https://github.com/anir0y/cdn/blob/main/Screenshot%202025-10-13%20at%2011.54.21.png?raw=true" alt="What IP did the attacker’s forged DNS response return for the domain"></p><h2 id=task-06-spotting-ssl-stripping-in-action>Task 06: Spotting SSL Stripping in Action</h2><p>SSL stripping is a man-in-the-middle technique in which an attacker intercepts and modifies traffic to remove or prevent TLS encryption between a client and a server. This causes the client to communicate over HTTP instead of HTTPS. The attacker retains a secure (HTTPS) session with the server while relaying plain HTTP to the victim, enabling eavesdropping and credential capture.</p><h4 id=how-it-works>How It Works</h4><ul><li>The victim initiates an HTTPS request to a website.</li><li>The attacker intercepts the request using ARP spoofing or a rogue access point.</li><li>The attacker connects to the website over HTTPS but relays the response to the victim through HTTP.</li><li>The victim unknowingly interacts over HTTP, exposing sensitive data in plaintext</li></ul><h4 id=indicators-of-ssl-stripping>Indicators of SSL stripping</h4><ul><li>Initial Request vs. Response: The user&rsquo;s initial request may be for HTTPS (port 443), but the subsequent packets immediately shift to unencrypted HTTP (port 80) for the same domain.</li><li>Redirects/Link Rewriting: Monitoring for redirects (HTTP Status Codes 301, 302) that persistently direct an HTTPS request to an HTTP resource.</li><li>Certificate Errors: Although the attacker usually tries to hide this, the initial TLS/SSL Handshake may fail or display a self-signed certificate if the attacker uses a more direct proxying technique.</li></ul><h4 id=network-traffic-analysis-2>Network Traffic Analysis</h4><p>Let’s continue our investigation by examining the same network traffic. pcap file in Wireshark. In this task, we will look at SSL traffic and see if we can identify any of the indicators mentioned above.</p><h4 id=narrowing-down-ssl-traffic>Narrowing down SSL traffic</h4><p>For this task, HTTPS is the protocol of interest. We start by isolating it using the following filter. This will allow us to inspect SSL requests and notice abnormal volumes or patterns.</p><p><strong>Filter:</strong> <code>tls || ssl</code></p><blockquote><p>This filter will show all the traffic associated with SSL.</p></blockquote><h4 id=examine-the-ssl-traffic-of-our-server>Examine the SSL traffic of our Server.</h4><p>Let&rsquo;s apply the following filter to show the established TLS handshakes to our server, which proves the site normally uses TLS for communication.</p><p><strong>Filter:</strong> <code>tls.handshake.type == 1 && tls.handshake.extensions_server_name == "corp-login.acme-corp.local"</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759724449015.png alt=img></p><p>One of the key observations from the above output is the confirmation that the domain in question uses TLS for communication.</p><h4 id=show-dns-redirect-that-precedes-stripping>Show DNS redirect that precedes stripping.</h4><p>Our hypothesis about SSL stripping is that it is done after the attacker has successfully performed DNS spoofing, sending the victim to the attacker&rsquo;s IP. In the previous task, we identified the attacker&rsquo;s IP address performing the DNS spoofing. Let&rsquo;s isolate DNS responses from the attacker to show the victim was pointed to the attacker&rsquo;s IP, as shown below:</p><p><strong>Filter:</strong> <code>dns.flags.response == 1 && ip.src == 192.168.10.55 && dns.qry.name == "corp-login.acme-corp.local"</code></p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759862810108.png alt=img></p><h4 id=verify-tls-disappears>Verify TLS disappears</h4><p>One of the main indicators of SSL stripping is that, after the spoof, the domain no longer performs TLS handshakes to the legitimate server, which validates the absence of TLS traffic from the victim to the real server. Let&rsquo;s apply the following filter on the server IP and the attacker IP, as shown below:</p><p><strong>Filter:</strong> <code>http && ip.src == 192.168.10.10 && ip.dst == 192.168.10.55</code>
<img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759724655694.png alt=img></p><p>We can clearly see that the victim connected to the server after SSL stripping and logged in.</p><p><img src=https://tryhackme-images.s3.amazonaws.com/user-uploads/5e8dd9a4a45e18443162feab/room-content/5e8dd9a4a45e18443162feab-1759724796641.png alt=img></p><p>We can also identify the user&rsquo;s credentials in plaintext, which confirms that the attacker was able to obtain the victim&rsquo;s credentials. Though there are other SSL stripping indicators as well that we should be looking at. In this scenario, we only observed one indicator, where HTTPS traffic of our portal was stripped down to HTTP.</p><h3 id=task-06-answer-the-questions-below>Task 06: Answer the questions below</h3><h4 id=how-many-post-requests-were-observed-for-our-domain-corp-loginacme-corplocal>How many POST requests were observed for our domain corp-login.acme-corp.local?</h4><p><strong>Filter:</strong> <code>http.request.method == "POST"</code></p><p><img src="https://github.com/anir0y/cdn/blob/main/Screenshot%202025-10-13%20at%2012.01.12.png?raw=true" alt=img></p><h4 id=whats-the-password-of-the-victim-found-in-the-plaintext-after-successful-ssl-stripping-attack>What&rsquo;s the password of the victim found in the plaintext after successful ssl stripping attack.</h4><p>Use the same <code>http.request.method == "POST"</code> filter and read the packet data.</p><p><img src="https://github.com/anir0y/cdn/blob/main/Screenshot%202025-10-13%20at%2012.02.37.png?raw=true" alt=img></p><h2 id=task-07-conclusion>Task 07: Conclusion</h2><hr><blockquote><p>My View: Lab is well designed and informative; I loved it while solving the challenge.</p></blockquote><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=anir0y data-description="Support me on Buy me a coffee!" data-message data-color=#5F7FFF data-position=Right data-x_margin=18 data-y_margin=18></script></article></section></div></div><footer class="ui basic center aligned segment" style=background-color:initial><p>© 2010 - 2025 Classroom</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/img/avatar.jpeg></div><div class=content><h1 class="ui medium header">Reading Stuffs<div class="sub header"></div></h1><article class="ui horizontal list"><a class=item href=/categories><i class="th list icon" title="All Categories"></i>
</a><a class=item href=/tags><i class="tags icon" title="All Tags"></i></a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><h3 class="ui header">Social Links</h3><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:classroom@anir0y.in><i class="large mail icon" title=Email></i></a></div><div class=item><a href=https://twitter.com/anir0y target=_blank><i class="large twitter icon" title=Twitter></i></a></div><div class=item><a href=https://facebook.com/0xanir0y target=_blank><i class="large facebook icon" title=Facebook></i></a></div><div class=item><a href=https://instagram.com/0xanir0y target=_blank><i class="large instagram icon" title=Instagram></i></a></div><div class=item><a href=https://www.linkedin.com/in/anir0y target=_blank><i class="large linkedin icon" title=Linkedin></i></a></div><div class=item><a href=https://github.com/anir0y target=_blank><i class="large github icon" title=GitHub></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment">YOU CAN REUSE MY CONTENT</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(e,t,n){var o,i=e.getElementsByTagName(t)[0],s=window.twttr||{};return e.getElementById(n)?s:(o=e.createElement(t),o.id=n,o.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(o,i),s._e=[],s.ready=function(e){s._e.push(e)},s)}(document,"script","twitter-wjs"))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var e=localStore.getItem("hugo-theme-dream-is-dark"),e=e?e:window.defaultDark?"y":e,t="tomorrow",n="tomorrow-night",s=e==="y"?n:t;$("link[data-highlight]").attr("href","https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/"+s+".min.css"),$("pre").css("background",e==="y"?"#333":"")}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=Search></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON("https://classroom.anir0y.in//index.json",function(e){$(".ui.search").search({source:e,searchFields:["title"],showNoResults:!0})})})</script><script src=/js/search.js></script></body></html>