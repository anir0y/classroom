<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge">
<title>Try Hack Me Room Attacktivedirectory | Classroom</title>
<link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon>
<meta name=author content="Animesh Roy">
<meta name=description content="Try Hack Me Room Attacktive Directorysolved by Animesh Roy. this is a walkthough. read more...">
<title>Animesh Roy | Classroom Posts</title>
<meta name=title content="Animesh Roy | Blogs & Writeups">
<meta name=description content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training">
<meta property="og:type" content="website">
<meta property="og:url" content="https://classroom.anir0y.in/">
<meta property="og:title" content="Animesh Roy | Blogs & Writeups">
<meta property="og:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training">
<meta property="og:image" content="https://i.imgur.com/Ji5C41H.png">
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://classroom.anir0y.in/post/thm-room-attacktivedirectory/">
<meta property="twitter:title" content="Animesh Roy | Blogs & Writeups">
<meta property="twitter:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training">
<meta property="twitter:image" content="https://i.imgur.com/Ji5C41H.png">
<script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZBEX7RBNF"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NZBEX7RBNF')</script>
<script type=text/javascript>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","6gp5990ghr")</script>
<link rel=canonical href=https://classroom.anir0y.in/post/thm-room-attacktivedirectory/>
<meta property="og:title" content="Try Hack Me Room Attacktivedirectory">
<meta property="og:description" content="Try Hack Me Room Attacktive Directorysolved by Animesh Roy. this is a walkthough. read more...">
<meta property="og:type" content="article">
<meta property="og:url" content="https://classroom.anir0y.in/post/thm-room-attacktivedirectory/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2021-05-18T23:58:19+05:30">
<meta property="article:modified_time" content="2021-05-18T23:58:19+05:30">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Try Hack Me Room Attacktivedirectory">
<meta name=twitter:description content="Try Hack Me Room Attacktive Directorysolved by Animesh Roy. this is a walkthough. read more...">
<link rel=stylesheet href=/css/semantic.min.css>
<link rel=stylesheet href=/css/icomoon.css>
<link rel=stylesheet href=/css/OverlayScrollbars.min.css>
<link rel=stylesheet href=/css/github-markdown.css>
<link rel=stylesheet href=/css/site.css>
<link rel=stylesheet href=/css/custom.css>
<style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style>
<link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css>
<link rel=stylesheet href=/css/custom.css>
</head>
<body class=default>
<nav class="ui secondary menu dream-menu">
<div class=item>
<i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i>
</div>
<div class=item>
<i class="large link home icon" title=Home onclick="window.location.href='https://classroom.anir0y.in'"></i>
</div>
<div class=item>
<i class="large link icon theme-switch" onclick=themeSwitch()></i>
</div>
<div class=item>
<i class="large link search icon" onclick=toggleSearch()></i>
</div>
</nav>
<div class=flip-container>
<div class=flipper>
<section class=front>
<div class=dream-max-width>
<div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse>
<aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside">
<div class="ui segment toc">
<nav id=TableOfContents>
<ul>
<li><a href=#task-01-deploy-the-machine>Task 01: Deploy The Machine</a></li>
<li><a href=#task-02-setup>Task 02: Setup</a>
<ul>
<li><a href=#installing-bloodhound-and-neo4j>Installing Bloodhound and Neo4j</a></li>
<li><a href=#troubleshooting>Troubleshooting</a></li>
</ul>
</li>
<li><a href=#task-03-welcome-to-attacktive-directory>Task 03: Welcome to Attacktive Directory</a>
<ul>
<li><a href=#enumeration>Enumeration</a></li>
<li><a href=#flags-31>Flags 3.1</a></li>
<li><a href=#flags-32>Flags 3.2</a></li>
<li><a href=#flags-33>Flags 3.3</a></li>
</ul>
</li>
<li><a href=#task-04-enumerating-users-via-kerberos>Task 04: Enumerating Users via Kerberos</a>
<ul>
<li><a href=#introduction>Introduction:</a></li>
<li><a href=#enumeration-1>Enumeration:</a></li>
<li><a href=#flags-41>Flags 4.1</a></li>
<li><a href=#flag-42>Flag 4.2</a></li>
<li><a href=#flag-43>Flag 4.3</a></li>
</ul>
</li>
<li><a href=#task-05--abusing-kerberos>Task 05: Abusing Kerberos</a>
<ul>
<li><a href=#introduction-1>Introduction</a></li>
<li><a href=#retrieving-kerberos-tickets>Retrieving Kerberos Tickets</a></li>
<li><a href=#flags-51>Flags 5.1</a></li>
<li><a href=#flags-52--53>Flags 5.2 / 5.3</a></li>
<li><a href=#flags-54>Flags 5.4</a></li>
</ul>
</li>
<li><a href=#task-06-back-to-the-basics>Task 06: Back to the Basics</a>
<ul>
<li><a href=#enumeration-2>Enumeration:</a></li>
<li><a href=#flag-61>Flag 6.1</a></li>
<li><a href=#flag-62>Flag 6.2</a></li>
<li><a href=#flag-63>Flag 6.3</a></li>
<li><a href=#flag-64>Flag 6.4</a></li>
<li><a href=#flag-65>Flag 6.5</a></li>
<li><a href=#flag-66>Flag 6.6</a></li>
</ul>
</li>
<li><a href=#task-07-elevating-privileges-within-the-domain>Task 07: Elevating Privileges within the Domain</a>
<ul>
<li><a href=#lets-sync-up>Let&rsquo;s Sync Up!</a></li>
<li><a href=#flag-71>Flag 7.1</a></li>
<li><a href=#flag-72>Flag 7.2</a></li>
<li><a href=#flag-73>Flag 7.3</a></li>
<li><a href=#flag-74>Flag 7.4</a></li>
</ul>
</li>
<li><a href=#task-08-flag-submission-panel>Task 08: Flag Submission Panel</a>
<ul>
<li><a href=#flag-submission-panel>Flag Submission Panel</a></li>
<li><a href=#flags-task1>Flags Task.1</a></li>
<li><a href=#flags-task1-1>Flags Task.1</a></li>
<li><a href=#flags-task1-2>Flags Task.1</a></li>
</ul>
</li>
</ul>
</nav>
</div>
<div class="ui segment actions">
<button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i>
</button>
<a href="https://twitter.com/intent/tweet?text=Try%20Hack%20Me%20Room%20Attacktivedirectory&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-attacktivedirectory%2f" class="ui circular twitter icon button">
<i class="twitter icon"></i>
</a>
<a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-attacktivedirectory%2f" class="ui circular facebook icon button">
<i class="facebook icon"></i>
</a>
</div>
</aside>
<div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img>
<section class="ui top attached segment">
<header>
<h1 class="ui large header">Try Hack Me Room Attacktivedirectory<div class="sub header">
@
<a href=https://anir0y.in target=_blank>Animesh Roy</a>
|
Tuesday, May 18, 2021
| 6 minutes read
| Update at
Tuesday, May 18, 2021
</div>
</h1>
</header>
<article class=main><h1 id=attacktivedirectory>Attacktivedirectory</h1>
<table>
<thead>
<tr>
<th style=text-align:left>Profile</th>
<th style=text-align:right>Support</th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:left><script src=https://tryhackme.com/badge/434937></script></td>
<td style=text-align:right><a href=https://www.buymeacoffee.com/anir0y><img src="https://img.buymeacoffee.com/button-api/?text=Cheers!!!&emoji=🍺&slug=anir0y&button_colour=BD5FFF&font_colour=ffffff&font_family=Lato&outline_colour=000000&coffee_colour=FFDD00"></a></td>
</tr>
</tbody>
</table>
<script type=text/javascript language=javascript>var aax_size='300x250',aax_pubname='anir0y-21',aax_src='302'</script>
<script type=text/javascript language=javascript src=https://c.amazon-adsystem.com/aax2/assoc.js></script>
<h2 id=task-01-deploy-the-machine>Task 01: Deploy The Machine</h2>
<p>Walkthough how to access VM & Attacker VM</p>
<hr>
<h2 id=task-02-setup>Task 02: Setup</h2>
<p>Installing Impacket:</p>
<p>Whether you&rsquo;re on the Kali 2019.3 or Kali 2021.1, Impacket can be a pain to install correctly. Here&rsquo;s some instructions that may help you install it correctly!</p>
<p>First, you will need to clone the Impacket Github repo onto your box. The following command will clone Impacket into /opt/impacket:</p>
<p><code>git clone https://github.com/SecureAuthCorp/impacket.git /opt/impacket</code></p>
<p>After the repo is cloned, you will notice several install related files, requirements.txt, and setup.py. A commonly skipped file during the installation is setup.py, this actually installs Impacket onto your system so you can use it and not have to worry about any dependencies.</p>
<p>To install the Python requirements for Impacket:</p>
<p><code>pip3 install -r /opt/impacket/requirements.txt</code></p>
<p>Once the requirements have finished installing, we can then run the python setup install script:</p>
<p><code>cd /opt/impacket/ && python3 ./setup.py install</code></p>
<p>After that, Impacket should be correctly installed now and it should be ready to use!</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>sudo git clone https://github.com/SecureAuthCorp/impacket.git /opt/impacket
sudo pip3 install -r /opt/impacket/requirements.txt
sudo cd /opt/impacket/ 
sudo pip3 install .
sudo python3 setup.py install
</code></pre></div><h3 id=installing-bloodhound-and-neo4j>Installing Bloodhound and Neo4j</h3>
<p>Bloodhound is another tool that we&rsquo;ll be utilizing while attacking Attacktive Directory. We&rsquo;ll cover specifcs of the tool later, but for now, we need to install two packages with Apt, those being bloodhound and neo4j. You can install it with the following command:</p>
<p><code>apt install bloodhound neo4j</code></p>
<p>Now that it&rsquo;s done, you&rsquo;re ready to go1</p>
<h3 id=troubleshooting>Troubleshooting</h3>
<p>If you are having issues installing Bloodhound and Neo4j, try issuing the following command:</p>
<p><code>apt update && apt upgrade</code></p>
<hr>
<h2 id=task-03-welcome-to-attacktive-directory>Task 03: Welcome to Attacktive Directory</h2>
<h3 id=enumeration>Enumeration</h3>
<p>Basic enumeration starts out with an nmap scan. Nmap is a relatively complex utility that has been refined over the years to detect what ports are open on a device, what services are running, and even detect what operating system is running. It&rsquo;s important to note that not all services may be deteted correctly and not enumerated to it&rsquo;s fullest potential. Despite nmap being an overly complex utility, it cannot enumerate everything. Therefore after an initial nmap scan we&rsquo;ll be using other utilities to help us enumerate the services running on the device.</p>
<p><strong>Notes</strong>: Flags for each user account are available for submission. You can retrieve the flags for user accounts via RDP (Note: the login format is spookysec.local\User at the Window&rsquo;s login prompt) and Administrator via Evil-WinRM.</p>
<h3 id=flags-31>Flags 3.1</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>What tool will allow us to enumerate port 139/445?</td>
<td style=text-align:left><code>enum4linux</code></td>
</tr>
</tbody>
</table>
<h4 id=explanation>Explanation</h4>
<h3 id=flags-32>Flags 3.2</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>What is the NetBIOS-Domain Name of the machine?</td>
<td style=text-align:left><code>THM-**</code></td>
</tr>
</tbody>
</table>
<h4 id=explanation-1>Explanation</h4>
<p>NMAP <code>nmap -sC -sV [ip]</code> reveals the Name</p>
<h3 id=flags-33>Flags 3.3</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>What invalid TLD do people commonly use for their Active Directory Domain?</td>
<td style=text-align:left><code>.local</code></td>
</tr>
</tbody>
</table>
<h4 id=explanation-2>Explanation</h4>
<p>this is common practic we select <code>.local</code> as test environment.</p>
<hr>
<h2 id=task-04-enumerating-users-via-kerberos>Task 04: Enumerating Users via Kerberos</h2>
<h3 id=introduction>Introduction:</h3>
<p>A whole host of other services are running, including Kerberos. Kerberos is a key authentication service within Active Directory. With this port open, we can use a tool called <a href=https://github.com/ropnop/kerbrute/releases>Kerbrute</a> (by Ronnie Flathers @ropnop) to brute force discovery of users, passwords and even password spray!</p>
<h3 id=enumeration-1>Enumeration:</h3>
<p>For this box, a modified User List and Password List will be used to cut down on time of enumeration of users and password hash cracking. It is NOT recommended to brute force credentials due to account lockout policies that we cannot enumerate on the domain controller.</p>
<ul>
<li><a href=https://raw.githubusercontent.com/Sq00ky/attacktive-directory-tools/master/userlist.txt>userlist</a></li>
<li><a href=https://raw.githubusercontent.com/Sq00ky/attacktive-directory-tools/master/passwordlist.txt>passwordlist</a></li>
</ul>
<h3 id=flags-41>Flags 4.1</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>What command within Kerbrute will allow us to enumerate valid usernames?</td>
<td style=text-align:left><code>userenum</code></td>
</tr>
</tbody>
</table>
<h4 id=explanation-3>Explanation</h4>
<p>read this : <a href=https://github.com/ropnop/kerbrute>https://github.com/ropnop/kerbrute</a>
or just check the Help.</p>
<p><img src=https://i.imgur.com/YhbjhFc.png alt></p>
<h3 id=flag-42>Flag 4.2</h3>
<h3 id=flag-43>Flag 4.3</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>What notable account is discovered? (These should jump out at you)</td>
<td style=text-align:left><code>svc-admin</code></td>
</tr>
<tr>
<td style=text-align:center>What is the other notable account is discovered? (These should jump out at you)</td>
<td style=text-align:left><code>backup</code></td>
</tr>
</tbody>
</table>
<p><img src=https://i.imgur.com/6Zfhn8B.png alt></p>
<hr>
<h2 id=task-05--abusing-kerberos>Task 05: Abusing Kerberos</h2>
<h3 id=introduction-1>Introduction</h3>
<p>After the enumeration of user accounts is finished, we can attempt to abuse a feature within Kerberos with an attack method called ASREPRoasting. ASReproasting occurs when a user account has the privilege &ldquo;Does not require Pre-Authentication&rdquo; set. This means that the account does not need to provide valid identification before requesting a Kerberos Ticket on the specified user account.</p>
<h3 id=retrieving-kerberos-tickets>Retrieving Kerberos Tickets</h3>
<p><a href=https://github.com/SecureAuthCorp/impacket>Impacket</a> has a tool called &ldquo;GetNPUsers.py&rdquo; (located in impacket/examples/GetNPUsers.py) that will allow us to query ASReproastable accounts from the Key Distribution Center. The only thing that&rsquo;s necessary to query accounts is a valid set of usernames which we enumerated previously via Kerbrute.</p>
<h3 id=flags-51>Flags 5.1</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>We have two user accounts that we could potentially query a ticket from. Which user account can you query a ticket from with no password?</td>
<td style=text-align:left><code>svc-admin</code></td>
</tr>
</tbody>
</table>
<h4 id=explanation-4>Explanation</h4>
<p><img src=https://i.imgur.com/x0kxxqs.png alt></p>
<h3 id=flags-52--53>Flags 5.2 / 5.3</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>Looking at the Hashcat Examples Wiki page, what type of Kerberos hash did we retrieve from the KDC? (Specify the full name)</td>
<td style=text-align:left><code>Kerberos 5 AS-REP etype 23</code></td>
</tr>
<tr>
<td style=text-align:center>What mode is the hash?</td>
<td style=text-align:left>18200</td>
</tr>
</tbody>
</table>
<h4 id=explanation-5>Explanation</h4>
<p>Check out the site: <a href="https://hashcat.net/wiki/doku.php?id=example_hashes">https://hashcat.net/wiki/doku.php?id=example_hashes</a></p>
<p><img src=https://i.imgur.com/oG5Vju3.png alt></p>
<h3 id=flags-54>Flags 5.4</h3>
<table>
<thead>
<tr>
<th style=text-align:center></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td style=text-align:center>Now crack the hash with the modified password list provided, what is the user accounts password?</td>
<td style=text-align:left><code>management2005</code></td>
</tr>
</tbody>
</table>
<h4 id=explanation-6>Explanation</h4>
<p><img src=https://i.imgur.com/mgACreG.png alt></p>
<hr>
<h2 id=task-06-back-to-the-basics>Task 06: Back to the Basics</h2>
<h3 id=enumeration-2>Enumeration:</h3>
<p>With a user&rsquo;s account credentials we now have significantly more access within the domain. We can now attempt to enumerate any shares that the domain controller may be giving out.</p>
<h3 id=flag-61>Flag 6.1</h3>
<h4 id=using-utility-can-we-map-remote-smb-shares>Using utility can we map remote SMB shares?</h4>
<blockquote>
<p><code>Smbclient</code></p>
</blockquote>
<h3 id=flag-62>Flag 6.2</h3>
<h4 id=which-option-will-list-shares>Which option will list shares?</h4>
<blockquote>
<p><code>-l</code></p>
</blockquote>
<h3 id=flag-63>Flag 6.3</h3>
<h4 id=how-many-remote-shares-is-the-server-listing>How many remote shares is the server listing?</h4>
<blockquote>
<p><code>6</code></p>
</blockquote>
<h4 id=explanation-7>Explanation</h4>
<p><img src=https://i.imgur.com/c6iFnzO.png alt></p>
<h3 id=flag-64>Flag 6.4</h3>
<h4 id=there-is-one-particular-share-that-we-have-access-to-that-contains-a-text-file-which-share-is-it>There is one particular share that we have access to that contains a text file. Which share is it?</h4>
<blockquote>
<p><code>backup</code></p>
</blockquote>
<h4 id=explanation-8>Explanation</h4>
<p>run the command</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>└──╼ $smbclient <span style=color:#ae81ff>\\\\</span>10.10.8.212<span style=color:#ae81ff>\\</span>backup -U <span style=color:#e6db74>&#39;svc-admin%management2005&#39;</span>
Try <span style=color:#e6db74>&#34;help&#34;</span> to get a list of possible commands.
smb: <span style=color:#ae81ff>\&gt;</span> dir
  .                                   D        <span style=color:#ae81ff>0</span>  Sun Apr  <span style=color:#ae81ff>5</span> 00:38:39 <span style=color:#ae81ff>2020</span>
  ..                                  D        <span style=color:#ae81ff>0</span>  Sun Apr  <span style=color:#ae81ff>5</span> 00:38:39 <span style=color:#ae81ff>2020</span>
  fooo.txt              A       <span style=color:#ae81ff>48</span>  Sun Apr  <span style=color:#ae81ff>5</span> 00:38:53 <span style=color:#ae81ff>2020</span>

		<span style=color:#ae81ff>8247551</span> blocks of size 4096. <span style=color:#ae81ff>3632648</span> blocks available
smb: <span style=color:#ae81ff>\&gt;</span> 
</code></pre></div><h3 id=flag-65>Flag 6.5</h3>
<h4 id=what-is-the-content-of-the-file>What is the content of the file?</h4>
<h4 id=explanation-9>Explanation</h4>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>smb: <span style=color:#ae81ff>\&gt;</span> get backup_credentials.txt
getting file <span style=color:#ae81ff>\b</span>ackup_credentials.txt of size <span style=color:#ae81ff>48</span> as backup_credentials.txt <span style=color:#f92672>(</span>0.1 KiloBytes/sec<span style=color:#f92672>)</span> <span style=color:#f92672>(</span>average 0.1 KiloBytes/sec<span style=color:#f92672>)</span>
smb: <span style=color:#ae81ff>\&gt;</span> exit
┌─<span style=color:#f92672>[</span>mentor@attackerVM<span style=color:#f92672>]</span>─<span style=color:#f92672>[</span>~/thm/attacktivedirectory<span style=color:#f92672>]</span>
└──╼ $cat backup_credentials.txt 
YmFja3VwQHNwb29reXNlYy5sb2NhbDpiYWNrdXAyNTE3ODYw
</code></pre></div><h3 id=flag-66>Flag 6.6</h3>
<h4 id=decoding-the-contents-of-the-file-what-is-the-full-contents>Decoding the contents of the file, what is the full contents?</h4>
<blockquote>
<p><a href=mailto:backup@spookysec.local>backup@spookysec.local</a>:backup2517860</p>
</blockquote>
<h4 id=explanation-10>Explanation</h4>
<p>base64 decode</p>
<hr>
<h2 id=task-07-elevating-privileges-within-the-domain>Task 07: Elevating Privileges within the Domain</h2>
<h3 id=lets-sync-up>Let&rsquo;s Sync Up!</h3>
<p>Now that we have new user account credentials, we may have more privileges on the system than before. The username of the account &ldquo;backup&rdquo; gets us thinking. What is this the backup account to?</p>
<p>Well, it is the backup account for the Domain Controller. This account has a unique permission that allows all Active Directory changes to be synced with this user account. This includes password hashes</p>
<p><img src=https://blog.spookysec.net/img/dcsync.png alt></p>
<p>Knowing this, we can use another tool within Impacket called &ldquo;secretsdump.py&rdquo;. This will allow us to retrieve all of the password hashes that this user account (that is synced with the domain controller) has to offer. Exploiting this, we will effectively have full control over the AD Domain.</p>
<h3 id=flag-71>Flag 7.1</h3>
<h4 id=what-method-allowed-us-to-dump-ntdsdit>What method allowed us to dump NTDS.DIT?</h4>
<blockquote>
<p><code>DRSUAPI</code></p>
</blockquote>
<h4 id=explanation-11>Explanation</h4>
<p><img src=https://i.imgur.com/bD5Z10P.png alt></p>
<h3 id=flag-72>Flag 7.2</h3>
<h4 id=what-is-the-administrators-ntlm-hash>What is the Administrators NTLM hash?</h4>
<blockquote>
<p><code>0e0363213e37b94221497260erbcb4fc</code></p>
</blockquote>
<h4 id=explanation-12>Explanation</h4>
<p><img src=https://i.imgur.com/bD5Z10P.png alt></p>
<h3 id=flag-73>Flag 7.3</h3>
<h4 id=what-method-of-attack-could-allow-us-to-authenticate-as-the-user-without-the-password>What method of attack could allow us to authenticate as the user without the password?</h4>
<blockquote>
<p><code>Pass the Hash</code></p>
</blockquote>
<h3 id=flag-74>Flag 7.4</h3>
<h4 id=using-a-tool-called-evil-winrm-what-option-will-allow-us-to-use-a-hash>Using a tool called Evil-WinRM what option will allow us to use a hash?</h4>
<blockquote>
<p><code>-H</code></p>
</blockquote>
<h4 id=explanation-13>Explanation</h4>
<p><img src=https://i.imgur.com/ctRxPeL.png alt></p>
<hr>
<h2 id=task-08-flag-submission-panel>Task 08: Flag Submission Panel</h2>
<h3 id=flag-submission-panel>Flag Submission Panel</h3>
<p>Submit the flags for each user account. They can be located on each user&rsquo;s desktop.</p>
<h3 id=flags-task1>Flags Task.1</h3>
<h4 id=svc-admin>svc-admin</h4>
<blockquote>
<p><code>TryHackMe{K3rb3r0s_Pr3_4uth}</code></p>
</blockquote>
<h3 id=flags-task1-1>Flags Task.1</h3>
<h4 id=backup>backup</h4>
<blockquote>
<p><code>TryHackMe{B4ckM3UpSc0tty!}</code></p>
</blockquote>
<h3 id=flags-task1-2>Flags Task.1</h3>
<h4 id=administrator>Administrator</h4>
<blockquote>
<p><code>TryHackMe{4ctiveD1rectoryM4st3r}</code></p>
</blockquote>
<h4 id=explanation-14>Explanation</h4>
<p>Run <code>evil-winrm</code> with <code>administrator</code> hash and copy the flags</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>┌─<span style=color:#f92672>[</span>✗<span style=color:#f92672>]</span>─<span style=color:#f92672>[</span>mentor@attackerVM<span style=color:#f92672>]</span>─<span style=color:#f92672>[</span>~/thm/attacktivedirectory<span style=color:#f92672>]</span>
└──╼ $evil-winrm -i 10.10.8.212 -u administrator -H 0e0363213e37b94221497260b0bcb4fc
</code></pre></div><hr>
<script type=text/javascript language=javascript>var aax_size='300x250',aax_pubname='anir0y-21',aax_src='302'</script>
<script type=text/javascript language=javascript src=https://c.amazon-adsystem.com/aax2/assoc.js></script>
<hr>
</article>
</section>
</div>
</div>
<footer class="ui basic center aligned segment" style=background-color:transparent>
<p>© 2010 - 2022 Classroom</p>
</footer>
</div>
</section>
<section class=back>
<div class=dream-max-width>
<header class="ui basic very padded segment dream-header">
<div class="ui small circular image">
<img src=/img/avatar.jpeg>
</div>
<div class=content>
<h1 class="ui medium header">Classroom Notes & Blog Posts<div class="sub header"></div>
</h1>
<article class="ui horizontal list">
<a class=item href=/categories>
<i class="th list icon" title="All Categories"></i>
</a>
<a class=item href=/tags>
<i class="tags icon" title="All Tags"></i>
</a>
</article>
<article class=dream-tags>
<a class="ui label" href=/tags/agent-sudo/ title="Agent Sudo">
Agent Sudo
</a>
<a class="ui label" href=/tags/autopsy/ title=autopsy>
autopsy
</a>
<a class="ui label" href=/tags/backdoor/ title=backdoor>
backdoor
</a>
<a class="ui label" href=/tags/baron-samedit/ title="Baron Samedit">
Baron Samedit
</a>
<a class="ui label" href=/tags/bash/ title=bash>
bash
</a>
<a class="ui label" href=/tags/ceh0821/ title=ceh0821>
ceh0821
</a>
<a class="ui label" href=/tags/cheatsheet/ title=cheatsheet>
cheatsheet
</a>
<a class="ui label" href=/tags/config/ title=config>
config
</a>
<a class="ui label" href=/tags/couch/ title=couch>
couch
</a>
<a class="ui label" href=/tags/crisis/ title=Crisis>
Crisis
</a>
<a class="ui label" href=/tags/dominos/ title=dominos>
dominos
</a>
<a class="ui label" href=/tags/empire/ title=Empire>
Empire
</a>
<a class="ui label" href=/tags/encryption/ title=encryption>
encryption
</a>
<a class="ui label" href=/tags/ffuf/ title=ffuf>
ffuf
</a>
<a class="ui label" href=/tags/forensic/ title=forensic>
forensic
</a>
<a class="ui label" href=/tags/gitandcrumpets/ title=gitandcrumpets>
gitandcrumpets
</a>
<a class="ui label" href=/tags/gnupg/ title=gnupg>
gnupg
</a>
<a class="ui label" href=/tags/hackpark/ title=HackPark>
HackPark
</a>
<a class="ui label" href=/tags/hydra/ title=hydra>
hydra
</a>
<a class="ui label" href=/tags/inclusion/ title=inclusion>
inclusion
</a>
<a class="ui label" href=/tags/internal/ title=internal>
internal
</a>
<a class="ui label" href=/tags/internship/ title=Internship>
Internship
</a>
<a class="ui label" href=/tags/interview/ title=interview>
interview
</a>
<a class="ui label" href=/tags/kenobi/ title=kenobi>
kenobi
</a>
<a class="ui label" href=/tags/lab/ title=lab>
lab
</a>
<a class="ui label" href=/tags/leaks/ title=leaks>
leaks
</a>
<a class="ui label" href=/tags/linux/ title=Linux>
Linux
</a>
<a class="ui label" href=/tags/memory/ title=memory>
memory
</a>
<a class="ui label" href=/tags/metamorphosis/ title=Metamorphosis>
Metamorphosis
</a>
<a class="ui label" href=/tags/metasploit/ title=metasploit>
metasploit
</a>
<a class="ui label" href=/tags/mobile/ title=Mobile>
Mobile
</a>
<a class="ui label" href=/tags/msf/ title=msf>
msf
</a>
<a class="ui label" href=/tags/msfvenom/ title=msfvenom>
msfvenom
</a>
<a class="ui label" href=/tags/nfs/ title=nfs>
nfs
</a>
<a class="ui label" href=/tags/notes/ title=notes>
notes
</a>
<a class="ui label" href=/tags/openvas/ title=openvas>
openvas
</a>
<a class="ui label" href=/tags/osi/ title=OSI>
OSI
</a>
<a class="ui label" href=/tags/osi-model/ title="OSI Model">
OSI Model
</a>
<a class="ui label" href=/tags/overpass-2/ title="Overpass 2">
Overpass 2
</a>
<a class="ui label" href=/tags/pentesting/ title=Pentesting>
Pentesting
</a>
<a class="ui label" href=/tags/pgp/ title=PGP>
PGP
</a>
<a class="ui label" href=/tags/pip/ title=pip>
pip
</a>
<a class="ui label" href=/tags/pip2/ title=pip2>
pip2
</a>
<a class="ui label" href=/tags/post-exploitation/ title=Post-Exploitation>
Post-Exploitation
</a>
<a class="ui label" href=/tags/powershell/ title=powershell>
powershell
</a>
<a class="ui label" href=/tags/putty/ title=putty>
putty
</a>
<a class="ui label" href=/tags/python/ title=python>
python
</a>
<a class="ui label" href=/tags/razorblack/ title=RazorBlack>
RazorBlack
</a>
<a class="ui label" href=/tags/redteaming/ title=redteaming>
redteaming
</a>
<a class="ui label" href=/tags/ref/ title=Ref>
Ref
</a>
<a class="ui label" href=/tags/relevant/ title=Relevant>
Relevant
</a>
<a class="ui label" href=/tags/rooms/ title=rooms>
rooms
</a>
<a class="ui label" href=/tags/rootme/ title=RootMe>
RootMe
</a>
<a class="ui label" href=/tags/rpwebscanning/ title=rpwebscanning>
rpwebscanning
</a>
<a class="ui label" href=/tags/script/ title=script>
script
</a>
<a class="ui label" href=/tags/scripting/ title=Scripting>
Scripting
</a>
<a class="ui label" href=/tags/simple-ctf/ title="Simple CTF">
Simple CTF
</a>
<a class="ui label" href=/tags/splunk/ title=splunk>
splunk
</a>
<a class="ui label" href=/tags/stego/ title=stego>
stego
</a>
<a class="ui label" href=/tags/super-spam/ title=Super-Spam>
Super-Spam
</a>
<a class="ui label" href=/tags/sweettoothinc/ title=sweettoothinc>
sweettoothinc
</a>
<a class="ui label" href=/tags/sysmon/ title=sysmon>
sysmon
</a>
<a class="ui label" href=/tags/thefindcommand/ title=Thefindcommand>
Thefindcommand
</a>
<a class="ui label" href=/tags/thm/ title=thm>
thm
</a>
<a class="ui label" href=/tags/tmux/ title=tmux>
tmux
</a>
<a class="ui label" href=/tags/tools/ title=tools>
tools
</a>
<a class="ui label" href=/tags/tryhackme/ title=tryhackme>
tryhackme
</a>
<a class="ui label" href=/tags/vapt/ title=vapt>
vapt
</a>
<a class="ui label" href=/tags/volatility/ title=Volatility>
Volatility
</a>
<a class="ui label" href=/tags/vuln-labs/ title="vuln labs">
vuln labs
</a>
<a class="ui label" href=/tags/vulnversity/ title=Vulnversity>
Vulnversity
</a>
<a class="ui label" href=/tags/web-scanning/ title="web scanning">
web scanning
</a>
<a class="ui label" href=/tags/wireshark/ title=wireshark>
wireshark
</a>
</article>
</div>
</header>
<div class="ui relaxed grid dream-grid dream-back">
<div class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
<article class="ui segment">
<h3 class="ui header">Social Links</h3>
<nav class="ui secondary menu dream-menu dream-socials">
<div class=item>
<a href=/index.xml>
<i class="large rss square icon" title=RSS></i>
</a>
</div>
<div class=item>
<a href=mailto:classroom@anir0y.in>
<i class="large mail icon" title=Email></i>
</a>
</div>
<div class=item>
<a href=https://twitter.com/anir0y target=_blank>
<i class="large twitter icon" title=Twitter></i>
</a>
</div>
<div class=item>
<a href=https://facebook.com/anir0yofficial target=_blank>
<i class="large facebook icon" title=Facebook></i>
</a>
</div>
<div class=item>
<a href=https://instagram.com/anir0yofficial target=_blank>
<i class="large instagram icon" title=Instagram></i>
</a>
</div>
<div class=item>
<a href=https://www.linkedin.com/in/anir0y target=_blank>
<i class="large linkedin icon" title=Linkedin></i>
</a>
</div>
<div class=item>
<a href=https://github.com/anir0y target=_blank>
<i class="large github icon" title=GitHub></i>
</a>
</div>
</nav>
</article>
</div>
<div class="sixteen wide mobile eight wide tablet four wide computer column dream-column">
<article class="ui segment">
YOU CAN RESUE MY CONTENT
</article>
</div>
</div>
</div>
</section>
</div>
</div>
<script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(c,d,e){var b,f=c.getElementsByTagName(d)[0],a=window.twttr||{};return c.getElementById(e)?a:(b=c.createElement(d),b.id=e,b.src='https://platform.twitter.com/widgets.js',f.parentNode.insertBefore(b,f),a._e=[],a.ready=function(b){a._e.push(b)},a)}(document,'script','twitter-wjs'))</script>
<script src=/js/jquery.min.js></script>
<script src=/js/semantic.min.js></script>
<script src=/js/jquery.overlayScrollbars.min.js></script>
<script src=/js/header.js></script>
<script src=/js/main.js></script>
<script src=/js/theme.js></script>
<script src=/js/html2canvas.min.js></script>
<script src=/js/post.js></script>
<script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script>
<script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script>
<script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script>
<script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var a=localStore.getItem('hugo-theme-dream-is-dark'),b,c,d;a=a?a:window.defaultDark?'y':a,b="tomorrow",c="tomorrow-night",d=a==='y'?c:b,$('link[data-highlight]').attr('href','https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/'+d+'.min.css'),$('pre').css('background',a==='y'?'#333':'')}</script>
<div class="ui inverted segment" id=dream-search>
<div class="ui search">
<div class="ui transparent input">
<input class=prompt type=text placeholder=Search>
</div>
<div class=results></div>
</div>
</div>
<script>$(document).ready(function(){$.getJSON('https://classroom.anir0y.in/index.json',function(a){$('.ui.search').search({source:a,searchFields:['title'],showNoResults:!0})})})</script>
<script src=/js/search.js></script>
</body>
</html>