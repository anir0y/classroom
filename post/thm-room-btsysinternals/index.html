<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Thm Room Sysinternals | Classroom</title><link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon><meta name=author content="Animesh Roy"><meta name=description content="Try Hack ME Room Sysinternals walkthough"><script async src="https://www.googletagmanager.com/gtag/js?id=G-NZBEX7RBNF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NZBEX7RBNF')</script><script type=text/javascript>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","6gp5990ghr")</script><link rel=canonical href=https://classroom.anir0y.in/post/thm-room-btsysinternals/><meta property="og:title" content="Thm Room Sysinternals"><meta property="og:description" content="Try Hack ME Room Sysinternals walkthough"><meta property="og:type" content="article"><meta property="og:url" content="https://classroom.anir0y.in/post/thm-room-btsysinternals/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-11T20:59:17+05:30"><meta property="article:modified_time" content="2021-05-11T20:59:17+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Thm Room Sysinternals"><meta name=twitter:description content="Try Hack ME Room Sysinternals walkthough"><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i></div><div class=item><i class="large link home icon" title=Home onclick="window.location.href='https://classroom.anir0y.in'"></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment toc"><nav id=TableOfContents><ul><li><a href=#sysinternals>Sysinternals</a></li><li><a href=#room-subscription-onlyhttpstryhackmecomroombtsysinternalssg>Room <a href=https://tryhackme.com/room/btsysinternalssg>Subscription Only</a></a></li><li><a href=#task-01-introduction>TASK 01: Introduction</a></li><li><a href=#flags>Flags</a></li><li><a href=#task-02--install-the-sysinternals-suite>TASK 02: Install the Sysinternals Suite</a></li><li><a href=#flags-1>Flags</a></li><li><a href=#task-03--using-sysinternals-live>TASK 03: Using Sysinternals Live</a></li><li><a href=#flags-2>Flags</a></li><li><a href=#task-04--file-and-disk-utilities>TASK 04: File and Disk Utilities</a><ul><li><a href=#sigcheck>Sigcheck</a></li></ul></li><li><a href=#flags-3>Flags</a><ul><li></li></ul></li><li><a href=#task-05--networking-utilities>TASK 05 : Networking Utilities</a><ul><li><a href=#tcpview>TCPView</a></li></ul></li><li><a href=#flags-4>Flags</a></li><li><a href=#task-06-process-utilities>TASK 06: Process Utilities</a><ul><li><a href=#autoruns>Autoruns</a></li><li><a href=#procdump>ProcDump</a></li><li><a href=#process-explorer>Process Explorer</a></li><li><a href=#process-monitor>Process Monitor</a></li><li><a href=#psexec>PsExec</a></li></ul></li><li><a href=#flags-5>Flags</a></li><li><a href=#task-07-security-utilities>TASK 07: Security Utilities</a><ul><li><a href=#sysmon>Sysmon</a></li></ul></li><li><a href=#flags-6>Flags</a></li><li><a href=#task-08-system-information>TASK 08: System Information</a><ul><li><a href=#winobj>WinObj</a></li></ul></li><li><a href=#flags-7>Flags</a></li><li><a href=#task-09-miscellaneous>TASK 09: Miscellaneous</a><ul><li><a href=#bginfo>BgInfo</a></li><li><a href=#regjump>RegJump</a></li><li><a href=#strings>Strings</a></li></ul></li><li><a href=#flags-8>Flags</a></li><li><a href=#task-10-conclusion>TASK 10: Conclusion</a></li><li><a href=#flags-9>Flags</a></li></ul></nav></div><div class="ui segment actions"><button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i></button>
<a href="https://twitter.com/intent/tweet?text=Thm%20Room%20Sysinternals&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-btsysinternals%2f" class="ui circular twitter icon button"><i class="twitter icon"></i></a>
<a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-btsysinternals%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui top attached segment"><header><h1 class="ui large header">Thm Room Sysinternals<div class="sub header">@
<a href=https://anir0y.in target=_blank>Animesh Roy</a>
|
Tuesday, May 11, 2021
| 18 minutes read
| Update at
Tuesday, May 11, 2021</div></h1></header><article class=main><hr><h2 id=sysinternals>Sysinternals</h2><script src=https://tryhackme.com/badge/434937></script><h2 id=room-subscription-onlyhttpstryhackmecomroombtsysinternalssg>Room <a href=https://tryhackme.com/room/btsysinternalssg>Subscription Only</a></h2><hr><h2 id=task-01-introduction>TASK 01: Introduction</h2><p>What are the tools known as Sysinternals?</p><p>The Sysinternals tools is a compilation of over 70+ Windows-based tools. Each of the tools falls into one of the following categories:</p><ul><li>File and Disk Utilities</li><li>Networking Utilities</li><li>Process Utilities</li><li>Security Utilities</li><li>System Information</li><li>Miscellaneous
The Sysinternals tools and its website (sysinternals.com) were created by Mark Russinovich back in the late &rsquo;90s, along with an individual named Bryce Cogswell under the company Wininternals Software.</li></ul><p>In 2005, Microsoft acquired Wininternals Software, and Mark Russinovich joined Microsoft. Today he is the CTO of Microsoft Azure.</p><p>Mark Russinovich made headlines when he reported that Sony embedded rootkits into their music CDs back in 2005. This discovery was made known thanks to one of the Sysinternals tools he was testing. You can read more about that <a href=https://www.virusbulletin.com/virusbulletin/2005/12/inside-sony-s-rootkit>here</a>.</p><p>He also discovered in 2006 that Symantec was using rootkit-like technology. You can read more about that <a href=https://www.zdnet.com/article/symantec-confesses-to-using-rootkit-technology/>here</a>.</p><p>The Sysinternals tools are extremely popular among IT professionals who manage Windows systems. These tools are so popular that even red teamers and adversaries alike use them. Throughout this room, I&rsquo;ll note which tools MITRE has identified to have been used by adversaries.</p><p>The goal of this room is to introduce you to a handful of Sysinternals tools with the hopes that you will expand on this knowledge with your own research and curiosity.</p><hr><h2 id=flags>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>When did Microsoft acquire the Sysinternals tools?</td><td><code>2005</code></td></tr></tbody></table><hr><h2 id=task-02--install-the-sysinternals-suite>TASK 02: Install the Sysinternals Suite</h2><p>Time to get our hands dirty with Sysinternals.</p><p>The Sysinternals tool(s) can be downloaded and run from the local system, or the tool(s) can be run from the web.</p><p>Regarding local install/run, you can download the entire suite or just the tool(s) you need.</p><p>If you wish to download a tool or two but not the entire suite, you can navigate to the Sysinternals Utilities Index page, <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/,>https://docs.microsoft.com/en-us/sysinternals/downloads/,</a> and download the tool(s). If you know which tool you want to download, then this is fine. The tools are listed in alphabetical order are not separated by categories.
<img src=https://assets.tryhackme.com/additional/sysinternals/sysint-util-index.png alt=sysinternals></p><p>Alternatively, you can use the category links to find and download the tool(s). This route is better since there are so many tools you can focus on all the tools of interest instead of the entire index.</p><p>For example, let&rsquo;s say you need tools to inspect Windows processes; then, you can navigate to the Process Utilities page, <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/process-utilities/,>https://docs.microsoft.com/en-us/sysinternals/downloads/process-utilities/,</a> for all the tools that fall under this category.
<img src=https://assets.tryhackme.com/additional/sysinternals/sysint-proc-util.png alt></p><p>Notice that you are conveniently supplied with a brief explanation for each tool.</p><p>Lastly, you can do the same from the Sysinternals Live URL, <a href=https://live.sysinternals.com/>https://live.sysinternals.com/</a>. This is the same URL to use if you wish to run the tool from the web. We will look at how to accomplish this in the next section.</p><p>If you chose to download from this page, it is similar to the Sysinternals Utilities Index page. The tools are listed in alphabetical order and are not separated by categories.
<img src=https://assets.tryhackme.com/additional/sysinternals/sysint-live-index.png alt></p><p>If you wish to download the Sysinternals Suite, you can download the zip file from <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite>here</a>.</p><p>The suite has a select number of Sysinternal tools. See below for a rundown of the tools included in the suite
<img src=https://assets.tryhackme.com/additional/sysinternals/sysint-suite.png alt></p><p>After you download the zip file, you need to extract the files. After the files are extracted, the extra step, which is by choice, is to add the folder path to the environment variables. By doing so, you can launch the tools via the command line without navigating to the directory the tools reside in.</p><p>Environment Variables can be edited from System Properties.</p><p>The System Properties can be launched via the command line by running <code>sysdm.cpl</code>. Click on the <code>Advanced</code> tab
<img src=https://assets.tryhackme.com/additional/sysinternals/env-variables.png alt><br>Select <code>Path</code> under <code>System Variables</code> and select Edit&mldr; then <strong>OK</strong>.
<img src=https://assets.tryhackme.com/additional/sysinternals/env-variables2.png alt><br>Open a new command prompt (elevated) to confirm that the Sysinternals Suite can be executed from any location.
<img src=https://assets.tryhackme.com/additional/sysinternals/env-variables4.png alt></p><p>A local copy of the Sysinternals Suite is located in <code>C:\Tools\Sysint</code>.</p><p>Alternatively, a PowerShell module can download and install all of the Sysinternals tools.</p><blockquote><p>PowerShell command: <code>Download-SysInternalsTools C:\Tools\Sysint</code>
Now let&rsquo;s look at how to run the Sysinternals tools from the web.</p></blockquote><hr><h2 id=flags-1>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What is the last tool listed within the Sysinternals Suite?</td><td><code>Zoomit</code></td></tr></tbody></table><hr><h2 id=task-03--using-sysinternals-live>TASK 03: Using Sysinternals Live</h2><p>Per the Sysinternals website, &ldquo;Sysinternals Live is a service that enables you to execute Sysinternals tools directly from the Web without hunting for and manually downloading them. Simply enter a tool&rsquo;s Sysinternals Live path into Windows Explorer or a command prompt as live.sysinternals.com/<toolname> or \live.sysinternals.com\tools&lt;toolname>.&rdquo;</p><p>Let&rsquo;s take a look at how we can do this.</p><p>Based on the instructions, to launch Process Monitor from the web the syntax is <code>\\live.sysinternals.com\tools\procmon.exe</code>.</p><p>And it fails.
<img src=https://assets.tryhackme.com/additional/sysinternals/sysint-live-fail.png alt></p><p>To resolve this issue the WebDAV client must be installed and running on the machine. The WebDAV protocol is what allows a local machine to access a remote machine running a WebDAV share and perform actions in it.</p><p>On a Windows 10 client, the WebDAV client is installed but the client is most likely not running. If you try to run a Sysinternals tool it will fail with a message &ldquo;The network path was not found.&rdquo;
<img src=https://assets.tryhackme.com/additional/sysinternals/win10-webclient1b.png alt><br>The service needs to be started before attempting to call any Sysinternals tool in this fashion.<br><img src=https://assets.tryhackme.com/additional/sysinternals/win10-webclient2.png alt><br>Verify it&rsquo;s running before proceeding.
<img src=https://assets.tryhackme.com/additional/sysinternals/win10-webclient3.png alt></p><p>Also, Network Discovery needs to be enabled as well. This setting can be enabled in the Network and Sharing Center.</p><p>There are a few ways to open the Network and Sharing Center. Here is a neat command line to launch it.
<img src=https://assets.tryhackme.com/additional/sysinternals/network-and-sharing.png alt></p><p>Click on <code>Change advanced sharing settings</code> and select <code>Turn on network discovery</code> for your current network profile.</p><p>The attached VM is a Windows Server 2019 edition. The WebDAV client is not installed by default.</p><p>The feature to install on Windows Server is WebDAV Redirector. This feature can be installed via Server Manager or using PowerShell.</p><p>To install with PowerShell, <code>Install-WindowsFeature WebDAV-Redirector –Restart</code>. The server needs to reboot for the installation to complete.</p><p>After reboot, the installation can be verified with the following PowerShell command, <code>Get-WindowsFeature WebDAV-Redirector | Format-Table –Autosize.</code>
<img src=https://assets.tryhackme.com/additional/sysinternals/win2019-webclient1.png alt></p><p>The same process as with a Windows 10 client applies from this point:</p><ul><li>Make sure the WebClient service is runnin</li><li>Make sure Network Discovery is enabled</li></ul><p>Now with all the necessary components installed and enabled the local machine is ready to run Sysinternals tools from the web.</p><p>There are 2 ways the tools can be run:</p><ul><li>Run the tool from the command line (as shown above from the Windows 10 machine)</li><li>Create a network drive and run the tool from the mapped drive</li></ul><p>Method 1 - Run tool from command line
<img src=https://assets.tryhackme.com/additional/sysinternals/win2019-method1.png alt></p><p>Method 2 - Run tool from a mapped drive
<img src=https://assets.tryhackme.com/additional/sysinternals/win2019-method2a.png alt><br><strong>Note</strong>: The asterick will auto-assign a drive letter. The asterick can be replaced with an actual drive letter instead.<br><img src=https://assets.tryhackme.com/additional/sysinternals/win2019-method2b.png alt>
<img src=https://assets.tryhackme.com/additional/sysinternals/win2019-method2c.png alt><br><img src=https://assets.tryhackme.com/additional/sysinternals/win2019-method2d.png alt></p><hr><h2 id=flags-2>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What service needs to be enabled on the local host to interact with live.sysinternals.com?</td><td>WebClient</td></tr></tbody></table><hr><h2 id=task-04--file-and-disk-utilities>TASK 04: File and Disk Utilities</h2><h3 id=sigcheck>Sigcheck</h3><p>&ldquo;Sigcheck is a command-line utility that shows file version number, timestamp information, and digital signature details, including certificate chains. It also includes an option to check a file’s status on VirusTotal, a site that performs automated file scanning against over 40 antivirus engines, and an option to upload a file for scanning.&rdquo; (official definition)<br><img src=https://assets.tryhackme.com/additional/sysinternals/sigcheck1.png alt></p><p>From the official Sigcheck <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/sigcheck>page</a>, a use case is identified towards the bottom of the page.</p><p>If you completed the Core Windows Processes room you should be aware that the location of all the executables is <code>C:\Windows\System32</code>, except for Explorer.exe (which is <code>C:\Windows</code>).</p><p>Use Case: Check for unsigned files in <code>C:\Windows\System32</code>.</p><p>Command: <code>sigcheck -u -e C:\Windows\System32</code>
<img src=https://assets.tryhackme.com/additional/sysinternals/sigcheck2.png alt><br><strong>Parameter usage:</strong></p><ul><li><code>-u </code>&ldquo;If VirusTotal check is enabled, show files that are unknown by VirusTotal or have non-zero detection, otherwise show only unsigned files.&rdquo;</li><li><code>-e</code> &ldquo;Scan executable images only (regardless of their extension)&rdquo;</li></ul><p><em>Note</em>: If the results were different it would warrant an investigation into any listed executables.</p><h4 id=streams>Streams</h4><p>&ldquo;The NTFS file system provides applications the ability to create alternate data streams of information. By default, all data is stored in a file&rsquo;s main unnamed data stream, but by using the syntax &lsquo;file:stream&rsquo;, you are able to read and write to alternates.&rdquo; (official definition)</p><p>Alternate Data Streams (ADS) is a file attribute specific to Windows NTFS (New Technology File System). Every file has at least one data stream ($DATA) and ADS allows files to contain more than one stream of data. Natively Window Explorer doesn&rsquo;t display ADS to the user. There are 3rd party executables that can be used to view this data, but Powershell gives you the ability to view ADS for files.</p><p>Malware writers have used ADS to hide data in an endpoint, but not all its uses are malicious. When you download a file from the Internet unto an endpoint, there are identifiers written to ADS to identify that it was downloaded from the Internet.</p><p><img src=https://assets.tryhackme.com/additional/sysinternals/streams1.png alt></p><p><strong>Example</strong>: A file downloaded from the Internet.<br><img src=https://assets.tryhackme.com/additional/sysinternals/streams2.png alt></p><p>Since the file has this identifier, additional security measures are added to its properties.
<img src=https://assets.tryhackme.com/additional/sysinternals/streams3.png alt></p><h4 id=sdelete>SDelete</h4><p>&ldquo;SDelete is a command line utility that takes a number of options. In any given use, it allows you to delete one or more files and/or directories, or to cleanse the free space on a logical disk.&rdquo;</p><p>As per the official documentation page, SDelete (Secure Delete) implemented the DOD 5220.22-M (Department of Defense clearing and sanitizing protocol).
<img src=https://assets.tryhackme.com/additional/sysinternals/sdelete.png alt></p><p>Source: <a href=https://www.lifewire.com/dod-5220-22-m-2625856>https://www.lifewire.com/dod-5220-22-m-2625856</a></p><p>SDelete has been used by adversaries and is associated with MITRE techniques <a href=https://attack.mitre.org/techniques/T1485/>T1485</a> (Data Destruction) and <a href=https://attack.mitre.org/techniques/T1070/004/>T1070.004</a> (Indicator Removal on Host: File Deletion). It&rsquo;s MITRE ID <a href=https://attack.mitre.org/software/S0195/>S0195</a>.</p><p>You can review this tool more in-depth by visiting its Sysinternals SDelete <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/sdelete>page</a>.</p><p>Other tools fall under the File and Disk Utilities category. I encourage you to explore these tools at your own leisure.</p><p>Link: <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/file-and-disk-utilities>https://docs.microsoft.com/en-us/sysinternals/downloads/file-and-disk-utilities</a></p><hr><h2 id=flags-3>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>There is a txt file on the desktop named file.txt. What is the text within the ADS?</td><td><code>I am hiding in the stream.</code></td></tr></tbody></table><h4 id=explaination>Explaination</h4><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell>PS C:\Users\Administrator\Desktop&gt; streams.exe .\file.txt

streams v1.60 - Reveal NTFS alternate streams.
Copyright (C) 2005-2016 Mark Russinovich
Sysinternals - www.sysinternals.com

C:\Users\Administrator\Desktop\file.txt<span style=color:#960050;background-color:#1e0010>:</span>
         <span style=color:#960050;background-color:#1e0010>:</span>ads.txt<span style=color:#960050;background-color:#1e0010>:</span>$DATA 26 <span style=color:#75715e>#FileName</span>
PS C:\Users\Administrator\Desktop&gt; Get-Content -Path .\file.txt -Stream ads.txt
I am hiding <span style=color:#66d9ef>in</span> the stream. <span style=color:#75715e>#Flag</span>
</code></pre></div><hr><h2 id=task-05--networking-utilities>TASK 05 : Networking Utilities</h2><h3 id=tcpview>TCPView</h3><p>&ldquo;TCPView is a Windows program that will show you detailed listings of all TCP and UDP endpoints on your system, including the local and remote addresses and state of TCP connections. On Windows Server 2008, Vista, and XP, TCPView also reports the name of the process that owns the endpoint. TCPView provides a more informative and conveniently presented subset of the Netstat program that ships with Windows. The TCPView download includes Tcpvcon, a command-line version with the same functionality.&rdquo; (official definition)</p><p>This is a good time to mention that Windows has a built-in utility that provides the same functionality. This tool is called Resource Monitor. There are many ways to open this tool. From the command line use <code>resmon</code>.
<img src=https://assets.tryhackme.com/additional/sysinternals/resource-monitor0.png alt><br>Expand TCP Connections to view the Remote Address for each Process with an outbound connection.
<img src=https://assets.tryhackme.com/additional/sysinternals/resource-monitor.png alt><br>This tool can also be called from the Performance tab within Task Manager. Look at the bottom left for the link to open Resource Monitor.
<img src=https://assets.tryhackme.com/additional/sysinternals/resource-monitor2.png alt><br>Now back to TCPView.<br><img src=https://assets.tryhackme.com/additional/sysinternals/tcpview.png alt><br>The below image shows the default view for TCPView.
<img src=https://assets.tryhackme.com/additional/sysinternals/tcpview0.png alt><br>In the below image, I unselected <code>Show Unconnected Endpoints</code> in the Options menu.
<img src=https://assets.tryhackme.com/additional/sysinternals/tcpview1.png alt><br>Other tools fall under the Networking Utilities category. I encourage you to explore these tools at your own leisure.</p><p>Link: <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/networking-utilities>https://docs.microsoft.com/en-us/sysinternals/downloads/networking-utilities</a></p><hr><h2 id=flags-4>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>Using WHOIS tools, what is the ISP/Organization for the remote address in the screenshots above?</td><td><code>Microsoft Corporation</code></td></tr></tbody></table><hr><h2 id=task-06-process-utilities>TASK 06: Process Utilities</h2><blockquote><p>Note: Some of these tools require you to run as an administrator.</p></blockquote><h3 id=autoruns>Autoruns</h3><p>&ldquo;This utility, which has the most comprehensive knowledge of auto-starting locations of any startup monitor, shows you what programs are configured to run during system bootup or login, and when you start various built-in Windows applications like Internet Explorer, Explorer and media players. These programs and drivers include ones in your startup folder, Run, RunOnce, and other Registry keys. Autoruns reports Explorer shell extensions, toolbars, browser helper objects, Winlogon notifications, auto-start services, and much more. Autoruns goes way beyond other autostart utilities.&rdquo; (official definition)</p><p>Note: This is a good tool to search for any malicious entries created in the local machine to establish Persistence.</p><p>Launch Autoruns.<br><img src=https://assets.tryhackme.com/additional/sysinternals/autoruns0.png alt></p><p>Below is a snapshot of Autoruns, showing the first couple of items from the Everything tab. Normally there are a lot of entries within this tab.<br><img src=https://assets.tryhackme.com/additional/sysinternals/autoruns.png alt></p><p>Notice all the tabs within the application. Click on each tab to inspect the items associated with each.</p><p>The below image is a snapshot of the Image Hijacks tab. (At this time there is only 1 item listed)
<img src=https://assets.tryhackme.com/additional/sysinternals/autoruns-image-hijacks.png alt></p><h3 id=procdump>ProcDump</h3><p>&ldquo;ProcDump is a command-line utility whose primary purpose is monitoring an application for CPU spikes and generating crash dumps during a spike that an administrator or developer can use to determine the cause of the spike.&rdquo; (official definition)<br><img src=https://assets.tryhackme.com/additional/sysinternals/procdump.png alt><br>Alternatively, you can use Process Explorer to do the same.</p><p>Right-click on the process to create a Minidump or Full Dump of the process.<br><img src=https://assets.tryhackme.com/additional/sysinternals/procexp-create-dump.png alt></p><blockquote><p>Please refer to the examples listed on the ProcDump <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/procdump>page</a> to learn about all the available options with running this tool.</p></blockquote><h3 id=process-explorer>Process Explorer</h3><p>&ldquo;The Process Explorer display consists of two sub-windows. The top window always shows a list of the currently active processes, including the names of their owning accounts, whereas the information displayed in the bottom window depends on the mode that Process Explorer is in: if it is in handle mode you&rsquo;ll see the handles that the process selected in the top window has opened; if Process Explorer is in DLL mode you&rsquo;ll see the DLLs and memory-mapped files that the process has loaded.&rdquo; (official definition)</p><p>This tool was touched on slightly within the Core Windows Processes room. Process Hacker was intentionally used in that room to broaden your exposure to various tools that essentially perform the same tasks with subtle differences.</p><p>Since much of the basic foundational information was discussed in the Core Windows Processes room, Process Explorer will be briefly touched.</p><p>In the following images, let&rsquo;s look at svchost.exe PID 3636 more closely.
<img src=https://assets.tryhackme.com/additional/sysinternals/procexp-svchost.png alt><br><img src=https://assets.tryhackme.com/additional/sysinternals/procexp-svchost-services.png alt><br>This process is associated with the WebClient service that is needed to connect to live.sysinternals.com (WebDAV).</p><p>There should be web traffic listed in the TCP/IP tab.
<img src=https://assets.tryhackme.com/additional/sysinternals/procexp-svchost-tcpip.png alt></p><p>Ideally, it would be wise to check if that IP is what we assume it is.</p><p>Various online tools can be utilized to verify the authenticity of an IP address. For this demonstration, I&rsquo;ll use Talos Reputation Center.
<img src=https://assets.tryhackme.com/additional/sysinternals/procexp-svchost-tcpip-2.png alt><br><a href="https://talosintelligence.com/reputation_center/lookup?search=52.154.170.73">https://talosintelligence.com/reputation_center/lookup?search=52.154.170.73</a></p><p>As mentioned in the ProcExp description, we can see open handles associated with the process within the bottom window.
<img src=https://assets.tryhackme.com/additional/sysinternals/procexp-svchost-handle.png alt></p><p>Listed as an open handle is the connection to the remote WebDAV folder.</p><p>There is an option within ProcExp to Verify Signatures. Once enabled, it shows up as a column within the Process view.<br><img src=https://assets.tryhackme.com/additional/sysinternals/procexp-verify-sig.png alt></p><p>Other options to note include Run at Logon and Replace Task Manager.</p><p>You may have noticed that some of the processes within Process Explorer have different colors. Those colors have meaning.</p><p>Below is a snippet from MalwareBytes explaining what each of those colors means.<br><img src=https://assets.tryhackme.com/additional/sysinternals/procexp-colors.png alt></p><h3 id=process-monitor>Process Monitor</h3><p>&ldquo;Process Monitor is an advanced monitoring tool for Windows that shows real-time file system, Registry and process/thread activity. It combines the features of two legacy Sysinternals utilities, Filemon and Regmon, and adds an extensive list of enhancements including rich and non-destructive filtering, comprehensive event properties such as session IDs and user names, reliable process information, full thread stacks with integrated symbol support for each operation, simultaneous logging to a file, and much more. Its uniquely powerful features will make Process Monitor a core utility in your system troubleshooting and malware hunting toolkit.&rdquo; (official definition)</p><p>Launch ProcMon.<br><img src=https://assets.tryhackme.com/additional/sysinternals/procmon0.png alt></p><p>In the below snapshot, I set a filter to capture all the events related to PID 3888, notepad.exe. You can see some of the file operations that were captured and the file path or registry path/key the action occurred on, and the operation result.
<img src=https://assets.tryhackme.com/additional/sysinternals/procmon.png alt><br>ProcMon will capture thousands upon thousands of events occurring within the operating system.</p><p>The option to capture events can be toggled on and off.<br><img src=https://assets.tryhackme.com/additional/sysinternals/procmon3.png alt></p><p>In this ProcMon example, the session captured events only for a few seconds. Look at how many events were captured in that short space of time!
<img src=https://assets.tryhackme.com/additional/sysinternals/procmon2.png alt></p><p>To use ProcMon effectively you must use the Filter and must configure it properly.
<img src=https://assets.tryhackme.com/additional/sysinternals/procmon4.png alt></p><p>In the above image, a filter was already set to capture events associated with PID 3888. Alternatively, a filter could have been set to capture events with the Process Name = notepad.exe.</p><p><a href=https://adamtheautomator.com/procmon/>Here</a> is a useful guide on configuring ProcMon.</p><p>Note: To fully understand the output from some of these tools you need to understand some Windows concepts, such as <a href=https://docs.microsoft.com/en-us/windows/win32/procthread/about-processes-and-threads>Processes and Threads</a> and <a href=https://docs.microsoft.com/en-us/windows/win32/apiindex/windows-api-list>Windows API calls</a>.</p><h3 id=psexec>PsExec</h3><p>&ldquo;PsExec is a light-weight telnet-replacement that lets you execute processes on other systems, complete with full interactivity for console applications, without having to manually install client software. PsExec&rsquo;s most powerful uses include launching interactive command-prompts on remote systems and remote-enabling tools like IpConfig that otherwise do not have the ability to show information about remote systems.&rdquo; (official definition)
<img src=https://assets.tryhackme.com/additional/sysinternals/psexec.png alt></p><p>PsExec is another tool that is utilized by adversaries. This tool is associated with MITRE techniques <a href=https://attack.mitre.org/techniques/T1570>T1570</a> (Lateral Tool Transfer), <a href=https://attack.mitre.org/techniques/T1021/002>T1021.002</a> (Remote Services: SMB/Windows Admin Shares), and <a href=https://attack.mitre.org/techniques/T1569/002>T1569.002</a> (System Services: Service Execution). It&rsquo;s MITRE ID is <a href=https://attack.mitre.org/software/S0029/>S0029</a>.</p><p>You can review this tool more in-depth by visiting its Sysinternals PsExec <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/psexec>page</a>. You can also check out this resource <a href=https://adamtheautomator.com/psexec-ultimate-guide/>page</a>.</p><p>Other tools fall under the Process Utilities category. I encourage you to explore these tools at your own leisure.</p><p>Link: <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/process-utilities>https://docs.microsoft.com/en-us/sysinternals/downloads/process-utilities</a></p><hr><h2 id=flags-5>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>Run Autoruns and inspect what are the new entries in the Image Hijacks tab compared to the screenshots above.</td><td><code>NA</code></td></tr><tr><td>What entry was updated?</td><td>taskmgr.exe</td></tr><tr><td>What is the updated value?</td><td>c:\tools\sysint\procexp.exe</td></tr></tbody></table><hr><h2 id=task-07-security-utilities>TASK 07: Security Utilities</h2><h3 id=sysmon>Sysmon</h3><p>&ldquo;System Monitor (Sysmon) is a Windows system service and device driver that, once installed on a system, remains resident across system reboots to monitor and log system activity to the Windows event log. It provides detailed information about process creations, network connections, and changes to file creation time. By collecting the events it generates using Windows Event Collection or SIEM agents and subsequently analyzing them, you can identify malicious or anomalous activity and understand how intruders and malware operate on your network.&rdquo; (official definition)
<img src=https://assets.tryhackme.com/additional/sysinternals/sysmon.png alt></p><hr><h2 id=flags-6>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>You will check out the Sysmon room if you haven&rsquo;t done so already&mldr;</td><td><code>NA</code></td></tr></tbody></table><hr><h2 id=task-08-system-information>TASK 08: System Information</h2><h3 id=winobj>WinObj</h3><p>&ldquo;WinObj is a 32-bit Windows NT program that uses the native Windows NT API (provided by NTDLL.DLL) to access and display information on the NT Object Manager&rsquo;s name space.&rdquo; (official definition)</p><p>To showcase this tool, let&rsquo;s look into the concept of Session 0 and Session 1 that was mentioned in the Core Windows Processes room.</p><p>Remember that Session 0 is the OS session and Session 1 is the User session. Also recall that there will be at least 2 csrss.exe processes running, one for each session. Note Session 1 will be for the first user logged into the system.</p><p>Launch WinObj.<br><img src=https://assets.tryhackme.com/additional/sysinternals/winobj.png alt></p><p>The below image shows the default view for WinObj.<br><img src=https://assets.tryhackme.com/additional/sysinternals/winobj1.png alt><br>Within Session 0, under <code>DosDevices</code>, there is an entry for the network drive I mounted in my local machine.<br><img src=https://assets.tryhackme.com/additional/sysinternals/winobj5.png alt></p><p>Let&rsquo;s look at <code>WindowStations</code> value for Session 1.<br><img src=https://assets.tryhackme.com/additional/sysinternals/winobj3.png alt></p><p>Let&rsquo;s compare this information with Process Explorer. The below image is for csrss.exe, which was launched along with winlogon.exe by smss.exe.<br><img src=https://assets.tryhackme.com/additional/sysinternals/winobj4.png alt></p><p><strong>Note</strong>: This is a high-level exposure for this tool.</p><p>Other tools fall under the System Information category. I encourage you to explore these tools at your own leisure.</p><p>Link: <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/system-information>https://docs.microsoft.com/en-us/sysinternals/downloads/system-information</a></p><hr><h2 id=flags-7>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>Moving along..</td><td><code>NA</code></td></tr></tbody></table><hr><h2 id=task-09-miscellaneous>TASK 09: Miscellaneous</h2><h3 id=bginfo>BgInfo</h3><p>&ldquo;It automatically displays relevant information about a Windows computer on the desktop&rsquo;s background, such as the computer name, IP address, service pack version, and more.&rdquo; (official definition)</p><p>This is a handy utility if you manage multiple machines. This tool, or similar tools, are typically utilized on servers. When a user RDPs into a server, the system information is displayed on the wallpaper to provide quick information about the server, such as the server&rsquo;s name.
<img src=https://assets.tryhackme.com/additional/sysinternals/bginfo.png alt></p><p>Refer to the Sysinternals <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/bginfo>BgInfo page</a> for more information on installation and usage.</p><h3 id=regjump>RegJump</h3><p>&ldquo;This little command-line applet takes a registry path and makes Regedit open to that path. It accepts root keys in standard (e.g. HKEY_LOCAL_MACHINE) and abbreviated form (e.g. HKLM).&rdquo; (official definition)</p><p>When navigating through the registry using the Registry Editor, one must manually drill down to the key you wish to inspect.<br><img src=https://assets.tryhackme.com/additional/sysinternals/registry-editor.png alt><br>There are multiple ways to query the Windows Registry without using the Registry Editor, such as via the command line (<code>reg query</code>) and PowerShell (<code>Get-Item</code>/<code>Get-ItemProperty</code>).</p><p>Using Regjump will open the Registry Editor and automatically open the editor directly at the path, so one doesn&rsquo;t need to navigate it manually.<br><img src=https://assets.tryhackme.com/additional/sysinternals/regjump0.png alt><br><img src=https://assets.tryhackme.com/additional/sysinternals/regjump2.png alt><br><img src=https://assets.tryhackme.com/additional/sysinternals/regjump2.png alt></p><h3 id=strings>Strings</h3><p>&ldquo;Strings just scans the file you pass it for UNICODE (or ASCII) strings of a default length of 3 or more UNICODE (or ASCII) characters. Note that it works under Windows 95 as well.&rdquo; (official definition)</p><p>This is the tool that was used on Day 21 of AoC2 to inspect a mysterious binary.</p><p>The example below strings is used to search within the ZoomIt binary for any string containing the word &lsquo;zoom&rsquo;.<br><img src=https://assets.tryhackme.com/additional/sysinternals/strings.png alt></p><p>Other tools fall under the Miscellaneous category. I encourage you to explore these tools at your own leisure.</p><p>Link: <a href=https://docs.microsoft.com/en-us/sysinternals/downloads/misc-utilities>https://docs.microsoft.com/en-us/sysinternals/downloads/misc-utilities</a></p><hr><h2 id=flags-8>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>Run the Strings tool on ZoomIt.exe. What is the full path to the .pdb file?</td><td><code>C:\agent\_work\112\s\Win32\Release\ZoomIt.pdb</code></td></tr></tbody></table><hr><h2 id=task-10-conclusion>TASK 10: Conclusion</h2><p>When you read the Sysinternals documentation, it might hint these tools are for troubleshooting purposes only, but that is not entirely the case.</p><p>You should know or be familiar with the Sysinternals tools whether you&rsquo;re a Desktop Engineer, Systems Analyst, or Security Engineer.</p><p>Real-world scenario: As a security engineer, I had to work with vendors to troubleshoot why an agent wasn&rsquo;t responding on an endpoint—the tools used were ProcExp, ProcMon, and ProcDump.</p><p>ProcExp = to inspect the agent process, its properties, and associated threads and handles.
ProcMon = to investigate if there were any indicators on why the agent was not operating as it should.
ProcDump = to create a dump of the agent process to send to the vendor for further analysis.
And guess what? Asking questions about Sysinternals became part of the interview questions when hiring additional staff.</p><p>Remember, red teamers and adversaries even use these tools.</p><p>Below are some additional links to further your knowledge on how to use these tools as a Security Analyst, Security Engineer, or even an Incident Responder:</p><p>Mark&rsquo;s Blog - <a href=https://docs.microsoft.com/en-us/archive/blogs/markrussinovich/>https://docs.microsoft.com/en-us/archive/blogs/markrussinovich/</a>
Windows Blog Archive - <a href=https://techcommunity.microsoft.com/t5/windows-blog-archive/bg-p/Windows-Blog-Archive/label-name/Mark%20Russinovich>https://techcommunity.microsoft.com/t5/windows-blog-archive/bg-p/Windows-Blog-Archive/label-name/Mark%20Russinovich</a>
License to Kill: Malware Hunting with Sysinternals Tools - <a href="https://www.youtube.com/watch?v=A_TPZxuTzBU">https://www.youtube.com/watch?v=A_TPZxuTzBU</a>
Malware Hunting with Mark Russinovich and the Sysinternals Tools - <a href="https://www.youtube.com/watch?v=vW8eAqZyWeo">https://www.youtube.com/watch?v=vW8eAqZyWeo</a>
Note: Some of the videos/blogs are a bit outdated, but they&rsquo;re still good to review as it showcases how to use these tools extensively. This will build your foundation on the tools covered, along with the tools that weren&rsquo;t covered in this room</p><hr><h2 id=flags-9>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td><code>na</code></td><td><code>NA</code></td></tr></tbody></table><hr><hr><script type=text/javascript language=javascript>var aax_size='728x90',aax_pubname='anir0y-21',aax_src='302'</script><script type=text/javascript language=javascript src=http://c.amazon-adsystem.com/aax2/assoc.js></script></article></section></div></div><footer class="ui basic center aligned segment" style=background-color:transparent><p>© 2010 - 2021 Classroom</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/img/avatar.jpeg></div><div class=content><h1 class="ui medium header">Classroom Notes & Blog Posts<div class="sub header"></div></h1><article class="ui horizontal list"><a class=item href=/categories><i class="th list icon" title="All Categories"></i></a>
<a class=item href=/tags><i class="tags icon" title="All Tags"></i></a></article><article class=dream-tags><a class="ui label" href=/tags/bash/ title=bash>bash</a>
<a class="ui label" href=/tags/cheatsheet/ title=cheatsheet>cheatsheet</a>
<a class="ui label" href=/tags/config/ title=config>config</a>
<a class="ui label" href=/tags/empire/ title=Empire>Empire</a>
<a class="ui label" href=/tags/encryption/ title=encryption>encryption</a>
<a class="ui label" href=/tags/forensic/ title=forensic>forensic</a>
<a class="ui label" href=/tags/gnupg/ title=gnupg>gnupg</a>
<a class="ui label" href=/tags/internship/ title=Internship>Internship</a>
<a class="ui label" href=/tags/interview/ title=interview>interview</a>
<a class="ui label" href=/tags/lab/ title=lab>lab</a>
<a class="ui label" href=/tags/linux/ title=Linux>Linux</a>
<a class="ui label" href=/tags/memory/ title=memory>memory</a>
<a class="ui label" href=/tags/metasploit/ title=metasploit>metasploit</a>
<a class="ui label" href=/tags/mobile/ title=Mobile>Mobile</a>
<a class="ui label" href=/tags/msf/ title=msf>msf</a>
<a class="ui label" href=/tags/notes/ title=notes>notes</a>
<a class="ui label" href=/tags/osi/ title=OSI>OSI</a>
<a class="ui label" href=/tags/osi-model/ title="OSI Model">OSI Model</a>
<a class="ui label" href=/tags/pentesting/ title=Pentesting>Pentesting</a>
<a class="ui label" href=/tags/pgp/ title=PGP>PGP</a>
<a class="ui label" href=/tags/powershell/ title=powershell>powershell</a>
<a class="ui label" href=/tags/ref/ title=Ref>Ref</a>
<a class="ui label" href=/tags/rooms/ title=rooms>rooms</a>
<a class="ui label" href=/tags/scripting/ title=Scripting>Scripting</a>
<a class="ui label" href=/tags/splunk/ title=splunk>splunk</a>
<a class="ui label" href=/tags/stego/ title=stego>stego</a>
<a class="ui label" href=/tags/sysmon/ title=sysmon>sysmon</a>
<a class="ui label" href=/tags/tools/ title=tools>tools</a>
<a class="ui label" href=/tags/tryhackme/ title=tryhackme>tryhackme</a>
<a class="ui label" href=/tags/vapt/ title=vapt>vapt</a>
<a class="ui label" href=/tags/volatility/ title=Volatility>Volatility</a>
<a class="ui label" href=/tags/vuln-labs/ title="vuln labs">vuln labs</a>
<a class="ui label" href=/tags/wireshark/ title=wireshark>wireshark</a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><h3 class="ui header">Social Links</h3><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:classroom@anir0y.in><i class="large mail icon" title=Email></i></a></div><div class=item><a href=https://twitter.com/anir0y target=_blank><i class="large twitter icon" title=Twitter></i></a></div><div class=item><a href=https://facebook.com/anir0yofficial target=_blank><i class="large facebook icon" title=Facebook></i></a></div><div class=item><a href=https://instagram.com/anir0yofficial target=_blank><i class="large instagram icon" title=Instagram></i></a></div><div class=item><a href=https://www.linkedin.com/in/anir0y target=_blank><i class="large linkedin icon" title=Linkedin></i></a></div><div class=item><a href=https://github.com/anir0y target=_blank><i class="large github icon" title=GitHub></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment">YOU CAN RESUE MY CONTENT</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(c,d,e){var b,f=c.getElementsByTagName(d)[0],a=window.twttr||{};return c.getElementById(e)?a:(b=c.createElement(d),b.id=e,b.src='https://platform.twitter.com/widgets.js',f.parentNode.insertBefore(b,f),a._e=[],a.ready=function(b){a._e.push(b)},a)}(document,'script','twitter-wjs'))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var a=localStore.getItem('hugo-theme-dream-is-dark'),b,c,d;a=a?a:window.defaultDark?'y':a,b="tomorrow",c="tomorrow-night",d=a==='y'?c:b,$('link[data-highlight]').attr('href','https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/'+d+'.min.css'),$('pre').css('background',a==='y'?'#333':'')}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=Search></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON('https://classroom.anir0y.in/index.json',function(a){$('.ui.search').search({source:a,searchFields:['title'],showNoResults:!0})})})</script><script src=/js/search.js></script></body></html>