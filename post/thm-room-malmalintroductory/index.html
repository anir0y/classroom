<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Try Hack ME Room Malware Introductory | Classroom</title>
<link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon><meta name=author content="Animesh Roy @anir0y  "><meta name=description content="Try Hack Me Room MAL Malware Introductory solved by Animesh Roy. this is a walkthough. read more..."><title>Animesh Roy | Classroom Posts</title>
<meta name=title content="Animesh Roy | Blogs & Writeups"><meta name=description content="Animesh Roy has more than a decade worth experience working in cyber security domain. He has worked with governments, corporates, colleges and universities, defence, and the community. He also running a community “Arishti Live” to help everyone who wants to, or work in cyber security domain. His expertise on training & consulting are the best of both the world. He uses his real-life case studies in trainings, to help candidates to understand the job in better ways."><script async src="https://www.googletagmanager.com/gtag/js?id=G-SPD6BXK0P5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SPD6BXK0P5")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","it10lq8bk1")</script><meta property="og:type" content="website"><meta property="og:url" content="https://classroom.anir0y.in/"><meta property="og:title" content="Animesh Roy | Blogs & Writeups"><meta property="og:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="og:image" content="https://i.imgur.com/Ji5C41H.png"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://classroom.anir0y.in/post/thm-room-malmalintroductory/"><meta property="twitter:title" content="Animesh Roy | Blogs & Writeups"><meta property="twitter:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="twitter:image" content="https://i.imgur.com/Ji5C41H.png"><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link rel=canonical href=https://classroom.anir0y.in/post/thm-room-malmalintroductory/><meta property="og:url" content="https://classroom.anir0y.in/post/thm-room-malmalintroductory/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="Try Hack ME Room Malware Introductory"><meta property="og:description" content="Try Hack Me Room MAL Malware Introductory solved by Animesh Roy. this is a walkthough. read more..."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-29T00:08:19+05:30"><meta property="article:modified_time" content="2021-05-29T00:08:19+05:30"><meta property="article:tag" content="Tryhackme"><meta property="article:tag" content="Rooms"><meta property="article:tag" content="Thm"><meta name=twitter:card content="summary"><meta name=twitter:title content="Try Hack ME Room Malware Introductory"><meta name=twitter:description content="Try Hack Me Room MAL Malware Introductory solved by Animesh Roy. this is a walkthough. read more..."><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><link rel=stylesheet href=/css/custom.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i></div><div class=item><i class="large link home icon" title=Home onclick='window.location.href="https://classroom.anir0y.in/"'></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment toc"><nav id=TableOfContents><ul><li><a href=#task-01-what-is-the-purpose-of-malware-analysis>Task 01: What is the Purpose of Malware Analysis?</a></li><li><a href=#task-02-understanding-malware-campaigns>Task 02: Understanding Malware Campaigns</a><ul><li><a href=#targeted>Targeted</a></li><li><a href=#mass-campaign>Mass Campaign</a></li><li><a href=#flags-2>Flags 2</a></li></ul></li><li><a href=#task-03-identifying-if-a-malware-attack-has-happened>Task 03: Identifying if a Malware Attack has Happened</a><ul><li><a href=#1-delivery>1. Delivery</a></li><li><a href=#2-execution>2. Execution</a></li><li><a href=#3-maintaining-persistence>3. Maintaining Persistence</a></li><li><a href=#4-persistence>4. Persistence</a></li><li><a href=#5-propagation>5. Propagation</a></li><li><a href=#host-based-signatures>Host-Based Signatures</a></li><li><a href=#network-based-signatures>Network-Based Signatures</a></li><li><a href=#flags-3>Flags 3</a></li></ul></li><li><a href=#task-04-static-vs-dynamic-analysis>Task 04: Static Vs. Dynamic Analysis</a><ul><li><a href=#static-analysis>Static Analysis.</a></li><li><a href=#dynamic-analysis>Dynamic Analysis</a></li></ul></li><li><a href=#task-05-discussion-of-provided-tools--their-uses>Task 05: Discussion of Provided Tools & Their Uses</a></li><li><a href=#task-06-connecting-to-the-windows-analysis-environment-deploy>Task 06: Connecting to the Windows Analysis Environment (Deploy)</a></li><li><a href=#task-07-obtaining-md5-checksums-of-provided-files>Task 07: Obtaining MD5 Checksums of Provided Files</a><ul><li><a href=#your-task>Your Task:</a></li><li><a href=#flags-7>Flags 7</a></li></ul></li><li><a href=#task-08-now-lets-see-if-the-md5-checksums-have-been-analysed-before>Task 08: Now lets see if the MD5 Checksums have been analysed before</a><ul><li><a href=#flg-8>flg 8</a></li></ul></li><li><a href=#task-09-identifying-if-the-executables-are-obfuscated--packed>Task 09: Identifying if the Executables are obfuscated / packed</a><ul><li><a href=#flags-9>Flags-9</a></li></ul></li><li><a href=#task-10-what-is-obfuscation--packing>Task 10: What is Obfuscation / Packing?</a><ul><li><a href=#theory>Theory:</a></li><li><a href=#practical>Practical:</a></li><li><a href=#flags-10>Flags 10</a></li></ul></li><li><a href=#task-11-visualising-the-differences-between-packed--non-packed-code>Task 11: Visualising the Differences Between Packed & Non-Packed Code</a><ul><li><a href=#practical-1>Practical:</a></li></ul></li><li><a href=#task-12-introduction-to-strings>Task 12: Introduction to Strings</a><ul><li><a href=#theory-1>Theory:</a></li><li><a href=#task>Task:</a></li><li><a href=#flags-12>Flags 12</a></li></ul></li><li><a href=#task-13-introduction-to-imports>Task 13: Introduction to Imports</a><ul><li><a href=#theory-2>Theory:</a></li><li><a href=#practical-2>Practical:</a></li><li><a href=#task-1>Task:</a></li><li><a href=#flags-13>Flags 13</a></li></ul></li><li><a href=#task-14-practical-summary>Task 14: Practical Summary</a><ul><li><a href=#flags-14>Flags 14</a></li><li><a href=#141>14.1</a></li><li><a href=#142>14.2</a></li><li><a href=#144>14.4</a></li></ul></li></ul></nav></div><div class="ui segment actions"><button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i>
</button>
<a href="https://twitter.com/intent/tweet?text=Try%20Hack%20ME%20Room%20Malware%20Introductory&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-malmalintroductory%2f" class="ui circular twitter icon button"><i class="twitter icon"></i>
</a><a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-malmalintroductory%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui top attached segment"><header><h1 class="ui large header">Try Hack ME Room Malware Introductory<div class="sub header">@
<a href=https://anir0y.in target=_blank>Animesh Roy</a>
|
Saturday, May 29, 2021
| 16 minutes read
| Update at
Saturday, May 29, 2021</div></h1></header><article class=main><h1 id=mal-malware-introductory>MAL: Malware Introductory</h1><table><thead><tr><th style=text-align:left>Profile</th><th style=text-align:right>Support</th></tr></thead><tbody><tr><td style=text-align:left><script src=https://tryhackme.com/badge/434937></script></td><td style=text-align:right><a href=https://www.buymeacoffee.com/anir0y><img src="https://img.buymeacoffee.com/button-api/?text=Cheers!!!&emoji=🍺&slug=anir0y&button_colour=BD5FFF&font_colour=ffffff&font_family=Lato&outline_colour=000000&coffee_colour=FFDD00"></a></td></tr></tbody></table><script type=text/javascript language=javascript>var aax_size="300x250",aax_pubname="anir0y-21",aax_src="302"</script><script type=text/javascript language=javascript src=https://c.amazon-adsystem.com/aax2/assoc.js></script><hr><h2 id=task-01-what-is-the-purpose-of-malware-analysis>Task 01: What is the Purpose of Malware Analysis?</h2><p>Malware is such a prevalent topic within Cybersecurity, and often an unfortunately recurring theme among global news today.</p><p>Not only is malware analysis a form of incidence response, but it is also useful in understanding how the behaviours of variants of malware result in their respective categorisation. This room will be a practical introduction to the techniques and tools used throughout malware analysis - albeit brief, I hope to expand on these techniques a lot more in-depth within the future.</p><p>When analysing malware, it is important to consider the following:</p><ul><li>Point of Entry (PoE) I.e. Was it through spam that our e-mail filtering missed and the user opened the attachment? Let&rsquo;s review our spam filters and train our users better for future prevention!</li><li>What are the indicators that malware has even been executed on a machine? Are there any files, processes, or perhaps any attempt of &ldquo;un-ordinary&rdquo; communication?</li><li>How does the malware perform? Does it attempt to infect other devices? Does it encrypt files or install anything like a backdoor / Remote Access Tool (RAT)?</li><li>Most importantly - can we ultimately prevent and/or detect further infection?!</li></ul><hr><h2 id=task-02-understanding-malware-campaigns>Task 02: Understanding Malware Campaigns</h2><p>Despite the many variants of malware, attacks can generally be classified into two types: Targeted and Mass Campaign.</p><h3 id=targeted>Targeted</h3><p>A &ldquo;Targeted&rdquo; attack is just that - targeted. In most cases, malware attacks that occur this way are created for a specific purpose against a specific target. A great example of this type of purpose could be the <a href=https://www.kaspersky.co.uk/resource-center/threats/darkhotel-malware-virus-threat-definition>DarkHotel</a> malware, whom is designed to steal information such as authentication details from government officials.</p><h3 id=mass-campaign>Mass Campaign</h3><p>On the other hand, the &ldquo;Mass Campaign&rdquo; classification can be akin to many real life examples, and is the most common type of attacks. The entire purpose of this type of Malware is to infect as many devices as possible and perform whatever it may - regardless of target.</p><p>Companies such as Kaspersky to name one, track these campaigns (known as Advanced Persistent Threats (APTs) and often report on their infection rate and indicators, much akin to the real-life spread of a virus from the World Health Organisation (WHO).</p><p>Kaspersky <a href=https://www.kaspersky.co.uk/resource-center/threats/crouching-yeti-energetic-bear-malware-threat>report on the &ldquo;Crouching Yeti (Energetic Bear)</a>&rdquo; campaign, this campaign specifically targets the following:</p><ul><li>Industrial/machinery</li><li>Manufacturing</li><li>Pharmaceutical</li><li>Construction</li><li>Education</li><li>Information technology</li></ul><p>(Kaspersky)</p><p>Whilst it this variant is technically targeted, there is a rather large scope of this variant of malware, and as such, can be considered as a &ldquo;Mass Campaign&rdquo; attack.</p><h3 id=flags-2>Flags 2</h3><table><thead><tr><th>Flag ID</th><th style=text-align:center>Questions</th><th style=text-align:left>Ans</th></tr></thead><tbody><tr><td>1</td><td style=text-align:center>What is the famous example of a targeted attack-esque Malware that targeted Iran?</td><td style=text-align:left><code>stuxnet</code></td></tr><tr><td>2</td><td style=text-align:center>What is the name of the Ransomware that used the Eternalblue exploit in a &ldquo;Mass Campaign&rdquo; attack?</td><td style=text-align:left><code>wannacry</code></td></tr></tbody></table><hr><h2 id=task-03-identifying-if-a-malware-attack-has-happened>Task 03: Identifying if a Malware Attack has Happened</h2><p>Much like any interaction with an Operating System, there is always remnants of such activity even if there is little trace&mldr;</p><p>Unfortunately, malware (dependant on its variant) is largely obtrusive - in the sense that it leaves quite an extensive papertrail of evidence&mldr;Perfect for us analysers!</p><p>The ultimate process of a malware attack can be broken down into a few broad steps:</p><ol><li>Delivery</li><li>Execution</li><li>Maintaining persistence (not always the case!)</li><li>Propagation (not always!)</li></ol><p>These steps will generate lots of data. Namely: network traffic such as communicating with hosts, file system interaction like read/writes and modification.</p><p>Malware is essentially classified based upon the behaviours it produces to perform the steps listed above. For a famous example, Wannacry performs all four of these steps.</p><h3 id=1-delivery>1. Delivery</h3><p>This could be of many methods, to name a few: USB (Stuxnet!), PDF attachments through &ldquo;Phising&rdquo; campaigns or vulnerability enumeration.</p><h3 id=2-execution>2. Execution</h3><p>Here&rsquo;s the main part of how we classify Malware. What does it actually do? If it encrypts files - it&rsquo;s Ransomware! If it records information like keystrokes or displays adware - we can classify it as Spyware.</p><p>We only understand this stage through analysing the sample, which is why analysis is important - and is what we&rsquo;ll be covering</p><h3 id=3-maintaining-persistence>3. Maintaining Persistence</h3><p>It wouldn&rsquo;t make much sense for Malware authors to go through all the trouble of developing a piece of code that is capable of execution - just for it to execute and that&rsquo;s it&mldr;Gone. Unless you have a very specific agenda (<a href=https://blog.malwarebytes.com/detections/ransom-cerber/>Cerber</a>).</p><p>I have submitted an extensive report on this specific Malware, amongst others for a University Module on Malware Analysis&mldr;however I will wait for it to be marked before sharing.</p><p>Imagine a keylogger has been installed, but you then restart your Computer 30 seconds later. Unless you&rsquo;ve entered a lot of sensitive information in 30 seconds - that&rsquo;ll be of no use to the author.</p><h3 id=4-persistence>4. Persistence</h3><p>This stage is largely why Malware is so &ldquo;noisy&rdquo;, Malware employs many techniques, of which we&rsquo;ll be covering in-depth much later on. Essentially, this stage is just to make sure that the &ldquo;execution&rdquo; is worth its while.</p><h3 id=5-propagation>5. Propagation</h3><p>Hey&mldr;If you can infect one device, why not infect more whilst you&rsquo;re at it? Again, this is another reason why Malware can be so noticeable. Host discovery generates a lot of network traffic, we&rsquo;ll come to this later.</p><p>In Summary, there are two categories of fingerprints that malware may leave behind on a Host after an attack:</p><h3 id=host-based-signatures>Host-Based Signatures</h3><p>These are generally speaking the results of execution and any persistence performed by the Malware. For example, has a file been encrypted? Has any additional software been installed? These can are two of many, many host-based signatures that are useful to know to prevent and check against further infection.</p><h3 id=network-based-signatures>Network-Based Signatures</h3><p>At an overview, this classification of signatures are the observation of any networking communication taking place during delivery, execution and propagation. For example, in Ransomware, where has the Malware contacted for Bitcoin payments?</p><p>Such as in the case of Wannacry, looking for a large amount of &ldquo;Samba&rdquo; Protocol communication attempts is a great indication of infection due to its use of &ldquo;<a href=https://research.checkpoint.com/2017/eternalblue-everything-know/>Eternalblue</a>&rdquo;.</p><h3 id=flags-3>Flags 3</h3><table><thead><tr><th>Flag ID</th><th style=text-align:center>Questions</th><th style=text-align:left>Ans</th></tr></thead><tbody><tr><td>1</td><td style=text-align:center>Name the first essential step of a Malware Attack?</td><td style=text-align:left><code>Delivery</code></td></tr><tr><td>2</td><td style=text-align:center>Now name the second essential step of a Malware Attack?</td><td style=text-align:left><code>Execution</code></td></tr><tr><td>3</td><td style=text-align:center>What type of signature is used to classify remnants of infection on a host?</td><td style=text-align:left><code>host-based signature</code></td></tr><tr><td>4</td><td style=text-align:center>What is the name of the other classification of signature used after a Malware attack?</td><td style=text-align:left><code>Network-Based Signatures</code></td></tr></tbody></table><hr><h2 id=task-04-static-vs-dynamic-analysis>Task 04: Static Vs. Dynamic Analysis</h2><p>There are two categories used when analysing malware, these are:</p><ol><li><p>Static Analysis</p></li><li><p>Dynamic Analysis</p></li></ol><p>Whilst the methods and tools used for these two categories are vastly different, they are essential in compositing an understanding of how a malware behaves.</p><h3 id=static-analysis>Static Analysis.</h3><p>At its brief, &ldquo;Static Analysis&rdquo; is used to gain a high-level abstraction of the sample - it can be fairly simple to decide if a piece of code is &ldquo;malicious&rdquo; or not with this method alone (but not always, this will be discussed later&mldr;). At its core, this method is of the analysis of the sample at the state it presents itself as, without executing the code.</p><p>Employing the use of techniques such as signature analysis via checksums means quick, efficient (albeit extremely brief) and safe analysis of malware.</p><h3 id=dynamic-analysis>Dynamic Analysis</h3><p>This step is a lot more involved, and is where the abstraction of the sample is largely built upon. &ldquo;Dynamic Analysis&rdquo; essentially involves executing the sample and observing what happens. This of course is not safe. If the sample turns out to be &ldquo;Ransomware&rdquo; - you&rsquo;ve now lost your files. If it is capable of propagating via traversing a network, nice&mldr;You&rsquo;ve now just infected your Local Area Network (LAN).</p><p>Please note that these are extremely simplistic explanations of these techniques, there is a lot more involved which we will go throughout this series.</p><hr><h2 id=task-05-discussion-of-provided-tools--their-uses>Task 05: Discussion of Provided Tools & Their Uses</h2><p>You will see that some tools will overlap between Static and Dynamic analysis:</p><p>Provided Static Analysis Tools:</p><p><code>C:\Users\Analysis\Desktop\Tools\Static\PE Tools</code></p><ul><li>Dependency Walker (depends)</li><li>PeID</li><li>PE Explorer</li><li>PEview</li><li>ResourceHacker</li></ul><p><code>C:\Users\Analysis\Desktop\Tools\Static\Disassembly</code></p><ul><li>IDA Freeware</li><li>WinDbg</li></ul><p><code>C:\Users\Analysis\Desktop\Tools\Sysinternalsuite</code></p><ul><li>ResourceHacker</li></ul><p><code>C:\Users\Analysis\Desktop\Tools\Dynamic</code></p><p>The tools listed here will be used for future tasks, as they involve debugging which is currently out-of-scope for this room&mldr;However, will be explored later within the series.</p><hr><h2 id=task-06-connecting-to-the-windows-analysis-environment-deploy>Task 06: Connecting to the Windows Analysis Environment (Deploy)</h2><hr><h2 id=task-07-obtaining-md5-checksums-of-provided-files>Task 07: Obtaining MD5 Checksums of Provided Files</h2><p>MD5 &ldquo;Checksums&rdquo; are a prominent attribute in the malware Community. Because there can be many variants of a family of Ransomware, these MD5 &ldquo;Checksums&rdquo; are cryptographic &ldquo;fingerprints&rdquo; of the files. This allows a uniformed identification throughout the community - especially with automated Sandboxes.</p><p>For example, say you have 20 files of unknown origin, you are able to identify their genus using their MD5 sum against websites such as <a href=https://www.virustotal.com/gui/>Virustotal</a>, if that MD5 &ldquo;Checksum&rdquo; has been previously analyzed - removing all the legwork for us!</p><p>Navigate to the &ldquo;Tasks&rdquo; Folder on the Desktop, and then enter the &ldquo;Task 7&rdquo; Directory, where there will be three files:</p><ul><li>aws.exe</li><li>NetLog.exe</li><li>vlc.exe</li></ul><p>Sure, these are common names of executables, but anyone can name an executable as whatever they like! Just because it says &ldquo;vlc&rdquo; doesn&rsquo;t mean it is indeed the VLC application! This is where identifying their MD5 Checksum is useful, as no matter the name - their MD5 reveals its true identity.</p><p>I have installed the &ldquo;<a href=http://implbits.com/products/hashtab/>HashTab</a>&rdquo; application, which calculates a files MD5 sum - amongst others, directly within Windows Explorer as if you were inspecting its properties&mldr;</p><p><img src=https://i.imgur.com/e5xemTO.png alt=hashtab></p><h3 id=your-task>Your Task:</h3><p>Identify the MD5 Checksums of the three files provided in &ldquo;Task 7&rdquo; (You can use Ctrl + C & Ctrl + V over RDP)</p><h3 id=flags-7>Flags 7</h3><p>I used certutil.exe to complete the task:</p><p><img src=https://i.imgur.com/oS5CK6Q.png alt></p><hr><h2 id=task-08-now-lets-see-if-the-md5-checksums-have-been-analysed-before>Task 08: Now lets see if the MD5 Checksums have been analysed before</h2><p>Outside of the Remote Windows Environment i.e. Kali or your Windows PC, look up those MD5 &ldquo;Checksums&rdquo; on Virustotal to solve this task:</p><h3 id=flg-8>flg 8</h3><p><img src=https://i.imgur.com/kx8gxmf.png alt></p><hr><h2 id=task-09-identifying-if-the-executables-are-obfuscated--packed>Task 09: Identifying if the Executables are obfuscated / packed</h2><p>There are a few provided tools on this Windows instance that are capable of identifying the compiler / packer of a file. However, PeID has a huge database and is a great tool for this.</p><p>Moreover, just because a file doesn&rsquo;t have the &ldquo;.exe&rdquo; extension, doesn&rsquo;t mean it isn&rsquo;t an actual executable! For instance, it can have the &ldquo;.jpg&rdquo; extension and still be an executable piece of code. This is a tad-bit out of scope for this room specifically, but essentially, files have identifying attributes within its hex - known as file headers.</p><p>E.g. The hex value for an executable is always &ldquo;4D 5A&rdquo;. So if a file with a &ldquo;.jpg&rdquo; file has the hex header of &ldquo;4D 5A&rdquo;, then it is obviously not a jpg file. You can read more into file headers / trailers <a href=https://www.garykessler.net/library/file_sigs.html>here</a>, which are great resources for data carving in file forensics / recovery.</p><p><strong>Provided Tools: PeID</strong></p><p>Now using &ldquo;PeID&rdquo;, identify the compiler / packer of the following two files in the Directory &ldquo;Tasks/Task 9&rdquo; to answer the questions.<br><img src=https://i.imgur.com/tkj30Rv.png alt>
An example of using PEiD to identify the packer of a file. In this case, it is reported as &ldquo;Microsoft Visual C++ 6.0&rdquo;</p><h3 id=flags-9>Flags-9</h3><table><thead><tr><th>Flag ID</th><th style=text-align:center>Questions</th><th style=text-align:left>Ans</th></tr></thead><tbody><tr><td>1</td><td style=text-align:center>What does PeID propose 1DE9176AD682FF.dll being packed with</td><td style=text-align:left><code>MicroSoft Visual C++ 6.0 DLL</code></td></tr><tr><td>2</td><td style=text-align:center>What does PeID propose AD29AA1B.bin being packed with?</td><td style=text-align:left><code>Microsoft Visual C++ 6.0</code></td></tr></tbody></table><h4 id=flag-91>Flag-9.1</h4><p><img src=https://i.imgur.com/tkj30Rv.png alt></p><h4 id=flag-92>Flag-9.2</h4><p><img src=https://i.imgur.com/6nir5bY.png alt></p><hr><h2 id=task-10-what-is-obfuscation--packing>Task 10: What is Obfuscation / Packing?</h2><h3 id=theory>Theory:</h3><p>Packing is one form of obfuscation that malware Authors employ to prevent the analysis of programmes. There are both legitimate and malicious reasons as to why the Author of a program will want to prevent the decompiling of their program.</p><p>For example, a legitimate reason is the protection of intellectual property! Whilst I&rsquo;m one for open-source as much as the next person here - alas not every organisation has the same mindset&mldr;but let&rsquo;s leave that aside.</p><p>In the same token, just because you write a program&mldr;Why should everyone have the right to &ldquo;copy&rdquo; your project? This is one of the justifiable reasons for obfuscation - it is yours at the end of the day!</p><p>However, malware Authors employ obfuscation techniques such as packing - whilst for the same reasons, they do so with the intent to prevent people like us reversing it to understand its behaviours and ultimately with the aims of achieving infection.</p><p>How packing works is out of scope for this room, but I hope to be able to delve into topics like these later on within THM, so that you can understand the theory behind the practical skills you&rsquo;ll be using.</p><h3 id=practical>Practical:</h3><p>Your task is to identify whether or not the file &ldquo;6F431F46547DB2628&rdquo; located in the Directory of &ldquo;Tasks\Task 10&rdquo; is packed using the tool &ldquo;PeID&rdquo; akin to the task you just completed!</p><h3 id=flags-10>Flags 10</h3><table><thead><tr><th>Flag ID</th><th style=text-align:center>Questions</th><th style=text-align:left>Ans</th></tr></thead><tbody><tr><td>1</td><td style=text-align:center>What packer does PeID report file &ldquo;6F431F46547DB2628&rdquo; to be packed with?</td><td style=text-align:left><code>FSG 1.0 -> dulek/xt</code></td></tr></tbody></table><h4 id=flag-101>Flag-10.1</h4><p><img src=https://i.imgur.com/DJFAKEd.png alt></p><hr><h2 id=task-11-visualising-the-differences-between-packed--non-packed-code>Task 11: Visualising the Differences Between Packed & Non-Packed Code</h2><p>This is another example of why PeID is a fantastic little tool. With its huge dataset of known packers, it is arguably one of the better ones at being able to fingerprint the names of packers / obfuscators within an application.</p><p>Whilst this tool has a huge database, it doesn&rsquo;t have every packer out there! Especially say if an Author has written their own - PeID will have no way of identifying the packer used. In cases like this, it&rsquo;s more about what PeID doesn&rsquo;t tell us - rather than what it does.</p><h3 id=practical-1>Practical:</h3><p>You can try this yourself by navigating to directory &ldquo;Tasks/Task 11&rdquo; and dragging and dropping that file into PeID. What does it tell us?<br><img src=https://i.imgur.com/JVOrgcz.png alt></p><p>In this instance, PeID is able to detect what packer has been used to obfuscate the code. Whilst PeID is capable of detecting the possibility of packers being used, it is not able to automatically de-obfuscate them. This is a process we will have to do manually - at a later stage.</p><p>After confirming that this file is indeed packed, let&rsquo;s open it up with a tool called IDA Freeware. This is located in the &ldquo;Tools/Static/Disassembly&rdquo; directory (or you can search for it through Windows Toolbar). Notice how there is a very minimal amount of information provided to us? For example, the &ldquo;Imports&rdquo; tab is practically empty! Little odd&mldr;right?</p><p>When opening the file, a few dialogue boxes may appear - its just IDA Freeware processing the file, it&rsquo;ll take a couple of seconds</p><p><img src=https://i.imgur.com/GJZPTRK.png alt></p><p><img src=https://i.imgur.com/q8MknAs.png alt></p><p>We can see there are only two &ldquo;Imports&rdquo; in this program! That&rsquo;s a bit bizarre&mldr;</p><p>&mldr;The use of &ldquo;IDA Free&rdquo; will be developed upon as it is an advanced bit of kit. But essentially, we can see the flow of how the program executes - indicated by the arrows. The problem? There&rsquo;s very little here! There are a few more characteristics that indicate its packed, but this is also beyond the scope for this room.</p><p><img src=https://i.imgur.com/YtCCrw1.png alt></p><p>Whereas, if we were to open a file that isn&rsquo;t obfuscated, we should expect to see a much larger import count and graph/flowchart, like this:</p><p><img src=https://i.imgur.com/yOyFwrJ.png alt></p><p><img src=https://i.imgur.com/XM6eSBr.png alt></p><p>See how there&rsquo;s so much more information here? Obfuscated code is much harder to analyze at least at the static level, as we&rsquo;re presented with very little information!</p><hr><h2 id=task-12-introduction-to-strings>Task 12: Introduction to Strings</h2><h3 id=theory-1>Theory:</h3><p>&ldquo;Strings&rdquo; are essentially the ASCII / Text contents of a program&mldr;this could be anything from passwords for self-extracting zips, to bitcoin addresses in ransomware samples.</p><p>Such as that in the example above, when analysing the contents of these strings, we can sometimes paint a fairly indicative picture of the behaviours of the programme - bitcoin wallets being used in ransomware.</p><h3 id=task>Task:</h3><p>Open a Command prompt on the Windows Machine and navigate to the directory &ldquo;Tools\Sysinternalssuite&rdquo;</p><p><code>cd C:\Users\Analysis\Desktop\Tools\SysinternalsSuite</code></p><p>Keep this terminal open.</p><p>We&rsquo;re going to use Microsoft&rsquo;s Sysinternals &ldquo;Strings&rdquo; program to output the retained strings within the specified file in &ldquo;Task 12&rdquo;. We can do this by:</p><p><code>strings "C:\Users\Analysis\Desktop\Tasks\Task 12\67844C01"</code></p><p>You will receive a whole load of text, most of it looks like nonsense&mldr;But there is some text in there that is valuable. Scroll up!</p><p><img src=https://i.imgur.com/PZBczF7.png alt></p><p>Proceed to answering Question 1.</p><p>You&rsquo;ll find that programs often contain large amount of strings and using the &ldquo;strings&rdquo; tool from sysinternals may only display 10% of these&mldr;</p><p>&mldr;That and it&rsquo;s not exactly practical scrolling up through a terminal for stuff like this - we are on Windows afterall! There&rsquo;s a GUI tool for that.</p><p>Launch the application within &ldquo;Tools/Static/PE Tools/PE Explorer&rdquo; and drag and drop the same file &ldquo;67844C01&rdquo; from the previous question into the application.</p><p><img src=https://i.imgur.com/XDmSuSX.png alt></p><p>Where you will be presented with the following, indicating that it has successfully imported:</p><p><img src=https://i.imgur.com/822wO58.png alt></p><p>After import. Navigate to &ldquo;View -> Imports&rdquo;</p><p><img src=https://i.imgur.com/jQr7zsI.png alt></p><p><img src=https://i.imgur.com/YFI42EL.png alt></p><p>You can now answer Question #2!</p><h3 id=flags-12>Flags 12</h3><table><thead><tr><th>Flag ID</th><th style=text-align:center>Questions</th><th style=text-align:left>Ans</th></tr></thead><tbody><tr><td>1</td><td style=text-align:center>What is the URL that is outputted after using &ldquo;strings&rdquo;</td><td style=text-align:left><code>practicalmalwareanalysis.com</code></td></tr><tr><td>2</td><td style=text-align:center>How many unique &ldquo;Imports&rdquo; are there?</td><td style=text-align:left><code>5</code></td></tr></tbody></table><h4 id=121>12.1</h4><p><img src=https://i.imgur.com/MrCYVbE.png alt></p><h4 id=122>12.2</h4><p><img src=https://i.imgur.com/IrSUgL1.png alt></p><hr><h2 id=task-13-introduction-to-imports>Task 13: Introduction to Imports</h2><h3 id=theory-2>Theory:</h3><p>The classification of IDA Freeware is arguable as the tool can be used for both static and dynamic analysis. Without going too in-depth regarding the differences, there are two classifications of tools like IDA Freeware:</p><ul><li>Disassemblers</li><li>Debuggers</li></ul><p>I&rsquo;ll allow you to explore the differences between these two types of tools and their use cases in your own time, but for contextual sake - Disassemblers reverse the compiled code of a program from machine code to human-readable instructions (assembly). This is limited to how the program represents itself in its current state! I.e. If the contents of an executable changes during execution - &ldquo;Disassemblers&rdquo; will not reflect this.</p><p>Whilst Debuggers deploy the same techniques used by &ldquo;Disassemblers&rdquo;, &ldquo;Debuggers&rdquo; essentially facilitate execution of the program - where the analyser can view the changes made throughout each &ldquo;step&rdquo; of the program. These tools are great because a true picture of the program presents itself. However, if it is indeed malicious, you have now infected yourself.</p><p>With enough understanding, an analyser can introduce &ldquo;breakpoints&rdquo; (or pauses) at various stages of a program, where the program will execute up until a breakpoint. For example, sticking with the idea of Ransomware, an analyser can create a &ldquo;breakpoint&rdquo; within the application prior to the actual stage of encryption of files. This facilitates an analyser to view the various changes of a program during execution (such as unpacking or connecting to a remote server such as that in a botnet) up until the point of malicious infection.</p><h3 id=practical-2>Practical:</h3><p>For this room, we will be using IDA Freeware within the context of statistical analysis. I&rsquo;ll walkthrough how to import an executable into IDA Freeware below.</p><ol><li>Lets launch &ldquo;IDA Freeware&rdquo; and select the file to import, in this case we&rsquo;ll be using &ldquo;uninstall.exe&rdquo;</li></ol><p><img src=https://i.imgur.com/vmv9Xsc.png alt></p><p>And navigate to the file&mldr;</p><p><img src=https://i.imgur.com/G3VAJc1.png alt></p><ol start=2><li>Since we know it is an executable file, we select &ldquo;Portable executable for 80386 (PE) [pe64.dll]&rdquo;</li></ol><p><img src=https://i.imgur.com/I9TUxXi.png alt></p><ol start=3><li>After pressing &ldquo;OK&rdquo; the application will load. Allow a few minutes for the executable to be decompiled.</li></ol><p><img src=https://i.imgur.com/wbQGqxH.png alt></p><p>There are various tabs, similar to what we saw in &ldquo;PE Explorer&rdquo; i.e. &ldquo;Imports&rdquo; and &ldquo;Exports&rdquo;.</p><h3 id=task-1>Task:</h3><p>Navigate to the directory &ldquo;Tasks/Task 13&rdquo; and open &ldquo;install.exe&rdquo; with IDA Freeware, just like we did in the example above. Again, this may take a few seconds to a couple of minutes to compute dependant upon the size of the application. For this task expect roughly ~20 seconds.</p><p>You can now answer the question below:</p><h3 id=flags-13>Flags 13</h3><table><thead><tr><th>Flag ID</th><th style=text-align:center>Questions</th><th style=text-align:left>Ans</th></tr></thead><tbody><tr><td>1</td><td style=text-align:center>How many references are there to the library &ldquo;msi&rdquo; in the &ldquo;Imports&rdquo; tab of IDA Freeware for &ldquo;install.exe&rdquo;</td><td style=text-align:left><code>9</code></td></tr></tbody></table><h4 id=131>13.1</h4><p><img src=https://i.imgur.com/OJ9pGIR.png alt></p><hr><h2 id=task-14-practical-summary>Task 14: Practical Summary</h2><p>The file specified for analysis is &ldquo;ComplexCalculator.exe&rdquo; in the Directory &ldquo;Tasks/Task 14&rdquo;. I&rsquo;ll leave it up to you to figure out what tool(s) out of what we&rsquo;ve used above is best!</p><h3 id=flags-14>Flags 14</h3><table><thead><tr><th>Flag ID</th><th style=text-align:center>Questions</th><th style=text-align:left>Ans</th></tr></thead><tbody><tr><td>1</td><td style=text-align:center>What is the MD5 Checksum of the file?</td><td style=text-align:left><code>f5bd8e6dc6782ed4dfa62b8215bdc429</code></td></tr><tr><td>2</td><td style=text-align:center>Does Virustotal report this file as malicious? (Yay/Nay)</td><td style=text-align:left><code>yay</code></td></tr><tr><td>3</td><td style=text-align:center>Output the strings using Sysinternals &ldquo;strings&rdquo; tool What is the last string outputted?</td><td style=text-align:left><code>D:H:</code></td></tr><tr><td>4</td><td style=text-align:center>What is the output of PeID when trying to detect what packer is used by the file?</td><td style=text-align:left><code>Nothing Found</code></td></tr></tbody></table><h3 id=141>14.1</h3><p><img src=https://i.imgur.com/6bQqLB6.png alt></p><h3 id=142>14.2</h3><p><img src=https://i.imgur.com/FwlR0ld.png alt></p><h3 id=144>14.4</h3><p><img src=https://i.imgur.com/4qwKCKw.png alt></p><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr></article></section></div></div><footer class="ui basic center aligned segment" style=background-color:transparent><p>© 2010 - 2024 Classroom</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/img/avatar.jpeg></div><div class=content><h1 class="ui medium header">Reading Stuffs<div class="sub header"></div></h1><article class="ui horizontal list"><a class=item href=/categories><i class="th list icon" title="All Categories"></i>
</a><a class=item href=/tags><i class="tags icon" title="All Tags"></i></a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><h3 class="ui header">Social Links</h3><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:classroom@anir0y.in><i class="large mail icon" title=Email></i></a></div><div class=item><a href=https://twitter.com/anir0y target=_blank><i class="large twitter icon" title=Twitter></i></a></div><div class=item><a href=https://facebook.com/0xanir0y target=_blank><i class="large facebook icon" title=Facebook></i></a></div><div class=item><a href=https://instagram.com/0xanir0y target=_blank><i class="large instagram icon" title=Instagram></i></a></div><div class=item><a href=https://www.linkedin.com/in/anir0y target=_blank><i class="large linkedin icon" title=Linkedin></i></a></div><div class=item><a href=https://github.com/anir0y target=_blank><i class="large github icon" title=GitHub></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment">YOU CAN REUSE MY CONTENT</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(e,t,n){var o,i=e.getElementsByTagName(t)[0],s=window.twttr||{};return e.getElementById(n)?s:(o=e.createElement(t),o.id=n,o.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(o,i),s._e=[],s.ready=function(e){s._e.push(e)},s)}(document,"script","twitter-wjs"))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var e=localStore.getItem("hugo-theme-dream-is-dark"),e=e?e:window.defaultDark?"y":e,t="tomorrow",n="tomorrow-night",s=e==="y"?n:t;$("link[data-highlight]").attr("href","https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/"+s+".min.css"),$("pre").css("background",e==="y"?"#333":"")}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=Search></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON("https://classroom.anir0y.in//index.json",function(e){$(".ui.search").search({source:e,searchFields:["title"],showNoResults:!0})})})</script><script src=/js/search.js></script></body></html>