<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Try Hack Me Room Core Windows Processes | Classroom</title><link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon><meta name=author content="Animesh Roy"><meta name=description content="Try Hack ME Room Core Windows Processes walkthough"><script async src="https://www.googletagmanager.com/gtag/js?id=G-NZBEX7RBNF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NZBEX7RBNF')</script><script type=text/javascript>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","6gp5990ghr")</script><link rel=canonical href=https://classroom.anir0y.in/post/thm-room-btwindowsinternals/><meta property="og:title" content="Try Hack Me Room Core Windows Processes"><meta property="og:description" content="Try Hack ME Room Core Windows Processes walkthough"><meta property="og:type" content="article"><meta property="og:url" content="https://classroom.anir0y.in/post/thm-room-btwindowsinternals/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-11T00:23:04+05:30"><meta property="article:modified_time" content="2021-05-11T00:23:04+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Try Hack Me Room Core Windows Processes"><meta name=twitter:description content="Try Hack ME Room Core Windows Processes walkthough"><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i></div><div class=item><i class="large link home icon" title=Home onclick="window.location.href='https://classroom.anir0y.in'"></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment toc"><nav id=TableOfContents><ul><li><a href=#task-1--nothing-imp>Task 1: Nothing IMP</a></li><li><a href=#task-2-task-manager>Task 2: Task Manager</a></li><li><a href=#task-3-system>Task 3: System</a></li><li><a href=#flags>Flags</a></li><li><a href=#task-4-system--smssexe>Task 4: System > smss.exe</a></li><li><a href=#flags-1>Flags</a></li><li><a href=#csrssexe>csrss.exe</a></li><li><a href=#flags-2>Flags</a></li><li><a href=#task-6--wininitexe>Task 6: wininit.exe</a></li><li><a href=#flags-3>Flags</a></li><li><a href=#wininitexe--servicesexe>wininit.exe > services.exe</a></li><li><a href=#flags-4>Flags</a></li><li><a href=#wininitexe--servicesexe--svchostexe>wininit.exe > services.exe > svchost.exe</a></li><li><a href=#flags-5>Flags</a></li><li><a href=#task-9--lsassexe>Task 9: lsass.exe</a></li><li><a href=#flags-6>Flags</a></li><li><a href=#task-10--winlogonexe>Task 10: winlogon.exe</a></li><li><a href=#flags-7>Flags</a></li><li><a href=#task-11--explorerexe>Task 11: explorer.exe</a></li><li><a href=#flags-8>Flags</a></li><li><a href=#task-12--conclusion>Task 12: conclusion</a></li><li><a href=#flags-9>Flags</a></li></ul></nav></div><div class="ui segment actions"><button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i></button>
<a href="https://twitter.com/intent/tweet?text=Try%20Hack%20Me%20Room%20Core%20Windows%20Processes&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-btwindowsinternals%2f" class="ui circular twitter icon button"><i class="twitter icon"></i></a>
<a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-btwindowsinternals%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui top attached segment"><header><h1 class="ui large header">Try Hack Me Room Core Windows Processes<div class="sub header">@
<a href=https://anir0y.in target=_blank>Animesh Roy</a>
|
Tuesday, May 11, 2021
| 15 minutes read
| Update at
Tuesday, May 11, 2021</div></h1></header><article class=main><h2 id=task-1--nothing-imp>Task 1: Nothing IMP</h2><h2 id=task-2-task-manager>Task 2: Task Manager</h2><p>Task Manager is a built-in GUI-based Windows utility that allows users to see what is running on the Windows system. It also provides information on resource usage, such as how much CPU and memory are utilized by each process. When a program is not responding, Task Manager is used to end (kill) the process.</p><p>If you&rsquo;re not familiar with Task Manager, we&rsquo;ll go through a brief overview.</p><p>To open Task Manager, right-click the Taskbar. When the new window appears, select <code>Task Manager</code> (as shown below).</p><p><img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager.png alt></p><p>If you don&rsquo;t have any apps that you explicitly opened, then you should see the same message as shown below.
<img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager-2.png alt></p><p>Weird. Not seeing much, eh? Within a Windows system, many processes are running. Click on <code>More details</code>.
<img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager-3.png alt></p><p>Ok, now we&rsquo;re getting somewhere. Notice the 5 tabs within Task Manager. By default, the current tab is <code>Processes</code>.</p><p>Note: If you&rsquo;re running Task Manager on your Windows machine, you might see additional tabs.</p><p>In the above image (or if you&rsquo;re following along within your own Windows system), notice that the processes are categorized: <code>Apps</code> and <code>Background processes</code>. Another category that is not visible in the above image is <code>Windows processes</code>.</p><p>The columns are very minimal. The columns Name, Status, CPU, and Memory, are the only ones visible. To view more columns, right-click on any of the column headers to open more options.
<img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager-4.png alt></p><p><img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager-5.png alt></p><p>This looks a little better. Let&rsquo;s briefly go over each column (excluding Name, of course):</p><ul><li><strong>Type</strong> - Each process falls into 1 of 3 categories (Apps, Background process, or Windows process).</li><li><strong>Publisher</strong> - Think of this column as the name of the author of the program/file.</li><li><strong>PID</strong> - This is known as the process identifier number. Windows assigns a unique process identifier each time a program starts. If the same program has multiple processes running, each will have its own unique process identifier (PID).</li><li><strong>Process name</strong> - This is the file name of the process. In the above image, the file name for Task Manager is Taskmrg.exe.</li><li><strong>Command line</strong> - The full command used to launch the process.</li><li><strong>CPU</strong> - The amount of CPU (processing power) used by the process.</li><li><strong>Memory</strong> - The amount of physical working memory utilized by the process.</li></ul><p>This is a utility you should be comfortable with using, whether you&rsquo;re troubleshooting or performing analysis on the endpoint.</p><p>Let&rsquo;s move to the <code>Details</code> tab. Within this view are some of the core processes that will be discussed in this room. Sort the PID column so that the PIDs are in ascending order.</p><p><img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager-6.png alt>
Add some additional columns to see more information about these processes. Good columns to add are <code>Image path name</code> and <code>Command line</code>.</p><p>These 2 columns can quickly alert an analyst on any outliers with a given process. For example, in the below image, PID 384 is paired with a process named svchost.exe, a Windows process, but if the Image path name or Command line is not what it&rsquo;s expected to be, then we can perform a deeper analysis on this process.
<img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager-7.png alt></p><p>Of course, you can add as many columns as you wish, but it&rsquo;s recommended to add the columns that would be pertinent to your current task.</p><p>Task Manager is a powerful built-in Windows utility but lacks certain important information when analyzing processes, such as parent process information. This is another key column when identifying outliers. Back to svchost.exe, if the parent process for PID 384 is not services.exe, then this will warrant further analysis.</p><p>To further prove this point, where is services.exe?
<img src=https://assets.tryhackme.com/additional/windows-processes/taskmanager-8.png alt></p><p>Based on the above image, the PID for services.exe is 632. But wait, one of the svchost.exe processes has a PID of 384. How did svchost.exe start before services.exe? Well, it didn&rsquo;t. Task Manager doesn&rsquo;t show a Parent-Child process view. That is where other utilities, such as Process Hacker and Process Explorer, come to the rescue.</p><p><strong>Process Hacker</strong>
<img src=https://assets.tryhackme.com/additional/windows-processes/processhacker.png alt></p><p><strong>Process Explorer</strong>
<img src=https://assets.tryhackme.com/additional/windows-processes/process-explorer.png alt></p><p>Moving forward, I&rsquo;ll use both Process Hacker and Process Explorer instead of Task Manager to obtain information about each of the Windows processes.</p><p>As always, it&rsquo;s encouraged that you inspect and familiarize yourself with all information that is available within Task Manager. It&rsquo;s a built-in utility that is available in every Windows system. You might find yourself in a situation where you can&rsquo;t bring your tools to the fight and rely on the tools that are native to the system.</p><p>Aside from Task Manager, it would be best if you also familiarize yourself with the command-line equivalent of obtaining information about the running processes on a Windows system: <code>tasklist</code>, <code>Get-Process</code> or <code>ps</code> (PowerShell), and <code>wmic</code>.</p><h2 id=task-3-system>Task 3: System</h2><p>The first Windows process on the list is System. It was mentioned in a previous section that a PID for any given process is assigned at random, but that is not the case for the System process. The PID for System is always 4. What does this process do exactly?</p><p>The official definition from Windows Internals 6th Edition:</p><p>&ldquo;The System process (process ID 4) is the home for a special kind of thread that runs only in kernel mode a kernel-mode system thread. System threads have all the attributes and contexts of regular user-mode threads (such as a hardware context, priority, and so on) but are different in that they run only in kernel-mode executing code loaded in system space, whether that is in Ntoskrnl.exe or in any other loaded device driver. In addition, system threads don&rsquo;t have a user process address space and hence must allocate any dynamic storage from operating system memory heaps, such as a paged or nonpaged pool.&rdquo;</p><p>What is user mode? Kernel-mode? Visit the following link (<a href=https://docs.microsoft.com/en-us/windows-hardware/drivers/gettingstarted/user-mode-and-kernel-mode>here</a>) to understand each of these.</p><p>Now, what is normal behavior for this process? Let&rsquo;s use Process Explorer and view the properties for System.</p><p><img src=https://assets.tryhackme.com/additional/windows-processes/system.png alt></p><p><strong>Image Path</strong>: N/A</p><p><strong>Parent Process</strong>: None</p><p><strong>Number of Instances</strong>: One</p><p><strong>User Account</strong>: Local System</p><p><strong>Start Time</strong>: At boot time</p><p>The information is slightly different if we view the System properties using Process Hacker.</p><p><img src=https://assets.tryhackme.com/additional/windows-processes/system2.png alt></p><p><strong>Image Path</strong>: C:\Windows\system32\ntoskrnl.exe (NT OS Kernel)</p><p><strong>Parent Process</strong>: System Idle Process (0)</p><p>Technically this is correct. Notice that Process Hacker confirms this is legit &lsquo;(Verified) Microsoft Windows.</p><p><strong>What is unusual behavior for this process?</strong></p><ul><li>A parent process (aside from System Idle Process (0))</li><li>Multiple instances of System. (Should only be 1 instance)</li><li>A different PID. (Remember that the PID will always be PID 4)</li><li>Not running in Session 0</li></ul><p>&ndash;</p><h2 id=flags>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What PID should System always be?</td><td><code>4</code></td></tr></tbody></table><hr><h2 id=task-4-system--smssexe>Task 4: System > smss.exe</h2><p>The next process is smss.exe (Session Manager Subsystem). This process, also known as the Windows Session Manager, is responsible for creating new sessions. This is the first user-mode process started by the kernel.</p><p>This process starts the kernel mode and user mode of the Windows subsystem (you can read more about the NT Architecture <a href=https://en.wikipedia.org/wiki/Architecture_of_Windows_NT>here</a>). This subsystem includes win32k.sys (kernel mode), winsrv.dll (user mode), and csrss.exe (user mode).</p><p>Smss.exe starts csrss.exe (Windows subsystem) and wininit.exe in Session 0, an isolated Windows session for the operating system, and csrss.exe and winlogon.exe for Session 1, which is the user session. The first child instance creates child instances in new sessions. This is done by smss.exe copying itself into the new session and self-terminating. You can read more about this process <a href=https://en.wikipedia.org/wiki/Session_Manager_Subsystem>here</a>.</p><p>Session 0 (csrss.exe & wininit.exe)
<img src=https://assets.tryhackme.com/additional/windows-processes/smss-session0-tree.png alt></p><p><img src=https://assets.tryhackme.com/additional/windows-processes/smss-session0b.png alt></p><p>Session 1 (csrss.exe & winlogon.exe)
<img src=https://assets.tryhackme.com/additional/windows-processes/smss-session1-tree.png alt>
<img src=https://assets.tryhackme.com/additional/windows-processes/smss-session1b.png alt></p><p>Any other subsystem listed in the <code>Required</code> value of <code>HKLM\System\CurrentControlSet\Control\Session Manager\Subsystems</code> is also launched.
<img src=https://assets.tryhackme.com/additional/windows-processes/smss-registry.png alt>
SMSS is also responsible for creating environment variables, virtual memory paging files and starts winlogon.exe (the Windows Logon Manager).</p><p>what is normal?
<img src=https://assets.tryhackme.com/additional/windows-processes/smss.png alt></p><ul><li><strong>Image Path</strong>: %SystemRoot%\System32\smss.exe</li><li><strong>Parent Process</strong>: System</li><li><strong>Number of Instances</strong>: One master instance and child instance per session. The child instance exits after creating the session.</li><li><strong>User Account</strong>: Local System</li><li><strong>Start Time</strong>: Within seconds of boot time for the master instance</li></ul><p>What is unusual?</p><ul><li>A different parent process other than System(4)</li><li>Image path is different from C:\Windows\System32</li><li>More than 1 running process. (children self-terminate and exit after each new session)</li><li>User is not SYSTEM</li><li>Unexpected registry entries for Subsystem</li></ul><hr><h2 id=flags-1>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What other process does smss.exe start in Session 1? (answer format: process, process)</td><td></td></tr><tr><td><code>csrss.exe, winlogon.exe</code></td><td></td></tr></tbody></table><hr><h2 id=csrssexe>csrss.exe</h2><p>As mentioned in the previous section, csrss.exe (Client Server Runtime Process) is the user-mode side of the Windows subsystem. This process is always running and is critical to system operation. If by chance this process is terminated it will result in system failure. This process is responsible for the Win32 console window and process thread creation and deletion. For each instance csrsrv.dll, basesrv.dll, and winsrv.dll are loaded (along with others).</p><p>This process is also responsible for making the Windows API available to other processes, mapping drive letters, and handling the Windows shutdown process. You can read more about this process <a href=https://en.wikipedia.org/wiki/Client/Server_Runtime_Subsystem>here</a>.</p><p>Note: Recall that csrss.exe and winlogon.exe are called from smss.exe at startup for Session 1.</p><p>What is normal?</p><p>Session 0 (PID 392)
<img src=https://assets.tryhackme.com/additional/windows-processes/csrss-session0.png alt></p><p>Session 1 (PID 512)
<img src=https://assets.tryhackme.com/additional/windows-processes/csrss-session1.png alt>
Notice what is shown for the parent process for these 2 processes. Remember these processes are spawned by smss.exe which self-terminates itself.</p><ul><li>Image Path: %SystemRoot%\System32\csrss.exe</li><li>Parent Process: Created by an instance of smss.exe</li><li>Number of Instances: Two or more</li><li>User Account: Local System</li><li>Start Time: Within seconds of boot time for the first 2 instances (for Session 0 and 1). Start times for additional instances occur as new sessions are created, although often only Sessions 0 and 1 are created.</li></ul><p><strong>What is unusual?</strong></p><ul><li>An actual parent process. (smss.exe calls this process and self-terminates)</li><li>Image file path other than C:\Windows\System32</li><li>Subtle misspellings to hide rogue process masquerading as csrss.exe in plain sight</li><li>User is not SYSTEM</li></ul><hr><h2 id=flags-2>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What was the process which had PID 384 and PID 488?</td><td><code>smss.exe</code></td></tr></tbody></table><hr><h2 id=task-6--wininitexe>Task 6: wininit.exe</h2><p>The Windows Initialization Process, wininit.exe, is responsible for launching services.exe (Service Control Manager), lsass.exe (Local Security Authority), and lsaiso.exe within Session 0. This is another critical Windows process that runs in the background, along with its child processes.
<img src=https://assets.tryhackme.com/additional/windows-processes/wininit-tree.png alt></p><p>Note: lsaiso.exe is a process associated with Credential Guard and Key Guard. You will only see this process if Credential Guard is enabled.</p><p>What is normal?
<img src=https://assets.tryhackme.com/additional/windows-processes/wininit.png alt></p><p><strong>Image Path</strong>: %SystemRoot%\System32\wininit.exe</p><p><strong>Parent Process</strong>: Created by an instance of smss.exe</p><p><strong>Number of Instances</strong>: One</p><p><strong>User Account</strong>: Local System</p><p><strong>Start Time</strong>: Within seconds of boot time</p><p>What is unusual?</p><ul><li>An actual parent process. (smss.exe calls this process and self-terminates)</li><li>Image file path other than C:\Windows\System32</li><li>Subtle misspellings to hide rogue process in plain sight</li><li>Multiple running instances</li><li>Not running as SYSTEM</li></ul><hr><h2 id=flags-3>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>Which process you might not see running if Credential Guard is not enabled?</td><td><code>lsaiso.exe</code></td></tr></tbody></table><hr><h2 id=wininitexe--servicesexe>wininit.exe > services.exe</h2><p>The next process is the Service Control Manager (SCM), which is services.exe. Its primary responsibility is to handle system services: loading services, interacting with services, starting/ending services, etc. It maintains a database that can be queried using a Windows built-in utility, &lsquo;sc.exe.&rsquo;
<img src=https://assets.tryhackme.com/additional/windows-processes/scm.png alt></p><p>Information regarding services is stored in the registry, <code>HKLM\System\CurrentControlSet\Services</code>.
<img src=https://assets.tryhackme.com/additional/windows-processes/services-registry.png alt></p><p>This process also loads device drivers marked as auto-start into memory.</p><p>When a user logs into a machine successfully, this process is responsible for setting the value of the Last Known Good control set (Last Known Good Configuration), <code>HKLM\System\Select\LastKnownGood</code>, to that of the CurrentControlSet.
<img src=https://assets.tryhackme.com/additional/windows-processes/lastknowngood.png alt>
This process is the parent to several other key processes: svchost.exe, spoolsv.exe, msmpeng.exe, dllhost.exe, to name a few. You can read more about this process <a href=https://en.wikipedia.org/wiki/Service_Control_Manager>here</a>.
<img src=https://assets.tryhackme.com/additional/windows-processes/services-tree.png alt></p><p>What is normal?
<img src=https://assets.tryhackme.com/additional/windows-processes/services.png alt>
<img src=https://assets.tryhackme.com/additional/windows-processes/services2.png alt></p><p><strong>Image Path</strong>: %SystemRoot%\System32\services.exe<br><strong>Parent Process</strong>: wininit.exe<br><strong>Number of Instances</strong>: One<br><strong>User Account</strong>: Local System<br><strong>Start Time</strong>: Within seconds of boot time<br></p><p>What is unusual?</p><ul><li>A parent process other than wininit.exe</li><li>Image file path other than C:\Windows\System32</li><li>Subtle misspellings to hide rogue process in plain sight</li><li>Multiple running instances</li><li>Not running as SYSTEM</li></ul><hr><h2 id=flags-4>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>How many instances of services.exe should be running on a Windows system?</td><td><code>1</code></td></tr></tbody></table><hr><h2 id=wininitexe--servicesexe--svchostexe>wininit.exe > services.exe > svchost.exe</h2><p><strong>The Service Host</strong> (Host Process for Windows Services), or svchost.exe, is responsible for hosting and managing Windows services.
<img src=https://assets.tryhackme.com/additional/windows-processes/dcomlaunch.png alt>
The services running in this process are implemented as DLLs. The DLL to implement is stored in the registry for the service under the <code>Parameters</code> subkey in <code>ServiceDLL</code>. The full path is <code>HKLM\SYSTEM\CurrentControlSet\Services\SERVICE NAME\Parameters</code>.</p><p>The example below is the ServiceDLL value for the Dcomlaunch service.
<img src=https://assets.tryhackme.com/additional/windows-processes/servicedll.png alt>
In order to view this information from within Process Hacker right-click the svchost.exe process. In this case, it will be PID 748.
<img src=https://assets.tryhackme.com/additional/windows-processes/dcomlaunch2.png alt>
Right-click the service and select Properties. Look at Service DLL.
<img src=https://assets.tryhackme.com/additional/windows-processes/dcomlaunch3.png alt></p><p>From the above screenshot, the Binary Path is listed.</p><p>Also, notice how it is structured. There is a key identifier in the binary path. That identifier is <code>-k</code> . This is how a legitimate svchost.exe process is called.</p><p>The -k parameter is for grouping similar services to share the same process. This concept was based on the OS design and implemented to reduce resource consumption. Starting from <strong>Windows 10 Version 1703</strong> services grouped into host processes changed. On machines running more than 3.5 GB of memory, each service will run its own process. You can read more about this process <a href=https://en.wikipedia.org/wiki/Svchost.exe>here</a>.</p><p>Back to the key identifier (-k) from the binary path. In the above screen the -k value is Dcomlaunch. In the virtual machine used to create this room, there are other services running with the same binary path.
<img src=https://assets.tryhackme.com/additional/windows-processes/shared-process.png alt></p><p>Each will have a different value for ServiceDLL. Let&rsquo;s take LSM for example and inspect the value for ServiceDLL.
<img src=https://assets.tryhackme.com/additional/windows-processes/lcm.png alt>
<img src=https://assets.tryhackme.com/additional/windows-processes/lcm2.png alt></p><p>Since svchost.exe will always have multiple running processes on any Windows system, this process has been a target for malicious use. Adversaries create malware to masquerade as this process and try to hide amongst the legitimate svchost.exe processes. They can name the malware svchost.exe or misspell it slightly, such as scvhost.exe. By doing so the intention is to go under the radar. Another tactic is to install/call a malicious service (DLL).</p><p>Extra reading - Hexacorn Blog (<a href=https://www.hexacorn.com/blog/2015/12/18/the-typographical-and-homomorphic-abuse-of-svchost-exe-and-other-popular-file-names/>https://www.hexacorn.com/blog/2015/12/18/the-typographical-and-homomorphic-abuse-of-svchost-exe-and-other-popular-file-names/</a>)</p><p>What is normal?
<img src=https://assets.tryhackme.com/additional/windows-processes/svchost.png alt></p><p><strong>Image Path</strong>: %SystemRoot%\System32\svchost.exe<br><strong>Parent Process</strong>: services.exe<br><strong>Number of Instances</strong>: Many<br><strong>User Account</strong>: Varies (SYSTEM, Network Service, Local Service) depending on the svchost.exe instance. In Windows 10 some instances can run as the logged-in user.<br><strong>Start Time</strong>: Typically within seconds of boot time. Other instances can be started after boot</p><p>What is unusual?</p><ul><li>A parent process other than services.exe</li><li>Image file path other than C:\Windows\System32</li><li>Subtle misspellings to hide rogue process in plain sight</li><li>The absence of the -k parameter</li></ul><hr><h2 id=flags-5>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What single letter parameter should always be visible in the Command line or Binary path?</td><td><code>k</code></td></tr></tbody></table><hr><h2 id=task-9--lsassexe>Task 9: lsass.exe</h2><p>Per Wikipedia, &ldquo;Local Security Authority Subsystem Service (LSASS) is a process in Microsoft Windows operating systems that is responsible for enforcing the security policy on the system. It verifies users logging on to a Windows computer or server, handles password changes, and creates access tokens. It also writes to the Windows Security Log.&rdquo;</p><p>It creates security tokens for SAM (Security Account Manager), AD (Active Directory), and NETLOGON. It uses authentication packages specified in <code>HKLM\System\CurrentControlSet\Control\Lsa</code>.
<img src=https://assets.tryhackme.com/additional/windows-processes/lsa.png alt></p><p>This is another process adversaries target. Common tools such as mimikatz is used to dump credentials or they mimic this process to hide in plain sight. Again, they do this by either naming their malware by this process name or simply misspelling the malware slightly.</p><p><strong>Extra reading</strong>: How LSASS is maliciously used and additional features that Microsoft has put into place to prevent these attacks. ([here(https://yungchou.wordpress.com/2016/03/14/an-introduction-of-windows-10-credential-guard/)])</p><p>What is normal?
<img src=https://assets.tryhackme.com/additional/windows-processes/lsass.png alt></p><p><strong>Image Path</strong>: %SystemRoot%\System32\lsass.exe<br><strong>Parent Process</strong>: wininit.exe<br><strong>Number of Instances</strong>: One<br><strong>User Account</strong>: Local System<br><strong>Start Time</strong>: Within seconds of boot time</p><p>What is unusual?</p><ul><li>A parent process other than wininit.exe</li><li>Image file path other than C:\Windows\System32</li><li>Subtle misspellings to hide rogue process in plain sight</li><li>Multiple running instances*</li><li>Not running as SYSTEM</li></ul><hr><h2 id=flags-6>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What is the parent process for LSASS?</td><td><code>wininit.exe</code></td></tr></tbody></table><hr><h2 id=task-10--winlogonexe>Task 10: winlogon.exe</h2><p><strong>The Windows Logon</strong>, <em>winlogon.exe</em>, is responsible for handling the <strong>Secure Attention Sequence</strong> (SAS). This is the ALT+CTRL+DELETE key combination users press to enter their username & password.</p><p>This process is also responsible for loading the user profile. This is done by loading the user&rsquo;s NTUSER.DAT into HKCU and via userinit.exe loads the user&rsquo;s shell. Read more about this process <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc939862(v=technet.10)?redirectedfrom=MSDN">here</a>.
<img src=https://assets.tryhackme.com/additional/windows-processes/winlogon-registry.png alt></p><p>It is also responsible for locking the screen and running the user&rsquo;s screensaver, among other functions. You can read more about this process <a href=https://en.wikipedia.org/wiki/Winlogon>here</a>.<br>Remember from earlier sections, smss.exe launches this process along with a copy of csrss.exe within Session 1.
<img src=https://assets.tryhackme.com/additional/windows-processes/winlogon-tree.png alt></p><p>What is normal?
<img src=https://assets.tryhackme.com/additional/windows-processes/winlogon1.png alt>
<img src=https://assets.tryhackme.com/additional/windows-processes/winlogon2.png alt></p><p><strong>Image Path</strong>: %SystemRoot%\System32\winlogon.exe<br><strong>Parent Process</strong>: Created by an instance of smss.exe that exits, so analysis tools usually do not provide the parent process name.<br>Number of Instances: One or more<br><strong>User Account</strong>: Local System<br><strong>Start Time</strong>: Within seconds of boot time for the first instance (for Session 1). Additional instances occur as new sessions are created, typically through Remote Desktop or Fast User Switching logons.</p><p>What is unusual?</p><ul><li>An actual parent process. (smss.exe calls this process and self-terminates)</li><li>Image file path other than C:\Windows\System32
Subtle misspellings to hide rogue process in plain sight</li><li>Not running as SYSTEM</li><li>Shell value in the registry other than explorer.exe</li></ul><hr><h2 id=flags-7>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What is the non-existent parent process for winlogon.exe?</td><td><code>smss.exe</code></td></tr></tbody></table><hr><h2 id=task-11--explorerexe>Task 11: explorer.exe</h2><p>The last process we&rsquo;ll look at is the Windows Explorer, explorer.exe. This is the process that gives the user access to their folders and files. It also provides functionality to other features such as the Start Menu, Taskbar, etc.
As mentioned previously, the Winlogon process runs userinit.exe, which launches the value in H<code>KLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\Shell.</code> Userinit.exe exits after spawning explorer.exe. Because of this, the parent process is non-existent.
<img src=https://assets.tryhackme.com/additional/windows-processes/explorer-tree.png alt></p><p>What is normal?
<img src=https://assets.tryhackme.com/additional/windows-processes/explorer.png alt></p><p><strong>Image Path</strong>: %SystemRoot%\explorer.exe<br><strong>Parent Process</strong>: Created by userinit.exe and exits<br><strong>Number of Instances</strong>: One or more per interactively logged-in user
<strong>User Account</strong>: Logged-in user(s)<br><strong>Start Time</strong>: First instance when the first interactive user logon session begins</p><p>What is unusual?</p><ul><li>An actual parent process. (userinit.exe calls this process and exits)</li><li>Image file path other than C:\Windows</li><li>Running as an unknown user</li><li>Subtle misspellings to hide rogue process in plain sight</li><li>Outbound TCP/IP connections
<img src=https://assets.tryhackme.com/additional/windows-processes/explorer-tcpip.png alt>
<em>Note</em>: The above image is a screenshot for the explorer.exe properties view from Process Explorer.</li></ul><hr><h2 id=flags-8>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td>What is the non-existent process for explorer.exe?</td><td></td></tr><tr><td><code>userinit.exe</code></td><td></td></tr></tbody></table><hr><h2 id=task-12--conclusion>Task 12: conclusion</h2><p>It is vital to understand how the Windows operating system functions as a defender. The Windows processes discussed in this room are core processes. Understanding how they operate normally can aid a defender to identify unusual activity on the endpoint.</p><p>With the introduction of Windows 10 additional processes have been added to the list of core processes to know and understand normal behavior.</p><p>Earlier it was mentioned that if Credential Guard is enabled on the endpoint an additional process will be running, which will be a child process to wininit.exe, and that process is lsaiso.exe. This process works in conjunction with lsass.exe to enhance password protection on the endpoint.</p><p>Other processes with Windows 10 is RuntimeBroker.exe and taskhostw.exe (formerly taskhost.exe and taskhostex.exe). Please research these processes and any other processes you might be curious about to understand their purpose and their normal functionality.</p><p>The information for this room was derived from multiple sources.</p><p><a href=https://www.threathunting.se/tag/windows-process/>https://www.threathunting.se/tag/windows-process/</a>
<a href=https://www.sans.org/security-resources/posters/hunt-evil/165/download>https://www.sans.org/security-resources/posters/hunt-evil/165/download</a>
<a href=https://docs.microsoft.com/en-us/sysinternals/resources/windows-internals>https://docs.microsoft.com/en-us/sysinternals/resources/windows-internals</a>
Other links were provided throughout the room. It is encouraged to read them at your own leisure to further your foundation and understanding regarding the core Windows processes.</p><hr><h2 id=flags-9>Flags</h2><table><thead><tr><th>Questions</th><th>Flag</th></tr></thead><tbody><tr><td><code>NA</code></td><td><code>NA</code></td></tr></tbody></table><hr><hr><script type=text/javascript language=javascript>var aax_size='728x90',aax_pubname='anir0y-21',aax_src='302'</script><script type=text/javascript language=javascript src=http://c.amazon-adsystem.com/aax2/assoc.js></script></article></section></div></div><footer class="ui basic center aligned segment" style=background-color:transparent><p>© 2010 - 2021 Classroom</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/img/avatar.jpeg></div><div class=content><h1 class="ui medium header">Classroom Notes & Blog Posts<div class="sub header"></div></h1><article class="ui horizontal list"><a class=item href=/categories><i class="th list icon" title="All Categories"></i></a>
<a class=item href=/tags><i class="tags icon" title="All Tags"></i></a></article><article class=dream-tags><a class="ui label" href=/tags/bash/ title=bash>bash</a>
<a class="ui label" href=/tags/cheatsheet/ title=cheatsheet>cheatsheet</a>
<a class="ui label" href=/tags/config/ title=config>config</a>
<a class="ui label" href=/tags/empire/ title=Empire>Empire</a>
<a class="ui label" href=/tags/encryption/ title=encryption>encryption</a>
<a class="ui label" href=/tags/forensic/ title=forensic>forensic</a>
<a class="ui label" href=/tags/gnupg/ title=gnupg>gnupg</a>
<a class="ui label" href=/tags/internship/ title=Internship>Internship</a>
<a class="ui label" href=/tags/interview/ title=interview>interview</a>
<a class="ui label" href=/tags/lab/ title=lab>lab</a>
<a class="ui label" href=/tags/linux/ title=Linux>Linux</a>
<a class="ui label" href=/tags/memory/ title=memory>memory</a>
<a class="ui label" href=/tags/metasploit/ title=metasploit>metasploit</a>
<a class="ui label" href=/tags/mobile/ title=Mobile>Mobile</a>
<a class="ui label" href=/tags/msf/ title=msf>msf</a>
<a class="ui label" href=/tags/notes/ title=notes>notes</a>
<a class="ui label" href=/tags/osi/ title=OSI>OSI</a>
<a class="ui label" href=/tags/osi-model/ title="OSI Model">OSI Model</a>
<a class="ui label" href=/tags/pentesting/ title=Pentesting>Pentesting</a>
<a class="ui label" href=/tags/pgp/ title=PGP>PGP</a>
<a class="ui label" href=/tags/powershell/ title=powershell>powershell</a>
<a class="ui label" href=/tags/ref/ title=Ref>Ref</a>
<a class="ui label" href=/tags/rooms/ title=rooms>rooms</a>
<a class="ui label" href=/tags/scripting/ title=Scripting>Scripting</a>
<a class="ui label" href=/tags/splunk/ title=splunk>splunk</a>
<a class="ui label" href=/tags/stego/ title=stego>stego</a>
<a class="ui label" href=/tags/sysmon/ title=sysmon>sysmon</a>
<a class="ui label" href=/tags/tools/ title=tools>tools</a>
<a class="ui label" href=/tags/tryhackme/ title=tryhackme>tryhackme</a>
<a class="ui label" href=/tags/vapt/ title=vapt>vapt</a>
<a class="ui label" href=/tags/volatility/ title=Volatility>Volatility</a>
<a class="ui label" href=/tags/vuln-labs/ title="vuln labs">vuln labs</a>
<a class="ui label" href=/tags/wireshark/ title=wireshark>wireshark</a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><h3 class="ui header">Social Links</h3><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:classroom@anir0y.in><i class="large mail icon" title=Email></i></a></div><div class=item><a href=https://twitter.com/anir0y target=_blank><i class="large twitter icon" title=Twitter></i></a></div><div class=item><a href=https://facebook.com/anir0yofficial target=_blank><i class="large facebook icon" title=Facebook></i></a></div><div class=item><a href=https://instagram.com/anir0yofficial target=_blank><i class="large instagram icon" title=Instagram></i></a></div><div class=item><a href=https://www.linkedin.com/in/anir0y target=_blank><i class="large linkedin icon" title=Linkedin></i></a></div><div class=item><a href=https://github.com/anir0y target=_blank><i class="large github icon" title=GitHub></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment">YOU CAN RESUE MY CONTENT</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(c,d,e){var b,f=c.getElementsByTagName(d)[0],a=window.twttr||{};return c.getElementById(e)?a:(b=c.createElement(d),b.id=e,b.src='https://platform.twitter.com/widgets.js',f.parentNode.insertBefore(b,f),a._e=[],a.ready=function(b){a._e.push(b)},a)}(document,'script','twitter-wjs'))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var a=localStore.getItem('hugo-theme-dream-is-dark'),b,c,d;a=a?a:window.defaultDark?'y':a,b="tomorrow",c="tomorrow-night",d=a==='y'?c:b,$('link[data-highlight]').attr('href','https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/'+d+'.min.css'),$('pre').css('background',a==='y'?'#333':'')}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=Search></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON('https://classroom.anir0y.in/index.json',function(a){$('.ui.search').search({source:a,searchFields:['title'],showNoResults:!0})})})</script><script src=/js/search.js></script></body></html>