<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Try Hack Me Room Osquery | Classroom</title>
<link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon><meta name=author content="Animesh Roy @anir0y  "><meta name=description content="Try Hack Me Room Osquery solved by Animesh Roy"><title>Animesh Roy | Classroom Posts</title>
<meta name=title content="Animesh Roy | Blogs & Writeups"><meta name=description content="Animesh Roy has more than a decade worth experience working in cyber security domain. He has worked with governments, corporates, colleges and universities, defence, and the community. He also running a community “Arishti Live” to help everyone who wants to, or work in cyber security domain. His expertise on training & consulting are the best of both the world. He uses his real-life case studies in trainings, to help candidates to understand the job in better ways."><script async src="https://www.googletagmanager.com/gtag/js?id=G-SPD6BXK0P5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SPD6BXK0P5")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","it10lq8bk1")</script><meta property="og:type" content="website"><meta property="og:url" content="https://classroom.anir0y.in/"><meta property="og:title" content="Animesh Roy | Blogs & Writeups"><meta property="og:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="og:image" content="https://i.imgur.com/Ji5C41H.png"><script type=text/javascript src=//cdn.cookie-script.com/s/88cd00f83ae38d0239d06996b1ad293a.js></script><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://classroom.anir0y.in/post/thm-room-osquery/"><meta property="twitter:title" content="Animesh Roy | Blogs & Writeups"><meta property="twitter:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="twitter:image" content="https://i.imgur.com/Ji5C41H.png"><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link rel=canonical href=https://classroom.anir0y.in/post/thm-room-osquery/><meta property="og:url" content="https://classroom.anir0y.in/post/thm-room-osquery/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="Try Hack Me Room Osquery"><meta property="og:description" content="Try Hack Me Room Osquery solved by Animesh Roy"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-16T23:54:39+05:30"><meta property="article:modified_time" content="2021-05-16T23:54:39+05:30"><meta property="article:tag" content="Notes"><meta property="article:tag" content="Tryhackme"><meta property="article:tag" content="Rooms"><meta name=twitter:card content="summary"><meta name=twitter:title content="Try Hack Me Room Osquery"><meta name=twitter:description content="Try Hack Me Room Osquery solved by Animesh Roy"><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><link rel=stylesheet href=/css/custom.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i></div><div class=item><i class="large link home icon" title=Home onclick='window.location.href="https://classroom.anir0y.in/"'></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment toc"><nav id=TableOfContents><ul><li><a href=#osquery>Osquery</a></li><li><a href=#task-1--introduction>TASK 1 : Introduction</a></li><li><a href=#task-2--installation>TASK 2 : Installation</a></li><li><a href=#task-3--interacting-with-the-osquery-shell>TASK 3 : Interacting with the Osquery Shell</a><ul><li><a href=#flag-31>Flag 3.1</a></li><li><a href=#flag-32>Flag 3.2</a></li><li><a href=#flag-33>Flag 3.3</a></li><li><a href=#flag-34>Flag 3.4</a></li><li><a href=#flag-35>Flag 3.5</a></li></ul></li><li><a href=#task-4--schema-documentation>TASK 4 : Schema Documentation</a><ul><li><a href=#flag-41>Flag 4.1</a></li><li><a href=#flag-42>Flag 4.2</a></li><li><a href=#flag-43>Flag 4.3</a></li><li><a href=#flag-44>Flag 4.4</a></li><li><a href=#flag-45>Flag 4.5</a></li></ul></li><li><a href=#task-5--creating-queries>TASK 5 : Creating queries</a><ul><li><a href=#flags-51>Flags 5.1</a></li></ul></li><li><a href=#task-6--using-kolide-fleet>TASK 6 : Using Kolide Fleet</a><ul><li><a href=#flags-61>Flags 6.1</a></li><li><a href=#flags-62>Flags 6.2</a></li><li><a href=#flags-63>Flags 6.3</a></li></ul></li><li><a href=#task-7--osquery-extensions>TASK 7 : Osquery extensions</a><ul><li><a href=#flags-71>Flags 7.1</a></li></ul></li><li><a href=#task-8--linux-and-osquery>TASK 8 : Linux and Osquery</a><ul><li><a href=#flags-81>Flags 8.1</a></li><li><a href=#flags-82>Flags 8.2</a></li><li><a href=#flags-83>Flags 8.3</a></li><li><a href=#flags-84>Flags 8.4</a></li><li><a href=#flags-85>Flags 8.5</a></li><li><a href=#flags-86>Flags 8.6</a></li><li><a href=#flags-87>Flags 8.7</a></li><li><a href=#flags-88>Flags 8.8</a></li></ul></li><li><a href=#task-9--windows-and-osquery>TASK 9 : Windows and Osquery</a><ul><li><a href=#flags-91>Flags 9.1</a></li><li><a href=#flags-92>Flags 9.2</a></li><li><a href=#flags-93>Flags 9.3</a></li><li><a href=#flags-94>Flags 9.4</a></li><li><a href=#flags-95>Flags 9.5</a></li><li><a href=#flags-96>Flags 9.6</a></li><li><a href=#flags-97>Flags 9.7</a></li><li><a href=#flags-98>Flags 9.8</a></li></ul></li><li><a href=#task-10->TASK 10 :</a></li></ul></nav></div><div class="ui segment actions"><button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i>
</button>
<a href="https://twitter.com/intent/tweet?text=Try%20Hack%20Me%20Room%20Osquery&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-osquery%2f" class="ui circular twitter icon button"><i class="twitter icon"></i>
</a><a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fthm-room-osquery%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui top attached segment"><header><h1 class="ui large header">Try Hack Me Room Osquery<div class="sub header">@
<a href=https://anir0y.in target=_blank>Animesh Roy</a>
|
Sunday, May 16, 2021
| 12 minutes read
| Update at
Sunday, May 16, 2021</div></h1></header><article class=main><h2 id=osquery>Osquery</h2><table><thead><tr><th style=text-align:left>Profile</th><th style=text-align:right>Support</th></tr></thead><tbody><tr><td style=text-align:left><script src=https://tryhackme.com/badge/434937></script></td><td style=text-align:right><a href=https://www.buymeacoffee.com/anir0y><img src="https://img.buymeacoffee.com/button-api/?text=Cheers!!!&emoji=🍺&slug=anir0y&button_colour=BD5FFF&font_colour=ffffff&font_family=Lato&outline_colour=000000&coffee_colour=FFDD00"></a></td></tr></tbody></table><hr><h2 id=task-1--introduction>TASK 1 : Introduction</h2><p><a href=https://osquery.io/>Osquery</a> is an <a href=https://github.com/osquery/osquery>open-source</a> tool created by Facebook. With Osquery, Security Analysts, Incident Responders, Threat Hunters, etc., can query an endpoint (or multiple endpoints) using SQL syntax. Osquery can be installed on multiple platforms: Windows, Linux, macOS, and FreeBSD.</p><p>Many well-known companies, besides Facebook, either use Osquery, utilize osquery within their tools, and/or look for individuals who know Osquery.</p><p>As of today (March 2021), Github and AT&amp;T seek individuals who have experience with Osquery.</p><p>Github:
<img src=https://assets.tryhackme.com/additional/osquery/github-posting.png alt><br>AT&amp;T:<br><img src=https://assets.tryhackme.com/additional/osquery/att-posting.png alt></p><p>Some of the tools (open-source and commercial) that utilize Osquery are listed below.</p><ul><li>Alienvault: The <a href=https://otx.alienvault.com/endpoint-security/welcome>AlienVault agent</a> is based on Osquery.</li><li>Cisco: Cisco AMP (Advanced Malware Protection) for endpoints utilize Osquery in Cisco Orbital.</li></ul><p>Learning Osquery will be beneficial if you are looking to enter into this field or if you&rsquo;re already in the field and you&rsquo;re looking to level up your skills.</p><hr><h2 id=task-2--installation>TASK 2 : Installation</h2><p>Install Osquery on your local machine or local virtual machine, please refer to the installation instructions.</p><ul><li><a href=https://osquery.readthedocs.io/en/stable/installation/install-windows/>Windows</a></li><li><a href=https://osquery.readthedocs.io/en/stable/installation/install-linux/>Linux</a></li><li><a href=https://osquery.readthedocs.io/en/stable/installation/install-macos/>MacOS</a></li><li><a href=https://osquery.readthedocs.io/en/stable/installation/install-freebsd/>FreeBSD</a></li></ul><p>Refer to the documentation on the Osquery daemon (osqueryd) information and all the <a href=https://osquery.readthedocs.io/en/latest/installation/cli-flags/>command-line flags here</a>.<br>Schema is <a href=https://osquery.io/schema/>here</a></p><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=1939553774></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=task-3--interacting-with-the-osquery-shell>TASK 3 : Interacting with the Osquery Shell</h2><p>To interact with the Osquery interactive console/shell, open CMD (or PowerShell) and run <code>osqueryi</code>.</p><p>As per the documentation, osqueryi is a modified version of the SQLite shell.</p><p>You&rsquo;ll know that you&rsquo;ve successfully entered into the interactive shell by the new command prompt.
<img src=https://assets.tryhackme.com/additional/osquery/osquery_prompt.png alt><br>One way to familiarize yourself with the Osquery interactive shell, as with any new tool, is to check its help menu.</p><p>In Osquery, the help command (or meta-command) is <code>.help</code>.<br><img src=https://assets.tryhackme.com/additional/osquery/osquery_help.png alt><br>Note: As per the documentation, meta-commands are prefixed with a <code>'.'</code>.</p><p>To list all the available tables that can be queried, use the .<code>tables</code> meta-command.</p><p>For example, if you wish to check what tables are associated with processes, you can use <code>.tables</code> process.<br><img src=https://assets.tryhackme.com/additional/osquery/osquery_tables.png alt><br>In the above image, 3 tables are returned that contain the word &lsquo;process.&rsquo;</p><p>Note: Depending on the operating system, different tables will be returned when the .tables meta-command is executed.</p><p>Table names are not enough to know exactly what information is contained in any given table without actually querying it.</p><p>Knowing what columns and types, known as a schema, for each table are also useful.</p><p>You can list a table&rsquo;s schema with the following meta-command: <code>.schema table_name</code>
<img src=https://assets.tryhackme.com/additional/osquery/osquery_schema.png alt><br>Looking at the above image, <strong>pid</strong> is the <strong>column</strong>, and <strong>BIGINT</strong> is the type.</p><p><strong>Note</strong>: Any user on a system can run and interact with osqueryi, but some tables might return limited results compared to running osqueryi from an elevated shell.</p><p>If you which to check the schema for another operating system, you&rsquo;ll need to use the <code>--enable_foreign</code> command-line flag.</p><p>To read more about command-line flags, refer to this page, <a href=https://osquery.readthedocs.io/en/latest/installation/cli-flags/>https://osquery.readthedocs.io/en/latest/installation/cli-flags/</a>.</p><p>Interacting with the shell to get quick schema information for a table is good but not ideal when you want schema information for multiple tables.</p><p>For that, the schema API online documentation can be used to view a complete list of tables, columns, types, and column descriptions.</p><h3 id=flag-31>Flag 3.1</h3><h4 id=what-is-the-osquery-version>What is the Osquery version</h4><p>run <code>.version</code> to get the flag</p><p><img src=https://i.imgur.com/IEJciiE.png alt></p><h3 id=flag-32>Flag 3.2</h3><h4 id=what-is-the-sqlite-version>What is the SQLite version?</h4><p>run <code>.version</code> to get the flag</p><p><img src=https://i.imgur.com/IEJciiE.png alt></p><h3 id=flag-33>Flag 3.3</h3><h4 id=what-is-the-default-output-mode>What is the default output mode?</h4><p>run the <code>.show</code> command to get the answer</p><p><img src=https://i.imgur.com/dAlkh6g.png alt></p><h3 id=flag-34>Flag 3.4</h3><h4 id=what-is-the-meta-command-to-set-the-output-to-show-one-value-per-line>What is the meta-command to set the output to show one value per line?</h4><p>run <code>.help</code> command to find out the <code>.mode</code> args.</p><p><img src=https://i.imgur.com/9aPv10t.png alt></p><h3 id=flag-35>Flag 3.5</h3><h4 id=what-are-the-2-meta-commands-to-exit-osqueryi>What are the 2 meta-commands to exit osqueryi?</h4><p>not a rocket science, figure it out by yourself.</p><blockquote><p>Hint: Don&rsquo;t <code>quit</code> ;)</p></blockquote><hr><h2 id=task-4--schema-documentation>TASK 4 : Schema Documentation</h2><p>Head over to the schema documentation <a href=https://osquery.io/schema/4.7.0/>here</a>.<br><img src=https://assets.tryhackme.com/additional/osquery/osquery_apischema-1.png alt></p><p>The above image is a resemblance to what you&rsquo;ll see when you navigate to the page.</p><p><strong>Note</strong>: At the time of this writing, the current version for Osquery is 4.7.0.</p><p>A breakdown of the information listed on the schema API page is explained below.</p><ol><li>A dropdown listing various versions of Osquery. Choose the version of Osquery you wish to see schema tables for.</li><li>The number of tables within the selected version of Osquery. (In the above image, 271 tables exist for Osquery 4.7.0)</li><li>The list of the tables is listed in alphabetical order for the selected version of Osquery.</li><li>The name of the table and a brief description.</li><li>A detailed chart listing the column, type, and column description for each table.</li><li>Information to which operating system the table applies to. (In the above image, the account_policy_data table is available only for macOS)</li></ol><p>You have enough information to confidently navigate this resource to retrieve any information you&rsquo;ll need.</p><h3 id=flag-41>Flag 4.1</h3><h4 id=what-table-would-you-query-to-get-the-version-of-osquery-installed-on-the-windows-endpoint>What table would you query to get the version of Osquery installed on the Windows endpoint?</h4><p>search for <code>osquery_*</code> tables and find out which one have <code>vesion</code> column.</p><h3 id=flag-42>Flag 4.2</h3><h4 id=how-many-tables-are-there-for-this-version-of-osquery>How many tables are there for this version of Osquery?</h4><p>just open the website <a href=https://osquery.io/schema/4.6.0/>here</a> you&rsquo;ll see it in left corner.</p><h3 id=flag-43>Flag 4.3</h3><h4 id=how-many-of-the-tables-for-this-version-are-compatible-with-windows>How many of the tables for this version are compatible with Windows?</h4><p>just open the website <a href=https://osquery.io/schema/4.6.0/>here</a> filter for windows.
<img src=https://i.imgur.com/a9NrNKv.png alt></p><h3 id=flag-44>Flag 4.4</h3><h4 id=how-many-tables-is-compatible-with-linux>How many tables is compatible with Linux?</h4><p>just open the website <a href=https://osquery.io/schema/4.6.0/>here</a> filter for Linux.
<img src=https://i.imgur.com/AJtMIKt.png alt></p><h3 id=flag-45>Flag 4.5</h3><h4 id=what-is-the-first-table-listed-that-is-compatible-with-both-linux-and-windows>What is the first table listed that is compatible with both Linux and Windows?</h4><p>just open the website <a href=https://osquery.io/schema/4.6.0/>here</a> filter for windows & Linux type the first table name.
<img src=https://i.imgur.com/AJtMIKt.png alt></p><hr><h2 id=task-5--creating-queries>TASK 5 : Creating queries</h2><p>The SQL language implemented in Osquery is not an entire SQL language that you might be accustomed to, but rather it&rsquo;s a superset of SQLite&rsquo;s.</p><p>Realistically all your queries will start with a SELECT statement. This makes sense because, with Osquery, you are only querying information on an endpoint or endpoints. You won&rsquo;t be updating or deleting any information/data on the endpoint.</p><p>The exception to the rule: The use of other SQL statements, such as UPDATE and DELETE, is possible, but only if you&rsquo;re creating run-time tables (views) or using an extension if the extension supports them.</p><p>Your queries will also include a FROM clause and end with a semicolon.</p><p>If you wish to retrieve all the information about the running processes on the endpoint: <code>SELECT * FROM processes;</code><br><img src=https://assets.tryhackme.com/additional/osquery/osquery_selectall.png alt></p><p><strong>Note</strong>: The results for you will be different if you run this query in the attached VM or your local machine (if Osquery is installed).</p><p>The number of columns returned might be more than what you need. You can select specific columns rather than retrieving every column in the table.</p><p>Query: <code>SELECT pid, name, path FROM processes;</code><br><img src=https://assets.tryhackme.com/additional/osquery/osquery_notselectall.png alt><br>The above query will list the process id, the process&rsquo;s name, and the path for all running processes on the endpoint.</p><p>This will still return a large number of results, depending on how busy the endpoint is.</p><p>The count() function can be used to get exactly how many.</p><p>Query: <code>SELECT count(*) from processes;</code>
<img src=https://assets.tryhackme.com/additional/osquery/osquery_count.png alt><br>The output can be limited to the first 3 in ascending order by process name, as shown below.
<img src=https://assets.tryhackme.com/additional/osquery/osquery_orderby_limit.png alt><br>Optionally, you can use a WHERE clause to narrow down the list of results returned based on specified criteria.</p><p>Query: <code>SELECT pid, name, path FROM processes WHERE name='lsass.exe';</code><br><img src=https://assets.tryhackme.com/additional/osquery/osquery_where.png alt></p><p>The equal sign is not the only filtering option available in a WHERE clause.</p><p>Below are filtering operators that can be used in a WHERE clause:</p><ul><li><code>= </code>[equal]</li><li><code>&lt;></code> [not equal]</li><li><code>></code>, <code>>=</code> [greater than, greater than or equal to]</li><li><code>&lt;</code>, <code>&lt;=</code>[less than or less than or equal to]</li><li><code>BETWEEN</code> [between a range]</li><li><code>LIKE</code> [pattern wildcard searches]</li><li><code>%</code>[wildcard, multiple characters]</li><li><code>_</code> [wildcard, one character]</li></ul><p>Below is a screenshot from the Osquery <a href=https://osquery.readthedocs.io/en/stable/deployment/file-integrity-monitoring/>documentation</a> showing examples of using wildcards when used in folder structures.<br><img src=https://assets.tryhackme.com/additional/osquery/osquery_wildcard.png alt></p><p>Some tables will require a WHERE clause, such as the file table, to return a value. If the required WHERE clause is not included in the query, then you will get an error.
<img src=https://assets.tryhackme.com/additional/osquery/osquery_fileerror.png alt></p><p>The last concept to cover is JOIN. To join 2 or more tables, each table needs to share a column in common.</p><p>Let&rsquo;s look at 2 tables to demonstrate this further. Below is the schema for the <strong>osquery_info</strong> table and the <strong>processes</strong> table.<br><img src=https://assets.tryhackme.com/additional/osquery/osquery_join_example.png alt><br>The common column in both tables is pid. A query can be constructed to use the JOIN clause to join these 2 tables USING the PID column.</p><p>Query: <code>SELECT pid, name, path FROM osquery_info JOIN processes USING (pid);</code>
<img src=https://assets.tryhackme.com/additional/osquery/osquery_join.png alt></p><h3 id=flags-51>Flags 5.1</h3><h4 id=what-is-the-query-to-show-the-username-field-from-the-users-table-where-the-username-is-3-characters-long-and-ends-with-en-use-single-quotes-in-your-answer>What is the query to show the username field from the users table where the username is 3 characters long and ends with &rsquo;en&rsquo;? (use single quotes in your answer)</h4><p>Query: <code>select username from users where username like '%nt';</code><br>Modify the query Smarty Pants!</p><hr><h2 id=task-6--using-kolide-fleet>TASK 6 : Using Kolide Fleet</h2><p>In this task, we will look at an open-source Osquery Fleet Manager known as <a href=https://github.com/kolide/fleet>Kolide Fleet</a>.</p><p>With Kolide Fleet, instead of using Osquery locally to query an endpoint, you can query multiple endpoints from the Kolide Fleet UI.</p><p>Note: The open-source repo of Kolide Fleet is no longer supported and was retired on November 4th, 2020. A commercial version, known as Kolide K2, is available. You can view more about it <a href=https://www.kolide.com/launcher>here</a>. There is a more recent repo called <a href=https://github.com/fleetdm/fleet>fleet</a>, a fork of the original Kolide Fleet, and as per the creators of Kolide Fleet, &ldquo;it appears to be the first of many promising forks.&rdquo;</p><p>Feel free to explore Query Packs at your own leisure. You can read more about this <a href=https://osquery.readthedocs.io/en/stable/deployment/configuration/>here</a> and <a href=https://osquery.readthedocs.io/en/stable/deployment/log-aggregation/>here</a>.</p><h3 id=flags-61>Flags 6.1</h3><h4 id=what-is-the-osquery-enroll-secret>What is the Osquery Enroll Secret?</h4><p>When you click on add host you can copy the secret from there<br><img src=https://i.imgur.com/N8w9xqd.png alt></p><h3 id=flags-62>Flags 6.2</h3><h4 id=what-is-the-osquery-version-1>What is the Osquery version?</h4><p>read it on added host, it&rsquo;s in details<br><img src=https://i.imgur.com/PwnlQ4h.png alt></p><h3 id=flags-63>Flags 6.3</h3><h4 id=what-is-the-path-for-the-running-osquerydexe-process>What is the path for the running osqueryd.exe process?</h4><p>the launcher path.
hint: <code>C:\Users\?????????????\Desktop\????????\???????\osqueryd.exe</code></p><hr><h2 id=task-7--osquery-extensions>TASK 7 : Osquery extensions</h2><p>Extensions add functionality/features (i.e., additional tables) that are not included in the core Osquery. Anyone can create extensions for Osquery. The official documentation on this subject is <a href=https://osquery.readthedocs.io/en/latest/deployment/extensions/>here</a>.</p><p>If you perform a search, you&rsquo;ll find some interesting ones that can be downloaded and implemented with Osquery with little hassle. Others might require extra steps, such as setting up additional dependencies and compiling the extension before use.</p><p>Below are 2 repos of Osquery extensions that you can play with.</p><ul><li><a href=https://github.com/trailofbits/osquery-extensions>https://github.com/trailofbits/osquery-extensions</a></li><li><a href=https://github.com/polylogyx/osq-ext-bin>https://github.com/polylogyx/osq-ext-bin</a></li></ul><h3 id=flags-71>Flags 7.1</h3><h4 id=according-to-the-polylogyx-readme-how-many-features-does-the-plug-in-add-to-the-osquery-core>According to the polylogyx readme, how many &lsquo;features&rsquo; does the plug-in add to the Osquery core?</h4><p>answer is in readme page: <a href=https://github.com/polylogyx/osq-ext-bin/blob/master/README.md>https://github.com/polylogyx/osq-ext-bin/blob/master/README.md</a></p><hr><h2 id=task-8--linux-and-osquery>TASK 8 : Linux and Osquery</h2><p>Review the On-Demand YARA scanning <a href=https://osquery.readthedocs.io/en/stable/deployment/yara/>here</a> to answer some of the questions below.</p><h3 id=flags-81>Flags 8.1</h3><h4 id=what-is-the-current_value-for-kernelosrelease>What is the &lsquo;current_value&rsquo; for kernel.osrelease?</h4><p><code>osquery> SELECT * FROM kernel_info;</code></p><h3 id=flags-82>Flags 8.2</h3><h4 id=what-is-the-uid-for-the-bravo-user>What is the uid for the bravo user?</h4><p>Query: <code>osquery> SELECT username,uid from users where username= "bravo" ;</code></p><h3 id=flags-83>Flags 8.3</h3><h4 id=one-of-the-users-performed-a-binary-padding-attack-what-was-the-target-file-in-the-attack>One of the users performed a &lsquo;Binary Padding&rsquo; attack. What was the target file in the attack?</h4><p>I gave up on real way of finding answer, I guess my way isn&rsquo;t intended. correct me if I&rsquo;m wrong <a href=mailto:classroom@anir0y.in>here</a>.<br>I found the ans by running this: <code>select * from shell_history;</code> and looking into file names.</p><h3 id=flags-84>Flags 8.4</h3><h4 id=what-is-the-hash-value-for-this-file>What is the hash value for this file?</h4><p>Exit from OSQuery, find the file name, run md5sum
<img src=https://i.imgur.com/0ZSrZxW.png alt></p><h3 id=flags-85>Flags 8.5</h3><h4 id=check-all-file-hashes-in-the-home-directory-for-each-user-one-file-will-not-show-any-hashes-which-file-is-that>Check all file hashes in the home directory for each user. One file will not show any hashes. Which file is that?</h4><p>it;s the zip. I just bruteforeced it.<br>I guess my way isn&rsquo;t intended. correct me <a href=mailto:classroom@anir0y.in>here</a>.</p><p><img src=https://i.imgur.com/6dlQi2d.png alt></p><h4 id=solution-provided-by-georg>solution provided by <strong>Georg</strong></h4><p><code>osquery> select path,filename,md5 from file join hash using (path) where path like "/home/%%/%" ;</code></p><h3 id=flags-86>Flags 8.6</h3><h4 id=there-is-a-file-that-is-categorized-as-malicious-in-one-of-the-home-directories-query-the-yara-table-to-find-this-file-use-the-sigfile-which-is-saved-in-varosqueryyarascanneryara-which-file-is-it>There is a file that is categorized as malicious in one of the home directories. Query the Yara table to find this file. Use the sigfile which is saved in &lsquo;/var/osquery/yara/scanner.yara&rsquo;. Which file is it?</h4><p>being a lame person I ran yara directly.
query: <code>yara /var/osquery/yara/scanner.yara /home/charlie/</code></p><p><img src=https://i.imgur.com/TJI9YbY.png alt></p><p>query: <code>osquery> SELECT * FROM yara WHERE path="/path/filename" and sigfile="/var/osquery/yara/scanner.yara";</code>
<img src=https://i.imgur.com/rvVBDwa.png alt></p><h3 id=flags-87>Flags 8.7</h3><h4 id=what-were-the-matches>What were the &lsquo;matches&rsquo;?</h4><p>ans is on same query run
<img src=https://i.imgur.com/TJI9YbY.png alt></p><h3 id=flags-88>Flags 8.8</h3><h4 id=scan-the-file-from-q3-with-the-same-yara-file-what-is-the-entry-for-strings>Scan the file from Q#3 with the same Yara file. What is the entry for &lsquo;strings&rsquo;?</h4><p>run the same command by changing the file name get the strings.</p><p><strong>Query</strong>: <code>osquery> SELECT * FROM yara WHERE path="/home/tryhackme/filename" and sigfile="/var/osquery/yara/scanner.yara";</code></p><p><img src=https://i.imgur.com/G6Yy6Ks.png alt></p><hr><h2 id=task-9--windows-and-osquery>TASK 9 : Windows and Osquery</h2><p>For this exercise, use either Kolide Fleet or the Windows CMD/PowerShell.</p><p>Note: For the questions which involve the Polylogyx osq-ext-bin extension, you&rsquo;ll need to interact with Osquery via the command line.</p><p>To load the extension: <code>osqueryi --allow-unsafe --extension "C:\Program Files\osquery\extensions\osq-ext-bin\plgx_win_extension.ext.exe"</code></p><p>Wait for the command prompt to reflect the phrase <code>Done StartDriver</code>. This will indicate that the extension is fully loaded into the session.</p><p>Tip: If the phrase doesn&rsquo;t appear after a minute or so, hit the ENTER key. It should appear right after.</p><p>Resources for Polylogx osq-ext-bin:</p><ul><li><a href=https://github.com/polylogyx/osq-ext-bin/blob/master/README.md>https://github.com/polylogyx/osq-ext-bin/blob/master/README.md</a></li><li><a href=https://github.com/polylogyx/osq-ext-bin/tree/master/tables-schema>https://github.com/polylogyx/osq-ext-bin/tree/master/tables-schema</a></li></ul><h3 id=flags-91>Flags 9.1</h3><h4 id=what-is-the-description-for-the-windows-defender-service>What is the description for the Windows Defender Service?</h4><p>Query: <code>select name,description from services where name like "WinD%";</code><br><img src=https://i.imgur.com/kYRGFD3.png alt></p><h3 id=flags-92>Flags 9.2</h3><h4 id=there-is-another-security-agent-on-the-windows-endpoint-what-is-the-name-of-this-agent>There is another security agent on the Windows endpoint. What is the name of this agent?</h4><p><strong>Query:</strong>: <code>select name,publisher from programs;</code><br><img src=https://i.imgur.com/VBAQZ9C.png alt></p><h3 id=flags-93>Flags 9.3</h3><h4 id=what-is-required-with-win_event_log_data>What is required with win_event_log_data?</h4><p>Well the &lsquo;Origin&rsquo; from where you get the data (hint: S****E )</p><h3 id=flags-94>Flags 9.4</h3><h4 id=how-many-sources-are-returned-for-win_event_log_channels>How many sources are returned for win_event_log_channels?</h4><p><strong>Query:</strong>: <code>osquery> select count (*) from win_event_log_channels;</code><br><img src=https://i.imgur.com/nP2cI5j.png alt></p><h3 id=flags-95>Flags 9.5</h3><h4 id=what-is-the-schema-for-win_event_log_data>What is the schema for win_event_log_data?</h4><p><strong>Query:</strong>: <code>osquery> .schema win_event_log_data</code><br><img src=https://i.imgur.com/3b25Pxn.png alt></p><h3 id=flags-96>Flags 9.6</h3><h4 id=previous-file-scanned-on-the-linux-endpoint-with-yara-is-on-the-windows-endpoint--what-datetime-was-this-file-first-detected-answer-format-yyyy-mm-dd-hhmmss>previous file scanned on the Linux endpoint with Yara is on the Windows endpoint. What date/time was this file first detected? (Answer format: YYYY-MM-DD HH:MM:SS)</h4><p>Query: <code>osquery> select eventid,datetime from win_event_log_data where source = "Microsoft-Windows-Windows Defender/Operational" and eventid like '1116' ;</code><br><img src=https://i.imgur.com/oz9YRJ8.png alt></p><h3 id=flags-97>Flags 9.7</h3><h4 id=what-is-the-query-to-find-the-first-sysmon-event-select-only-the-event-id-order-by-datetime-and-limit-the-output-to-only-1-entry>What is the query to find the first Sysmon event? Select only the event id, order by date/time, and limit the output to only 1 entry.</h4><p>Query 1: find the sysmon Source
<code>select * from win_event_log_channels where source like '%sysmon%';</code></p><p>Query 2: <code>select eventid from win_event_log_data where source="Microsoft-Windows-Sysmon/Operational" order by datetime limit 1;</code></p><p><img src=https://i.imgur.com/hmBZb7L.png alt></p><h3 id=flags-98>Flags 9.8</h3><h4 id=what-is-the-sysmon-event-id>What is the Sysmon event id?</h4><p><img src=https://i.imgur.com/hmBZb7L.png alt></p><hr><h2 id=task-10->TASK 10 :</h2><p>This was a high-level overview of Osquery. This room&rsquo;s goal was to introduce you to this alternate method of interacting with endpoints to extract information. There is more to Osquery than what was covered in this room.</p><ul><li>File Integrity Monitoring: <a href=https://osquery.readthedocs.io/en/latest/deployment/file-integrity-monitoring/>https://osquery.readthedocs.io/en/latest/deployment/file-integrity-monitoring/</a></li><li>Process Auditing: <a href=https://osquery.readthedocs.io/en/latest/deployment/process-auditing/>https://osquery.readthedocs.io/en/latest/deployment/process-auditing/</a></li><li>Syslog Consumption: <a href=https://osquery.readthedocs.io/en/latest/deployment/syslog/>https://osquery.readthedocs.io/en/latest/deployment/syslog/</a></li></ul><p>SIEMs like ELK and Splunk can ingest Osquery logs. If you completed some of the Splunk rooms, specifically Splunk 2 and Splunk 3, you should recall that Osquery logs (osquery:info, osquery:results, and osquery:warning) were part of the various queried sources to extract information. If looking at the log data seemed foreign, now you have a better understanding of the displayed in the results.</p><p>Lastly, look at other community projects for Osquery listed at <a href=https://osquery.io/>https://osquery.io/</a>.</p><p><img src=https://assets.tryhackme.com/additional/osquery/osquery_comm_projs.png alt></p><p>The repo on enterprise threat hunting with <a href=https://github.com/teoseller/osquery-attck>Osquery + MITRE ATT&amp;CK</a> is definitely worth your attention.</p><hr><script type=text/javascript language=javascript>var aax_size="728x90",aax_pubname="anir0y-21",aax_src="302"</script><script type=text/javascript language=javascript src=https://c.amazon-adsystem.com/aax2/assoc.js></script></article></section></div></div><footer class="ui basic center aligned segment" style=background-color:transparent><p>© 2010 - 2025 Classroom</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/img/avatar.jpeg></div><div class=content><h1 class="ui medium header">Reading Stuffs<div class="sub header"></div></h1><article class="ui horizontal list"><a class=item href=/categories><i class="th list icon" title="All Categories"></i>
</a><a class=item href=/tags><i class="tags icon" title="All Tags"></i></a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><h3 class="ui header">Social Links</h3><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:classroom@anir0y.in><i class="large mail icon" title=Email></i></a></div><div class=item><a href=https://twitter.com/anir0y target=_blank><i class="large twitter icon" title=Twitter></i></a></div><div class=item><a href=https://facebook.com/0xanir0y target=_blank><i class="large facebook icon" title=Facebook></i></a></div><div class=item><a href=https://instagram.com/0xanir0y target=_blank><i class="large instagram icon" title=Instagram></i></a></div><div class=item><a href=https://www.linkedin.com/in/anir0y target=_blank><i class="large linkedin icon" title=Linkedin></i></a></div><div class=item><a href=https://github.com/anir0y target=_blank><i class="large github icon" title=GitHub></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment">YOU CAN REUSE MY CONTENT</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(e,t,n){var o,i=e.getElementsByTagName(t)[0],s=window.twttr||{};return e.getElementById(n)?s:(o=e.createElement(t),o.id=n,o.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(o,i),s._e=[],s.ready=function(e){s._e.push(e)},s)}(document,"script","twitter-wjs"))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var e=localStore.getItem("hugo-theme-dream-is-dark"),e=e?e:window.defaultDark?"y":e,t="tomorrow",n="tomorrow-night",s=e==="y"?n:t;$("link[data-highlight]").attr("href","https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/"+s+".min.css"),$("pre").css("background",e==="y"?"#333":"")}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=Search></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON("https://classroom.anir0y.in//index.json",function(e){$(".ui.search").search({source:e,searchFields:["title"],showNoResults:!0})})})</script><script src=/js/search.js></script></body></html>