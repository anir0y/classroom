<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><meta name=theme-color><title>SOC Splunk101 &#183; Classroom</title><meta name=title content="SOC Splunk101 &#183; Classroom"><meta name=description content="More than 80 Use Cases for Splunk."><meta name=keywords content="splunk,soc,"><link rel=canonical href=https://classroom.anir0y.in/post/soc-splunk101/><meta name=author content="Animesh Roy"><link href=https://twitter.com/anir0y rel=me><link href=https://github.com/anir0y rel=me><meta property="og:url" content="https://classroom.anir0y.in/post/soc-splunk101/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="SOC Splunk101"><meta property="og:description" content="More than 80 Use Cases for Splunk."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2023-04-10T19:27:17+05:30"><meta property="article:modified_time" content="2023-04-10T19:27:17+05:30"><meta property="article:tag" content="Splunk"><meta property="article:tag" content="Soc"><meta name=twitter:card content="summary"><meta name=twitter:title content="SOC Splunk101"><meta name=twitter:description content="More than 80 Use Cases for Splunk."><meta name=twitter:image content="https://classroom.anir0y.in/img/cover.jpg"><meta property="og:image" content="https://classroom.anir0y.in/img/cover.jpg"><link type=text/css rel=stylesheet href=/css/main.bundle.min.2b25fd51aafe5a0a65545bce9bd61a30f10d3e06d3ee7763f9340e7b14b436599753c7638c95d4d05f1c440e6fd97fc28f2f1a2f19130b30f65434ddd920ebe3.css integrity="sha512-KyX9Uar+WgplVFvOm9YaMPENPgbT7ndj+TQOexS0NlmXU8djjJXU0F8cRA5v2X/Cjy8aLxkTCzD2VDTd2SDr4w=="><script type=text/javascript src=/js/appearance.min.6f41174b3a05b680820fe08cadbfa5fb7a7ca347b76a0955cdc68b9d8aca1ce24f0547e138cea33bcc7904d551a90afcb1cc7f2d9fe8557075d501419046c08c.js integrity="sha512-b0EXSzoFtoCCD+CMrb+l+3p8o0e3aglVzcaLnYrKHOJPBUfhOM6jO8x5BNVRqQr8scx/LZ/oVXB11QFBkEbAjA=="></script><script src=/lib/zoom/zoom.min.umd.a527109b68c082a70f3697716dd72a9d5aa8b545cf800cecbbc7399f2ca6f6e0ce3e431f2062b48bbfa47c9ea42822714060bef309be073f49b9c0e30d318d7b.js integrity="sha512-pScQm2jAgqcPNpdxbdcqnVqotUXPgAzsu8c5nyym9uDOPkMfIGK0i7+kfJ6kKCJxQGC+8wm+Bz9JucDjDTGNew=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.bdda7dece6cbaf08deef7d254f7f842f3261c2524d247905127c9a20decc03f1011a2950048464c79272c1ce0705a49a41147f39f2b95163bb71d404b33263ef.js integrity="sha512-vdp97ObLrwje730lT3+ELzJhwlJNJHkFEnyaIN7MA/EBGilQBIRkx5Jywc4HBaSaQRR/OfK5UWO7cdQEszJj7w==" data-copy=Copy data-copied=Copied></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"SOC Splunk101","headline":"SOC Splunk101","description":"More than 80 Use Cases for Splunk.","inLanguage":"en","url":"https://classroom.anir0y.in/post/soc-splunk101/","author":{"@type":"Person","name":"Animesh Roy","url":"https:\/\/classroom.anir0y.in\/about/me/"},"publisher":{"@type":"Organization","name":"Classroom","logo":{"@type":"ImageObject","url":"https:\/\/classroom.anir0y.in\/img/avatar.jpeg"}},"image":"https:\/\/classroom.anir0y.in\/img\/soc-101.png","copyrightYear":"2023","dateCreated":"2023-04-10T19:27:17\u002b05:30","datePublished":"2023-04-10T19:27:17\u002b05:30","dateModified":"2023-04-10T19:27:17\u002b05:30","keywords":["splunk","soc"],"mainEntityOfPage":{"@type":"WebPage","@id":"https://classroom.anir0y.in/post/soc-splunk101/"},"wordCount":"7274"},{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://classroom.anir0y.in/post/"},{"@type":"ListItem","position":2,"name":"SOC Splunk101","item":"https://classroom.anir0y.in/post/soc-splunk101/"}]}]</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3526678290068011" crossorigin=anonymous></script></head><body class="flex flex-col h-screen m-auto leading-7 max-w-7xl px-6 sm:px-14 md:px-24 lg:px-32 text-lg bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral bf-scrollbar"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 pe-2 dark:text-primary-400">&darr;</span>
Skip to main content</a></div><div class="main-menu flex items-center w-full gap-2 p-1 pl-0"><a href=/ class="text-base font-medium truncate min-w-0 shrink">Classroom</a><div class="flex items-center ms-auto"><div class="hidden md:flex"><nav class="flex items-center gap-x-5 h-12"><a href=/post/ class="flex items-center bf-icon-color-hover" aria-label=Posts title=Posts><span class="text-base font-medium break-normal">Posts
</span></a><a href=/categories/ class="flex items-center bf-icon-color-hover" aria-label=Categories title=Categories><span class="text-base font-medium break-normal">Categories
</span></a><a href=/tags/ class="flex items-center bf-icon-color-hover" aria-label=Tags title=Tags><span class="text-base font-medium break-normal">Tags
</span></a><a href=/archives/ class="flex items-center bf-icon-color-hover" aria-label=Archives title=Archives><span class="text-base font-medium break-normal">Archives
</span></a><a href=/about/me/ class="flex items-center bf-icon-color-hover" aria-label=About title><span class="text-base font-medium break-normal">About
</span></a><button id=search-button aria-label=Search class="text-base bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base bf-icon-color-hover"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav></div><div class="flex md:hidden"><div class="flex items-center h-14 gap-4"><button id=search-button-mobile aria-label=Search class="flex items-center justify-center bf-icon-color-hover" title="Search (/)">
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile type=button aria-label="Dark mode switcher" class="flex items-center justify-center text-neutral-900 hover:text-primary-600 dark:text-neutral-200 dark:hover:text-primary-400"><div class=dark:hidden><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="hidden dark:block"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button>
<input type=checkbox id=mobile-menu-toggle autocomplete=off class="hidden peer">
<label for=mobile-menu-toggle class="flex items-center justify-center cursor-pointer bf-icon-color-hover"><span class="relative block icon"><svg viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></label><div role=dialog aria-modal=true style=scrollbar-gutter:stable class="fixed inset-0 z-50 invisible overflow-y-auto px-6 py-20 opacity-0 transition-[opacity,visibility] duration-300 peer-checked:visible peer-checked:opacity-100 bg-neutral-50/97 dark:bg-neutral-900/99
bf-scrollbar"><label for=mobile-menu-toggle class="fixed end-8 top-5 flex items-center justify-center z-50 h-12 w-12 cursor-pointer select-none rounded-full bf-icon-color-hover border bf-border-color bf-border-color-hover bg-neutral-50 dark:bg-neutral-900"><span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></label><nav class="mx-auto max-w-md space-y-6"><div class=px-2><a href=/post/ aria-label=Posts class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Posts class="text-2xl font-bold tracking-tight">Posts</span></a></div><div class=px-2><a href=/categories/ aria-label=Categories class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Categories class="text-2xl font-bold tracking-tight">Categories</span></a></div><div class=px-2><a href=/tags/ aria-label=Tags class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Tags class="text-2xl font-bold tracking-tight">Tags</span></a></div><div class=px-2><a href=/archives/ aria-label=Archives class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title=Archives class="text-2xl font-bold tracking-tight">Archives</span></a></div><div class=px-2><a href=/about/me/ aria-label=About class="flex items-center gap-4 group bf-icon-color-hover text-neutral-700 dark:text-neutral-200"><span title class="text-2xl font-bold tracking-tight">About</span></a></div></nav></div></div></div></div></div><script>(function(){var t,n,e=document.querySelector(".main-menu");if(!e)return;t=window.location.pathname,n=e.querySelectorAll('a[href="'+t+'"]'),n.forEach(function(e){var t=e.querySelectorAll("span");t.forEach(function(e){e.classList.add("active")})})})()</script><div class="relative flex flex-col grow"><main id=main-content class=grow><article><header id=single_header class="mt-5 max-w-prose"><ol class="text-sm text-neutral-500 dark:text-neutral-400 print:hidden"><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/>Classroom</a><span class="px-1 text-primary-500">/</span></li><li class=inline><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/post/>Posts</a><span class="px-1 text-primary-500">/</span></li><li class=hidden><a class="hover:underline decoration-neutral-300 dark:underline-neutral-600" href=/post/soc-splunk101/>SOC Splunk101</a><span class="px-1 text-primary-500">/</span></li></ol><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">SOC Splunk101</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-04-10T19:27:17+05:30>10 April 2023</time><span class="px-2 text-primary-500">&#183;</span><span>7274 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">35 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/splunk/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Splunk
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/categories/soc/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">SOC
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/splunk/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Splunk
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/soc/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Soc</span></span></a></div></div><div class="flex author"><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Animesh Roy</div><div class="text-sm text-neutral-700 dark:text-neutral-400">CTF walkthroughs, malware analysis, penetration testing, and security research.</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/anir0y target=_blank aria-label=Twitter title=Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/anir0y target=_blank aria-label=Github title=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ms-auto px-0 lg:order-last lg:ps-8 lg:max-w-2xs"><div class="toc ps-5 print:hidden lg:sticky lg:top-10"><details open id=TOCView class="toc-right mt-0 overflow-y-auto overscroll-contain bf-scrollbar rounded-lg -ms-5 ps-5 pe-2 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#some-use-cases-for-splunk>some Use Cases for Splunk.</a><ul><li><a href=#1--windows-audit-log-tampering>1- Windows Audit Log Tampering</a></li><li><a href=#2--finding-large-web-uploads>2- Finding Large Web Uploads</a></li><li><a href=#3--detecting-recurring-malware-on-host>3- Detecting Recurring Malware on Host</a></li><li><a href=#4-detecting-brute-force-attacks>4-Detecting Brute Force Attacks</a></li><li><a href=#5--detecting-unencrypted-web-communications>5- Detecting Unencrypted Web Communications</a></li><li><a href=#6--identifying-web-users-by-country>6- Identifying Web Users By Country</a></li><li><a href=#7--identifying-slow-web-content>7- Identifying Slow Web Content</a></li><li><a href=#8--finding-new-local-admin-accounts>8- Finding New Local Admin Accounts</a></li><li><a href=#9--finding-interactive-logins-from-service-accounts>9- Finding Interactive Logins From Service Accounts</a></li><li><a href=#10--log-volume-trending>10- Log Volume Trending</a></li><li><a href=#11--basic-tor-traffic-detection>11- Basic TOR Traffic Detection</a></li><li><a href=#12--measuring-storage-io-latency>12- Measuring Storage I/O Latency</a></li><li><a href=#13--measuring-storage-speed-io-utilization-by-host>13- Measuring Storage Speed I/O Utilization by Host</a></li><li><a href=#14--measuring-memory-utilization-by-host>14- Measuring Memory Utilization by Host</a></li><li><a href=#15--rogue-dns-detection>15- Rogue DNS detection</a></li><li><a href=#16--suspicious-powershell-commands>16- Suspicious PowerShell Commands</a></li><li><a href=#17--windows-audit-log-cleared>17- Windows audit log cleared</a></li><li><a href=#18--detecting-network-and-port-scanning>18- Detecting Network and Port Scanning</a></li><li><a href=#19--unusual-access>19- Unusual Access</a></li><li><a href=#20--malware-attack>20- Malware Attack</a></li><li><a href=#21-attempt-to-add-certificate-to-untrusted-store>21-Attempt To Add Certificate To Untrusted Store</a></li><li><a href=#22--batch-file-write-to-system32>22**- Batch File Write to System32**</a></li><li><a href=#23--bcdedit-failure-recovery-modification>23- BCDEdit Failure Recovery Modification</a></li><li><a href=#24--bits-job-persistence>24- BITS Job Persistence</a></li><li><a href=#25--bitsadmin-download-file>25- BITSAdmin Download File</a></li><li><a href=#26--certutil-download-with-urlcache-and-split-arguments>26- CertUtil Download With URLCache and Split Arguments</a></li><li><a href=#27--certutil-download-with-verifyctl-and-split-arguments>27- CertUtil Download With VerifyCtl and Split Arguments</a></li><li><a href=#28--certutil-exe-certificate-extraction>28- Certutil exe certificate extraction</a></li><li><a href=#29--certutil-with-decode-argument>29- CertUtil With Decode Argument</a></li><li><a href=#30--create-local-admin-accounts-using-net-exe>30- Create local admin accounts using net exe</a></li><li><a href=#31--create-remote-thread-into-lsass>31- Create Remote Thread into LSASS</a></li><li><a href=#32--create-service-in-suspicious-file-path>32- Create Service In Suspicious File Path</a></li><li><a href=#33--common-windows-process-masquerading>33- Common Windows Process Masquerading</a></li><li><a href=#34--unusual-child-process-spawned-using-dde-exploit>34- Unusual Child Process spawned using DDE exploit</a></li><li><a href=#35--detecting-tampering-of-windows-defender-command-prompt>35- Detecting Tampering of Windows Defender Command Prompt</a></li><li><a href=#36--disable-uac>36- Disable UAC</a></li><li><a href=#37--identifying-port-scanning-activity>37- Identifying Port Scanning Activity</a></li><li><a href=#38--unusually-long-command-line-strings>38- Unusually Long Command Line Strings</a></li><li><a href=#39--clearing-windows-logs-with-wevtutil>39- Clearing Windows Logs with Wevtutil</a></li><li><a href=#41--detecting-shadow-copy-deletion-via-vssadminexe>41- Detecting Shadow Copy Deletion via Vssadmin.exe</a></li><li><a href=#42--webshell-indicative-process-tree>42- Webshell-Indicative Process Tree</a></li><li><a href=#43--get-system-elevation>43- Get System Elevation</a></li><li><a href=#44--boot-or-logon-initialization-scripts>44- Boot or Logon Initialization Scripts</a></li><li><a href=#45--local-network-sniffing>45- Local Network Sniffing</a></li><li><a href=#46--dll-injection-with-mavinject>46- DLL Injection with Mavinject</a></li><li><a href=#47--processes-started-from-irregular-parent>47- Processes Started From Irregular Parent</a></li><li><a href=#48--clear-powershell-console-command-history>48- Clear Powershell Console Command History</a></li><li><a href=#49--local-permission-group-discovery>49- Local Permission Group Discovery</a></li><li><a href=#50--network-share-connection-removal>50- Network Share Connection Removal</a></li><li><a href=#51--msbuild-and-msxsl>51- MSBuild and msxsl</a></li><li><a href=#52--compiled-html-access>52- Compiled HTML Access</a></li><li><a href=#53--cmstp>53- CMSTP</a></li><li><a href=#54--registry-edit-from-screensaver>54- Registry Edit from Screensaver</a></li><li><a href=#55--scheduled-task---file-access>55- Scheduled Task - File Access</a></li><li><a href=#56--component-object-model-hijacking>56- Component Object Model Hijacking</a></li><li><a href=#57--indicator-blocking---driver-unloaded>57- Indicator Blocking - Driver Unloaded</a></li><li><a href=#58--credentials-in-files--registry>58- Credentials in Files & Registry</a></li><li><a href=#59--appinit-dlls>59- AppInit DLLs</a></li><li><a href=#60--ntfs-alternate-data-stream-execution---system-utilities>60- NTFS Alternate Data Stream Execution - System Utilities</a></li><li><a href=#61--ntfs-alternate-data-stream-execution---lolbas>61- NTFS Alternate Data Stream Execution - LOLBAS</a></li><li><a href=#62--execution-with-at>62- Execution with AT</a></li><li><a href=#63--running-executables-with-same-hash-and-different-names>63- Running executables with same hash and different names</a></li><li><a href=#64--suspicious-arguments>64- Suspicious Arguments</a></li><li><a href=#65--user-login-activity-monitoring>65- User Login Activity Monitoring</a></li><li><a href=#66--powershell-execution>66- PowerShell Execution</a></li><li><a href=#67--services-launching-cmd>67- Services launching Cmd</a></li><li><a href=#68--command-launched-from-winlogon>68- Command Launched from WinLogon</a></li><li><a href=#69--host-discovery-commands>69- Host Discovery Commands</a></li><li><a href=#70--create-remote-process-via-wmic>70- Create Remote Process via WMIC</a></li><li><a href=#71--uac-bypass>71- UAC Bypass</a></li><li><a href=#72--generic-regsvr32>72- Generic Regsvr32</a></li><li><a href=#73--squiblydoo>73- Squiblydoo</a></li><li><a href=#74--credential-dumping-via-mimikatz>74- Credential Dumping via Mimikatz</a></li><li><a href=#75--access-permission-modification>75- Access Permission Modification</a></li><li><a href=#76--lsass-process-dump-via-procdump>76- Lsass Process Dump via Procdump</a></li><li><a href=#77--credential-dumping-via-windows-task-manager>77- Credential Dumping via Windows Task Manager</a></li><li><a href=#78--active-directory-dumping-via-ntdsutil>78- Active Directory Dumping via NTDSUtil</a></li><li><a href=#79--shadow-copy-deletion>79- Shadow Copy Deletion</a></li><li><a href=#80--minidump-of-lsass>80- MiniDump of LSASS</a></li><li><a href=#81--rare-lolbas-command-lines>81- Rare LolBAS Command Lines</a></li></ul></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg -ms-5 ps-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 -ms-5 ps-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 border-s-1 -ms-5 ps-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#some-use-cases-for-splunk>some Use Cases for Splunk.</a><ul><li><a href=#1--windows-audit-log-tampering>1- Windows Audit Log Tampering</a></li><li><a href=#2--finding-large-web-uploads>2- Finding Large Web Uploads</a></li><li><a href=#3--detecting-recurring-malware-on-host>3- Detecting Recurring Malware on Host</a></li><li><a href=#4-detecting-brute-force-attacks>4-Detecting Brute Force Attacks</a></li><li><a href=#5--detecting-unencrypted-web-communications>5- Detecting Unencrypted Web Communications</a></li><li><a href=#6--identifying-web-users-by-country>6- Identifying Web Users By Country</a></li><li><a href=#7--identifying-slow-web-content>7- Identifying Slow Web Content</a></li><li><a href=#8--finding-new-local-admin-accounts>8- Finding New Local Admin Accounts</a></li><li><a href=#9--finding-interactive-logins-from-service-accounts>9- Finding Interactive Logins From Service Accounts</a></li><li><a href=#10--log-volume-trending>10- Log Volume Trending</a></li><li><a href=#11--basic-tor-traffic-detection>11- Basic TOR Traffic Detection</a></li><li><a href=#12--measuring-storage-io-latency>12- Measuring Storage I/O Latency</a></li><li><a href=#13--measuring-storage-speed-io-utilization-by-host>13- Measuring Storage Speed I/O Utilization by Host</a></li><li><a href=#14--measuring-memory-utilization-by-host>14- Measuring Memory Utilization by Host</a></li><li><a href=#15--rogue-dns-detection>15- Rogue DNS detection</a></li><li><a href=#16--suspicious-powershell-commands>16- Suspicious PowerShell Commands</a></li><li><a href=#17--windows-audit-log-cleared>17- Windows audit log cleared</a></li><li><a href=#18--detecting-network-and-port-scanning>18- Detecting Network and Port Scanning</a></li><li><a href=#19--unusual-access>19- Unusual Access</a></li><li><a href=#20--malware-attack>20- Malware Attack</a></li><li><a href=#21-attempt-to-add-certificate-to-untrusted-store>21-Attempt To Add Certificate To Untrusted Store</a></li><li><a href=#22--batch-file-write-to-system32>22**- Batch File Write to System32**</a></li><li><a href=#23--bcdedit-failure-recovery-modification>23- BCDEdit Failure Recovery Modification</a></li><li><a href=#24--bits-job-persistence>24- BITS Job Persistence</a></li><li><a href=#25--bitsadmin-download-file>25- BITSAdmin Download File</a></li><li><a href=#26--certutil-download-with-urlcache-and-split-arguments>26- CertUtil Download With URLCache and Split Arguments</a></li><li><a href=#27--certutil-download-with-verifyctl-and-split-arguments>27- CertUtil Download With VerifyCtl and Split Arguments</a></li><li><a href=#28--certutil-exe-certificate-extraction>28- Certutil exe certificate extraction</a></li><li><a href=#29--certutil-with-decode-argument>29- CertUtil With Decode Argument</a></li><li><a href=#30--create-local-admin-accounts-using-net-exe>30- Create local admin accounts using net exe</a></li><li><a href=#31--create-remote-thread-into-lsass>31- Create Remote Thread into LSASS</a></li><li><a href=#32--create-service-in-suspicious-file-path>32- Create Service In Suspicious File Path</a></li><li><a href=#33--common-windows-process-masquerading>33- Common Windows Process Masquerading</a></li><li><a href=#34--unusual-child-process-spawned-using-dde-exploit>34- Unusual Child Process spawned using DDE exploit</a></li><li><a href=#35--detecting-tampering-of-windows-defender-command-prompt>35- Detecting Tampering of Windows Defender Command Prompt</a></li><li><a href=#36--disable-uac>36- Disable UAC</a></li><li><a href=#37--identifying-port-scanning-activity>37- Identifying Port Scanning Activity</a></li><li><a href=#38--unusually-long-command-line-strings>38- Unusually Long Command Line Strings</a></li><li><a href=#39--clearing-windows-logs-with-wevtutil>39- Clearing Windows Logs with Wevtutil</a></li><li><a href=#41--detecting-shadow-copy-deletion-via-vssadminexe>41- Detecting Shadow Copy Deletion via Vssadmin.exe</a></li><li><a href=#42--webshell-indicative-process-tree>42- Webshell-Indicative Process Tree</a></li><li><a href=#43--get-system-elevation>43- Get System Elevation</a></li><li><a href=#44--boot-or-logon-initialization-scripts>44- Boot or Logon Initialization Scripts</a></li><li><a href=#45--local-network-sniffing>45- Local Network Sniffing</a></li><li><a href=#46--dll-injection-with-mavinject>46- DLL Injection with Mavinject</a></li><li><a href=#47--processes-started-from-irregular-parent>47- Processes Started From Irregular Parent</a></li><li><a href=#48--clear-powershell-console-command-history>48- Clear Powershell Console Command History</a></li><li><a href=#49--local-permission-group-discovery>49- Local Permission Group Discovery</a></li><li><a href=#50--network-share-connection-removal>50- Network Share Connection Removal</a></li><li><a href=#51--msbuild-and-msxsl>51- MSBuild and msxsl</a></li><li><a href=#52--compiled-html-access>52- Compiled HTML Access</a></li><li><a href=#53--cmstp>53- CMSTP</a></li><li><a href=#54--registry-edit-from-screensaver>54- Registry Edit from Screensaver</a></li><li><a href=#55--scheduled-task---file-access>55- Scheduled Task - File Access</a></li><li><a href=#56--component-object-model-hijacking>56- Component Object Model Hijacking</a></li><li><a href=#57--indicator-blocking---driver-unloaded>57- Indicator Blocking - Driver Unloaded</a></li><li><a href=#58--credentials-in-files--registry>58- Credentials in Files & Registry</a></li><li><a href=#59--appinit-dlls>59- AppInit DLLs</a></li><li><a href=#60--ntfs-alternate-data-stream-execution---system-utilities>60- NTFS Alternate Data Stream Execution - System Utilities</a></li><li><a href=#61--ntfs-alternate-data-stream-execution---lolbas>61- NTFS Alternate Data Stream Execution - LOLBAS</a></li><li><a href=#62--execution-with-at>62- Execution with AT</a></li><li><a href=#63--running-executables-with-same-hash-and-different-names>63- Running executables with same hash and different names</a></li><li><a href=#64--suspicious-arguments>64- Suspicious Arguments</a></li><li><a href=#65--user-login-activity-monitoring>65- User Login Activity Monitoring</a></li><li><a href=#66--powershell-execution>66- PowerShell Execution</a></li><li><a href=#67--services-launching-cmd>67- Services launching Cmd</a></li><li><a href=#68--command-launched-from-winlogon>68- Command Launched from WinLogon</a></li><li><a href=#69--host-discovery-commands>69- Host Discovery Commands</a></li><li><a href=#70--create-remote-process-via-wmic>70- Create Remote Process via WMIC</a></li><li><a href=#71--uac-bypass>71- UAC Bypass</a></li><li><a href=#72--generic-regsvr32>72- Generic Regsvr32</a></li><li><a href=#73--squiblydoo>73- Squiblydoo</a></li><li><a href=#74--credential-dumping-via-mimikatz>74- Credential Dumping via Mimikatz</a></li><li><a href=#75--access-permission-modification>75- Access Permission Modification</a></li><li><a href=#76--lsass-process-dump-via-procdump>76- Lsass Process Dump via Procdump</a></li><li><a href=#77--credential-dumping-via-windows-task-manager>77- Credential Dumping via Windows Task Manager</a></li><li><a href=#78--active-directory-dumping-via-ntdsutil>78- Active Directory Dumping via NTDSUtil</a></li><li><a href=#79--shadow-copy-deletion>79- Shadow Copy Deletion</a></li><li><a href=#80--minidump-of-lsass>80- MiniDump of LSASS</a></li><li><a href=#81--rare-lolbas-command-lines>81- Rare LolBAS Command Lines</a></li></ul></li></ul></nav></div></details><script>(function(){"use strict";const s=.33,o="#TableOfContents",i=".anchor",a='a[href^="#"]',r="li ul",c="active";let t=!1;function l(e,n){const o=window.scrollY+window.innerHeight*n,i=[...document.querySelectorAll('#TableOfContents a[href^="#"]')],s=new Set(i.map(e=>e.getAttribute("href").substring(1)));if(t)for(let t=0;t<e.length;t++){const n=e[t];if(!s.has(n.id))continue;const o=n.getBoundingClientRect().top+window.scrollY;if(Math.abs(window.scrollY-o)<100)return n.id}for(let t=e.length-1;t>=0;t--){const n=e[t].getBoundingClientRect().top+window.scrollY;if(n<=o&&s.has(e[t].id))return e[t].id}return e.find(e=>s.has(e.id))?.id||""}function e({toc:e,anchors:t,links:n,scrollOffset:s,collapseInactive:o}){const i=l(t,s);if(!i)return;if(n.forEach(e=>{const t=e.getAttribute("href")===`#${i}`;if(e.classList.toggle(c,t),o){const n=e.closest("li")?.querySelector("ul");n&&(n.style.display=t?"":"none")}}),o){const n=e.querySelector(`a[href="#${CSS.escape(i)}"]`);let t=n;for(;t&&t!==e;)t.tagName==="UL"&&(t.style.display=""),t.tagName==="LI"&&t.querySelector("ul")?.style.setProperty("display",""),t=t.parentElement}}function n(){const n=document.querySelector(o);if(!n)return;const l=!0,u=[...document.querySelectorAll(i)],d=[...n.querySelectorAll(a)];l&&n.querySelectorAll(r).forEach(e=>e.style.display="none"),d.forEach(e=>{e.addEventListener("click",()=>{t=!0})});const c={toc:n,anchors:u,links:d,scrollOffset:s,collapseInactive:l};window.addEventListener("scroll",()=>e(c),{passive:!0}),window.addEventListener("hashchange",()=>e(c),{passive:!0}),e(c)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",n):n()})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="not-prose my-4 print:hidden"><div class=ad-container><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div><div class="article-content max-w-prose mb-20"><h2 class="relative group">some Use Cases for Splunk.<div id=some-use-cases-for-splunk class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#some-use-cases-for-splunk aria-label=Anchor>#</a></span></h2><h3 class="relative group">1- Windows Audit Log Tampering<div id=1--windows-audit-log-tampering class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#1--windows-audit-log-tampering aria-label=Anchor>#</a></span></h3><p>Check for any tampering done to Windows audit logs.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=p>(</span><span class=n>sourcetype</span><span class=o>=</span><span class=n>wineventlog</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1102</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1100</span><span class=p>))</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>sourcetype</span><span class=o>=</span><span class=n>wineventlog</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>104</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=n>EventCode</span><span class=w> </span><span class=n>Message</span><span class=w> </span><span class=n>sourcetype</span><span class=w> </span><span class=k>host</span></span></span></code></pre></div></div><h3 class="relative group">2- Finding Large Web Uploads<div id=2--finding-large-web-uploads class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#2--finding-large-web-uploads aria-label=Anchor>#</a></span></h3><p>Find large file uploads that could point to data exfiltration in your network.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>websense</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>bytes_out</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>35000000</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=n>src_ip</span><span class=w> </span><span class=n>bytes</span><span class=o>*</span><span class=w> </span><span class=n>uri</span></span></span></code></pre></div></div><h3 class="relative group">3- Detecting Recurring Malware on Host<div id=3--detecting-recurring-malware-on-host class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#3--detecting-recurring-malware-on-host aria-label=Anchor>#</a></span></h3><p>Using anti-virus logs to detect if malware is recurring on a host after being removed.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>symantec</span><span class=p>:</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=n>range</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>TimeRange</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Risk_Name</span><span class=p>,</span><span class=w> </span><span class=n>Computer_Name</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>TimeRange</span><span class=o>&gt;</span><span class=mi>1800</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>eval</span><span class=w> </span><span class=n>TimeRange_In_Hours</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>round</span><span class=p>(</span><span class=n>TimeRange</span><span class=o>/</span><span class=mi>3600</span><span class=p>,</span><span class=mi>2</span><span class=p>),</span><span class=w> </span><span class=n>TimeRange_In_Days</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>round</span><span class=p>(</span><span class=n>TimeRange</span><span class=o>/</span><span class=mi>3600</span><span class=o>/</span><span class=mi>24</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">4-Detecting Brute Force Attacks<div id=4-detecting-brute-force-attacks class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#4-detecting-brute-force-attacks aria-label=Anchor>#</a></span></h3><p>A brute-force attack consists of a multiple login attempts using many passwords by an unauthorized user/attacker with the hope of eventually guessing the correct password.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>winxsecurity</span><span class=w> </span><span class=k>user</span><span class=o>=*</span><span class=w> </span><span class=k>user</span><span class=o>!</span><span class=s2>&#34;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>eval</span><span class=p>(</span><span class=n>action</span><span class=o>=</span><span class=s2>&#34;success&#34;</span><span class=p>))</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>successes</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>eval</span><span class=p>(</span><span class=n>action</span><span class=o>=</span><span class=s2>&#34;failure&#34;</span><span class=p>))</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>failures</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>user</span><span class=p>,</span><span class=w> </span><span class=n>ComputerName</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>successes</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>failures</span><span class=o>&gt;</span><span class=mi>100</span></span></span></code></pre></div></div><p><strong>Windows</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>windows</span><span class=w> </span><span class=k>source</span><span class=o>=</span><span class=s2>&#34;WinEventLog:Security&#34;</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4625</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>bin</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=n>span</span><span class=o>=</span><span class=mi>5</span><span class=n>m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>_time</span><span class=p>,</span><span class=k>user</span><span class=p>,</span><span class=k>host</span><span class=p>,</span><span class=n>src</span><span class=p>,</span><span class=n>action</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>5</span></span></span></code></pre></div></div><p><strong>Linux</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>linux</span><span class=w> </span><span class=k>source</span><span class=o>=</span><span class=s2>&#34;/var/log/auth.log&#34;</span><span class=w> </span><span class=s2>&#34;Failed password&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>bin</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=n>span</span><span class=o>=</span><span class=mi>5</span><span class=n>m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>_time</span><span class=p>,</span><span class=k>user</span><span class=p>,</span><span class=k>host</span><span class=p>,</span><span class=n>src</span><span class=p>,</span><span class=n>action</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=mi>5</span></span></span></code></pre></div></div><h3 class="relative group">5- Detecting Unencrypted Web Communications<div id=5--detecting-unencrypted-web-communications class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#5--detecting-unencrypted-web-communications aria-label=Anchor>#</a></span></h3><p>Find unencrypted web communications that could lead to a data breach.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>firewall_data</span><span class=w> </span><span class=n>dest_port</span><span class=o>!=</span><span class=mi>443</span><span class=w> </span><span class=n>app</span><span class=o>=</span><span class=n>workday</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>app</span><span class=w> </span><span class=n>bytes</span><span class=o>*</span><span class=w> </span><span class=n>src_ip</span><span class=w> </span><span class=n>dest_ip</span><span class=w> </span><span class=n>dest_port</span></span></span></code></pre></div></div><h3 class="relative group">6- Identifying Web Users By Country<div id=6--identifying-web-users-by-country class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#6--identifying-web-users-by-country aria-label=Anchor>#</a></span></h3><p>Use IPs in your data to report and visualize user locations.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>web</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>access_combined</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>iplocation</span><span class=w> </span><span class=n>clientip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>geostats</span><span class=w> </span><span class=n>dc</span><span class=p>(</span><span class=n>clientip</span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Country</span></span></span></code></pre></div></div><h3 class="relative group">7- Identifying Slow Web Content<div id=7--identifying-slow-web-content class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#7--identifying-slow-web-content aria-label=Anchor>#</a></span></h3><p>A slow loading web site can not only frustrate users, but can also hurt search rankings.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>web</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>ms</span><span class=p>:</span><span class=n>iis</span><span class=p>:</span><span class=n>auto</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>apache</span><span class=p>:</span><span class=w> </span><span class=k>access</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=n>response_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>art</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>uri_path</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>eval</span><span class=w> </span><span class=s2>&#34;Average Response Time&#34;</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>round</span><span class=p>(</span><span class=n>art</span><span class=p>,</span><span class=mi>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>sort</span><span class=w> </span><span class=o>-</span><span class=s2>&#34;Average Response Time&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>uri_path</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;Average Response Time&#34;</span></span></span></code></pre></div></div><h3 class="relative group">8- Finding New Local Admin Accounts<div id=8--finding-new-local-admin-accounts class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#8--finding-new-local-admin-accounts aria-label=Anchor>#</a></span></h3><p>Often an attack will include the creation of a new user, followed by permissions being elevated to an admin level.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>win_servers</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>windows</span><span class=p>:</span><span class=k>security</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4720</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4732</span><span class=w> </span><span class=n>Administrators</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>transaction</span><span class=w> </span><span class=n>Security_ID</span><span class=w> </span><span class=n>maxspan</span><span class=o>=</span><span class=mi>180</span><span class=n>m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>search</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4720</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4732</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>_time</span><span class=p>,</span><span class=w> </span><span class=n>EventCode</span><span class=p>,</span><span class=w> </span><span class=n>Recurity_ID</span><span class=p>,</span><span class=w> </span><span class=n>SamAccountName</span></span></span></code></pre></div></div><h3 class="relative group">9- Finding Interactive Logins From Service Accounts<div id=9--finding-interactive-logins-from-service-accounts class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#9--finding-interactive-logins-from-service-accounts aria-label=Anchor>#</a></span></h3><p>Most service accounts should never interactively log into servers.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>systems</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>audit_logs</span><span class=w> </span><span class=k>user</span><span class=o>=</span><span class=n>svc_</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=n>earliest</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>earliest</span><span class=w> </span><span class=n>latest</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>latest</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>user</span><span class=p>,</span><span class=w> </span><span class=n>dest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>eval</span><span class=w> </span><span class=n>isOutlier</span><span class=o>=</span><span class=k>if</span><span class=p>(</span><span class=n>earliest</span><span class=w> </span><span class=o>&gt;=</span><span class=w> </span><span class=n>relative_time</span><span class=p>(</span><span class=n>now</span><span class=p>(),</span><span class=w> </span><span class=s2>&#34;-1d@d&#34;</span><span class=p>),</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>0</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>convert</span><span class=w> </span><span class=n>ctime</span><span class=p>(</span><span class=n>earliest</span><span class=p>)</span><span class=w> </span><span class=n>ctime</span><span class=p>(</span><span class=n>Latest</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">10- Log Volume Trending<div id=10--log-volume-trending class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#10--log-volume-trending aria-label=Anchor>#</a></span></h3><p>Visualizing the number of events being logged by an application can provide a simple, yet powerful indicator of the state of your application, or changes in the behavior of your code or environment.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=n>tstats</span><span class=w> </span><span class=n>prestats</span><span class=o>=</span><span class=n>t</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=k>index</span><span class=o>=</span><span class=n>apps</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>host</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=n>span</span><span class=o>=</span><span class=mi>1</span><span class=n>m</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=n>timechart</span><span class=w> </span><span class=k>partial</span><span class=o>=</span><span class=n>f</span><span class=w> </span><span class=n>span</span><span class=o>=</span><span class=mi>1</span><span class=n>m</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>host</span><span class=w> </span><span class=k>limit</span><span class=o>=</span><span class=mi>0</span></span></span></code></pre></div></div><h3 class="relative group">11- Basic TOR Traffic Detection<div id=11--basic-tor-traffic-detection class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#11--basic-tor-traffic-detection aria-label=Anchor>#</a></span></h3><p>Use firewall data to find TOR traffic on your network.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>network</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>firewall_data</span><span class=w> </span><span class=n>app</span><span class=o>=</span><span class=n>tor</span><span class=w> </span><span class=n>src_ip</span><span class=o>=*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=n>src_ip</span><span class=w> </span><span class=n>src_port</span><span class=w> </span><span class=n>dest_ip</span><span class=w> </span><span class=n>dest_port</span><span class=w> </span><span class=n>bytes</span><span class=w> </span><span class=n>app</span></span></span></code></pre></div></div><h3 class="relative group">12- Measuring Storage I/O Latency<div id=12--measuring-storage-io-latency class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#12--measuring-storage-io-latency aria-label=Anchor>#</a></span></h3><p>Quickly find I/O bottlenecks across your systems.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>main</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>iostat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>timechart</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=n>latency</span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>host</span></span></span></code></pre></div></div><h3 class="relative group">13- Measuring Storage Speed I/O Utilization by Host<div id=13--measuring-storage-speed-io-utilization-by-host class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#13--measuring-storage-speed-io-utilization-by-host aria-label=Anchor>#</a></span></h3><p>It simple to track disk I/O, helping you quickly discover storage issues on your servers.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>main</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>iostat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>eval</span><span class=w> </span><span class=n>hostdevice</span><span class=o>=</span><span class=k>host</span><span class=o>+</span><span class=s2>&#34;:&#34;</span><span class=o>+</span><span class=n>Device</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>timechart</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=n>total_ops</span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>hostdevice</span></span></span></code></pre></div></div><h3 class="relative group">14- Measuring Memory Utilization by Host<div id=14--measuring-memory-utilization-by-host class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#14--measuring-memory-utilization-by-host aria-label=Anchor>#</a></span></h3><p>It&rsquo;s easy to track memory utilization of your systems using Splunk Enterprise.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>main</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>vmstat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>memUsedPct</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>memused</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>host</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>memused</span><span class=o>&gt;</span><span class=mi>80</span></span></span></code></pre></div></div><h3 class="relative group">15- Rogue DNS detection<div id=15--rogue-dns-detection class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#15--rogue-dns-detection aria-label=Anchor>#</a></span></h3><p>Look for DNS requests that are not destined for the dedicated DNS server.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=k>security</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>cp_log</span><span class=w> </span><span class=n>src_ip</span><span class=o>!=</span><span class=mi>192</span><span class=p>.</span><span class=mi>168</span><span class=p>.</span><span class=mi>14</span><span class=p>.</span><span class=mi>10</span><span class=w> </span><span class=n>dest_ip</span><span class=o>!=</span><span class=mi>192</span><span class=p>.</span><span class=mi>168</span><span class=p>.</span><span class=mi>14</span><span class=p>.</span><span class=mi>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>protocol</span><span class=o>=</span><span class=mi>53</span><span class=w> </span><span class=n>action</span><span class=o>!=</span><span class=k>Drop</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>dest_ip</span><span class=o>=</span><span class=s2>&#34;192.168.0.0/16&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>src_ip</span><span class=o>=</span><span class=s2>&#34;192.168.0.0/16&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=p>,</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>dest_ip</span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>src_ip</span></span></span></code></pre></div></div><h3 class="relative group">16- Suspicious PowerShell Commands<div id=16--suspicious-powershell-commands class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#16--suspicious-powershell-commands aria-label=Anchor>#</a></span></h3><p>Look for logs with commands that try to download external scripts/content or bypass PowerShell.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>windows</span><span class=w> </span><span class=k>source</span><span class=o>=</span><span class=s2>&#34;WinEventLog:Microsoft-Windows-PowerShell/Operational&#34;</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4104</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>AND</span><span class=w> </span><span class=p>((</span><span class=n>ScriptBlockText</span><span class=o>=*-</span><span class=n>noni</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=n>iex</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=k>New</span><span class=o>-</span><span class=k>Object</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>ScriptBlockText</span><span class=o>=*-</span><span class=n>ep</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=n>bypass</span><span class=o>*</span><span class=w> </span><span class=o>*-</span><span class=n>Enc</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>ScriptBlockText</span><span class=o>=*</span><span class=n>powershell</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=n>reg</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=k>add</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>*</span><span class=n>HKCU</span><span class=err>\\</span><span class=n>software</span><span class=err>\\</span><span class=n>microsoft</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>currentversion</span><span class=err>\\</span><span class=n>run</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>ScriptBlockText</span><span class=o>=*</span><span class=n>bypass</span><span class=o>*</span><span class=w> </span><span class=o>*-</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>noprofile</span><span class=o>*</span><span class=w> </span><span class=o>*-</span><span class=n>windowstyle</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=n>hidden</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=k>new</span><span class=o>-</span><span class=k>object</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=k>system</span><span class=p>.</span><span class=n>net</span><span class=p>.</span><span class=n>webclient</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=p>.</span><span class=n>download</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>ScriptBlockText</span><span class=o>=*</span><span class=n>iex</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=k>New</span><span class=o>-</span><span class=k>Object</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=n>Net</span><span class=p>.</span><span class=n>WebClient</span><span class=o>*</span><span class=w> </span><span class=o>*</span><span class=p>.</span><span class=n>Download</span><span class=o>*</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>Computer</span><span class=p>,</span><span class=w> </span><span class=n>ScriptBlockText</span><span class=p>,</span><span class=w> </span><span class=n>UserID</span></span></span></code></pre></div></div><h3 class="relative group">17- Windows audit log cleared<div id=17--windows-audit-log-cleared class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#17--windows-audit-log-cleared aria-label=Anchor>#</a></span></h3><p>Look for security logs filtered with EventCode 1102.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>windows</span><span class=w> </span><span class=k>source</span><span class=o>=</span><span class=s2>&#34;WinEventLog:Security&#34;</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1102</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>_time</span><span class=p>,</span><span class=w> </span><span class=k>host</span><span class=p>,</span><span class=w> </span><span class=n>signature</span><span class=p>,</span><span class=w> </span><span class=k>user</span></span></span></code></pre></div></div><h3 class="relative group">18- Detecting Network and Port Scanning<div id=18--detecting-network-and-port-scanning class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#18--detecting-network-and-port-scanning aria-label=Anchor>#</a></span></h3><p>Look for distinct count of destination ports within a short span of time.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=p>:</span><span class=s2>&#34;Network_Traffic&#34;</span><span class=p>.</span><span class=s2>&#34;All_Traffic&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=n>dc</span><span class=p>(</span><span class=n>dest_port</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>dc_dest_port</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>src</span><span class=p>,</span><span class=w> </span><span class=n>dest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>dc_dest_port</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10</span></span></span></code></pre></div></div><p>OR</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=n>firewall</span><span class=o>*</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=n>dc</span><span class=p>(</span><span class=n>dest_port</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>num_dest_port</span><span class=w> </span><span class=n>dc</span><span class=p>(</span><span class=n>dest_ip</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>num_dest_ip</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>src_ip</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>num_dest_port</span><span class=w> </span><span class=o>&gt;</span><span class=mi>500</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>num_dest_ip</span><span class=w> </span><span class=o>&gt;</span><span class=mi>500</span></span></span></code></pre></div></div><h3 class="relative group">19- Unusual Access<div id=19--unusual-access class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#19--unusual-access aria-label=Anchor>#</a></span></h3><p>Look for count of multiple failed login attempts where successful login is true.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=p>:</span><span class=s2>&#34;Authentication&#34;</span><span class=p>.</span><span class=s2>&#34;Authentication&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>like</span><span class=p>(</span><span class=n>app</span><span class=p>,</span><span class=s2>&#34;ssh&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=n>list</span><span class=p>(</span><span class=n>action</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Attempts</span><span class=p>,</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>eval</span><span class=p>(</span><span class=k>match</span><span class=p>(</span><span class=n>action</span><span class=p>,</span><span class=s2>&#34;failure&#34;</span><span class=p>)))</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Failed</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>count</span><span class=p>(</span><span class=n>eval</span><span class=p>(</span><span class=k>match</span><span class=p>(</span><span class=n>action</span><span class=p>,</span><span class=s2>&#34;success&#34;</span><span class=p>)))</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Success</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>user</span><span class=p>,</span><span class=n>src</span><span class=p>,</span><span class=n>dest</span><span class=p>,</span><span class=n>app</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>mvcount</span><span class=p>(</span><span class=n>Attempts</span><span class=p>)</span><span class=o>&gt;=</span><span class=mi>6</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>Success</span><span class=o>&gt;</span><span class=mi>0</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>Failed</span><span class=o>&gt;=</span><span class=mi>5</span></span></span></code></pre></div></div><h3 class="relative group">20- Malware Attack<div id=20--malware-attack class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#20--malware-attack aria-label=Anchor>#</a></span></h3><p>Look for infection count of malware attack.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=p>:</span><span class=s2>&#34;Malware&#34;</span><span class=p>.</span><span class=s2>&#34;Malware_Attacks&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=n>dc</span><span class=p>(</span><span class=s2>&#34;signature&#34;</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s2>&#34;infection_count&#34;</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=s2>&#34;dest&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=s1>&#39;infection_count&#39;</span><span class=o>&gt;</span><span class=mi>1</span></span></span></code></pre></div></div><h3 class="relative group">21-Attempt To Add Certificate To Untrusted Store<div id=21-attempt-to-add-certificate-to-untrusted-store class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#21-attempt-to-add-certificate-to-untrusted-store aria-label=Anchor>#</a></span></h3><p>Adversaries may add their own root certificate to the certificate store, to cause the web browser to trust that certificate and not display a security warning when it encounters the previously unseen certificate. This action may be the precursor to malicious activity.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>process</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=*</span><span class=n>certutil</span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*-</span><span class=n>addstore</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span></span></span></code></pre></div></div><h3 class="relative group">22**- Batch File Write to System32**<div id=22--batch-file-write-to-system32 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#22--batch-file-write-to-system32 aria-label=Anchor>#</a></span></h3><p>While batch files are not inherently malicious, it is uncommon to see them created after OS installation, especially in the Windows directory. This analytic looks for the suspicious activity of a batch file being created within the C:\Windows\System32 directory tree. There will be only occasional false positives due to administrator actions.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Filesystem</span><span class=p>.</span><span class=n>dest</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>dest</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Filesystem</span><span class=p>.</span><span class=n>file_name</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>file_name</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Filesystem</span><span class=p>.</span><span class=k>user</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Filesystem</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Filesystem</span><span class=p>.</span><span class=n>file_path</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=n>rex</span><span class=w> </span><span class=n>field</span><span class=o>=</span><span class=n>file_name</span><span class=w> </span><span class=s2>&#34;(?&lt;file_extension&gt;\.[^\.]+)$&#34;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>search</span><span class=w> </span><span class=n>file_path</span><span class=o>=*</span><span class=n>system32</span><span class=o>*</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>file_extension</span><span class=o>=</span><span class=p>.</span><span class=n>bat</span></span></span></code></pre></div></div><h3 class="relative group">23- BCDEdit Failure Recovery Modification<div id=23--bcdedit-failure-recovery-modification class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#23--bcdedit-failure-recovery-modification aria-label=Anchor>#</a></span></h3><p>This search looks for flags passed to bcdedit.exe modifications to the built-in Windows error recovery boot configurations. This is typically used by ransomware to prevent recovery.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>bcdedit</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=</span><span class=s2>&#34;*recoveryenabled*&#34;</span><span class=w> </span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=</span><span class=s2>&#34;* no*&#34;</span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>dest</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span></span></span></code></pre></div></div><h3 class="relative group">24- BITS Job Persistence<div id=24--bits-job-persistence class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#24--bits-job-persistence aria-label=Anchor>#</a></span></h3><p>The following query identifies Microsoft Background Intelligent Transfer Service utility <code>bitsadmin.exe</code> scheduling a BITS job to persist on an endpoint. The query identifies the parameters used to create, resume or add a file to a BITS job. Typically seen combined in a oneliner or ran in sequence. If identified, review the BITS job created and capture any files written to disk. It is possible for BITS to be used to upload files and this may require further network data analysis to identify. You can use <code>bitsadmin /list /verbose</code> to list out the jobs during investigation.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>bitsadmin</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=o>*</span><span class=k>create</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>addfile</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>setnotifyflags</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>setnotifycmdline</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>setminretrydelay</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>setcustomheaders</span><span class=o>*</span><span class=p>,</span><span class=w> </span><span class=o>*</span><span class=n>resume</span><span class=o>*</span><span class=w> </span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>dest</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_id</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process_id</span></span></span></code></pre></div></div><h3 class="relative group">25- BITSAdmin Download File<div id=25--bitsadmin-download-file class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#25--bitsadmin-download-file aria-label=Anchor>#</a></span></h3><p>The following query identifies Microsoft Background Intelligent Transfer Service utility <code>bitsadmin.exe</code> using the <code>transfer</code> parameter to download a remote object. In addition, look for <code>download</code> or <code>upload</code> on the command-line, the switches are not required to perform a transfer. Capture any files downloaded. Review the reputation of the IP or domain used. Typically once executed, a follow on command will be used to execute the dropped file. Note that the network connection or file modification events related will not spawn or create from <code>bitsadmin.exe</code>, but the artifacts will appear in a parallel process of <code>svchost.exe</code> with a command-line similar to <code>svchost.exe -k netsvcs -s BITS</code>. Its important to review all parallel and child processes to capture any behaviors and artifacts. In some suspicious and malicious instances, BITS jobs will be created. You can use <code>bitsadmin /list /verbose</code> to list out the jobs during investigation.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>bitsadmin</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=n>transfer</span><span class=o>*</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>dest</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_id</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process_id</span></span></span></code></pre></div></div><h3 class="relative group">26- CertUtil Download With URLCache and Split Arguments<div id=26--certutil-download-with-urlcache-and-split-arguments class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#26--certutil-download-with-urlcache-and-split-arguments aria-label=Anchor>#</a></span></h3><p>Certutil.exe may download a file from a remote destination using <code>urlcache</code>. This behavior does require a URL to be passed on the command-line. In addition, <code>f</code> (force) and <code>split</code> (Split embedded ASN.1 elements, and save to files) will be used. It is not entirely common for <code>certutil.exe</code> to contact public IP space. However, it is uncommon for <code>certutil.exe</code> to write files to world writeable paths.\ During triage, capture any files on disk and review. Review the reputation of the remote IP or domain in question.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>certutil</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=n>urlcache</span><span class=o>*</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=n>split</span><span class=o>*</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>dest</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_id</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process_id</span></span></span></code></pre></div></div><h3 class="relative group">27- CertUtil Download With VerifyCtl and Split Arguments<div id=27--certutil-download-with-verifyctl-and-split-arguments class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#27--certutil-download-with-verifyctl-and-split-arguments aria-label=Anchor>#</a></span></h3><p>Certutil.exe may download a file from a remote destination using <code>VerifyCtl</code>. This behavior does require a URL to be passed on the command-line. In addition, <code>f</code> (force) and <code>split</code> (Split embedded ASN.1 elements, and save to files) will be used. It is not entirely common for <code>certutil.exe</code> to contact public IP space. \ During triage, capture any files on disk and review. Review the reputation of the remote IP or domain in question. Using <code>VerifyCtl</code>, the file will either be written to the current working directory or <code>%APPDATA%\..\LocalLow\Microsoft\CryptnetUrlCache\Content\&lt;hash></code>.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>certutil</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=n>verifyctl</span><span class=o>*</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=n>split</span><span class=o>*</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>dest</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_id</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process_id</span></span></span></code></pre></div></div><h3 class="relative group">28- Certutil exe certificate extraction<div id=28--certutil-exe-certificate-extraction class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#28--certutil-exe-certificate-extraction aria-label=Anchor>#</a></span></h3><p>This search looks for arguments to certutil.exe indicating the manipulation or extraction of Certificate. This certificate can then be used to sign new authentication tokens specially inside Federated environments such as Windows ADFS.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>process</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>certutil</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;* -exportPFX *&#34;</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span></span></span></code></pre></div></div><h3 class="relative group">29- CertUtil With Decode Argument<div id=29--certutil-with-decode-argument class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#29--certutil-with-decode-argument aria-label=Anchor>#</a></span></h3><p>CertUtil.exe may be used to <code>encode</code> and <code>decode</code> a file, including PE and script code. Encoding will convert a file to base64 with <code>----BEGIN CERTIFICATE-----</code> and <code>----END CERTIFICATE-----</code> tags. Malicious usage will include decoding a encoded file that was downloaded. Once decoded, it will be loaded by a parallel process. Note that there are two additional command switches that may be used - <code>encodehex</code> and <code>decodehex</code>. Similarly, the file will be encoded in HEX and later decoded for further execution. During triage, identify the source of the file being decoded. Review its contents or execution behavior for further analysis.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>certutil</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=n>decode</span><span class=o>*</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>dest</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_id</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process_id</span></span></span></code></pre></div></div><h3 class="relative group">30- Create local admin accounts using net exe<div id=30--create-local-admin-accounts-using-net-exe class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#30--create-local-admin-accounts-using-net-exe aria-label=Anchor>#</a></span></h3><p>This search looks for the creation of local administrator accounts using net.exe.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=n>tstats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=k>user</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=n>parent_process</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>parent_process</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>datamodel</span><span class=o>=</span><span class=n>Endpoint</span><span class=p>.</span><span class=n>Processes</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>net</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=o>=</span><span class=n>net1</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=n>localgroup</span><span class=o>*</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*/</span><span class=k>add</span><span class=o>*</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=o>=*</span><span class=k>user</span><span class=o>*</span><span class=p>)</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>process_name</span><span class=w> </span><span class=n>Processes</span><span class=p>.</span><span class=n>dest</span><span class=w>   </span><span class=o>|`</span><span class=n>create_local_admin_accounts_using_net_exe_filter</span><span class=o>`</span></span></span></code></pre></div></div><h3 class="relative group">31- Create Remote Thread into LSASS<div id=31--create-remote-thread-into-lsass class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#31--create-remote-thread-into-lsass aria-label=Anchor>#</a></span></h3><p>Actors may create a remote thread into the LSASS service as part of a workflow to dump credentials.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>`</span><span class=n>sysmon</span><span class=o>`</span><span class=w> </span><span class=n>EventID</span><span class=o>=</span><span class=mi>8</span><span class=w> </span><span class=n>TargetImage</span><span class=o>=*</span><span class=n>lsass</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Computer</span><span class=p>,</span><span class=w> </span><span class=n>EventCode</span><span class=p>,</span><span class=w> </span><span class=n>TargetImage</span><span class=p>,</span><span class=w> </span><span class=n>TargetProcessId</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>rename</span><span class=w> </span><span class=n>Computer</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>dest</span></span></span></code></pre></div></div><h3 class="relative group">32- Create Service In Suspicious File Path<div id=32--create-service-in-suspicious-file-path class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#32--create-service-in-suspicious-file-path aria-label=Anchor>#</a></span></h3><p>This detection is to identify a creation of user mode service where the service file path is located in non-common service folder in windows.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>`</span><span class=n>wineventlog_system</span><span class=o>`</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>7045</span><span class=w>  </span><span class=n>Service_File_Name</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;*\.exe&#34;</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=p>(</span><span class=n>Service_File_Name</span><span class=w> </span><span class=k>IN</span><span class=w> </span><span class=p>(</span><span class=s2>&#34;C:\\Windows\\*&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;C:\\Program File*&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;C:\\Programdata\\*&#34;</span><span class=p>,</span><span class=w> </span><span class=s2>&#34;%systemroot%\\*&#34;</span><span class=p>))</span><span class=w> </span><span class=n>Service_Type</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;user mode service&#34;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>count</span><span class=w> </span><span class=k>min</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>firstTime</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>_time</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>lastTime</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>EventCode</span><span class=w> </span><span class=n>Service_File_Name</span><span class=w> </span><span class=n>Service_Name</span><span class=w> </span><span class=n>Service_Start_Type</span><span class=w> </span><span class=n>Service_Type</span></span></span></code></pre></div></div><h3 class="relative group">33- Common Windows Process Masquerading<div id=33--common-windows-process-masquerading class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#33--common-windows-process-masquerading aria-label=Anchor>#</a></span></h3><p>Masquerading occurs when the name or location of an object, legitimate or malicious, is manipulated or abused for the sake of evading defenses and observation. This may include manipulating file metadata, tricking users into misidentifying the file type, and giving legitimate task or service names.</p><p>Malware authors often use this technique to hide malicious executables behind legitimate Windows executable names (e.g. <code>lsass.exe</code>, <code>svchost.exe</code>, etc).</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=k>source</span><span class=o>=</span><span class=s2>&#34;XmlWinEventLog:Microsoft-Windows-Sysmon/Operational&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>svchost</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=p>(</span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\svchost.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\SysWow64\\svchost.exe&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>smss</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\smss.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>wininit</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\wininit.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>taskhost</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\taskhost.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>lasass</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\lsass.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>winlogon</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\winlogon.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>csrss</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\csrss.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>services</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\services.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>lsm</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\lsm.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>process_name</span><span class=o>=</span><span class=n>explorer</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=n>process_path</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\explorer.exe&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">34- Unusual Child Process spawned using DDE exploit<div id=34--unusual-child-process-spawned-using-dde-exploit class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#34--unusual-child-process-spawned-using-dde-exploit aria-label=Anchor>#</a></span></h3><p>Adversaries may use Windows Dynamic Data Exchange (DDE) to execute arbitrary commands. DDE is a client-server protocol for one-time and/or continuous inter-process communication (IPC) between applications. Once a link is established, applications can autonomously exchange transactions consisting of strings, warm data links (notifications when a data item changes), hot data links (duplications of changes to a data item), and requests for command execution.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>__your_sysmon__index__</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>=</span><span class=s2>&#34;*excel.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>ParentImage</span><span class=o>=</span><span class=s2>&#34;*word.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>ParentImage</span><span class=o>=</span><span class=s2>&#34;*outlook.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*.exe&#34;</span></span></span></code></pre></div></div><h3 class="relative group">35- Detecting Tampering of Windows Defender Command Prompt<div id=35--detecting-tampering-of-windows-defender-command-prompt class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#35--detecting-tampering-of-windows-defender-command-prompt aria-label=Anchor>#</a></span></h3><p>In an attempt to avoid detection after compromising a machine, threat actors often try to disable Windows Defender. This is often done using sc [service control], a legitimate tool provided by Microsoft for managing services. This action interferes with event detection and may lead to a security event going undetected, thereby potentially leading to further compromise of the network.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=w> </span><span class=n>__your_sysmon__index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;C:\\Windows\\System32\\sc.exe&#34;</span><span class=w>  </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;^sc\s*(config|stop|query)\sWinDefend$&#34;</span></span></span></code></pre></div></div><h3 class="relative group">36- Disable UAC<div id=36--disable-uac class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#36--disable-uac aria-label=Anchor>#</a></span></h3><p>Threat actors often, after compromising a machine, try to disable User Access Control (UAC) to escalate privileges. This is often done by changing the registry key for system policies using reg.exe, a legitimate tool provided by Microsoft for modifying the registry via command prompt or scripts. This action interferes with UAC and may enable a threat actor to escalate privileges on the compromised system, thereby allowing further exploitation of the system.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>sourcetype</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>ParentImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;C:\\Windows\\System32\\cmd.exe&#34;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>like</span><span class=p>(</span><span class=n>CommandLine</span><span class=p>,</span><span class=s2>&#34;reg.exe%HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System%REG_DWORD /d 0%&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">37- Identifying Port Scanning Activity<div id=37--identifying-port-scanning-activity class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#37--identifying-port-scanning-activity aria-label=Anchor>#</a></span></h3><p>After compromising an initial machine, adversaries commonly attempt to laterally move across the network. The first step to attempt the lateral movement often involves conducting host identification, port and service scans on the internal network via the compromised machine using tools such as Nmap, Cobalt Strike, etc.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=n>sourcetype</span><span class=o>=</span><span class=s1>&#39;firewall_logs&#39;</span><span class=w> </span><span class=n>dest_ip</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;internal_subnet&#39;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=n>dc</span><span class=p>(</span><span class=n>dest_port</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>pcount</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>src_ip</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>pcount</span><span class=w> </span><span class=o>&gt;</span><span class=mi>5</span></span></span></code></pre></div></div><h3 class="relative group">38- Unusually Long Command Line Strings<div id=38--unusually-long-command-line-strings class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#38--unusually-long-command-line-strings aria-label=Anchor>#</a></span></h3><p>Often, after a threat actor gains access to a system, they will attempt to run some kind of malware to further infect the victim machine. These malware often have long command line strings, which could be a possible indicator of attack. Here, we use sysmon and Splunk to first find the average command string length and search for command strings that stretch over multiple lines, thus identifying anomalies and possibly malicious commands.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=s2>&#34;xmlwineventlog&#34;</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4688</span><span class=w>  </span><span class=o>|</span><span class=n>eval</span><span class=w> </span><span class=n>cmd_len</span><span class=o>=</span><span class=n>len</span><span class=p>(</span><span class=n>CommandLine</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>eventstats</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=n>cmd_len</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>avg</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>host</span><span class=o>|</span><span class=w> </span><span class=n>stats</span><span class=w> </span><span class=k>max</span><span class=p>(</span><span class=n>cmd_len</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>maxlen</span><span class=p>,</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=k>avg</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>avgperhost</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=k>host</span><span class=p>,</span><span class=w> </span><span class=n>CommandLine</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>maxlen</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>10</span><span class=o>*</span><span class=n>avgperhost</span></span></span></code></pre></div></div><h3 class="relative group">39- Clearing Windows Logs with Wevtutil<div id=39--clearing-windows-logs-with-wevtutil class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#39--clearing-windows-logs-with-wevtutil aria-label=Anchor>#</a></span></h3><p>In an attempt to clear traces after compromising a machine, threat actors often try to clear Windows Event logs. This is often done using wevtutil, a legitimate tool provided by Microsoft. This action interferes with event collection and notification, and may lead to a security event going undetected, thereby potentially leading to further compromise of the network.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>sourcetype</span><span class=o>=</span><span class=w> </span><span class=n>__your__windows__sysmon__sourcetype</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=*</span><span class=n>wevtutil</span><span class=o>*</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=*</span><span class=n>cl</span><span class=o>*</span><span class=w> </span><span class=p>(</span><span class=n>CommandLine</span><span class=o>=*</span><span class=k>System</span><span class=o>*</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=*</span><span class=k>Security</span><span class=o>*</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=*</span><span class=n>Setup</span><span class=o>*</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=*</span><span class=n>Application</span><span class=o>*</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>```</span><span class=c1>---
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>###</span><span class=w> </span><span class=mi>40</span><span class=o>-</span><span class=w> </span><span class=n>Unusual</span><span class=w> </span><span class=n>Child</span><span class=w> </span><span class=n>Process</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>Spoolsv</span><span class=p>.</span><span class=n>Exe</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>Connhost</span><span class=p>.</span><span class=n>Exe</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>After</span><span class=w> </span><span class=n>gaining</span><span class=w> </span><span class=n>initial</span><span class=w> </span><span class=k>access</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>system</span><span class=p>,</span><span class=w> </span><span class=n>threat</span><span class=w> </span><span class=n>actors</span><span class=w> </span><span class=n>attempt</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>escalate</span><span class=w> </span><span class=k>privileges</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>they</span><span class=w> </span><span class=n>may</span><span class=w> </span><span class=n>be</span><span class=w> </span><span class=n>operating</span><span class=w> </span><span class=n>within</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>lower</span><span class=w> </span><span class=n>privileged</span><span class=w> </span><span class=n>process</span><span class=w> </span><span class=n>which</span><span class=w> </span><span class=n>does</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=n>allow</span><span class=w> </span><span class=n>them</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=k>access</span><span class=w> </span><span class=n>protected</span><span class=w> </span><span class=n>information</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>carry</span><span class=w> </span><span class=k>out</span><span class=w> </span><span class=n>tasks</span><span class=w> </span><span class=n>which</span><span class=w> </span><span class=n>require</span><span class=w> </span><span class=n>higher</span><span class=w> </span><span class=n>permissions</span><span class=p>.</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>common</span><span class=w> </span><span class=n>way</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>escalating</span><span class=w> </span><span class=k>privileges</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>system</span><span class=w> </span><span class=k>is</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>externally</span><span class=w> </span><span class=n>invoking</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>exploiting</span><span class=w> </span><span class=n>spoolsv</span><span class=w> </span><span class=k>or</span><span class=w> </span><span class=n>connhost</span><span class=w> </span><span class=n>executables</span><span class=p>,</span><span class=w> </span><span class=k>both</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>which</span><span class=w> </span><span class=k>are</span><span class=w> </span><span class=n>legitimate</span><span class=w> </span><span class=n>Windows</span><span class=w> </span><span class=n>applications</span><span class=p>.</span><span class=w> </span><span class=n>This</span><span class=w> </span><span class=n>query</span><span class=w> </span><span class=n>searches</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>an</span><span class=w> </span><span class=n>invocation</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>either</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=n>these</span><span class=w> </span><span class=n>executables</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>a</span><span class=w> </span><span class=k>user</span><span class=p>,</span><span class=w> </span><span class=n>thus</span><span class=w> </span><span class=n>alerting</span><span class=w> </span><span class=n>us</span><span class=w> </span><span class=k>of</span><span class=w> </span><span class=k>any</span><span class=w> </span><span class=n>potentially</span><span class=w> </span><span class=n>malicious</span><span class=w> </span><span class=n>activity</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=o>```</span><span class=k>sql</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>System32</span><span class=err>\\</span><span class=n>spoolsv</span><span class=p>.</span><span class=n>exe</span><span class=o>*</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>System32</span><span class=err>\\</span><span class=n>conhost</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=n>ParentImage</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s2>&#34;C:\\Windows\\System32\\cmd.exe&#34;</span></span></span></code></pre></div></div><h3 class="relative group">41- Detecting Shadow Copy Deletion via Vssadmin.exe<div id=41--detecting-shadow-copy-deletion-via-vssadminexe class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#41--detecting-shadow-copy-deletion-via-vssadminexe aria-label=Anchor>#</a></span></h3><p>After compromising a network of systems, threat actors often try to delete Shadow Copy in an attempt to prevent administrators from restoring the systems to versions present before the attack. This is often done via vssadmin, a legitimate Windows tool to interact with shadow copies. This non-detection of this technique, which is often employed by ransomware strains such as Olympic Destroyer, may lead to a failure in recovering systems after an attack.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_win_event_log_index__</span><span class=w> </span><span class=n>EventType</span><span class=o>=</span><span class=mi>4688</span><span class=w> </span><span class=n>CommandLine</span><span class=p>:</span><span class=s2>&#34;delete&#34;</span><span class=w> </span><span class=n>OriginalFileName</span><span class=p>:</span><span class=s2>&#34;VSSADMIN.EXE&#34;</span></span></span></code></pre></div></div><h3 class="relative group">42- Webshell-Indicative Process Tree<div id=42--webshell-indicative-process-tree class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#42--webshell-indicative-process-tree aria-label=Anchor>#</a></span></h3><p>A web shell is a web script placed on an openly accessible web server to allow an adversary to use the server as a gatway in a network. As the shell operates, commands will be issued from within the web application into the broader server operating system. This analytic looks for host enumeration executables initiated by any web service that would not normally be executed within that environment.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\services.exe&#34;</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\cmd.exe&#34;</span><span class=w> </span><span class=p>(</span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*echo*&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*\\pipe\\*&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\rundll32.exe&#34;</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*,a /p:*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">43- Get System Elevation<div id=43--get-system-elevation class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#43--get-system-elevation aria-label=Anchor>#</a></span></h3><p>Cyber actors frequently escalate to the SYSTEM account after gaining entry to a Windows host, to enable them to carry out various attacks more effectively. Tools such as Meterpreter, Cobalt Strike, and Empire carry out automated steps to Get System, which is the same as switching over to the System user account. Most of these tools utilize multiple techniques to try and attain SYSTEM: in the first technique, they create a named pipe and connects an instance of cmd.exe to it, which allows them to impersonate the security context of cmd.exe, which is SYSTEM. In the second technique, a malicious DLL is injected into a process that is running as SYSTEM; the injected DLL steals the SYSTEM token and applies it where necessary to escalate privileges. This analytic looks for both of these techniques.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>index</span><span class=o>=</span>__your_sysmon_index__ <span class=o>(</span><span class=nv>ParentImage</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\services.exe&#34;</span> <span class=nv>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\cmd.exe&#34;</span> <span class=o>(</span><span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*echo*&#34;</span> AND <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*\\pipe\\*&#34;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>OR <span class=o>(</span><span class=nv>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\rundll32.exe&#34;</span> <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*,a /p:*&#34;</span><span class=o>)</span></span></span></code></pre></div></div><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\cmd.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*%COMSPEC%*&#34;</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*echo*&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*\pipe\*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">44- Boot or Logon Initialization Scripts<div id=44--boot-or-logon-initialization-scripts class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#44--boot-or-logon-initialization-scripts aria-label=Anchor>#</a></span></h3><p>Adversaries may schedule software to run whenever a user logs into the system; this is done to establish persistence and sometimes for lateral movement. This trigger is established through the registry key HKEY_CURRENT_USER\Environment<em>UserInitMprLogonScript</em>. This signature looks edits to existing keys or creation of new keys in that path. Users purposefully adding benign scripts to this path will result in false positives; that case is rare, however. There are other ways of running a script at startup or login that are not covered in this signature. Note that this signature overlaps with the Windows Sysinternals Autoruns tool, which would also show changes to this registry path.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\reg.exe&#34;</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*add*\\Environment*UserInitMprLogonScript&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=p>(</span><span class=n>EventCode</span><span class=o>=</span><span class=mi>12</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>14</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>13</span><span class=p>)</span><span class=w> </span><span class=n>TargetObject</span><span class=o>=</span><span class=s2>&#34;*\\Environment*UserInitMprLogonScript&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">45- Local Network Sniffing<div id=45--local-network-sniffing class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#45--local-network-sniffing aria-label=Anchor>#</a></span></h3><p>Adversaries may use a variety of tools to gain visibility on the current status of things on the network: which processes are listening on which ports, which services are running on other hosts, etc. This analytic looks for the names of the most common network sniffing tools. While this may be noisy on networks where sysadmins are using any of these tools on a regular basis, in most networks their use is noteworthy.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*tshark.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*windump.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*logman.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;?&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Program Files\\Windows Event Reporting\\Core\\EventReporting.AgentService.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*tcpdump.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*wprui.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*wpr.exe&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">46- DLL Injection with Mavinject<div id=46--dll-injection-with-mavinject class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#46--dll-injection-with-mavinject aria-label=Anchor>#</a></span></h3><p>Injecting a malicious DLL into a process is a common adversary TTP. Although the ways of doing this are numerous, mavinject.exe is a commonly used tool for doing so because it roles up many of the necessary steps into one, and is available within Windows. Attackers may rename the executable, so we also use the common argument INJECTRUNNING as a related signature here. Whitelisting certain applications may be necessary to reduce noise for this analytic.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\SysWOW64\\mavinject.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\mavinject.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*\INJECTRUNNING*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">47- Processes Started From Irregular Parent<div id=47--processes-started-from-irregular-parent class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#47--processes-started-from-irregular-parent aria-label=Anchor>#</a></span></h3><p>Adversaries may start legitimate processes and then use their memory space to run malicious code. This analytic looks for common Windows processes that have been abused this way in the past; when the processes are started for this purpose they may not have the standard parent that we would expect. This list is not exhaustive, and it is possible for cyber actors to avoid this discepency. These signatures only work if Sysmon reports the parent process, which may not always be the case if the parent dies before sysmon processes the event.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;?&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Program Files\\SplunkUniversalForwarder\\bin\\splunk-regmon.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Program Files\\SplunkUniversalForwarder\\bin\\splunk-powershell.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>((</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\System32\\smss.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\smss.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;System&#34;</span><span class=p>))</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\csrss.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\smss.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\svchost.exe&#34;</span><span class=p>))</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\wininit.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\smss.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\winlogon.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\smss.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\lsass.exe&#34;</span><span class=w> </span><span class=k>and</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\wininit.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\LogonUI.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\winlogon.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\wininit.exe&#34;</span><span class=p>))</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\services.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\wininit.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\spoolsv.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\services.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\taskhost.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\services.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\svchost.exe&#34;</span><span class=p>))</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\taskhostw.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\services.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\svchost.exe&#34;</span><span class=p>))</span><span class=w> </span><span class=k>OR</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\System32\\userinit.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\dwm.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\System32\\winlogon.exe&#34;</span><span class=p>)))</span></span></span></code></pre></div></div><h3 class="relative group">48- Clear Powershell Console Command History<div id=48--clear-powershell-console-command-history class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#48--clear-powershell-console-command-history aria-label=Anchor>#</a></span></h3><p>Adversaries may attempt to conceal their tracks by deleting the history of commands run within the Powershell console, or turning off history saving to begin with. This analytic looks for several commands that would do this. This does not capture the event if it is done within the console itself; only commandline-based commands are detected. Note that the command to remove the history file directly may very a bit if the history file is not saved in the default path on a particular system.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>(</span><span class=nv>index</span><span class=o>=</span>__your_sysmon_index__ <span class=nv>EventCode</span><span class=o>=</span>1<span class=o>)</span> <span class=o>(</span><span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*rm (Get-PSReadlineOption).HistorySavePath*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*del (Get-PSReadlineOption).HistorySavePath*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Set-PSReadlineOption HistorySaveStyle SaveNothing*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Remove-Item (Get-PSReadlineOption).HistorySavePath*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;del*Microsoft\\Windows\\Powershell\\PSReadline\\ConsoleHost_history.txt&#34;</span><span class=o>)</span></span></span></code></pre></div></div><h3 class="relative group">49- Local Permission Group Discovery<div id=49--local-permission-group-discovery class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#49--local-permission-group-discovery aria-label=Anchor>#</a></span></h3><p>Cyber actors frequently enumerate local or domain permissions groups. The net utility is usually used for this purpose. This analytic looks for any instances of net.exe, which is not normally used for benign purposes, although system administrator actions may trigger false positives.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>(</span><span class=nv>index</span><span class=o>=</span>__your_sysmon_index__ <span class=nv>EventCode</span><span class=o>=</span>1<span class=o>)</span> <span class=nv>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\net.exe&#34;</span> AND <span class=o>(</span><span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;* user*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;* group*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;* localgroup*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*get-localgroup*&#34;</span> OR <span class=nv>CommandLine</span><span class=o>=</span><span class=s2>&#34;*get-ADPrincipalGroupMembership*&#34;</span><span class=o>)</span></span></span></code></pre></div></div><h3 class="relative group">50- Network Share Connection Removal<div id=50--network-share-connection-removal class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#50--network-share-connection-removal aria-label=Anchor>#</a></span></h3><p>Adversaries may use network shares to exfliltrate date; they will then remove the shares to cover their tracks. This analytic looks for the removal of network shares via commandline, which is otherwise a rare event.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>((</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\net.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*delete*&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Remove-SmbShare*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Remove-FileShare*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">51- MSBuild and msxsl<div id=51--msbuild-and-msxsl class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#51--msbuild-and-msxsl aria-label=Anchor>#</a></span></h3><p>Trusted developer utilities such as MSBuild may be leveraged to run malicious code with elevated privileges. This analytic looks for any instances of msbuild.exe, which will execute any C# code placed within a given XML document; and msxsl.exe, which processes xsl transformation specifications for XML files and will execute a variaty of scripting languages contained within the XSL file. Both of these executables are rarely used outside of Visual Studio.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Program Files (x86)\\Microsoft Visual Studio\\*\\bin\\MSBuild.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\Microsoft.NET\\Framework*\\msbuild.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\users\\*\\appdata\\roaming\\microsoft\\msxsl.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;*\\Microsoft Visual Studio*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">52- Compiled HTML Access<div id=52--compiled-html-access class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#52--compiled-html-access aria-label=Anchor>#</a></span></h3><p>Adversaries may hide malicious code in .chm compiled HTML files. When these files are read, Windows uses the HTML help executable named hh.exe, which is the signature for this analytic.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\syswow64\\hh.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\system32\\hh.exe&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">53- CMSTP<div id=53--cmstp class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#53--cmstp aria-label=Anchor>#</a></span></h3><p>CMSTP.exe is the Microsoft Connection Manager Profile Installer, which can be leveraged to setup listeners that will receive and install malware from remote sources in trusted fashion. When CMSTP.exe is seen in combination with an external connection, it is a good indication of this TTP.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\CMSTP.exe&#34;</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=p>((</span><span class=o>!</span><span class=n>cidrmatch</span><span class=p>(</span><span class=s2>&#34;10.0.0.0/8&#34;</span><span class=p>,</span><span class=w> </span><span class=n>SourceIp</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=o>!</span><span class=n>cidrmatch</span><span class=p>(</span><span class=s2>&#34;192.168.0.0/16&#34;</span><span class=p>,</span><span class=w> </span><span class=n>SourceIp</span><span class=p>)</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=o>!</span><span class=n>cidrmatch</span><span class=p>(</span><span class=s2>&#34;172.16.0.0/12&#34;</span><span class=p>,</span><span class=w> </span><span class=n>SourceIp</span><span class=p>))</span></span></span></code></pre></div></div><h3 class="relative group">54- Registry Edit from Screensaver<div id=54--registry-edit-from-screensaver class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#54--registry-edit-from-screensaver aria-label=Anchor>#</a></span></h3><p>Adversaries may use screensaver files to run malicious code. This analytic triggers on suspicious edits to the screensaver registry keys, which dictate which .scr file the screensaver runs.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>your_sysmon_index</span><span class=w> </span><span class=p>(</span><span class=n>EventCode</span><span class=o>=</span><span class=mi>12</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>13</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span><span class=w> </span><span class=n>TargetObject</span><span class=o>=</span><span class=s2>&#34;*\\Software\\Policies\\Microsoft\\Windows\\Control Panel\\Desktop\\SCRNSAVE.EXE&#34;</span></span></span></code></pre></div></div><h3 class="relative group">55- Scheduled Task - File Access<div id=55--scheduled-task---file-access class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#55--scheduled-task---file-access aria-label=Anchor>#</a></span></h3><p>In order to gain persistence, privilege escalation, or remote execution, an adversary may use the Windows Task Scheduler to schedule a command to be run at a specified time, date, and even host. Task Scheduler stores tasks as files in two locations - C:\Windows\Tasks (legacy) or C:\Windows\System32\Tasks. Accordingly, this analytic looks for the creation of task files in these two locations.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>11</span><span class=w> </span><span class=n>Image</span><span class=o>!=</span><span class=s2>&#34;C:\\WINDOWS\\system32\\svchost.exe&#34;</span><span class=w> </span><span class=p>(</span><span class=n>TargetFilename</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\Tasks\\*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>TargetFilename</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\Tasks\\*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">56- Component Object Model Hijacking<div id=56--component-object-model-hijacking class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#56--component-object-model-hijacking aria-label=Anchor>#</a></span></h3><p>Adversaries may establish persistence or escalate privileges by executing malicious content triggered by hijacked references to Component Object Model (COM) objects. This is typically done by replacing COM object registry entries under the HKEY_CURRENT_USER\Software\Classes\CLSID or HKEY_LOCAL_MACHINE\SOFTWARE\Classes\CLSID keys. Accordingly, this analytic looks for any changes under these keys.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=p>(</span><span class=n>EventCode</span><span class=o>=</span><span class=mi>12</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>13</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span><span class=w> </span><span class=n>TargetObject</span><span class=o>=</span><span class=s2>&#34;*\\Software\\Classes\\CLSID\\*&#34;</span></span></span></code></pre></div></div><h3 class="relative group">57- Indicator Blocking - Driver Unloaded<div id=57--indicator-blocking---driver-unloaded class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#57--indicator-blocking---driver-unloaded aria-label=Anchor>#</a></span></h3><p>Adversaries may attempt to evade system defenses by unloading minifilter drivers used by host-based sensors such as Sysmon through the use of the fltmc command-line utility. Accordingly, this analytic looks for command-line invocations of this utility when used to unload minifilter drivers.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>client</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*unload*&#34;</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\SysWOW64\\fltMC.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\fltMC.exe&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">58- Credentials in Files & Registry<div id=58--credentials-in-files--registry class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#58--credentials-in-files--registry aria-label=Anchor>#</a></span></h3><p>Adversaries may search the Windows Registry on compromised systems for insecurely stored credentials for credential access. This can be accomplished using the query functionality of the reg.exe system utility, by looking for keys and values that contain strings such as password. In addition, adversaries may use toolkits such as <a href=https://powersploit.readthedocs.io/en/latest/ target=_blank rel=noreferrer>PowerSploit</a> in order to dump credentials from various applications such as IIS.Accordingly, this analytic looks for invocations of reg.exe in this capacity as well as that of several powersploit modules with similar functionality.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=p>((</span><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=k>index</span><span class=o>=</span><span class=n>__your_win_syslog_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4688</span><span class=p>))</span><span class=w> </span><span class=p>(</span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*reg* query HKLM /f password /t REG_SZ /s*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;reg* query HKCU /f password /t REG_SZ /s&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Get-UnattendedInstallFile*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Get-Webconfig*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Get-ApplicationHost*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Get-SiteListPassword*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Get-CachedGPPPassword*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*Get-RegistryAutoLogon*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">59- AppInit DLLs<div id=59--appinit-dlls class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#59--appinit-dlls aria-label=Anchor>#</a></span></h3><p>Adversaries may establish persistence and/or elevate privileges by executing malicious content triggered by AppInit DLLs loaded into processes. Dynamic-link libraries (DLLs) that are specified in the AppInit_DLLs value in the Registry keys <code>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Windows</code> or <code>HKEY_LOCAL_MACHINE\Software\Wow6432Node\Microsoft\Windows NT\CurrentVersion\Windows</code> are loaded by user32.dll into every process that loads user32.dll. These values can be abused to obtain elevated privileges by causing a malicious DLL to be loaded and run in the context of separate processes. Accordingly, this analytic looks for modifications to these registry keys that may be indicative of this type of abuse.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=p>(</span><span class=n>EventCode</span><span class=o>=</span><span class=mi>12</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>13</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>14</span><span class=p>)</span><span class=w> </span><span class=p>(</span><span class=n>TargetObject</span><span class=o>=</span><span class=s2>&#34;*\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Appinit_Dlls\\*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>TargetObject</span><span class=o>=</span><span class=s2>&#34;*\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion\\Windows\\Appinit_Dlls\\*&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">60- NTFS Alternate Data Stream Execution - System Utilities<div id=60--ntfs-alternate-data-stream-execution---system-utilities class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#60--ntfs-alternate-data-stream-execution---system-utilities aria-label=Anchor>#</a></span></h3><p>NTFS Alternate Data Streams (ADSs) may be used by adversaries as a means of evading security tools by storing malicious data or binaries in file attribute metadata. ADSs are also powerful because they can be directly executed by various Windows tools; accordingly, this analytic looks at common ways of executing ADSs using system utilities such as powershell.</p><p><strong>NTFS ADS - PowerShell</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=o>*</span><span class=err>\\</span><span class=n>powershell</span><span class=p>.</span><span class=n>exe</span><span class=o>|</span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;Invoke-CimMethod\s+-ClassName\s+Win32_Process\s+-MethodName\s+Create.*\b(\w+(\.\w+)?):(\w+(\.\w+)?)|-ep bypass\s+-\s+&lt;.*\b(\w+(\.\w+)?):(\w+(\.\w+)?)|-command.*Get-Content.*-Stream.*Set-Content.*start-process .*(\w+(\.\w+)?)&#34;</span><span class=n>NTFS</span><span class=w> </span><span class=n>ADS</span><span class=w> </span><span class=o>-</span><span class=w> </span><span class=n>wmic</span></span></span></code></pre></div></div><p><strong>NTFS ADS - wmic</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=o>*</span><span class=err>\\</span><span class=n>wmic</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;process call create.*\&#34;</span><span class=p>(</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>(</span><span class=err>\</span><span class=p>.</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>)</span><span class=o>?</span><span class=p>):(</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>(</span><span class=err>\</span><span class=p>.</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>)</span><span class=o>?</span><span class=p>)</span><span class=s2>&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - rundll32</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w>  </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=o>*</span><span class=err>\\</span><span class=n>rundll32</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;\&#34;</span><span class=o>?</span><span class=p>(</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>(</span><span class=err>\</span><span class=p>.</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>)</span><span class=o>?</span><span class=p>):(</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>(</span><span class=err>\</span><span class=p>.</span><span class=err>\</span><span class=n>w</span><span class=o>+</span><span class=p>)</span><span class=o>?</span><span class=p>)</span><span class=o>?</span><span class=err>\</span><span class=s2>&#34;?,\w+\|(advpack\.dll\|ieadvpack\.dll),RegisterOCX\s+(\w+\.\w+):(\w+(\.\w+)?)\|(shdocvw\.dll\|ieframe\.dll),OpenURL.*(\w+\.\w+):(\w+(\.\w+)?)&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - wscript/cscript</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=o>*</span><span class=err>\\</span><span class=n>wscript</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=o>*</span><span class=err>\\</span><span class=n>cscript</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;(?&lt;!\/)\b\w+(\.\w+)?:\w+(\.\w+)?$&#34;</span></span></span></code></pre></div></div><h3 class="relative group">61- NTFS Alternate Data Stream Execution - LOLBAS<div id=61--ntfs-alternate-data-stream-execution---lolbas class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#61--ntfs-alternate-data-stream-execution---lolbas aria-label=Anchor>#</a></span></h3><p>NTFS Alternate Data Streams (ADSs) may be used by adversaries as a means of evading security tools by storing malicious data or binaries in file attribute metadata. ADSs are also powerful because their contents can be directly executed by various Windows tools; accordingly, this analytic looks at common ways of executing ADSs using Living off the Land Binaries and Scripts (LOLBAS).</p><p><strong>NTFS ADS - control</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\</span><span class=n>System32</span><span class=err>\\</span><span class=n>control</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\</span><span class=n>SysWOW64</span><span class=err>\\</span><span class=n>control</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;(\w+(\.\w+)?):(\w+\.dll)&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - appvlp</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Program Files\\Microsoft Office\\root\\Client\\AppVLP.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Program Files (x86)\\Microsoft Office\\root\\Client\\AppVLP.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;(\w+(\.\w+)?):(\w+(\.\w+)?)&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - cmd</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>System32</span><span class=err>\\</span><span class=n>cmd</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>SysWOW64</span><span class=err>\\</span><span class=n>cmd</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;-\s+&lt;.*\b(\w+(\.\w+)?):(\w+(\.\w+)?)&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - ftp</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>System32</span><span class=err>\\</span><span class=n>ftp</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>SysWOW64</span><span class=err>\\</span><span class=n>ftp</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;-s:(\w+(\.\w+)?):(\w+(\.\w+)?)&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - bash</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>System32</span><span class=err>\\</span><span class=n>bash</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>SysWOW64</span><span class=err>\\</span><span class=n>bash</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;-c.*(\w+(\.\w+)?):(\w+(\.\w+)?)&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - mavinject</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>System32</span><span class=err>\\</span><span class=n>mavinject</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>SysWOW64</span><span class=err>\\</span><span class=n>mavinject</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;\d+\s+\/INJECTRUNNING.*\b(\w+(\.\w+)?):(\w+(\.\w+)?)&#34;</span></span></span></code></pre></div></div><p><strong>NTFS ADS - bitsadmin</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>System32</span><span class=err>\\</span><span class=n>bitsadmin</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=k>C</span><span class=p>:</span><span class=err>\\</span><span class=n>Windows</span><span class=err>\\</span><span class=n>SysWOW64</span><span class=err>\\</span><span class=n>bitsadmin</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=n>regex</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;\/create.*\/addfile.*\/SetNotifyCmdLine.*\b(\w+\.\w+):(\w+(\.\w+)?)&#34;</span></span></span></code></pre></div></div><h3 class="relative group">62- Execution with AT<div id=62--execution-with-at class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#62--execution-with-at aria-label=Anchor>#</a></span></h3><p>In order to gain <a href=https://attack.mitre.org/tactics/TA0003/ target=_blank rel=noreferrer>persistence</a>, <a href=https://attack.mitre.org/tactics/TA0004/ target=_blank rel=noreferrer>privilege escalation</a>, or <a href=https://attack.mitre.org/tactics/TA0002/ target=_blank rel=noreferrer>remote execution</a>, an adversary may use the Windows built-in command AT (at.exe) to <a href=https://attack.mitre.org/techniques/T1053/002 target=_blank rel=noreferrer>schedule a command</a> to be run at a specified time, date, and even host. This method has been used by adversaries and administrators alike. Its use may lead to detection of compromised hosts and compromised users if it is used to move laterally. The built-in Windows tool schtasks.exe (<a href=https://car.mitre.org/analytics/CAR-2013-08-001 target=_blank rel=noreferrer>CAR-2013-08-001</a>) offers greater flexibility when creating, modifying, and enumerating tasks. For these reasons, schtasks.exe is more commonly used by administrators, tools/scripts, and power users.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\at.exe&#34;</span><span class=o>|</span><span class=n>stats</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>CommandLine</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s2>&#34;Command Lines&#34;</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>ComputerName</span></span></span></code></pre></div></div><h3 class="relative group">63- Running executables with same hash and different names<div id=63--running-executables-with-same-hash-and-different-names class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#63--running-executables-with-same-hash-and-different-names aria-label=Anchor>#</a></span></h3><p>Executables are generally not renamed, thus a given hash of an executable should only have ever one name. Identifying instances where multiple process names share the same hash may find cases where tools are copied by attackers to different folders or hosts to <a href=https://attack.mitre.org/tactics/TA0005 target=_blank rel=noreferrer>avoid detection</a>.</p><p>Although this analytic was initially based on MD5 hashes, it is equally applicable to any hashing convention.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=o>|</span><span class=n>stats</span><span class=w> </span><span class=n>dc</span><span class=p>(</span><span class=n>Hashes</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>Num_Hashes</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Hashes</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s2>&#34;Hashes&#34;</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>Image</span><span class=o>|</span><span class=k>where</span><span class=w> </span><span class=n>Num_Hashes</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>1</span></span></span></code></pre></div></div><h3 class="relative group">64- Suspicious Arguments<div id=64--suspicious-arguments class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#64--suspicious-arguments aria-label=Anchor>#</a></span></h3><p>Malicious actors may rename built-in commands or external tools, such as those provided by SysInternals, to better <a href=https://attack.mitre.org/tactics/TA0005 target=_blank rel=noreferrer>blend in</a> with the environment. In those cases, the file path name is arbitrary and may blend in well with the background. If the arguments are closely inspected, it may be possible to infer what tools are running and understand what an adversary is doing. When any legitimate software shares the same command lines, it must be whitelisted according to the expected parameters.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* -R * -pw*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* -pw * *@*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*sekurlsa*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* -hp *&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* a *&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">65- User Login Activity Monitoring<div id=65--user-login-activity-monitoring class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#65--user-login-activity-monitoring aria-label=Anchor>#</a></span></h3><p>Monitoring logon and logoff events for hosts on the network is very important for situational awareness. This information can be used as an indicator of unusual activity as well as to corroborate activity seen elsewhere.</p><p>Could be applied to a number of different types of monitoring depending on what information is desired. Some use cases include monitoring for all remote connections and building login timelines for users. Logon events are Windows Event Code 4624 for Windows Vista and above, 518 for pre-Vista. Logoff events are 4634 for Windows Vista and above, 538 for pre-Vista.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_win_event_log_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4624</span><span class=o>|</span><span class=k>search</span><span class=w> </span><span class=k>NOT</span><span class=w> </span><span class=p>[</span><span class=k>search</span><span class=w> </span><span class=k>index</span><span class=o>=</span><span class=n>__your_win_event_log_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4624</span><span class=o>|</span><span class=n>top</span><span class=w> </span><span class=mi>30</span><span class=w> </span><span class=n>Account_Name</span><span class=o>|</span><span class=k>table</span><span class=w> </span><span class=n>Account_Name</span><span class=p>]</span></span></span></code></pre></div></div><h3 class="relative group">66- PowerShell Execution<div id=66--powershell-execution class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#66--powershell-execution aria-label=Anchor>#</a></span></h3><p><a href=https://attack.mitre.org/techniques/T1059/001/ target=_blank rel=noreferrer>PowerShell</a> is a scripting environment included with Windows that is used by both attackers and administrators. Execution of PowerShell scripts in most Windows versions is opaque and not typically secured by antivirus which makes using PowerShell an easy way to circumvent security measures. This analytic detects execution of PowerShell scripts.</p><p>Powershell can be used to hide monitored command line execution such as:</p><ul><li><code>net use</code></li><li><code>sc start</code></li></ul><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\powershell.exe&#34;</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=s2>&#34;C:\\Windows\\explorer.exe&#34;</span><span class=o>|</span><span class=n>stats</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>CommandLine</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s2>&#34;Command Lines&#34;</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>ParentImage</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s2>&#34;Parent Images&#34;</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>ComputerName</span></span></span></code></pre></div></div><h3 class="relative group">67- Services launching Cmd<div id=67--services-launching-cmd class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#67--services-launching-cmd aria-label=Anchor>#</a></span></h3><p>Windows runs the <a href=https://en.wikipedia.org/wiki/Service_Control_Manager target=_blank rel=noreferrer>Service Control Manager</a> (SCM) within the process <code>services.exe</code>. Windows launches services as independent processes or DLL loads within a <a href=https://en.wikipedia.org/wiki/svchost.exe target=_blank rel=noreferrer>svchost.exe</a> group. To be a legitimate service, a process (or DLL) must have the appropriate service entry point <a href=https://msdn.microsoft.com/en-us/library/windows/desktop/ms687414.aspx target=_blank rel=noreferrer>SvcMain</a>. If an application does not have the entry point, then it will timeout (default is 30 seconds) and the process will be killed.</p><p>To survive the timeout, <a href=https://www.operationblockbuster.com/wp-content/uploads/2016/02/Operation-Blockbuster-RAT-and-Staging-Report.pdf target=_blank rel=noreferrer>adversaries and red teams</a> can create services that direct to <code>cmd.exe</code> with the flag <code>/c</code>, followed by the desired command. The <code>/c</code> flag causes the command shell to run a command and immediately exit. As a result, the desired program will remain running and it will report an error starting the service. This analytic will catch that command prompt instance that is used to launch the actual malicious executable. Additionally, the children and descendants of services.exe will run as a SYSTEM user by default. Thus, services are a convenient way for an adversary to gain <a href=https://attack.mitre.org/tactics/TA0003 target=_blank rel=noreferrer>Persistence</a> and <a href=https://attack.mitre.org/tactics/TA0004 target=_blank rel=noreferrer>Privilege Escalation</a>.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\cmd.exe&#34;</span><span class=w> </span><span class=n>ParentImage</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\services.exe&#34;</span></span></span></code></pre></div></div><h3 class="relative group">68- Command Launched from WinLogon<div id=68--command-launched-from-winlogon class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#68--command-launched-from-winlogon aria-label=Anchor>#</a></span></h3><p>An adversary can use <a href=https://attack.mitre.org/techniques/T1546/008 target=_blank rel=noreferrer>accessibility features</a> (Ease of Access), such as StickyKeys or Utilman, to launch a command shell from the logon screen and gain SYSTEM access. Since an adversary does not have physical access to the machine, this technique must be run within <a href=https://attack.mitre.org/techniques/T1021/001 target=_blank rel=noreferrer>Remote Desktop</a>. To prevent an adversary from getting to the login screen without first authenticating, Network-Level Authentication (NLA) must be enabled. If a debugger is set up for one of the accessibility features, then it will intercept the process launch of the feature and instead execute a new command line. This analytic looks for instances of <code>cmd.exe</code> or <code>powershell.exe</code> launched directly from the logon process, <code>winlogon.exe</code>. It should be used in tandem with <a href=https://car.mitre.org/analytics/CAR-2014-11-003 target=_blank rel=noreferrer>CAR-2014-11-003</a>, which detects the accessibility programs in the command line.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>ParentImage</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\winlogon.exe&#34;</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\cmd.exe&#34;</span></span></span></code></pre></div></div><h3 class="relative group">69- Host Discovery Commands<div id=69--host-discovery-commands class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#69--host-discovery-commands aria-label=Anchor>#</a></span></h3><p>When entering on a host for the first time, an adversary may try to <a href=https://attack.mitre.org/tactics/TA0007 target=_blank rel=noreferrer>discover</a> information about the host. There are several built-in Windows commands that can be used to learn about the software configurations, active users, administrators, and networking configuration. These commands should be monitored to identify when an adversary is learning information about the system and environment. The information returned may impact choices an adversary can make when <a href=https://attack.mitre.org/tactics/TA0003 target=_blank rel=noreferrer>establishing persistence</a>, <a href=https://attack.mitre.org/tactics/TA0004 target=_blank rel=noreferrer>escalating privileges</a>, or <a href=https://attack.mitre.org/tactics/TA0008 target=_blank rel=noreferrer>moving laterally</a>.</p><p>Because these commands are built in, they may be run frequently by power users or even by normal users. Thus, an analytic looking at this information should have well-defined white- or blacklists, and should consider looking at an anomaly detection approach, so that this information can be learned dynamically.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\hostname.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\ipconfig.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\net.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\quser.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\qwinsta.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\sc.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=p>(</span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* query *&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* qc *&#34;</span><span class=p>))</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\systeminfo.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\tasklist.exe&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\whoami.exe&#34;</span><span class=p>)</span><span class=o>|</span><span class=n>stats</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>Image</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s2>&#34;Images&#34;</span><span class=w> </span><span class=k>values</span><span class=p>(</span><span class=n>CommandLine</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=s2>&#34;Command Lines&#34;</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>ComputerName</span></span></span></code></pre></div></div><h3 class="relative group">70- Create Remote Process via WMIC<div id=70--create-remote-process-via-wmic class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#70--create-remote-process-via-wmic aria-label=Anchor>#</a></span></h3><p>Adversaries may use <a href=https://attack.mitre.org/techniques/T1047 target=_blank rel=noreferrer>Windows Management Instrumentation</a> (WMI) to move laterally, by launching executables remotely.The analytic <a href=https://car.mitre.org/analytics/CAR-2014-12-001 target=_blank rel=noreferrer>CAR-2014-12-001</a> describes how to detect these processes with network traffic monitoring and process monitoring on the target host. However, if the command line utility <code>wmic.exe</code> is used on the source host, then it can additionally be detected on an analytic. The command line on the source host is constructed into something like <code>wmic.exe /node:"\&lt;hostname\>" process call create "\&lt;command line\>"</code>. It is possible to also connect via IP address, in which case the string <code>"\&lt;hostname\>"</code> would instead look like <code>IP Address</code>.</p><p>Although this analytic was created after <a href=https://car.mitre.org/analytics/CAR-2014-12-001 target=_blank rel=noreferrer>CAR-2014-12-001</a>, it is a much simpler (although more limited) approach. Processes can be created remotely via WMI in a few other ways, such as more direct API access or the built-in utility</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\wmic.exe&#34;</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* process call create *&#34;</span><span class=o>|</span><span class=k>search</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;* /node:*&#34;</span></span></span></code></pre></div></div><h3 class="relative group">71- UAC Bypass<div id=71--uac-bypass class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#71--uac-bypass aria-label=Anchor>#</a></span></h3><p>Bypassing user account control (UAC Bypass) is generally done by piggybacking on a system process that has auto-escalate privileges. This analytic looks to detect those cases as described by the open-source <a href=https://github.com/hfiref0x/UACME target=_blank rel=noreferrer>UACME</a> tool.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>_your_sysmon_index_</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>IntegrityLevel</span><span class=o>=</span><span class=n>High</span><span class=o>|</span><span class=k>search</span><span class=w> </span><span class=p>(</span><span class=n>ParentCommandLine</span><span class=o>=</span><span class=s2>&#34;\&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=n>dism</span><span class=p>.</span><span class=n>exe</span><span class=err>\</span><span class=s2>&#34;*&#34;&#34;*.xml&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>Image</span><span class=o>!=</span><span class=s2>&#34;c:\\users\\*\\appdata\\local\\temp\\*\\dismhost.exe&#34;</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>ParentImage</span><span class=o>=</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=n>fodhelper</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;\&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=n>wusa</span><span class=p>.</span><span class=n>exe</span><span class=err>\</span><span class=s2>&#34;*/quiet*&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=k>User</span><span class=o>!=</span><span class=n>NOT_TRANSLATED</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>CurrentDirectory</span><span class=o>=</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>ParentImage</span><span class=o>!=</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>explorer</span><span class=p>.</span><span class=n>exe</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*.exe\&#34;</span><span class=o>*</span><span class=n>cleanmgr</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=o>/</span><span class=n>autoclean</span><span class=o>*</span><span class=s2>&#34; OR (ParentImage=&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=o>*</span><span class=n>dccw</span><span class=p>.</span><span class=n>exe</span><span class=s2>&#34; AND Image!=&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=n>cttune</span><span class=p>.</span><span class=n>exe</span><span class=s2>&#34;) OR Image=&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>program</span><span class=w> </span><span class=n>files</span><span class=err>\\</span><span class=n>windows</span><span class=w> </span><span class=n>media</span><span class=w> </span><span class=n>player</span><span class=err>\\</span><span class=n>osk</span><span class=p>.</span><span class=n>exe</span><span class=s2>&#34; OR ParentImage=&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=n>slui</span><span class=p>.</span><span class=n>exe</span><span class=s2>&#34;|eval PossibleTechniques=case(like(lower(ParentCommandLine),&#34;</span><span class=o>%</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=n>dism</span><span class=p>.</span><span class=n>exe</span><span class=o>%</span><span class=s2>&#34;), &#34;</span><span class=n>UACME</span><span class=w> </span><span class=o>#</span><span class=mi>23</span><span class=s2>&#34;, like(lower(Image),&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>program</span><span class=w> </span><span class=n>files</span><span class=err>\\</span><span class=n>windows</span><span class=w> </span><span class=n>media</span><span class=w> </span><span class=n>player</span><span class=err>\\</span><span class=n>osk</span><span class=p>.</span><span class=n>exe</span><span class=s2>&#34;), &#34;</span><span class=n>UACME</span><span class=w> </span><span class=o>#</span><span class=mi>32</span><span class=s2>&#34;, like(lower(ParentImage),&#34;</span><span class=k>c</span><span class=p>:</span><span class=err>\\</span><span class=n>windows</span><span class=err>\\</span><span class=n>system32</span><span class=err>\\</span><span class=n>fodhelper</span><span class=p>.</span><span class=n>exe</span><span class=s2>&#34;),  &#34;</span><span class=n>UACME</span><span class=w> </span><span class=o>#</span><span class=mi>33</span><span class=s2>&#34;, like(lower(CommandLine),&#34;</span><span class=o>%</span><span class=p>.</span><span class=n>exe</span><span class=err>\</span><span class=s2>&#34;%cleanmgr.exe /autoclean%&#34;</span><span class=p>),</span><span class=w> </span><span class=s2>&#34;UACME #34&#34;</span><span class=p>,</span><span class=w> </span><span class=k>like</span><span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>Image</span><span class=p>),</span><span class=s2>&#34;c:\\windows\\system32\\wusa.exe&#34;</span><span class=p>),</span><span class=w> </span><span class=s2>&#34;UACME #36&#34;</span><span class=p>,</span><span class=w> </span><span class=k>like</span><span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>ParentImage</span><span class=p>),</span><span class=s2>&#34;c:\\windows\\%dccw.exe&#34;</span><span class=p>),</span><span class=w> </span><span class=s2>&#34;UACME #37&#34;</span><span class=p>,</span><span class=w> </span><span class=k>like</span><span class=p>(</span><span class=k>lower</span><span class=p>(</span><span class=n>ParentImage</span><span class=p>),</span><span class=s2>&#34;c:\\windows\\system32\\slui.exe&#34;</span><span class=p>),</span><span class=w> </span><span class=s2>&#34;UACME #45&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 class="relative group">72- Generic Regsvr32<div id=72--generic-regsvr32 class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#72--generic-regsvr32 aria-label=Anchor>#</a></span></h3><p>Regsvr32 can be used to execute arbitrary code in the context of a Windows signed binary, which can be used to bypass application whitelisting. This analytic looks for suspicious usage of the tool. Its not likely that youll get millions of hits, but it does occur during normal activity so some form of baselining would be necessary for this to be an alerting analytic. Alternatively, it can be used for hunt by looking for new or anomalous DLLs manually.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_data__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>regsvr32</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>search</span><span class=w> </span><span class=n>ParentImage</span><span class=o>=</span><span class=s2>&#34;*regsvr32.exe&#34;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>Image</span><span class=o>!=</span><span class=s2>&#34;*regsvr32.exe*&#34;</span></span></span></code></pre></div></div><h3 class="relative group">73- Squiblydoo<div id=73--squiblydoo class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#73--squiblydoo aria-label=Anchor>#</a></span></h3><p>Squiblydoo is a specific usage of regsvr32.dll to load a COM scriptlet directly from the internet and execute it in a way that bypasses application whitelisting. It can be seen by looking for regsvr32.exe executions that load the scrobj.dll (which execute the COM scriptlet) or, if that is too noisy, those that also load content directly via HTTP or HTTPS.</p><p>Squiblydoo was first written up by Casey Smith at Red Canary, though that blog post is no longer accessible.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_events__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>regsvr32</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=n>scrobj</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=k>search</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*regsvr32.exe&#34;</span></span></span></code></pre></div></div><h3 class="relative group">74- Credential Dumping via Mimikatz<div id=74--credential-dumping-via-mimikatz class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#74--credential-dumping-via-mimikatz aria-label=Anchor>#</a></span></h3><p>Credential dumpers like Mimikatz can be loaded into memory and from there read data from another processes. This analytic looks for instances where processes are requesting specific permissions to read parts of the LSASS process in order to detect when credential dumping is occurring. One weakness is that all current implementations are overtuned to look for common access patterns used by Mimikatz.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_data__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>10</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=n>TargetImage</span><span class=o>=</span><span class=s2>&#34;C:\\WINDOWS\\system32\\lsass.exe&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=p>(</span><span class=n>GrantedAccess</span><span class=o>=</span><span class=mi>0</span><span class=n>x1410</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>GrantedAccess</span><span class=o>=</span><span class=mi>0</span><span class=n>x1010</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>GrantedAccess</span><span class=o>=</span><span class=mi>0</span><span class=n>x1438</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>GrantedAccess</span><span class=o>=</span><span class=mi>0</span><span class=n>x143a</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>GrantedAccess</span><span class=o>=</span><span class=mi>0</span><span class=n>x1418</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=n>CallTrace</span><span class=o>=</span><span class=s2>&#34;C:\\windows\\SYSTEM32\\ntdll.dll+*|C:\\windows\\System32\\KERNELBASE.dll+20edd|UNKNOWN(*)&#34;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=n>hostname</span><span class=w> </span><span class=k>user</span><span class=w> </span><span class=n>SourceImage</span><span class=w> </span><span class=n>GrantedAccess</span></span></span></code></pre></div></div><h3 class="relative group">75- Access Permission Modification<div id=75--access-permission-modification class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#75--access-permission-modification aria-label=Anchor>#</a></span></h3><p>Adversaries sometimes modify object access rights at the operating system level. There are varying motivations behind this action - they may not want some files/objects to be changed on systems for persistence reasons and therefore provide admin only rights; also, they may want files to be accessible with lower levels of permissions.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_windows_security_log_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>4670</span><span class=w> </span><span class=n>Object_Type</span><span class=o>=</span><span class=s2>&#34;File&#34;</span><span class=w> </span><span class=n>Security_ID</span><span class=o>!=</span><span class=s2>&#34;NT AUTHORITY\\SYSTEM&#34;</span></span></span></code></pre></div></div><h3 class="relative group">76- Lsass Process Dump via Procdump<div id=76--lsass-process-dump-via-procdump class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#76--lsass-process-dump-via-procdump aria-label=Anchor>#</a></span></h3><p><a href=https://docs.microsoft.com/en-us/sysinternals/downloads/procdump target=_blank rel=noreferrer>ProcDump</a> is a sysinternal command-line utility whose primary purpose is monitoring an application for CPU spikes and generating crash dumps during a spike that an administrator or developer can use to determine the cause of the spike.</p><p>ProcDump may be used to dump the memory space of lsass.exe to disk for processing with a credential access tool such as Mimikatz. This is performed by launching procdump.exe as a privileged user with command line options indicating that lsass.exe should be dumped to a file with an arbitrary name.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*\\procdump*.exe&#34;</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*lsass*&#34;</span></span></span></code></pre></div></div><h3 class="relative group">77- Credential Dumping via Windows Task Manager<div id=77--credential-dumping-via-windows-task-manager class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#77--credential-dumping-via-windows-task-manager aria-label=Anchor>#</a></span></h3><p>The Windows Task Manager may be used to dump the memory space of <code>lsass.exe</code> to disk for processing with a credential access tool such as Mimikatz. This is performed by launching Task Manager as a privileged user, selecting <code>lsass.exe</code>, and clicking Create dump file. This saves a dump file to disk with a deterministic name that includes the name of the process being dumped.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>11</span><span class=w> </span><span class=n>TargetFilename</span><span class=o>=</span><span class=s2>&#34;*lsass*.dmp&#34;</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\taskmgr.exe&#34;</span></span></span></code></pre></div></div><h3 class="relative group">78- Active Directory Dumping via NTDSUtil<div id=78--active-directory-dumping-via-ntdsutil class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#78--active-directory-dumping-via-ntdsutil aria-label=Anchor>#</a></span></h3><p>The NTDSUtil tool may be used to dump a Microsoft Active Directory database to disk for processing with a credential access tool such as Mimikatz. This is performed by launching <code>ntdsutil.exe</code> as a privileged user with command line arguments indicating that media should be created for offline Active Directory installation and specifying a folder path. This process will create a copy of the Active Directory database, <code>ntds.dit</code>, to the specified folder path.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>11</span><span class=w> </span><span class=n>TargetFilename</span><span class=o>=</span><span class=s2>&#34;*ntds.dit&#34;</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;*ntdsutil.exe&#34;</span></span></span></code></pre></div></div><h3 class="relative group">79- Shadow Copy Deletion<div id=79--shadow-copy-deletion class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#79--shadow-copy-deletion aria-label=Anchor>#</a></span></h3><p>The Windows <a href=https://docs.microsoft.com/en-us/windows-server/storage/file-server/volume-shadow-copy-service target=_blank rel=noreferrer>Volume Shadow Copy Service</a> is a built-in OS feature that can be used to create backup copies of files and volumes.</p><p>Adversaries may delete these shadow copies, typically through the usage of system utilities such as vssadmin.exe or wmic.exe, in order prevent file and data recovery. This technique is commonly employed for this purpose by ransomware.</p><p><strong>Vssadmin.exe delete shadows</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\System32\\vssadmin.exe&#34;</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*delete shadows*&#34;</span></span></span></code></pre></div></div><p><strong>WMIC shadowcopy delete</strong></p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=n>Image</span><span class=o>=</span><span class=s2>&#34;C:\\Windows\\*\\wmic.exe&#34;</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=s2>&#34;*shadowcopy delete*&#34;</span></span></span></code></pre></div></div><h3 class="relative group">80- MiniDump of LSASS<div id=80--minidump-of-lsass class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#80--minidump-of-lsass aria-label=Anchor>#</a></span></h3><p>This analytic detects the minidump variant of credential dumping where a process opens lsass.exe in order to extract credentials using the Win32 API call <a href=https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump target=_blank rel=noreferrer>MiniDumpWriteDump</a>. Tools like <a href=https://github.com/GhostPack/SafetyKatz target=_blank rel=noreferrer>SafetyKatz</a>, <a href=https://github.com/m0rv4i/SafetyDump target=_blank rel=noreferrer>SafetyDump</a>, and <a href=https://github.com/outflanknl/Dumpert target=_blank rel=noreferrer>Outflank-Dumpert</a> default to this variant and may be detected by this analytic, though keep in mind that not all options for using those tools will result in this specific behavior.</p><p>The analytic is based on a <a href=https://github.com/NVISO-BE/sigma-public/blob/master/rules/windows/sysmon/sysmon_lsass_memdump.yml target=_blank rel=noreferrer>Sigma analytic</a> contributed by Samir Bousseaden and written up in a <a href=https://blog.menasec.net/2019/02/threat-hunting-21-procdump-or-taskmgr.html target=_blank rel=noreferrer>blog on MENASEC</a>. It looks for a call trace that includes either dbghelp.dll or dbgcore.dll, which export the relevant functions/permissions to perform the dump. It also detects using the Windows Task Manager (taskmgr.exe) to dump lsass, which is described in <a href=https://car.mitre.org/analytics/CAR-2019-08-001/ target=_blank rel=noreferrer>CAR-2019-08-001</a>. In this iteration of the Sigma analytic, the <code>GrantedAccess</code> filter isnt included because it didnt seem to filter out any false positives and introduces the potential for evasion.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>10</span><span class=w> </span><span class=n>TargetImage</span><span class=o>=</span><span class=s2>&#34;C:\\windows\\system32\\lsass.exe&#34;</span><span class=w> </span><span class=p>(</span><span class=n>CallTrace</span><span class=o>=</span><span class=s2>&#34;*dbghelp.dll*&#34;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>CallTrace</span><span class=o>=</span><span class=s2>&#34;*dbgcore.dll*&#34;</span><span class=p>)</span><span class=o>|</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>_time</span><span class=w> </span><span class=k>host</span><span class=w> </span><span class=n>SourceProcessId</span><span class=w> </span><span class=n>SourceImage</span></span></span></code></pre></div></div><h3 class="relative group">81- Rare LolBAS Command Lines<div id=81--rare-lolbas-command-lines class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100 select-none"><a class="text-primary-300 dark:text-neutral-700 !no-underline" href=#81--rare-lolbas-command-lines aria-label=Anchor>#</a></span></h3><p><a href=https://lolbas-project.github.io/ target=_blank rel=noreferrer>LoLBAS</a> are binaries and scripts that are built in to Windows, frequently are signed by Microsoft, and may be used by an attacker. Some LoLBAS are used very rarely and it might be possible to alert every time theyre used (this would depend on your environment), but many others are very common and cant be simply alerted on.</p><p>This analytic takes all instances of LoLBAS execution and then looks for instances of command lines that are not normal in the environment. This can detect attackers (which will tend to need the binaries for something different than normal usage) but will also tend to have false positives.</p><p>The analytic needs to be tuned. The <code>1.5</code> in the query is the number of standard deviations away to look. It can be tuned up to filter out more noise and tuned down to get more results. This means it is probably best as a hunting analytic when you have analysts looking at the screen and able to tune the analytic up and down, because the threshold may not be stable for very long.</p><div class=highlight-wrapper><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>index</span><span class=o>=</span><span class=n>__your_sysmon_index__</span><span class=w> </span><span class=n>EventCode</span><span class=o>=</span><span class=mi>1</span><span class=w> </span><span class=p>(</span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>At</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Atbroker</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Bash</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Bitsadmin</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Certutil</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cmd</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cmdkey</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cmstp</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Control</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Csc</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cscript</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Dfsvc</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Diskshadow</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Dnscmd</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Esentutl</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Eventvwr</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Expand</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Extexport</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Extrac32</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Findstr</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Forfiles</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Ftp</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Gpscript</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Hh</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Ie4uinit</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Ieexec</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Infdefaultinstall</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Installutil</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Jsc</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Makecab</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mavinject</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Microsoft</span><span class=p>.</span><span class=n>Workflow</span><span class=p>.</span><span class=n>r</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mmc</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Msbuild</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Msconfig</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Msdt</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mshta</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Msiexec</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Odbcconf</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pcalua</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pcwrun</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Presentationhost</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Print</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Reg</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Regasm</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Regedit</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Register</span><span class=o>-</span><span class=n>cimprovider</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Regsvcs</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Regsvr32</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Replace</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Rpcping</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Rundll32</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Runonce</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Runscripthelper</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Sc</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Schtasks</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Scriptrunner</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SyncAppvPublishingServer</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Tttracer</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Verclsid</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Wab</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Wmic</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Wscript</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Wsreset</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Xwizard</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Advpack</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Comsvcs</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Ieadvpack</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Ieaframe</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mshtml</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pcwutl</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Setupapi</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Shdocvw</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Shell32</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Syssetup</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Url</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Zipfldr</span><span class=p>.</span><span class=n>dll</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Appvlp</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Bginfo</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Cdb</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>csi</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Devtoolslauncher</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dnx</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Dxcap</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Excel</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Mftrace</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Msdeploy</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>msxsl</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Powerpnt</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>rcsi</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Sqler</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Sqlps</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>SQLToolsPS</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Squirrel</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>te</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Tracker</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>Update</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>vsjitdebugger</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Winword</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Wsl</span><span class=p>.</span><span class=n>exe</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CL_Mutexverifiers</span><span class=p>.</span><span class=n>ps1</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>CL_Invocation</span><span class=p>.</span><span class=n>ps1</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Manage</span><span class=o>-</span><span class=n>bde</span><span class=p>.</span><span class=n>wsf</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pubprn</span><span class=p>.</span><span class=n>vbs</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Slmgr</span><span class=p>.</span><span class=n>vbs</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Syncappvpublishingserver</span><span class=p>.</span><span class=n>vbs</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>winrm</span><span class=p>.</span><span class=n>vbs</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>OriginalFileName</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Pester</span><span class=p>.</span><span class=n>bat</span><span class=p>)</span><span class=o>|</span><span class=n>eval</span><span class=w> </span><span class=n>CommandLine</span><span class=o>=</span><span class=k>lower</span><span class=p>(</span><span class=n>CommandLine</span><span class=p>)</span><span class=o>|</span><span class=n>eventstats</span><span class=w> </span><span class=k>count</span><span class=p>(</span><span class=n>process</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>procCount</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=n>process</span><span class=o>|</span><span class=n>eventstats</span><span class=w> </span><span class=k>avg</span><span class=p>(</span><span class=n>procCount</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=k>avg</span><span class=w> </span><span class=n>stdev</span><span class=p>(</span><span class=n>procCount</span><span class=p>)</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=n>stdev</span><span class=o>|</span><span class=n>eval</span><span class=w> </span><span class=n>lowerBound</span><span class=o>=</span><span class=p>(</span><span class=k>avg</span><span class=o>-</span><span class=n>stdev</span><span class=o>*</span><span class=mi>1</span><span class=p>.</span><span class=mi>5</span><span class=p>)</span><span class=o>|</span><span class=n>eval</span><span class=w> </span><span class=n>isOutlier</span><span class=o>=</span><span class=k>if</span><span class=p>((</span><span class=n>procCount</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>lowerBound</span><span class=p>),</span><span class=mi>1</span><span class=p>,</span><span class=mi>0</span><span class=p>)</span><span class=o>|</span><span class=k>where</span><span class=w> </span><span class=n>isOutlier</span><span class=o>=</span><span class=mi>1</span><span class=o>|</span><span class=k>table</span><span class=w> </span><span class=k>host</span><span class=p>,</span><span class=w> </span><span class=n>Image</span><span class=p>,</span><span class=w> </span><span class=n>ParentImage</span><span class=p>,</span><span class=w> </span><span class=n>CommandLine</span><span class=p>,</span><span class=w> </span><span class=n>ParentCommandLine</span><span class=p>,</span><span class=w> </span><span class=n>procCount</span></span></span></code></pre></div></div><p><strong>References:</strong></p><p><a href=https://www.youtube.com/c/SplunkHowTo/videos target=_blank rel=noreferrer>Splunk How-To</a></p><p><a href=https://car.mitre.org/ target=_blank rel=noreferrer>car.mitre.org</a></p><p><a href=https://car.mitre.org/analytics/ target=_blank rel=noreferrer>Analytics</a></p><div class="not-prose my-6 print:hidden"><div class=ad-container><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188 data-ad-format=auto data-full-width-responsive=true></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></div></div></div><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class="flex-none relative overflow-hidden thumbnail_card_related"><img src=/img/cover_hu_e8c171fa060fd699.jpg role=presentation loading=lazy decoding=async fetchpriority=low class="not-prose absolute inset-0 w-full h-full object-cover"></div><div class=p-4><header><a href=/post/splunk-sysmon/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Splunk Sysmon Configuration</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2021-03-11T01:45:35+05:30>11 March 2021</time><span class="px-2 text-primary-500">&#183;</span><span>51 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">1 min</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/siem/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">SIEM
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/splunk/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Splunk
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/sysmon/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Sysmon
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/config/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Config</span></span></a></div></div><div class="article-link__summary prose dark:prose-invert mt-1 line-clamp-5"></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class=p-4><header><a href=/post/blog-optimizing-web-application-performance-and-security-with-azure-front-door-and-application-gateway/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Optimizing Web Application Performance and Security With Azure Front Door and Application Gateway</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-03-16T22:06:19+05:30>16 March 2023</time><span class="px-2 text-primary-500">&#183;</span><span>862 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">5 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/blog/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Blog
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/azure/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Azure</span></span></a></div></div><div class="article-link__summary prose dark:prose-invert mt-1 line-clamp-5"></div></div><div class="px-6 pt-4 pb-2"></div></article><article class="article-link--related relative min-h-full min-w-full overflow-hidden rounded-lg border border-neutral-300 dark:border-neutral-600"><div class=p-4><header><a href=/post/blog-watering-hole-attacks-scanbox-keylogger/ class="not-prose before:absolute before:inset-0 decoration-primary-500 dark:text-neutral text-xl font-bold text-neutral-800 hover:underline hover:underline-offset-2"><h2>Blog | Watering Hole Attacks Scanbox Keylogger</h2></a></header><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime=2023-03-12T19:25:10+05:30>12 March 2023</time><span class="px-2 text-primary-500">&#183;</span><span>231 words</span><span class="px-2 text-primary-500">&#183;</span><span title="Reading time">2 mins</span></div><div class="flex flex-row flex-wrap items-center"><a class="relative mt-[0.5rem] me-2" href=/categories/blog/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Blog
</span></span></a><a class="relative mt-[0.5rem] me-2" href=/tags/keylogger/><span class="flex cursor-pointer"><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Keylogger</span></span></a></div></div><div class="article-link__summary prose dark:prose-invert mt-1 line-clamp-5"></div></div><div class="px-6 pt-4 pb-2"></div></article></section></div></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span class="flex flex-col"><a class="flex text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/post/blog-optimizing-web-application-performance-and-security-with-azure-front-door-and-application-gateway/><span class=leading-6><span class="inline-block rtl:rotate-180">&larr;</span>&ensp;Optimizing Web Application Performance and Security With Azure Front Door and Application Gateway
</span></a><span class="ms-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-03-16T22:06:19+05:30>16 March 2023</time>
</span></span><span class="flex flex-col items-end"><a class="flex text-right text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" href=/post/blog-autohackos/><span class=leading-6>AutoHackOS A New Operating System for Automobile Pentesting&ensp;<span class="inline-block rtl:rotate-180">&rarr;</span>
</span></a><span class="me-6 mt-1 text-xs text-neutral-500 dark:text-neutral-400"><time datetime=2023-05-09T20:42:03+05:30>9 May 2023</time></span></span></div></div></footer></article><div id=scroll-to-top class="fixed bottom-6 end-6 z-50 transform translate-y-4 opacity-0 duration-200"><a href=#the-top class="pointer-events-auto flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex list-none flex-col sm:flex-row"><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title=Tags>Tags</a></li><li class="flex mb-1 text-end sm:mb-0 sm:me-7 sm:last:me-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/categories/ title=Categories>Categories</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">YOU CAN REUSE MY CONTENT</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh] z-500" data-url=https://classroom.anir0y.in/><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>