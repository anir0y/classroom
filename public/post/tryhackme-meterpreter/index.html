<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TryHackMe Metasploit Meterpreter | Classroom</title><meta name=keywords content="tryhackme"><meta name=description content="Take a deep dive into Meterpreter, and see how in-memory payloads can be used for post-exploitation. TryHackMe Room Metasploit Meterpreter solved by Animesh Roy. this is a walkthough. read more..."><meta name=author content="Animesh Roy"><link rel=canonical href=https://classroom.anir0y.in/post/tryhackme-meterpreter/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=icon type=image/png sizes=16x16 href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=icon type=image/png sizes=32x32 href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=apple-touch-icon href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=mask-icon href=https://classroom.anir0y.in/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://classroom.anir0y.in/post/tryhackme-meterpreter/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://classroom.anir0y.in/post/tryhackme-meterpreter/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="TryHackMe Metasploit Meterpreter"><meta property="og:description" content="Take a deep dive into Meterpreter, and see how in-memory payloads can be used for post-exploitation. TryHackMe Room Metasploit Meterpreter solved by Animesh Roy. this is a walkthough. read more..."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-09-30T13:21:37+05:30"><meta property="article:modified_time" content="2021-09-30T13:21:37+05:30"><meta property="article:tag" content="Tryhackme"><meta property="og:image" content="https://classroom.anir0y.in/img/msf.gif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://classroom.anir0y.in/img/msf.gif"><meta name=twitter:title content="TryHackMe Metasploit Meterpreter"><meta name=twitter:description content="Take a deep dive into Meterpreter, and see how in-memory payloads can be used for post-exploitation. TryHackMe Room Metasploit Meterpreter solved by Animesh Roy. this is a walkthough. read more..."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://classroom.anir0y.in/post/"},{"@type":"ListItem","position":2,"name":"TryHackMe Metasploit Meterpreter","item":"https://classroom.anir0y.in/post/tryhackme-meterpreter/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TryHackMe Metasploit Meterpreter","name":"TryHackMe Metasploit Meterpreter","description":"Take a deep dive into Meterpreter, and see how in-memory payloads can be used for post-exploitation. TryHackMe Room Metasploit Meterpreter solved by Animesh Roy. this is a walkthough. read more...","keywords":["tryhackme"],"articleBody":"OverView Take a deep dive into Meterpreter, and see how in-memory payloads can be used for post-exploitation.\nFollow @anir0y Metasploit: Meterpreter Metasploit: Meterpreter [Subscription Required] Metasploit: Meterpreter Task 01: Introduction to Meterpreter Meterpreter is a Metasploit payload that supports the penetration testing process with many valuable components. Meterpreter will run on the target system and act as an agent within a command and control architecture. You will interact with the target operating system and files and use Meterpreter’s specialized commands.\nMeterpreter has many versions which will provide different functionalities based on the target system.\nHow does Meterpreter work?\nMeterpreter runs on the target system but is not installed on it. It runs in memory and does not write itself to the disk on the target. This feature aims to avoid being detected during antivirus scans. By default, most antivirus software will scan new files on the disk (e.g. when you download a file from the internet) Meterpreter runs in memory (RAM - Random Access Memory) to avoid having a file that has to be written to the disk on the target system (e.g. meterpreter.exe). This way, Meterpreter will be seen as a process and not have a file on the target system.\nMeterpreter also aims to avoid being detected by network-based IPS (Intrusion Prevention System) and IDS (Intrusion Detection System) solutions by using encrypted communication with the server where Metasploit runs (typically your attacking machine). If the target organization does not decrypt and inspect encrypted traffic (e.g. HTTPS) coming to and going out of the local network, IPS and IDS solutions will not be able to detect its activities.\nWhile Meterpreter is recognized by major antivirus software, this feature provides some degree of stealth.\nThe example below shows a target Windows machine exploited using the MS17-010 vulnerability. You will see Meterpreter is running with a process ID (PID) of 1304; this PID will be different in your case. We have used the getpid command, which returns the process ID with which Meterpreter is running. The process ID (or process identifier) is used by operating systems to identify running processes. All processes running in Linux or Windows will have a unique ID number; this number is used to interact with the process when the need arises (e.g. if it needs to be stopped).\nIf we list processes running on the target system using the ps command, we see PID 1304 is spoolsv.exe and not Meterpreter.exe, as one might expect.\ncode\nmeterpreter \u003e ps Process List ============ PID PPID Name Arch Session User Path --- ---- ---- ---- ------- ---- ---- 0 0 [System Process] 4 0 System x64 0 396 644 LogonUI.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\LogonUI.exe 416 4 smss.exe x64 0 NT AUTHORITY\\SYSTEM \\SystemRoot\\System32\\smss.exe 428 692 svchost.exe x64 0 NT AUTHORITY\\SYSTEM 548 540 csrss.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe 596 540 wininit.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\wininit.exe 604 588 csrss.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\csrss.exe 644 588 winlogon.exe x64 1 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\winlogon.exe 692 596 services.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\services.exe 700 692 sppsvc.exe x64 0 NT AUTHORITY\\NETWORK SERVICE 716 596 lsass.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\lsass.exe 1276 1304 cmd.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\cmd.exe 1304 692 spoolsv.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\System32\\spoolsv.exe 1340 692 svchost.exe x64 0 NT AUTHORITY\\LOCAL SERVICE 1388 548 conhost.exe x64 0 NT AUTHORITY\\SYSTEM C:\\Windows\\system32\\conhost.exe Even if we were to go a step further and look at DLLs (Dynamic-Link Libraries) used by the Meterpreter process (PID 1304 in this case), we still would not find anything jumping at us (e.g. no meterpreter.dll)\ncode\nC:\\Windows\\system32\u003etasklist /m /fi \"pid eq 1304\" tasklist /m /fi \"pid eq 1304\" Image Name PID Modules ========================= ======== ============================================ spoolsv.exe 1304 ntdll.dll, kernel32.dll, KERNELBASE.dll, msvcrt.dll, sechost.dll, RPCRT4.dll, USER32.dll, GDI32.dll, LPK.dll, USP10.dll, POWRPROF.dll, SETUPAPI.dll, CFGMGR32.dll, ADVAPI32.dll, OLEAUT32.dll, ole32.dll, DEVOBJ.dll, DNSAPI.dll, WS2_32.dll, NSI.dll, IMM32.DLL, MSCTF.dll, CRYPTBASE.dll, slc.dll, RpcRtRemote.dll, secur32.dll, SSPICLI.DLL, credssp.dll, IPHLPAPI.DLL, WINNSI.DLL, mswsock.dll, wshtcpip.dll, wship6.dll, rasadhlp.dll, fwpuclnt.dll, CLBCatQ.DLL, umb.dll, ATL.DLL, WINTRUST.dll, CRYPT32.dll, MSASN1.dll, localspl.dll, SPOOLSS.DLL, srvcli.dll, winspool.drv, PrintIsolationProxy.dll, FXSMON.DLL, tcpmon.dll, snmpapi.dll, wsnmp32.dll, msxml6.dll, SHLWAPI.dll, usbmon.dll, wls0wndh.dll, WSDMon.dll, wsdapi.dll, webservices.dll, FirewallAPI.dll, VERSION.dll, FunDisc.dll, fdPnp.dll, winprint.dll, USERENV.dll, profapi.dll, GPAPI.dll, dsrole.dll, win32spl.dll, inetpp.dll, DEVRTL.dll, SPINF.dll, CRYPTSP.dll, rsaenh.dll, WINSTA.dll, cscapi.dll, netutils.dll, WININET.dll, urlmon.dll, iertutil.dll, WINHTTP.dll, webio.dll, SHELL32.dll, MPR.dll, NETAPI32.dll, wkscli.dll, PSAPI.DLL, WINMM.dll, dhcpcsvc6.DLL, dhcpcsvc.DLL, apphelp.dll, NLAapi.dll, napinsp.dll, pnrpnsp.dll, winrnr.dll C:\\Windows\\system32\u003e Techniques and tools that can be used to detect Meterpreter are beyond the scope of this room. This section aimed to show you how stealthy Meterpreter is running; remember, most antivirus software will detect it.\nIt is also worth noting that Meterpreter will establish an encrypted (TLS) communication channel with the attacker’s system.\nTask 02: Meterpreter Flavors As you will remember, staged payloads are sent to the target in two steps. An initial part is installed (the stager) and requests the rest of the payload. This allows for a smaller initial payload size. The inline payloads are sent in a single step. Meterpreter payloads are also divided into stagged and inline versions. However, Meterpreter has a wide range of different versions you can choose from based on your target system.\nWe have used the msfvenom --list payloads command and grepped “meterpreter” payloads (adding | grep meterpreter to the command line), so the output only shows these. You can try this command on the AttackBox.\ncode\nroot@ip-10-10-186-44:~# msfvenom --list payloads | grep meterpreter android/meterpreter/reverse_http Run a meterpreter server in Android. Tunnel communication over HTTP android/meterpreter/reverse_https Run a meterpreter server in Android. Tunnel communication over HTTPS android/meterpreter/reverse_tcp Run a meterpreter server in Android. Connect back stager android/meterpreter_reverse_http Connect back to attacker and spawn a Meterpreter shell android/meterpreter_reverse_https Connect back to attacker and spawn a Meterpreter shell android/meterpreter_reverse_tcp Connect back to the attacker and spawn a Meterpreter shell apple_ios/aarch64/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) apple_ios/aarch64/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) apple_ios/aarch64/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) apple_ios/armle/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) apple_ios/armle/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) apple_ios/armle/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) java/meterpreter/bind_tcp Run a meterpreter server in Java. Listen for a connection java/meterpreter/reverse_http Run a meterpreter server in Java. Tunnel communication over HTTP java/meterpreter/reverse_https Run a meterpreter server in Java. Tunnel communication over HTTPS java/meterpreter/reverse_tcp Run a meterpreter server in Java. Connect back stager linux/aarch64/meterpreter/reverse_tcp Inject the mettle server payload (staged). Connect back to the attacker linux/aarch64/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) linux/aarch64/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) linux/aarch64/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) linux/armbe/meterpreter_reverse_http Run the Meterpreter / Mettle server payload (stageless) linux/armbe/meterpreter_reverse_https Run the Meterpreter / Mettle server payload (stageless) linux/armbe/meterpreter_reverse_tcp Run the Meterpreter / Mettle server payload (stageless) linux/armle/meterpreter/bind_tcp Inject the mettle server payload (staged). Listen for a connection linux/armle/meterpreter/reverse_tcp Inject the mettle server payload (staged). Connect back to the attacker [...] The list will show Meterpreter versions available for the following platforms;\nAndroid Apple iOS Java Linux OSX PHP Python Windows Your decision on which version of Meterpreter to use will be mostly based on three factors:\nThe target operating system (Is the target operating system Linux or Windows? Is it a Mac device? Is it an Android phone? etc.) Components available on the target system (Is Python installed? Is this a PHP website? etc.) Network connection types you can have with the target system (Do they allow raw TCP connections? Can you only have an HTTPS reverse connection? Are IPv6 addresses not as closely monitored as IPv4 addresses? etc.) If you are not using Meterpreter as a standalone payload generated by Msfvenom, your choice may also be limited by the exploit. You will notice some exploits will have a default Meterpreter payload, as you can see in the example below with the ms17_010_eternalblue exploit.\nexploit\nmsf6 \u003e use exploit/windows/smb/ms17_010_eternalblue [*] Using configured payload windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/smb/ms17_010_eternalblue) \u003e You can also list other available payloads using the show payloads command with any module.\npayloads\nmsf6 exploit(windows/smb/ms17_010_eternalblue) \u003e show payloads Compatible Payloads =================== # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 generic/custom manual No Custom Payload 1 generic/shell_bind_tcp manual No Generic Command Shell, Bind TCP Inline 2 generic/shell_reverse_tcp manual No Generic Command Shell, Reverse TCP Inline 3 windows/x64/exec manual No Windows x64 Execute Command 4 windows/x64/loadlibrary manual No Windows x64 LoadLibrary Path 5 windows/x64/messagebox manual No Windows MessageBox x64 6 windows/x64/meterpreter/bind_ipv6_tcp manual No Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager 7 windows/x64/meterpreter/bind_ipv6_tcp_uuid manual No Windows Meterpreter (Reflective Injection x64), Windows x64 IPv6 Bind TCP Stager with UUID Support 8 windows/x64/meterpreter/bind_named_pipe manual No Windows Meterpreter (Reflective Injection x64), Windows x64 Bind Named Pipe Stager [...] Task 03: Meterpreter Commands Typing help on any Meterpreter session (shown by meterpreter\u003e at the prompt) will list all available commands.\nhelp\nmeterpreter \u003e help Core Commands ============= Command Description ------- ----------- ? Help menu background Backgrounds the current session bg Alias for background bgkill Kills a background meterpreter script bglist Lists running background scripts bgrun Executes a meterpreter script as a background thread channel Displays information or control active channels close Closes a channel[...] Every version of Meterpreter will have different command options, so running the help command is always a good idea. Commands are built-in tools available on Meterpreter. They will run on the target system without loading any additional script or executable files.\nMeterpreter will provide you with three primary categories of tools;\nBuilt-in commands Meterpreter tools Meterpreter scripting If you run the help command, you will see Meterpreter commands are listed under different categories.\nCore commands File system commands Networking commands System commands User interface commands Webcam commands Audio output commands Elevate commands Password database commands Timestomp commands Please note that the list above was taken from the output of the help command on the Windows version of Meterpreter (windows/x64/meterpreter/reverse_tcp). These will be different for other Meterpreter versions.\nMeterpreter commands\nCore commands will be helpful to navigate and interact with the target system. Below are some of the most commonly used. Remember to check all available commands running the help command once a Meterpreter session has started.\nAlthough all these commands may seem available under the help menu, they may not all work. For example, the target system might not have a webcam, or it can be running on a virtual machine without a proper desktop environment.\nTask 04:Post-Exploitation with Meterpreter Meterpreter provides you with many useful commands that facilitate the post-exploitation phase. Below are a few examples you will often use.\nHelp\nThis command will give you a list of all available commands in Meterpreter. As we have seen earlier, Meterpreter has many versions, and each version may have different options available. Typing help once you have a Meterpreter session will help you quickly browse through available commands.\nMeterpreter commands\nThe getuid command will display the user with which Meterpreter is currently running. This will give you an idea of your possible privilege level on the target system (e.g. Are you an admin level user like NT AUTHORITY\\SYSTEM or a regular user?)\nThe ps command will list running processes. The PID column will also give you the PID information you will need to migrate Meterpreter to another process.\nMigrate\nMigrating to another process will help Meterpreter interact with it. For example, if you see a word processor running on the target (e.g. word.exe, notepad.exe, etc.), you can migrate to it and start capturing keystrokes sent by the user to this process. Some Meterpreter versions will offer you the keyscan_start, keyscan_stop, and keyscan_dump command options to make Meterpreter act like a keylogger. Migrating to another process may also help you to have a more stable Meterpreter session.\nTo migrate to any process, you need to type the migrate command followed by the PID of the desired target process. The example below shows Meterpreter migrating to process ID 716.\nBe careful; you may lose your user privileges if you migrate from a higher privileged (e.g. SYSTEM) user to a process started by a lower privileged user (e.g. webserver). You may not be able to gain them back.\nHashdump\nThe hashdump command will list the content of the SAM database. The SAM (Security Account Manager) database stores user’s passwords on Windows systems. These passwords are stored in the NTLM (New Technology LAN Manager) format.\nWhile it is not mathematically possible to “crack” these hashes, you may still discover the cleartext password using online NTLM databases or a rainbow table attack. These hashes can also be used in Pass-the-Hash attacks to authenticate to other systems that these users can access the same network.\nSearch\nThe search command is useful to locate files with potentially juicy information. In a CTF context, this can be used to quickly find a flag or proof file, while in actual penetration testing engagements, you may need to search for user-generated files or configuration files that may contain password or account information.\nShell\nThe shell command will launch a regular command-line shell on the target system. Pressing CTRL+Z will help you go back to the Meterpreter shell.\nTask 05: Post-Exploitation Challenge Meterpreter provides several important post-exploitation tools.\nCommands mentioned previously, such as getsystem and hashdump will provide important leverage and information for privilege escalation and lateral movement. Meterpreter is also a good base you can use to run post-exploitation modules available on the Metasploit framework. Finally, you can also use the load command to leverage additional tools such as Kiwi or even the whole Python language.\nThe post-exploitation phase will have several goals; Meterpreter has functions that can assist all of them.\nGathering further information about the target system. Looking for interesting files, user credentials, additional network interfaces, and generally interesting information on the target system. Privilege escalation. Lateral movement. Once any additional tool is loaded using the load command, you will see new options on the help menu. The example below shows commands added for the Kiwi module (using the load kiwi command).\nThese will change according to the loaded menu, so running the help command after loading a module is always a good idea.\nAnswer the questions below question ans What is the computer name? 5.1 What is the target domain? 5.1 What is the name of the share likely created by the user? 5.3 What is the NTLM hash of the jchambers user? 5.4 What is the cleartext password of the jchambers user? 5.5 Where is the “secrets.txt” file located? 5.6 What is the Twitter password revealed in the “secrets.txt” file? 5.6 Where is the “realsecret.txt” file located? 5.7 What is the real secret? 5.8 solutions 1 sysinfo 3 run this post exploit post/windows/gather/enum_shares\n4 You will need to migrate to the “lsass.exe” process first\nrun ps | grep lsass to find the PID\nmigrration\nhashes\n5 goto crackstation.net and find the password 6 run this command in meterpreter \u003e search -f *.txt\nresults\n8 run this command in search -f realsecret.txt\nresults\n","wordCount":"2467","inLanguage":"en","image":"https://classroom.anir0y.in/img/msf.gif","datePublished":"2021-09-30T13:21:37+05:30","dateModified":"2021-09-30T13:21:37+05:30","author":{"@type":"Person","name":"Animesh Roy"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://classroom.anir0y.in/post/tryhackme-meterpreter/"},"publisher":{"@type":"Organization","name":"Classroom","logo":{"@type":"ImageObject","url":"https://classroom.anir0y.in/img/avatar.jpeg"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://classroom.anir0y.in/ accesskey=h title="Classroom (Alt + H)"><img src=https://classroom.anir0y.in/img/avatar.jpeg alt aria-label=logo height=35>Classroom</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://classroom.anir0y.in/post/ title=Posts><span>Posts</span></a></li><li><a href=https://classroom.anir0y.in/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://classroom.anir0y.in/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://classroom.anir0y.in/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://classroom.anir0y.in/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://classroom.anir0y.in/about/me/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://classroom.anir0y.in/>Home</a>&nbsp;»&nbsp;<a href=https://classroom.anir0y.in/post/>Posts</a></div><h1 class="post-title entry-hint-parent">TryHackMe Metasploit Meterpreter</h1><div class=post-description>Take a deep dive into Meterpreter, and see how in-memory payloads can be used for post-exploitation. TryHackMe Room Metasploit Meterpreter solved by Animesh Roy. this is a walkthough. read more...</div><div class=post-meta><span title='2021-09-30 13:21:37 +0530 IST'>September 30, 2021</span>&nbsp;·&nbsp;<span>12 min</span>&nbsp;·&nbsp;<span>Animesh Roy</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/anir0y/classroom/tree/master/content/post/TryHackMe-meterpreter.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><figure class=entry-cover><img loading=eager src=https://classroom.anir0y.in/img/msf.gif alt="cover image"></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#overview>OverView</a></li><li><a href=#task-01-introduction-to-meterpreter>Task 01: Introduction to Meterpreter</a></li><li><a href=#task-02-meterpreter-flavors>Task 02: Meterpreter Flavors</a></li><li><a href=#task-03--meterpreter-commands>Task 03: Meterpreter Commands</a></li><li><a href=#task-04post-exploitation-with-meterpreter>Task 04:Post-Exploitation with Meterpreter</a></li><li><a href=#task-05-post-exploitation-challenge>Task 05: Post-Exploitation Challenge</a><ul><li><a href=#answer-the-questions-below>Answer the questions below</a></li></ul></li><li><a href=#solutions>solutions</a><ul><li><a href=#1-sysinfo>1 sysinfo</a></li><li><a href=#3>3</a></li><li><a href=#4>4</a></li><li><a href=#5>5</a></li><li><a href=#6>6</a></li><li><a href=#8>8</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=overview>OverView<a hidden class=anchor aria-hidden=true href=#overview>#</a></h2><p>Take a deep dive into Meterpreter, and see how in-memory payloads can be used for post-exploitation.</p><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><script src=https://tryhackme.com/badge/434937></script></td><td><a class=twitter-follow-button href=https://twitter.com/anir0y data-size=large>Follow @anir0y<a></td></tr><tr><td>Metasploit: Meterpreter</td><td><img alt=logo loading=lazy src=https://tryhackme-images.s3.amazonaws.com/room-icons/7774a96fb05b63b3abfed628f267f2a9.png></td></tr><tr><td><b>Metasploit: Meterpreter [Subscription Required]</b></td><td><a href>Metasploit: Meterpreter</a></td></tr></tbody></table><h2 id=task-01-introduction-to-meterpreter>Task 01: Introduction to Meterpreter<a hidden class=anchor aria-hidden=true href=#task-01-introduction-to-meterpreter>#</a></h2><p>Meterpreter is a Metasploit payload that supports the penetration testing process with many valuable components. Meterpreter will run on the target system and act as an agent within a command and control architecture. You will interact with the target operating system and files and use Meterpreter&rsquo;s specialized commands.</p><p>Meterpreter has many versions which will provide different functionalities based on the target system.</p><p><strong>How does Meterpreter work?</strong></p><p>Meterpreter runs on the target system but is not installed on it. It runs in memory and does not write itself to the disk on the target. This feature aims to avoid being detected during antivirus scans. By default, most antivirus software will scan new files on the disk (e.g. when you download a file from the internet) Meterpreter runs in memory (RAM - Random Access Memory) to avoid having a file that has to be written to the disk on the target system (e.g. meterpreter.exe). This way, Meterpreter will be seen as a process and not have a file on the target system.</p><p>Meterpreter also aims to avoid being detected by network-based IPS (Intrusion Prevention System) and IDS (Intrusion Detection System) solutions by using encrypted communication with the server where Metasploit runs (typically your attacking machine). If the target organization does not decrypt and inspect encrypted traffic (e.g. HTTPS) coming to and going out of the local network, IPS and IDS solutions will not be able to detect its activities.</p><p>While Meterpreter is recognized by major antivirus software, this feature provides some degree of stealth.</p><p>The example below shows a target Windows machine exploited using the MS17-010 vulnerability. You will see Meterpreter is running with a process ID (PID) of 1304; this PID will be different in your case. We have used the <code>getpid</code> command, which returns the process ID with which Meterpreter is running. The process ID (or process identifier) is used by operating systems to identify running processes. All processes running in Linux or Windows will have a unique ID number; this number is used to interact with the process when the need arises (e.g. if it needs to be stopped).</p><p><img alt=img loading=lazy src=https://i.imgur.com/uiqGUBQ.png></p><p>If we list processes running on the target system using the ps command, we see PID 1304 is spoolsv.exe and not Meterpreter.exe, as one might expect.</p><ul><li><p>code</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>meterpreter &gt; ps
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Process <span class=nv>List</span>
</span></span><span class=line><span class=cl><span class=o>============</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PID   PPID  Name                  Arch  Session  User                          Path
</span></span><span class=line><span class=cl>---   ----  ----                  ----  -------  ----                          ----
</span></span><span class=line><span class=cl><span class=m>0</span>     <span class=m>0</span>     <span class=o>[</span>System Process<span class=o>]</span>                                                   
</span></span><span class=line><span class=cl><span class=m>4</span>     <span class=m>0</span>     System                x64   <span class=m>0</span>                                      
</span></span><span class=line><span class=cl><span class=m>396</span>   <span class=m>644</span>   LogonUI.exe           x64   <span class=m>1</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\L</span>ogonUI.exe
</span></span><span class=line><span class=cl><span class=m>416</span>   <span class=m>4</span>     smss.exe              x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           <span class=se>\S</span>ystemRoot<span class=se>\S</span>ystem32<span class=se>\s</span>mss.exe
</span></span><span class=line><span class=cl><span class=m>428</span>   <span class=m>692</span>   svchost.exe           x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           
</span></span><span class=line><span class=cl><span class=m>548</span>   <span class=m>540</span>   csrss.exe             x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\c</span>srss.exe
</span></span><span class=line><span class=cl><span class=m>596</span>   <span class=m>540</span>   wininit.exe           x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\w</span>ininit.exe
</span></span><span class=line><span class=cl><span class=m>604</span>   <span class=m>588</span>   csrss.exe             x64   <span class=m>1</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\c</span>srss.exe
</span></span><span class=line><span class=cl><span class=m>644</span>   <span class=m>588</span>   winlogon.exe          x64   <span class=m>1</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\w</span>inlogon.exe
</span></span><span class=line><span class=cl><span class=m>692</span>   <span class=m>596</span>   services.exe          x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\s</span>ervices.exe
</span></span><span class=line><span class=cl><span class=m>700</span>   <span class=m>692</span>   sppsvc.exe            x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\N</span>ETWORK SERVICE  
</span></span><span class=line><span class=cl><span class=m>716</span>   <span class=m>596</span>   lsass.exe             x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\l</span>sass.exe  <span class=m>1276</span>  <span class=m>1304</span>  cmd.exe               x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\c</span>md.exe
</span></span><span class=line><span class=cl><span class=m>1304</span>  <span class=m>692</span>   spoolsv.exe           x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\S</span>ystem32<span class=se>\s</span>poolsv.exe
</span></span><span class=line><span class=cl><span class=m>1340</span>  <span class=m>692</span>   svchost.exe           x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\L</span>OCAL SERVICE    
</span></span><span class=line><span class=cl><span class=m>1388</span>  <span class=m>548</span>   conhost.exe           x64   <span class=m>0</span>        NT AUTHORITY<span class=se>\S</span>YSTEM           C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32<span class=se>\c</span>onhost.exe
</span></span></code></pre></div></li></ul><p>Even if we were to go a step further and look at DLLs (Dynamic-Link Libraries) used by the Meterpreter process (PID 1304 in this case), we still would not find anything jumping at us (e.g. no meterpreter.dll)</p><ul><li><p>code</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;tasklist /m /fi <span class=s2>&#34;pid eq 1304&#34;</span>
</span></span><span class=line><span class=cl>tasklist /m /fi <span class=s2>&#34;pid eq 1304&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Image Name                     PID <span class=nv>Modules</span>                                     
</span></span><span class=line><span class=cl><span class=o>=========================</span> <span class=o>========</span> <span class=o>============================================</span>
</span></span><span class=line><span class=cl>spoolsv.exe                   <span class=m>1304</span> ntdll.dll, kernel32.dll, KERNELBASE.dll,    
</span></span><span class=line><span class=cl>                                   msvcrt.dll, sechost.dll, RPCRT4.dll,        
</span></span><span class=line><span class=cl>                                   USER32.dll, GDI32.dll, LPK.dll, USP10.dll,  
</span></span><span class=line><span class=cl>                                   POWRPROF.dll, SETUPAPI.dll, CFGMGR32.dll,   
</span></span><span class=line><span class=cl>                                   ADVAPI32.dll, OLEAUT32.dll, ole32.dll,      
</span></span><span class=line><span class=cl>                                   DEVOBJ.dll, DNSAPI.dll, WS2_32.dll,         
</span></span><span class=line><span class=cl>                                   NSI.dll, IMM32.DLL, MSCTF.dll,              
</span></span><span class=line><span class=cl>                                   CRYPTBASE.dll, slc.dll, RpcRtRemote.dll,    
</span></span><span class=line><span class=cl>                                   secur32.dll, SSPICLI.DLL, credssp.dll,      
</span></span><span class=line><span class=cl>                                   IPHLPAPI.DLL, WINNSI.DLL, mswsock.dll,      
</span></span><span class=line><span class=cl>                                   wshtcpip.dll, wship6.dll, rasadhlp.dll,     
</span></span><span class=line><span class=cl>                                   fwpuclnt.dll, CLBCatQ.DLL, umb.dll,         
</span></span><span class=line><span class=cl>                                   ATL.DLL, WINTRUST.dll, CRYPT32.dll,         
</span></span><span class=line><span class=cl>                                   MSASN1.dll, localspl.dll, SPOOLSS.DLL,      
</span></span><span class=line><span class=cl>                                   srvcli.dll, winspool.drv,                   
</span></span><span class=line><span class=cl>                                   PrintIsolationProxy.dll, FXSMON.DLL,        
</span></span><span class=line><span class=cl>                                   tcpmon.dll, snmpapi.dll, wsnmp32.dll,       
</span></span><span class=line><span class=cl>                                   msxml6.dll, SHLWAPI.dll, usbmon.dll,        
</span></span><span class=line><span class=cl>                                   wls0wndh.dll, WSDMon.dll, wsdapi.dll,       
</span></span><span class=line><span class=cl>                                   webservices.dll, FirewallAPI.dll,           
</span></span><span class=line><span class=cl>                                   VERSION.dll, FunDisc.dll, fdPnp.dll,        
</span></span><span class=line><span class=cl>                                   winprint.dll, USERENV.dll, profapi.dll,     
</span></span><span class=line><span class=cl>                                   GPAPI.dll, dsrole.dll, win32spl.dll,        
</span></span><span class=line><span class=cl>                                   inetpp.dll, DEVRTL.dll, SPINF.dll,          
</span></span><span class=line><span class=cl>                                   CRYPTSP.dll, rsaenh.dll, WINSTA.dll,        
</span></span><span class=line><span class=cl>                                   cscapi.dll, netutils.dll, WININET.dll,      
</span></span><span class=line><span class=cl>                                   urlmon.dll, iertutil.dll, WINHTTP.dll,      
</span></span><span class=line><span class=cl>                                   webio.dll, SHELL32.dll, MPR.dll,            
</span></span><span class=line><span class=cl>                                   NETAPI32.dll, wkscli.dll, PSAPI.DLL,        
</span></span><span class=line><span class=cl>                                   WINMM.dll, dhcpcsvc6.DLL, dhcpcsvc.DLL,     
</span></span><span class=line><span class=cl>                                   apphelp.dll, NLAapi.dll, napinsp.dll,       
</span></span><span class=line><span class=cl>                                   pnrpnsp.dll, winrnr.dll                     
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>C:<span class=se>\W</span>indows<span class=se>\s</span>ystem32&gt;
</span></span></code></pre></div></li></ul><p>Techniques and tools that can be used to detect Meterpreter are beyond the scope of this room. This section aimed to show you how stealthy Meterpreter is running; remember, most antivirus software will detect it.</p><p>It is also worth noting that Meterpreter will establish an encrypted (TLS) communication channel with the attacker&rsquo;s system.</p><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><hr><h2 id=task-02-meterpreter-flavors>Task 02: Meterpreter Flavors<a hidden class=anchor aria-hidden=true href=#task-02-meterpreter-flavors>#</a></h2><p>As you will remember, staged payloads are sent to the target in two steps. An initial part is installed (the stager) and requests the rest of the payload. This allows for a smaller initial payload size. The inline payloads are sent in a single step. Meterpreter payloads are also divided into stagged and inline versions. However, Meterpreter has a wide range of different versions you can choose from based on your target system.</p><p>We have used the <code>msfvenom --list</code> payloads command and grepped &ldquo;meterpreter&rdquo; payloads (adding | grep meterpreter to the command line), so the output only shows these. You can try this command on the AttackBox.</p><ul><li><p>code</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@ip-10-10-186-44:~# msfvenom --list payloads <span class=p>|</span> grep meterpreter
</span></span><span class=line><span class=cl>android/meterpreter/reverse_http                    Run a meterpreter server in Android. Tunnel communication over HTTP
</span></span><span class=line><span class=cl>android/meterpreter/reverse_https                   Run a meterpreter server in Android. Tunnel communication over HTTPS
</span></span><span class=line><span class=cl>android/meterpreter/reverse_tcp                     Run a meterpreter server in Android. Connect back stager
</span></span><span class=line><span class=cl>android/meterpreter_reverse_http                    Connect back to attacker and spawn a Meterpreter shell
</span></span><span class=line><span class=cl>android/meterpreter_reverse_https                   Connect back to attacker and spawn a Meterpreter shell
</span></span><span class=line><span class=cl>android/meterpreter_reverse_tcp                     Connect back to the attacker and spawn a Meterpreter shell
</span></span><span class=line><span class=cl>apple_ios/aarch64/meterpreter_reverse_http          Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>apple_ios/aarch64/meterpreter_reverse_https         Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>apple_ios/aarch64/meterpreter_reverse_tcp           Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>apple_ios/armle/meterpreter_reverse_http            Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>apple_ios/armle/meterpreter_reverse_https           Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>apple_ios/armle/meterpreter_reverse_tcp             Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>java/meterpreter/bind_tcp                           Run a meterpreter server in Java. Listen <span class=k>for</span> a connection
</span></span><span class=line><span class=cl>java/meterpreter/reverse_http                       Run a meterpreter server in Java. Tunnel communication over HTTP
</span></span><span class=line><span class=cl>java/meterpreter/reverse_https                      Run a meterpreter server in Java. Tunnel communication over HTTPS
</span></span><span class=line><span class=cl>java/meterpreter/reverse_tcp                        Run a meterpreter server in Java. Connect back stager
</span></span><span class=line><span class=cl>linux/aarch64/meterpreter/reverse_tcp               Inject the mettle server payload <span class=o>(</span>staged<span class=o>)</span>. Connect back to the attacker
</span></span><span class=line><span class=cl>linux/aarch64/meterpreter_reverse_http              Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>linux/aarch64/meterpreter_reverse_https             Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>linux/aarch64/meterpreter_reverse_tcp               Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>linux/armbe/meterpreter_reverse_http                Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>linux/armbe/meterpreter_reverse_https               Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>linux/armbe/meterpreter_reverse_tcp                 Run the Meterpreter / Mettle server payload <span class=o>(</span>stageless<span class=o>)</span>
</span></span><span class=line><span class=cl>linux/armle/meterpreter/bind_tcp                    Inject the mettle server payload <span class=o>(</span>staged<span class=o>)</span>. Listen <span class=k>for</span> a connection
</span></span><span class=line><span class=cl>linux/armle/meterpreter/reverse_tcp                 Inject the mettle server payload <span class=o>(</span>staged<span class=o>)</span>. Connect back to the attacker <span class=o>[</span>...<span class=o>]</span>
</span></span></code></pre></div></li></ul><p>The list will show Meterpreter versions available for the following platforms;</p><ul><li>Android</li><li>Apple iOS</li><li>Java</li><li>Linux</li><li>OSX</li><li>PHP</li><li>Python</li><li>Windows</li></ul><p>Your decision on which version of Meterpreter to use will be mostly based on three factors:</p><ul><li>The target operating system (Is the target operating system Linux or Windows? Is it a Mac device? Is it an Android phone? etc.)</li><li>Components available on the target system (Is Python installed? Is this a PHP website? etc.)</li><li>Network connection types you can have with the target system (Do they allow raw TCP connections? Can you only have an HTTPS reverse connection? Are IPv6 addresses not as closely monitored as IPv4 addresses? etc.)</li></ul><p>If you are not using Meterpreter as a standalone payload generated by Msfvenom, your choice may also be limited by the exploit. You will notice some exploits will have a default Meterpreter payload, as you can see in the example below with the ms17_010_eternalblue exploit.</p><ul><li><p>exploit</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msf6 &gt; use exploit/windows/smb/ms17_010_eternalblue 
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span> Using configured payload windows/x64/meterpreter/reverse_tcp
</span></span><span class=line><span class=cl>msf6 exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt;
</span></span></code></pre></div></li></ul><p>You can also list other available payloads using the <code>show payloads</code> command with any module.</p><ul><li><p>payloads</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msf6 exploit<span class=o>(</span>windows/smb/ms17_010_eternalblue<span class=o>)</span> &gt; show payloads 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Compatible <span class=nv>Payloads</span>
</span></span><span class=line><span class=cl><span class=o>===================</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#   Name                                        Disclosure Date  Rank    Check  Description</span>
</span></span><span class=line><span class=cl>-   ----                                        ---------------  ----    -----  -----------
</span></span><span class=line><span class=cl><span class=m>0</span>   generic/custom                                               manual  No     Custom Payload
</span></span><span class=line><span class=cl><span class=m>1</span>   generic/shell_bind_tcp                                       manual  No     Generic Command Shell, Bind TCP Inline
</span></span><span class=line><span class=cl><span class=m>2</span>   generic/shell_reverse_tcp                                    manual  No     Generic Command Shell, Reverse TCP Inline
</span></span><span class=line><span class=cl><span class=m>3</span>   windows/x64/exec                                             manual  No     Windows x64 Execute Command
</span></span><span class=line><span class=cl><span class=m>4</span>   windows/x64/loadlibrary                                      manual  No     Windows x64 LoadLibrary Path
</span></span><span class=line><span class=cl><span class=m>5</span>   windows/x64/messagebox                                       manual  No     Windows MessageBox x64
</span></span><span class=line><span class=cl><span class=m>6</span>   windows/x64/meterpreter/bind_ipv6_tcp                        manual  No     Windows Meterpreter <span class=o>(</span>Reflective Injection x64<span class=o>)</span>, Windows x64 IPv6 Bind TCP Stager
</span></span><span class=line><span class=cl><span class=m>7</span>   windows/x64/meterpreter/bind_ipv6_tcp_uuid                   manual  No     Windows Meterpreter <span class=o>(</span>Reflective Injection x64<span class=o>)</span>, Windows x64 IPv6 Bind TCP Stager with UUID Support
</span></span><span class=line><span class=cl><span class=m>8</span>   windows/x64/meterpreter/bind_named_pipe                      manual  No     Windows Meterpreter <span class=o>(</span>Reflective Injection x64<span class=o>)</span>, Windows x64 Bind Named Pipe Stager <span class=o>[</span>...<span class=o>]</span>
</span></span></code></pre></div></li></ul><hr><h2 id=task-03--meterpreter-commands>Task 03: Meterpreter Commands<a hidden class=anchor aria-hidden=true href=#task-03--meterpreter-commands>#</a></h2><p>Typing <code>help</code> on any Meterpreter session (shown by meterpreter> at the prompt) will list all available commands.</p><ul><li><p>help</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>meterpreter &gt; <span class=nb>help</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Core <span class=nv>Commands</span>
</span></span><span class=line><span class=cl><span class=o>=============</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Command                   Description
</span></span><span class=line><span class=cl>-------                   -----------
</span></span><span class=line><span class=cl>?                         Help menu
</span></span><span class=line><span class=cl>background                Backgrounds the current session
</span></span><span class=line><span class=cl><span class=nb>bg</span>                        Alias <span class=k>for</span> background
</span></span><span class=line><span class=cl>bgkill                    Kills a background meterpreter script
</span></span><span class=line><span class=cl>bglist                    Lists running background scripts
</span></span><span class=line><span class=cl>bgrun                     Executes a meterpreter script as a background thread
</span></span><span class=line><span class=cl>channel                   Displays information or control active channels
</span></span><span class=line><span class=cl>close                     Closes a channel<span class=o>[</span>...<span class=o>]</span>
</span></span></code></pre></div></li></ul><p>Every version of Meterpreter will have different command options, so running the help command is always a good idea. Commands are built-in tools available on Meterpreter. They will run on the target system without loading any additional script or executable files.</p><p>Meterpreter will provide you with three primary categories of tools;</p><ul><li>Built-in commands</li><li>Meterpreter tools</li><li>Meterpreter scripting</li></ul><p>If you run the help command, you will see Meterpreter commands are listed under different categories.</p><ul><li>Core commands</li><li>File system commands</li><li>Networking commands</li><li>System commands</li><li>User interface commands</li><li>Webcam commands</li><li>Audio output commands</li><li>Elevate commands</li><li>Password database commands</li><li>Timestomp commands</li></ul><p>Please note that the list above was taken from the output of the help command on the Windows version of Meterpreter (windows/x64/meterpreter/reverse_tcp). These will be different for other Meterpreter versions.</p><p><strong>Meterpreter commands</strong></p><p>Core commands will be helpful to navigate and interact with the target system. Below are some of the most commonly used. Remember to check all available commands running the help command once a Meterpreter session has started.</p><p><img alt=img loading=lazy src=https://i.imgur.com/i6PE07E.png></p><p><img alt=img loading=lazy src=https://i.imgur.com/4UXBvSa.png></p><p><img alt=img loading=lazy src=https://i.imgur.com/OI9ZyWU.png></p><p><img alt=img loading=lazy src=https://i.imgur.com/d4R3Msa.png></p><p><img alt=img loading=lazy src=https://i.imgur.com/PMCCw4Q.png></p><p>Although all these commands may seem available under the help menu, they may not all work. For example, the target system might not have a webcam, or it can be running on a virtual machine without a proper desktop environment.</p><hr><h2 id=task-04post-exploitation-with-meterpreter>Task 04:Post-Exploitation with Meterpreter<a hidden class=anchor aria-hidden=true href=#task-04post-exploitation-with-meterpreter>#</a></h2><p>Meterpreter provides you with many useful commands that facilitate the post-exploitation phase. Below are a few examples you will often use.</p><p><strong>Help</strong></p><p>This command will give you a list of all available commands in Meterpreter. As we have seen earlier, Meterpreter has many versions, and each version may have different options available. Typing help once you have a Meterpreter session will help you quickly browse through available commands.</p><p><img alt=img loading=lazy src=https://i.imgur.com/xgwYFkq.png></p><p><strong>Meterpreter commands</strong></p><p>The <code>getuid</code> command will display the user with which Meterpreter is currently running. This will give you an idea of your possible privilege level on the target system (e.g. Are you an admin level user like NT AUTHORITY\SYSTEM or a regular user?)</p><p><img alt=img loading=lazy src=https://i.imgur.com/Nf8tlhg.png></p><p>The <code>ps</code> command will list running processes. The PID column will also give you the PID information you will need to migrate Meterpreter to another process.</p><p><img alt=img loading=lazy src=https://i.imgur.com/jkkHTqY.png></p><p><strong>Migrate</strong></p><p>Migrating to another process will help Meterpreter interact with it. For example, if you see a word processor running on the target (e.g. word.exe, notepad.exe, etc.), you can migrate to it and start capturing keystrokes sent by the user to this process. Some Meterpreter versions will offer you the keyscan_start, keyscan_stop, and keyscan_dump command options to make Meterpreter act like a keylogger. Migrating to another process may also help you to have a more stable Meterpreter session.</p><p>To migrate to any process, you need to type the migrate command followed by the PID of the desired target process. The example below shows Meterpreter migrating to process ID 716.</p><p><img alt=img loading=lazy src=https://i.imgur.com/HCbgCa0.png></p><p>Be careful; you may lose your user privileges if you migrate from a higher privileged (e.g. SYSTEM) user to a process started by a lower privileged user (e.g. webserver). You may not be able to gain them back.</p><p><strong>Hashdump</strong></p><p>The hashdump command will list the content of the SAM database. The SAM (Security Account Manager) database stores user&rsquo;s passwords on Windows systems. These passwords are stored in the NTLM (New Technology LAN Manager) format.</p><p><img alt=img loading=lazy src=https://i.imgur.com/gd6z17M.png></p><p>While it is not mathematically possible to &ldquo;crack&rdquo; these hashes, you may still discover the cleartext password using online NTLM databases or a rainbow table attack. These hashes can also be used in Pass-the-Hash attacks to authenticate to other systems that these users can access the same network.</p><p><strong>Search</strong></p><p>The search command is useful to locate files with potentially juicy information. In a CTF context, this can be used to quickly find a flag or proof file, while in actual penetration testing engagements, you may need to search for user-generated files or configuration files that may contain password or account information.</p><p><img alt=img loading=lazy src=https://i.imgur.com/khrkqrL.png></p><p><strong>Shell</strong></p><p>The shell command will launch a regular command-line shell on the target system. Pressing CTRL+Z will help you go back to the Meterpreter shell.</p><p><img alt=img loading=lazy src=https://i.imgur.com/aqVpbNJ.png></p><hr><h2 id=task-05-post-exploitation-challenge>Task 05: Post-Exploitation Challenge<a hidden class=anchor aria-hidden=true href=#task-05-post-exploitation-challenge>#</a></h2><p>Meterpreter provides several important post-exploitation tools.</p><p>Commands mentioned previously, such as getsystem and hashdump will provide important leverage and information for privilege escalation and lateral movement. Meterpreter is also a good base you can use to run post-exploitation modules available on the Metasploit framework. Finally, you can also use the load command to leverage additional tools such as Kiwi or even the whole Python language.</p><p><img alt=img loading=lazy src=https://i.imgur.com/DIg3D5y.png></p><p>The post-exploitation phase will have several goals; Meterpreter has functions that can assist all of them.</p><ul><li>Gathering further information about the target system.</li><li>Looking for interesting files, user credentials, additional network interfaces, and generally interesting information on the target system.</li><li>Privilege escalation.</li><li>Lateral movement.</li></ul><p>Once any additional tool is loaded using the load command, you will see new options on the help menu. The example below shows commands added for the Kiwi module (using the load kiwi command).</p><p><img alt=img loading=lazy src=https://i.imgur.com/ZY1kcrj.png></p><p>These will change according to the loaded menu, so running the help command after loading a module is always a good idea.</p><p><img alt=img loading=lazy src=https://i.imgur.com/tzVhPqy.png></p><h3 id=answer-the-questions-below>Answer the questions below<a hidden class=anchor aria-hidden=true href=#answer-the-questions-below>#</a></h3><table><thead><tr><th>question</th><th>ans</th></tr></thead><tbody><tr><td>What is the computer name?</td><td><a href=#1-sysinfo>5.1</a></td></tr><tr><td>What is the target domain?</td><td><a href=#1-sysinfo>5.1</a></td></tr><tr><td>What is the name of the share likely created by the user?</td><td><a href=#3>5.3</a></td></tr><tr><td>What is the NTLM hash of the jchambers user?</td><td><a href=#4>5.4</a></td></tr><tr><td>What is the cleartext password of the jchambers user?</td><td><a href=#5>5.5</a></td></tr><tr><td>Where is the &ldquo;secrets.txt&rdquo; file located?</td><td><a href=#6>5.6</a></td></tr><tr><td>What is the Twitter password revealed in the &ldquo;secrets.txt&rdquo; file?</td><td><a href=#6>5.6</a></td></tr><tr><td>Where is the &ldquo;realsecret.txt&rdquo; file located?</td><td><a href=#8>5.7</a></td></tr><tr><td>What is the real secret?</td><td><a href=#8>5.8</a></td></tr></tbody></table><h2 id=solutions>solutions<a hidden class=anchor aria-hidden=true href=#solutions>#</a></h2><h3 id=1-sysinfo>1 sysinfo<a hidden class=anchor aria-hidden=true href=#1-sysinfo>#</a></h3><p><img alt=img loading=lazy src=https://i.imgur.com/vLx7TvS.png></p><h3 id=3>3<a hidden class=anchor aria-hidden=true href=#3>#</a></h3><ul><li><p>run this post exploit <code>post/windows/gather/enum_shares</code></p><p><img alt=img loading=lazy src=https://i.imgur.com/bZUmBgH.png></p></li></ul><h3 id=4>4<a hidden class=anchor aria-hidden=true href=#4>#</a></h3><ul><li><p>You will need to migrate to the &ldquo;lsass.exe&rdquo; process first</p></li><li><p>run <code>ps | grep lsass</code> to find the PID</p></li><li><p>migrration</p><p><img alt=img loading=lazy src=https://i.imgur.com/rLs9H9k.png></p></li><li><p>hashes</p><p><img alt=img loading=lazy src=https://i.imgur.com/8ewXMTD.png></p></li></ul><h3 id=5>5<a hidden class=anchor aria-hidden=true href=#5>#</a></h3><ul><li>goto <code>crackstation.net</code> and find the password</li></ul><h3 id=6>6<a hidden class=anchor aria-hidden=true href=#6>#</a></h3><ul><li><p>run this command in <code>meterpreter > search -f *.txt</code></p></li><li><p>results</p><p><img alt=img loading=lazy src=https://i.imgur.com/FNcOAwE.png></p></li></ul><h3 id=8>8<a hidden class=anchor aria-hidden=true href=#8>#</a></h3><ul><li><p>run this command in <code>search -f realsecret.txt</code></p></li><li><p>results</p><p><img alt=img loading=lazy src=https://i.imgur.com/Fu0OQJa.png></p></li></ul><hr><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><p><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-3526678290068011 data-ad-slot=7160066188></ins></p><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><script data-name=BMC-Widget data-cfasync=false src=https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js data-id=anir0y data-description="Support me on Buy me a coffee!" data-message data-color=#5F7FFF data-position=Right data-x_margin=18 data-y_margin=18></script></div><footer class=post-footer><ul class=post-tags><li><a href=https://classroom.anir0y.in/tags/tryhackme/>Tryhackme</a></li></ul><nav class=paginav><a class=prev href=https://classroom.anir0y.in/post/ref-do/><span class=title>« Prev</span><br><span>DigitalOcean Account Setup</span>
</a><a class=next href=https://classroom.anir0y.in/post/tryhackme-exploitingavulnerabilityv2.md/><span class=title>Next »</span><br><span>Try Hack Me Exploit Vulnerabilities</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe Metasploit Meterpreter on x" href="https://x.com/intent/tweet/?text=TryHackMe%20Metasploit%20Meterpreter&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f&amp;hashtags=tryhackme"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe Metasploit Meterpreter on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f&amp;title=TryHackMe%20Metasploit%20Meterpreter&amp;summary=TryHackMe%20Metasploit%20Meterpreter&amp;source=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe Metasploit Meterpreter on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f&title=TryHackMe%20Metasploit%20Meterpreter"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe Metasploit Meterpreter on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe Metasploit Meterpreter on whatsapp" href="https://api.whatsapp.com/send?text=TryHackMe%20Metasploit%20Meterpreter%20-%20https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe Metasploit Meterpreter on telegram" href="https://telegram.me/share/url?text=TryHackMe%20Metasploit%20Meterpreter&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share TryHackMe Metasploit Meterpreter on ycombinator" href="https://news.ycombinator.com/submitlink?t=TryHackMe%20Metasploit%20Meterpreter&u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2ftryhackme-meterpreter%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>YOU CAN REUSE MY CONTENT</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>